# Floor Planner 개발기

이사 준비하다가 만든 웹 평면도 도구. 가구 배치 시뮬레이션용.

---

## 프로젝트

- **기술**: Nuxt 3, vue-konva, Pinia, TailwindCSS
- **테스트**: Vitest 170개 + Playwright E2E 39개
- **배포**: https://mcu2cloud.kr/floor-planner/

---

## 쓸 거

삽질한 순서대로. 실제로 막혔던 것들 위주.

### 1. 왜 만들게 됐나

- 이사 앞두고 가구 배치 고민
- 기존 도구들 불편 (유료, 무거움, 복잡)
- 그냥 만들자

### 2. 캔버스 라이브러리 선택

- Fabric.js vs Konva vs PixiJS
- vue-konva 선택 이유
- Canvas API 직접 쓸까 고민했던 것

### 3. 좌표계 삽질

- 스크린 좌표 vs 캔버스 좌표 vs 실제 치수(cm)
- 줌할 때 좌표 변환
- 마우스 위치 계산이 왜 자꾸 틀리나

### 4. 무한 그리드

- 처음엔 선 수천 개 그렸다가 렉
- viewport 영역만 그리기
- 줌 레벨별 그리드 간격

### 5. 줌/팬

- 휠 줌 + 마우스 드래그 팬
- 줌 중심점 맞추기 (마우스 위치 기준)
- 모바일 핀치 줌 미지원 (귀찮음)

### 6. 가구 시스템

- 10종 가구 (침대, 책상, 의자, 소파...)
- 타입별 기본값
- 드래그 앤 드롭 배치

### 7. 다양한 모양

- 사각형, 원형, 타원형까지는 쉬움
- L자형에서 멘붕
- Path로 그리기, 가로/세로 비율 독립 조절

### 8. Konva Transformer

- 리사이즈 핸들 붙이기
- 종횡비 유지 옵션
- 회전 핸들

### 9. 회전된 객체

- 회전하면 바운딩 박스가 이상해짐
- 충돌 감지 어떻게?
- 결국 AABB로 타협

### 10. 문 시스템

- 벽에 붙어야 함 (스냅)
- 열림 방향, 경첩 위치
- 호(arc) 그리기 각도 계산

### 11. 측정 도구

- 두 점 클릭해서 거리 측정
- 모드 토글 (일반/측정)
- cm 단위 표시

### 12. 키보드 단축키

- R(회전), Delete(삭제), Enter(편집)
- Ctrl+Z/Y (Undo/Redo)
- 포커스 관리 삽질

### 13. Undo/Redo

- Command 패턴
- 깊은 복사 vs 얕은 복사
- 히스토리 크기 제한

### 14. 이미지 업로드

- 평면도 사진 배경으로
- 투명도/크기 조절
- 잠금 기능 (실수로 움직이지 않게)

### 15. 저장/불러오기

- LocalStorage 사용
- JSON 직렬화
- Konva 노드 → 순수 데이터 변환

### 16. PNG 내보내기

- Konva.Stage.toDataURL()
- 해상도 설정
- 배경색 처리

### 17. Vitest로 Konva 테스트

- 캔버스 모킹 어떻게?
- jsdom에서 Canvas 안 됨
- 이벤트 시뮬레이션

### 18. Playwright E2E

- 캔버스 요소 어떻게 선택?
- data-testid 붙이기
- 드래그 테스트

### 19. 성능 최적화

- 레이어 분리
- batchDraw 활용
- 불필요한 리렌더링 방지

### 20. Vue Reactivity + Konva 충돌

- ref()로 Konva 노드 감싸면 안 됨
- shallowRef 써야 함
- 왜 갑자기 느려지나 했더니

---

## 진행 상황

```
프로젝트 셋업     ✅
캔버스 기본       ✅
가구 시스템       ✅
문 시스템         ✅
도구들           ✅
테스트           ✅ (209개)
배포             ✅

글 작성          0/20
```

---

## 메모

- BMS, Ghidra 시리즈 끝나면 시작
- 프론트엔드 개발자 타겟
- 캔버스 + Vue 조합 경험 공유
