---
title: "AD7280A BMS 개발기 #26 - 현장 트러블슈팅"
date: 2024-12-13
draft: false
tags: ["AD7280A", "BMS", "STM32", "트러블슈팅", "디버깅"]
categories: ["BMS 개발"]
series: ["AD7280A BMS 개발"]
summary: "현장에서 만난 문제들. 실험실에서는 안 생기던 것들이 생긴다."
---

실험실에서 잘 되던 게 현장에 가면 안 된다. 몇 가지 사례를 정리한다.

---

**Case 1: 모터 시작하면 통신 끊김**

모터가 돌기 시작하면 BMS 통신이 끊겼다. 몇 초 후에 복구되긴 하는데 불안했다.

원인: 모터 시작 시 대전류(200A+)가 흘러서 배터리 전압이 순간적으로 떨어졌다. 72V → 65V. AD7280A VDD도 같이 떨어지면서 IC가 리셋됐다.

해결: 
- AD7280A 전원단에 100µF 벌크 캡 추가
- 통신 실패 시 재시도 로직 추가

---

**Case 2: 온도가 -40°C로 나옴**

여름인데 온도가 -40°C로 표시됐다.

원인: NTC 서미스터 단선. ADC 값이 4095 (풀업 저항만 측정됨).

해결:
```c
if (adc_value > 4000) {
    // 단선으로 판단
    temp = TEMP_SENSOR_ERROR;
}
```

---

**Case 3: 밸런싱이 안 됨**

밸런싱 ON 했는데 전류가 안 흘렀다.

원인: CB_TIMER 설정을 안 했다. 레지스터에 값은 써지는데 타이머가 0이라 바로 꺼졌다.

해결: CONTROL_HB에 CB_TIMER 설정 추가.

---

**Case 4: CAN 메시지가 간헐적으로 안 옴**

BMS → 인버터 CAN 통신이 가끔 끊겼다.

원인: CAN 버스 종단저항이 한쪽만 있었다. 반사파 때문에 통신 에러.

해결: 양쪽에 120Ω 종단저항 설치. (총 60Ω이 되어야 정상)

---

**Case 5: 부팅하면 가끔 리셋됨**

전원 넣으면 30% 확률로 리셋이 반복됐다.

원인: IWDG(와치독) 타임아웃. AD7280A 초기화가 오래 걸리는데 와치독이 먼저 터졌다.

해결: 초기화 중에 IWDG_Refresh() 추가.

---

트러블슈팅 팁:
1. 로그를 많이 남겨라
2. 현상이 재현되면 반은 해결된 거다
3. 오실로스코프는 친구다

---

다음 글에서 EMC 대응을 다룬다.

[#27 - EMC 대응](/posts/bms/ad7280a-bms-dev-27/)
