# AD7280A BMS 개발 삽질기 시리즈 기획

## 프로젝트 개요

- **목표**: AD7280A를 이용한 리튬 배터리 BMS 개발 경험 공유
- **타겟 MCU**: STM32F103
- **배터리**: 24S LiFePO4 (72V, 4개 디바이스)
- **총 셀 수**: 24셀 (6셀 × 4 디바이스)

---

## Part 1: 기초편 ✅

| # | 제목 | 핵심 내용 | 상태 |
|---|------|----------|------|
| 1 | AD7280A가 뭔가요? | IC 소개, 6셀 모니터링, 특징 | ✅ 완료 |
| 2 | 데이지체인의 마법 | 다중 디바이스 연결, 최대 8개 스택 | ✅ 완료 |
| 3 | SPI 통신 기초 | STM32 SPI 설정, 첫 통신 | ✅ 완료 |

## Part 2: 드라이버편 ✅

| # | 제목 | 핵심 내용 | 상태 |
|---|------|----------|------|
| 4 | 레지스터 맵 정복하기 | 주요 레지스터, 구조 이해 | ✅ 완료 |
| 5 | 읽기/쓰기 프레임 구조 | 32비트 프레임, 필드 배치 | ✅ 완료 |
| 6 | CRC 계산의 늪 | CRC-8, 다항식 0x2F, 삽질기 | ✅ 완료 |

## Part 3: 측정편 ✅

| # | 제목 | 핵심 내용 | 상태 |
|---|------|----------|------|
| 7 | 셀 전압 읽기 | 변환 시작, 결과 읽기, mV 변환 | ✅ 완료 |
| 8 | 자가진단 기능 | Self-test, 이상 감지 | ✅ 완료 |
| 9 | 보조 ADC 활용 (온도) | AUX 채널, NTC 연결, 온도 변환 | ✅ 완료 |

## Part 4: 밸런싱편 ✅

| # | 제목 | 핵심 내용 | 상태 |
|---|------|----------|------|
| 10 | 패시브 밸런싱 기초 | 내장 스위치, 방전 저항 선정 | ✅ 완료 |
| 11 | 밸런싱 알고리즘 구현 | 델타 전압 방식, 히스테리시스 | ✅ 완료 |
| 12 | 밸런싱 중 발열 관리 | 열 계산, 체커보드, 듀티 제어 | ✅ 완료 |

## Part 5: 알람 & 보호편 ✅

| # | 제목 | 핵심 내용 | 상태 |
|---|------|----------|------|
| 13 | 과전압/저전압 알람 설정 | OV/UV 레지스터, 6mV 해상도 | ✅ 완료 |
| 14 | Alert 핀 인터럽트 처리 | EXTI 설정, Open Drain, 디바운싱 | ✅ 완료 |
| 15 | 알람 상태 읽기 | Alert Register A/B/C, 비트맵 | ✅ 완료 |
| 16 | 보호 로직 통합 | 상태 머신, FET 제어, 폴트 복구 | ✅ 완료 |

## Part 6: 통신 & 진단편 ✅

| # | 제목 | 핵심 내용 | 상태 |
|---|------|----------|------|
| 17 | CAN 통신 프로토콜 설계 | 메시지 ID, DBC, 데이터 구조 | ✅ 완료 |
| 18 | SOC 추정 기초 | 쿨롱 카운팅, OCV 테이블, 하이브리드 | ✅ 완료 |
| 19 | 데이터 로깅 | Flash 링버퍼, 이벤트/통계 관리 | ✅ 완료 |
| 20 | 진단 인터페이스 | UART CLI, CAN 진단, UDS | ✅ 완료 |

## Part 7: 고급 기능편 ✅

| # | 제목 | 핵심 내용 | 상태 |
|---|------|----------|------|
| 21 | SOH 추정 | 용량/저항 기반, 복합 SOH | ✅ 완료 |
| 22 | 칼만 필터 적용 | SOC 정밀도 향상, EKF | ✅ 완료 |
| 23 | 프리차지 회로 | 돌입 전류 방지, 상태 머신 | ✅ 완료 |
| 24 | 절연 모니터링 | 누설 전류 감지, IMD | ✅ 완료 |

## Part 8: 실전 적용편 ✅

| # | 제목 | 핵심 내용 | 상태 |
|---|------|----------|------|
| 25 | 72V 팩 첫 연결 | 실제 배터리 연동 긴장감 | ✅ 완료 |
| 26 | 현장 트러블슈팅 | 예상 못한 문제들 | ✅ 완료 |
| 27 | EMC 대응 | 노이즈 대책, 필터 설계 | ✅ 완료 |
| 28 | 양산 검사 지그 | EOL 테스트 자동화 | ✅ 완료 |

## Part 9: 하드웨어 설계편 ✅

| # | 제목 | 핵심 내용 | 상태 |
|---|------|----------|------|
| 29 | 회로도 설계 팁 | 데이터시트 Figure 29 | ✅ 완료 |
| 30 | PCB 레이아웃 | 고전압 절연, Kelvin 연결 | ✅ 완료 |
| 31 | 부품 선정 | 저항, 커패시터, FET | ✅ 완료 |
| 32 | 제작 및 조립 | 납땜, 검사 | ✅ 완료 |

## 번외편 ✅

| # | 제목 | 핵심 내용 | 상태 |
|---|------|----------|------|
| B1 | AD7280A 단종 이야기 | NRND, 후속 ADBMS 시리즈 | ✅ 완료 |
| B2 | Linux IIO 드라이버 분석 | 커널 코드 리딩 | ✅ 완료 |
| B3 | 중국산 BMS IC 비교 | 가성비 대안 검토 | ✅ 완료 |
| B4 | 14S→24S 변환기 | NMC→LFP 전환 경험 | ✅ 완료 |

---

## 진행 현황

```
Part 1: 기초편           [████████████] 3/3  ✅
Part 2: 드라이버편        [████████████] 3/3  ✅
Part 3: 측정편           [████████████] 3/3  ✅
Part 4: 밸런싱편         [████████████] 3/3  ✅
Part 5: 알람 & 보호편     [████████████] 4/4  ✅
Part 6: 통신 & 진단편     [████████████] 4/4  ✅
Part 7: 고급 기능편       [████████████] 4/4  ✅
Part 8: 실전 적용편       [████████████] 4/4  ✅
Part 9: 하드웨어 설계편   [████████████] 4/4  ✅
번외편                   [████████████] 4/4  ✅

총 진행: 36/36 (100%) 🎉 완료!
```

---

## 기술 스택

| 항목 | 내용 |
|------|------|
| MCU | STM32F103VE |
| BMS IC | AD7280A × 4 |
| 배터리 | 24S LiFePO4 (72V) |
| 통신 | SPI (AD7280A), CAN (외부) |
| IDE | STM32CubeIDE |
| 디버깅 | ST-Link, Logic Analyzer |

---

## 시리즈 요약

### Part 1~3: 기초 다지기
- AD7280A 이해, 데이지체인, SPI 통신
- 레지스터, 프레임 구조, CRC
- 셀 전압/온도 측정

### Part 4~6: 핵심 기능
- 패시브 밸런싱, 발열 관리
- OV/UV 알람, Alert 처리, 보호 로직
- CAN 통신, SOC 추정, 데이터 로깅

### Part 7~8: 고급/실전
- SOH, 칼만 필터, 프리차지, 절연 모니터링
- 실제 팩 연결, 트러블슈팅, EMC, 양산 검사

### Part 9: 하드웨어
- 회로도, PCB, 부품, 조립 (스토리 중심)

### 번외편: 실무 이야기
- 단종 대응, 커널 드라이버, 중국산 IC, NMC→LFP 전환

---

## 참고 자료

- [AD7280A Datasheet](https://www.analog.com/media/en/technical-documentation/data-sheets/ad7280a.pdf)
- [EVAL-AD7280AEDZ User Guide (UG-252)](https://www.analog.com/media/en/technical-documentation/user-guides/ug-252.pdf)
- [CN0197 - 리튬이온 배터리 스택 모니터링](https://www.analog.com/en/resources/reference-designs/circuits-from-the-lab/cn0197.html)
- [EngineerZone AD7280A 포럼](https://ez.analog.com)
- [Linux IIO AD7280A Driver](https://elixir.bootlin.com/linux/latest/source/drivers/iio/adc/ad7280a.c)

---

## 메모

- 총 36개 글 (본편 32 + 번외 4)
- **시리즈 완료!** 🎉
- Part 9, 번외편은 스토리 중심으로 작성
