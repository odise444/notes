(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();/**
* @vue/shared v3.5.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function go(n){const t=Object.create(null);for(const e of n.split(","))t[e]=1;return e=>e in t}const Rt={},cn=[],qe=()=>{},xc=()=>!1,Er=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),mo=n=>n.startsWith("onUpdate:"),ce=Object.assign,bo=(n,t)=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)},Hu=Object.prototype.hasOwnProperty,kt=(n,t)=>Hu.call(n,t),mt=Array.isArray,hn=n=>bi(n)==="[object Map]",Cr=n=>bi(n)==="[object Set]",hl=n=>bi(n)==="[object Date]",wt=n=>typeof n=="function",Vt=n=>typeof n=="string",Xe=n=>typeof n=="symbol",Lt=n=>n!==null&&typeof n=="object",Ec=n=>(Lt(n)||wt(n))&&wt(n.then)&&wt(n.catch),Cc=Object.prototype.toString,bi=n=>Cc.call(n),Uu=n=>bi(n).slice(8,-1),kc=n=>bi(n)==="[object Object]",yo=n=>Vt(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,$n=go(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),kr=n=>{const t=Object.create(null);return e=>t[e]||(t[e]=n(e))},Wu=/-\w/g,Es=kr(n=>n.replace(Wu,t=>t.slice(1).toUpperCase())),Gu=/\B([A-Z])/g,Js=kr(n=>n.replace(Gu,"-$1").toLowerCase()),Tc=kr(n=>n.charAt(0).toUpperCase()+n.slice(1)),Zr=kr(n=>n?`on${Tc(n)}`:""),Ss=(n,t)=>!Object.is(n,t),Vi=(n,...t)=>{for(let e=0;e<n.length;e++)n[e](...t)},Pc=(n,t,e,s=!1)=>{Object.defineProperty(n,t,{configurable:!0,enumerable:!1,writable:s,value:e})},Tr=n=>{const t=parseFloat(n);return isNaN(t)?n:t};let ul;const Pr=()=>ul||(ul=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Rr(n){if(mt(n)){const t={};for(let e=0;e<n.length;e++){const s=n[e],i=Vt(s)?Xu(s):Rr(s);if(i)for(const r in i)t[r]=i[r]}return t}else if(Vt(n)||Lt(n))return n}const Vu=/;(?![^(]*\))/g,Ku=/:([^]+)/,qu=/\/\*[^]*?\*\//g;function Xu(n){const t={};return n.replace(qu,"").split(Vu).forEach(e=>{if(e){const s=e.split(Ku);s.length>1&&(t[s[0].trim()]=s[1].trim())}}),t}function yi(n){let t="";if(Vt(n))t=n;else if(mt(n))for(let e=0;e<n.length;e++){const s=yi(n[e]);s&&(t+=s+" ")}else if(Lt(n))for(const e in n)n[e]&&(t+=e+" ");return t.trim()}const Yu="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Zu=go(Yu);function Rc(n){return!!n||n===""}function Ju(n,t){if(n.length!==t.length)return!1;let e=!0;for(let s=0;e&&s<n.length;s++)e=Ir(n[s],t[s]);return e}function Ir(n,t){if(n===t)return!0;let e=hl(n),s=hl(t);if(e||s)return e&&s?n.getTime()===t.getTime():!1;if(e=Xe(n),s=Xe(t),e||s)return n===t;if(e=mt(n),s=mt(t),e||s)return e&&s?Ju(n,t):!1;if(e=Lt(n),s=Lt(t),e||s){if(!e||!s)return!1;const i=Object.keys(n).length,r=Object.keys(t).length;if(i!==r)return!1;for(const a in n){const o=n.hasOwnProperty(a),l=t.hasOwnProperty(a);if(o&&!l||!o&&l||!Ir(n[a],t[a]))return!1}}return String(n)===String(t)}function Qu(n,t){return n.findIndex(e=>Ir(e,t))}const Ic=n=>!!(n&&n.__v_isRef===!0),ls=n=>Vt(n)?n:n==null?"":mt(n)||Lt(n)&&(n.toString===Cc||!wt(n.toString))?Ic(n)?ls(n.value):JSON.stringify(n,Mc,2):String(n),Mc=(n,t)=>Ic(t)?Mc(n,t.value):hn(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[s,i],r)=>(e[Jr(s,r)+" =>"]=i,e),{})}:Cr(t)?{[`Set(${t.size})`]:[...t.values()].map(e=>Jr(e))}:Xe(t)?Jr(t):Lt(t)&&!mt(t)&&!kc(t)?String(t):t,Jr=(n,t="")=>{var e;return Xe(n)?`Symbol(${(e=n.description)!=null?e:t})`:n};/**
* @vue/reactivity v3.5.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let _e;class td{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=_e,!t&&_e&&(this.index=(_e.scopes||(_e.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].pause();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].resume();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].resume()}}run(t){if(this._active){const e=_e;try{return _e=this,t()}finally{_e=e}}}on(){++this._on===1&&(this.prevScope=_e,_e=this)}off(){this._on>0&&--this._on===0&&(_e=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){this._active=!1;let e,s;for(e=0,s=this.effects.length;e<s;e++)this.effects[e].stop();for(this.effects.length=0,e=0,s=this.cleanups.length;e<s;e++)this.cleanups[e]();if(this.cleanups.length=0,this.scopes){for(e=0,s=this.scopes.length;e<s;e++)this.scopes[e].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.parent=void 0}}}function ed(){return _e}let Ot;const Qr=new WeakSet;class Oc{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,_e&&_e.active&&_e.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Qr.has(this)&&(Qr.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Dc(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,dl(this),Fc(this);const t=Ot,e=Fe;Ot=this,Fe=!0;try{return this.fn()}finally{Nc(this),Ot=t,Fe=e,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)wo(t);this.deps=this.depsTail=void 0,dl(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Qr.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Aa(this)&&this.run()}get dirty(){return Aa(this)}}let Lc=0,Hn,Un;function Dc(n,t=!1){if(n.flags|=8,t){n.next=Un,Un=n;return}n.next=Hn,Hn=n}function vo(){Lc++}function _o(){if(--Lc>0)return;if(Un){let t=Un;for(Un=void 0;t;){const e=t.next;t.next=void 0,t.flags&=-9,t=e}}let n;for(;Hn;){let t=Hn;for(Hn=void 0;t;){const e=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(s){n||(n=s)}t=e}}if(n)throw n}function Fc(n){for(let t=n.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function Nc(n){let t,e=n.depsTail,s=e;for(;s;){const i=s.prevDep;s.version===-1?(s===e&&(e=i),wo(s),sd(s)):t=s,s.dep.activeLink=s.prevActiveLink,s.prevActiveLink=void 0,s=i}n.deps=t,n.depsTail=e}function Aa(n){for(let t=n.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(Bc(t.dep.computed)||t.dep.version!==t.version))return!0;return!!n._dirty}function Bc(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===ni)||(n.globalVersion=ni,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!Aa(n))))return;n.flags|=2;const t=n.dep,e=Ot,s=Fe;Ot=n,Fe=!0;try{Fc(n);const i=n.fn(n._value);(t.version===0||Ss(i,n._value))&&(n.flags|=128,n._value=i,t.version++)}catch(i){throw t.version++,i}finally{Ot=e,Fe=s,Nc(n),n.flags&=-3}}function wo(n,t=!1){const{dep:e,prevSub:s,nextSub:i}=n;if(s&&(s.nextSub=i,n.prevSub=void 0),i&&(i.prevSub=s,n.nextSub=void 0),e.subs===n&&(e.subs=s,!s&&e.computed)){e.computed.flags&=-5;for(let r=e.computed.deps;r;r=r.nextDep)wo(r,!0)}!t&&!--e.sc&&e.map&&e.map.delete(e.key)}function sd(n){const{prevDep:t,nextDep:e}=n;t&&(t.nextDep=e,n.prevDep=void 0),e&&(e.prevDep=t,n.nextDep=void 0)}let Fe=!0;const zc=[];function us(){zc.push(Fe),Fe=!1}function ds(){const n=zc.pop();Fe=n===void 0?!0:n}function dl(n){const{cleanup:t}=n;if(n.cleanup=void 0,t){const e=Ot;Ot=void 0;try{t()}finally{Ot=e}}}let ni=0;class nd{constructor(t,e){this.sub=t,this.dep=e,this.version=e.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Ao{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!Ot||!Fe||Ot===this.computed)return;let e=this.activeLink;if(e===void 0||e.sub!==Ot)e=this.activeLink=new nd(Ot,this),Ot.deps?(e.prevDep=Ot.depsTail,Ot.depsTail.nextDep=e,Ot.depsTail=e):Ot.deps=Ot.depsTail=e,jc(e);else if(e.version===-1&&(e.version=this.version,e.nextDep)){const s=e.nextDep;s.prevDep=e.prevDep,e.prevDep&&(e.prevDep.nextDep=s),e.prevDep=Ot.depsTail,e.nextDep=void 0,Ot.depsTail.nextDep=e,Ot.depsTail=e,Ot.deps===e&&(Ot.deps=s)}return e}trigger(t){this.version++,ni++,this.notify(t)}notify(t){vo();try{for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{_o()}}}function jc(n){if(n.dep.sc++,n.sub.flags&4){const t=n.dep.computed;if(t&&!n.dep.subs){t.flags|=20;for(let s=t.deps;s;s=s.nextDep)jc(s)}const e=n.dep.subs;e!==n&&(n.prevSub=e,e&&(e.nextSub=n)),n.dep.subs=n}}const Sa=new WeakMap,Us=Symbol(""),xa=Symbol(""),ii=Symbol("");function ne(n,t,e){if(Fe&&Ot){let s=Sa.get(n);s||Sa.set(n,s=new Map);let i=s.get(e);i||(s.set(e,i=new Ao),i.map=s,i.key=e),i.track()}}function is(n,t,e,s,i,r){const a=Sa.get(n);if(!a){ni++;return}const o=l=>{l&&l.trigger()};if(vo(),t==="clear")a.forEach(o);else{const l=mt(n),c=l&&yo(e);if(l&&e==="length"){const h=Number(s);a.forEach((u,d)=>{(d==="length"||d===ii||!Xe(d)&&d>=h)&&o(u)})}else switch((e!==void 0||a.has(void 0))&&o(a.get(e)),c&&o(a.get(ii)),t){case"add":l?c&&o(a.get("length")):(o(a.get(Us)),hn(n)&&o(a.get(xa)));break;case"delete":l||(o(a.get(Us)),hn(n)&&o(a.get(xa)));break;case"set":hn(n)&&o(a.get(Us));break}}_o()}function en(n){const t=Ct(n);return t===n?t:(ne(t,"iterate",ii),Ie(n)?t:t.map(Be))}function Mr(n){return ne(n=Ct(n),"iterate",ii),n}function bs(n,t){return fs(n)?yn(Ws(n)?Be(t):t):Be(t)}const id={__proto__:null,[Symbol.iterator](){return ta(this,Symbol.iterator,n=>bs(this,n))},concat(...n){return en(this).concat(...n.map(t=>mt(t)?en(t):t))},entries(){return ta(this,"entries",n=>(n[1]=bs(this,n[1]),n))},every(n,t){return Je(this,"every",n,t,void 0,arguments)},filter(n,t){return Je(this,"filter",n,t,e=>e.map(s=>bs(this,s)),arguments)},find(n,t){return Je(this,"find",n,t,e=>bs(this,e),arguments)},findIndex(n,t){return Je(this,"findIndex",n,t,void 0,arguments)},findLast(n,t){return Je(this,"findLast",n,t,e=>bs(this,e),arguments)},findLastIndex(n,t){return Je(this,"findLastIndex",n,t,void 0,arguments)},forEach(n,t){return Je(this,"forEach",n,t,void 0,arguments)},includes(...n){return ea(this,"includes",n)},indexOf(...n){return ea(this,"indexOf",n)},join(n){return en(this).join(n)},lastIndexOf(...n){return ea(this,"lastIndexOf",n)},map(n,t){return Je(this,"map",n,t,void 0,arguments)},pop(){return kn(this,"pop")},push(...n){return kn(this,"push",n)},reduce(n,...t){return fl(this,"reduce",n,t)},reduceRight(n,...t){return fl(this,"reduceRight",n,t)},shift(){return kn(this,"shift")},some(n,t){return Je(this,"some",n,t,void 0,arguments)},splice(...n){return kn(this,"splice",n)},toReversed(){return en(this).toReversed()},toSorted(n){return en(this).toSorted(n)},toSpliced(...n){return en(this).toSpliced(...n)},unshift(...n){return kn(this,"unshift",n)},values(){return ta(this,"values",n=>bs(this,n))}};function ta(n,t,e){const s=Mr(n),i=s[t]();return s!==n&&!Ie(n)&&(i._next=i.next,i.next=()=>{const r=i._next();return r.done||(r.value=e(r.value)),r}),i}const rd=Array.prototype;function Je(n,t,e,s,i,r){const a=Mr(n),o=a!==n&&!Ie(n),l=a[t];if(l!==rd[t]){const u=l.apply(n,r);return o?Be(u):u}let c=e;a!==n&&(o?c=function(u,d){return e.call(this,bs(n,u),d,n)}:e.length>2&&(c=function(u,d){return e.call(this,u,d,n)}));const h=l.call(a,c,s);return o&&i?i(h):h}function fl(n,t,e,s){const i=Mr(n);let r=e;return i!==n&&(Ie(n)?e.length>3&&(r=function(a,o,l){return e.call(this,a,o,l,n)}):r=function(a,o,l){return e.call(this,a,bs(n,o),l,n)}),i[t](r,...s)}function ea(n,t,e){const s=Ct(n);ne(s,"iterate",ii);const i=s[t](...e);return(i===-1||i===!1)&&Co(e[0])?(e[0]=Ct(e[0]),s[t](...e)):i}function kn(n,t,e=[]){us(),vo();const s=Ct(n)[t].apply(n,e);return _o(),ds(),s}const ad=go("__proto__,__v_isRef,__isVue"),$c=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Xe));function od(n){Xe(n)||(n=String(n));const t=Ct(this);return ne(t,"has",n),t.hasOwnProperty(n)}class Hc{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,s){if(e==="__v_skip")return t.__v_skip;const i=this._isReadonly,r=this._isShallow;if(e==="__v_isReactive")return!i;if(e==="__v_isReadonly")return i;if(e==="__v_isShallow")return r;if(e==="__v_raw")return s===(i?r?bd:Vc:r?Gc:Wc).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(s)?t:void 0;const a=mt(t);if(!i){let l;if(a&&(l=id[e]))return l;if(e==="hasOwnProperty")return od}const o=Reflect.get(t,e,le(t)?t:s);if((Xe(e)?$c.has(e):ad(e))||(i||ne(t,"get",e),r))return o;if(le(o)){const l=a&&yo(e)?o:o.value;return i&&Lt(l)?Ca(l):l}return Lt(o)?i?Ca(o):xo(o):o}}class Uc extends Hc{constructor(t=!1){super(!1,t)}set(t,e,s,i){let r=t[e];const a=mt(t)&&yo(e);if(!this._isShallow){const c=fs(r);if(!Ie(s)&&!fs(s)&&(r=Ct(r),s=Ct(s)),!a&&le(r)&&!le(s))return c||(r.value=s),!0}const o=a?Number(e)<t.length:kt(t,e),l=Reflect.set(t,e,s,le(t)?t:i);return t===Ct(i)&&(o?Ss(s,r)&&is(t,"set",e,s):is(t,"add",e,s)),l}deleteProperty(t,e){const s=kt(t,e);t[e];const i=Reflect.deleteProperty(t,e);return i&&s&&is(t,"delete",e,void 0),i}has(t,e){const s=Reflect.has(t,e);return(!Xe(e)||!$c.has(e))&&ne(t,"has",e),s}ownKeys(t){return ne(t,"iterate",mt(t)?"length":Us),Reflect.ownKeys(t)}}class ld extends Hc{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const cd=new Uc,hd=new ld,ud=new Uc(!0);const Ea=n=>n,Ri=n=>Reflect.getPrototypeOf(n);function dd(n,t,e){return function(...s){const i=this.__v_raw,r=Ct(i),a=hn(r),o=n==="entries"||n===Symbol.iterator&&a,l=n==="keys"&&a,c=i[n](...s),h=e?Ea:t?yn:Be;return!t&&ne(r,"iterate",l?xa:Us),ce(Object.create(c),{next(){const{value:u,done:d}=c.next();return d?{value:u,done:d}:{value:o?[h(u[0]),h(u[1])]:h(u),done:d}}})}}function Ii(n){return function(...t){return n==="delete"?!1:n==="clear"?void 0:this}}function fd(n,t){const e={get(i){const r=this.__v_raw,a=Ct(r),o=Ct(i);n||(Ss(i,o)&&ne(a,"get",i),ne(a,"get",o));const{has:l}=Ri(a),c=t?Ea:n?yn:Be;if(l.call(a,i))return c(r.get(i));if(l.call(a,o))return c(r.get(o));r!==a&&r.get(i)},get size(){const i=this.__v_raw;return!n&&ne(Ct(i),"iterate",Us),i.size},has(i){const r=this.__v_raw,a=Ct(r),o=Ct(i);return n||(Ss(i,o)&&ne(a,"has",i),ne(a,"has",o)),i===o?r.has(i):r.has(i)||r.has(o)},forEach(i,r){const a=this,o=a.__v_raw,l=Ct(o),c=t?Ea:n?yn:Be;return!n&&ne(l,"iterate",Us),o.forEach((h,u)=>i.call(r,c(h),c(u),a))}};return ce(e,n?{add:Ii("add"),set:Ii("set"),delete:Ii("delete"),clear:Ii("clear")}:{add(i){!t&&!Ie(i)&&!fs(i)&&(i=Ct(i));const r=Ct(this);return Ri(r).has.call(r,i)||(r.add(i),is(r,"add",i,i)),this},set(i,r){!t&&!Ie(r)&&!fs(r)&&(r=Ct(r));const a=Ct(this),{has:o,get:l}=Ri(a);let c=o.call(a,i);c||(i=Ct(i),c=o.call(a,i));const h=l.call(a,i);return a.set(i,r),c?Ss(r,h)&&is(a,"set",i,r):is(a,"add",i,r),this},delete(i){const r=Ct(this),{has:a,get:o}=Ri(r);let l=a.call(r,i);l||(i=Ct(i),l=a.call(r,i)),o&&o.call(r,i);const c=r.delete(i);return l&&is(r,"delete",i,void 0),c},clear(){const i=Ct(this),r=i.size!==0,a=i.clear();return r&&is(i,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(i=>{e[i]=dd(i,n,t)}),e}function So(n,t){const e=fd(n,t);return(s,i,r)=>i==="__v_isReactive"?!n:i==="__v_isReadonly"?n:i==="__v_raw"?s:Reflect.get(kt(e,i)&&i in s?e:s,i,r)}const pd={get:So(!1,!1)},gd={get:So(!1,!0)},md={get:So(!0,!1)};const Wc=new WeakMap,Gc=new WeakMap,Vc=new WeakMap,bd=new WeakMap;function yd(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function vd(n){return n.__v_skip||!Object.isExtensible(n)?0:yd(Uu(n))}function xo(n){return fs(n)?n:Eo(n,!1,cd,pd,Wc)}function _d(n){return Eo(n,!1,ud,gd,Gc)}function Ca(n){return Eo(n,!0,hd,md,Vc)}function Eo(n,t,e,s,i){if(!Lt(n)||n.__v_raw&&!(t&&n.__v_isReactive))return n;const r=vd(n);if(r===0)return n;const a=i.get(n);if(a)return a;const o=new Proxy(n,r===2?s:e);return i.set(n,o),o}function Ws(n){return fs(n)?Ws(n.__v_raw):!!(n&&n.__v_isReactive)}function fs(n){return!!(n&&n.__v_isReadonly)}function Ie(n){return!!(n&&n.__v_isShallow)}function Co(n){return n?!!n.__v_raw:!1}function Ct(n){const t=n&&n.__v_raw;return t?Ct(t):n}function wd(n){return!kt(n,"__v_skip")&&Object.isExtensible(n)&&Pc(n,"__v_skip",!0),n}const Be=n=>Lt(n)?xo(n):n,yn=n=>Lt(n)?Ca(n):n;function le(n){return n?n.__v_isRef===!0:!1}function Jt(n){return Kc(n,!1)}function Ad(n){return Kc(n,!0)}function Kc(n,t){return le(n)?n:new Sd(n,t)}class Sd{constructor(t,e){this.dep=new Ao,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=e?t:Ct(t),this._value=e?t:Be(t),this.__v_isShallow=e}get value(){return this.dep.track(),this._value}set value(t){const e=this._rawValue,s=this.__v_isShallow||Ie(t)||fs(t);t=s?t:Ct(t),Ss(t,e)&&(this._rawValue=t,this._value=s?t:Be(t),this.dep.trigger())}}function xd(n){return le(n)?n.value:n}const Ed={get:(n,t,e)=>t==="__v_raw"?n:xd(Reflect.get(n,t,e)),set:(n,t,e,s)=>{const i=n[t];return le(i)&&!le(e)?(i.value=e,!0):Reflect.set(n,t,e,s)}};function qc(n){return Ws(n)?n:new Proxy(n,Ed)}class Cd{constructor(t,e,s){this.fn=t,this.setter=e,this._value=void 0,this.dep=new Ao(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=ni-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!e,this.isSSR=s}notify(){if(this.flags|=16,!(this.flags&8)&&Ot!==this)return Dc(this,!0),!0}get value(){const t=this.dep.track();return Bc(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function kd(n,t,e=!1){let s,i;return wt(n)?s=n:(s=n.get,i=n.set),new Cd(s,i,e)}const Mi={},rr=new WeakMap;let zs;function Td(n,t=!1,e=zs){if(e){let s=rr.get(e);s||rr.set(e,s=[]),s.push(n)}}function Pd(n,t,e=Rt){const{immediate:s,deep:i,once:r,scheduler:a,augmentJob:o,call:l}=e,c=A=>i?A:Ie(A)||i===!1||i===0?rs(A,1):rs(A);let h,u,d,f,g=!1,p=!1;if(le(n)?(u=()=>n.value,g=Ie(n)):Ws(n)?(u=()=>c(n),g=!0):mt(n)?(p=!0,g=n.some(A=>Ws(A)||Ie(A)),u=()=>n.map(A=>{if(le(A))return A.value;if(Ws(A))return c(A);if(wt(A))return l?l(A,2):A()})):wt(n)?t?u=l?()=>l(n,2):n:u=()=>{if(d){us();try{d()}finally{ds()}}const A=zs;zs=h;try{return l?l(n,3,[f]):n(f)}finally{zs=A}}:u=qe,t&&i){const A=u,S=i===!0?1/0:i;u=()=>rs(A(),S)}const y=ed(),m=()=>{h.stop(),y&&y.active&&bo(y.effects,h)};if(r&&t){const A=t;t=(...S)=>{A(...S),m()}}let v=p?new Array(n.length).fill(Mi):Mi;const w=A=>{if(!(!(h.flags&1)||!h.dirty&&!A))if(t){const S=h.run();if(i||g||(p?S.some((k,C)=>Ss(k,v[C])):Ss(S,v))){d&&d();const k=zs;zs=h;try{const C=[S,v===Mi?void 0:p&&v[0]===Mi?[]:v,f];v=S,l?l(t,3,C):t(...C)}finally{zs=k}}}else h.run()};return o&&o(w),h=new Oc(u),h.scheduler=a?()=>a(w,!1):w,f=A=>Td(A,!1,h),d=h.onStop=()=>{const A=rr.get(h);if(A){if(l)l(A,4);else for(const S of A)S();rr.delete(h)}},t?s?w(!0):v=h.run():a?a(w.bind(null,!0),!0):h.run(),m.pause=h.pause.bind(h),m.resume=h.resume.bind(h),m.stop=m,m}function rs(n,t=1/0,e){if(t<=0||!Lt(n)||n.__v_skip||(e=e||new Map,(e.get(n)||0)>=t))return n;if(e.set(n,t),t--,le(n))rs(n.value,t,e);else if(mt(n))for(let s=0;s<n.length;s++)rs(n[s],t,e);else if(Cr(n)||hn(n))n.forEach(s=>{rs(s,t,e)});else if(kc(n)){for(const s in n)rs(n[s],t,e);for(const s of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,s)&&rs(n[s],t,e)}return n}/**
* @vue/runtime-core v3.5.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function vi(n,t,e,s){try{return s?n(...s):n()}catch(i){Or(i,t,e)}}function Ye(n,t,e,s){if(wt(n)){const i=vi(n,t,e,s);return i&&Ec(i)&&i.catch(r=>{Or(r,t,e)}),i}if(mt(n)){const i=[];for(let r=0;r<n.length;r++)i.push(Ye(n[r],t,e,s));return i}}function Or(n,t,e,s=!0){const i=t?t.vnode:null,{errorHandler:r,throwUnhandledErrorInProduction:a}=t&&t.appContext.config||Rt;if(t){let o=t.parent;const l=t.proxy,c=`https://vuejs.org/error-reference/#runtime-${e}`;for(;o;){const h=o.ec;if(h){for(let u=0;u<h.length;u++)if(h[u](n,l,c)===!1)return}o=o.parent}if(r){us(),vi(r,null,10,[n,l,c]),ds();return}}Rd(n,e,i,s,a)}function Rd(n,t,e,s=!0,i=!1){if(i)throw n;console.error(n)}const fe=[];let We=-1;const un=[];let ys=null,rn=0;const Xc=Promise.resolve();let ar=null;function ko(n){const t=ar||Xc;return n?t.then(this?n.bind(this):n):t}function Id(n){let t=We+1,e=fe.length;for(;t<e;){const s=t+e>>>1,i=fe[s],r=ri(i);r<n||r===n&&i.flags&2?t=s+1:e=s}return t}function To(n){if(!(n.flags&1)){const t=ri(n),e=fe[fe.length-1];!e||!(n.flags&2)&&t>=ri(e)?fe.push(n):fe.splice(Id(t),0,n),n.flags|=1,Yc()}}function Yc(){ar||(ar=Xc.then(Jc))}function Md(n){mt(n)?un.push(...n):ys&&n.id===-1?ys.splice(rn+1,0,n):n.flags&1||(un.push(n),n.flags|=1),Yc()}function pl(n,t,e=We+1){for(;e<fe.length;e++){const s=fe[e];if(s&&s.flags&2){if(n&&s.id!==n.uid)continue;fe.splice(e,1),e--,s.flags&4&&(s.flags&=-2),s(),s.flags&4||(s.flags&=-2)}}}function Zc(n){if(un.length){const t=[...new Set(un)].sort((e,s)=>ri(e)-ri(s));if(un.length=0,ys){ys.push(...t);return}for(ys=t,rn=0;rn<ys.length;rn++){const e=ys[rn];e.flags&4&&(e.flags&=-2),e.flags&8||e(),e.flags&=-2}ys=null,rn=0}}const ri=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Jc(n){try{for(We=0;We<fe.length;We++){const t=fe[We];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),vi(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;We<fe.length;We++){const t=fe[We];t&&(t.flags&=-2)}We=-1,fe.length=0,Zc(),ar=null,(fe.length||un.length)&&Jc()}}let Re=null,Qc=null;function or(n){const t=Re;return Re=n,Qc=n&&n.type.__scopeId||null,t}function Od(n,t=Re,e){if(!t||n._n)return n;const s=(...i)=>{s._d&&xl(-1);const r=or(t);let a;try{a=n(...i)}finally{or(r),s._d&&xl(1)}return a};return s._n=!0,s._c=!0,s._d=!0,s}function Ln(n,t){if(Re===null)return n;const e=Nr(Re),s=n.dirs||(n.dirs=[]);for(let i=0;i<t.length;i++){let[r,a,o,l=Rt]=t[i];r&&(wt(r)&&(r={mounted:r,updated:r}),r.deep&&rs(a),s.push({dir:r,instance:e,value:a,oldValue:void 0,arg:o,modifiers:l}))}return n}function Ls(n,t,e,s){const i=n.dirs,r=t&&t.dirs;for(let a=0;a<i.length;a++){const o=i[a];r&&(o.oldValue=r[a].value);let l=o.dir[s];l&&(us(),Ye(l,e,8,[n.el,o,n,t]),ds())}}function Ld(n,t){if(pe){let e=pe.provides;const s=pe.parent&&pe.parent.provides;s===e&&(e=pe.provides=Object.create(s)),e[n]=t}}function Ki(n,t,e=!1){const s=Df();if(s||dn){let i=dn?dn._context.provides:s?s.parent==null||s.ce?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:void 0;if(i&&n in i)return i[n];if(arguments.length>1)return e&&wt(t)?t.call(s&&s.proxy):t}}const Dd=Symbol.for("v-scx"),Fd=()=>Ki(Dd);function Wn(n,t,e){return th(n,t,e)}function th(n,t,e=Rt){const{immediate:s,deep:i,flush:r,once:a}=e,o=ce({},e),l=t&&s||!t&&r!=="post";let c;if(oi){if(r==="sync"){const f=Fd();c=f.__watcherHandles||(f.__watcherHandles=[])}else if(!l){const f=()=>{};return f.stop=qe,f.resume=qe,f.pause=qe,f}}const h=pe;o.call=(f,g,p)=>Ye(f,h,g,p);let u=!1;r==="post"?o.scheduler=f=>{Se(f,h&&h.suspense)}:r!=="sync"&&(u=!0,o.scheduler=(f,g)=>{g?f():To(f)}),o.augmentJob=f=>{t&&(f.flags|=4),u&&(f.flags|=2,h&&(f.id=h.uid,f.i=h))};const d=Pd(n,t,o);return oi&&(c?c.push(d):l&&d()),d}function Nd(n,t,e){const s=this.proxy,i=Vt(n)?n.includes(".")?eh(s,n):()=>s[n]:n.bind(s,s);let r;wt(t)?r=t:(r=t.handler,e=t);const a=_i(this),o=th(i,r.bind(s),e);return a(),o}function eh(n,t){const e=t.split(".");return()=>{let s=n;for(let i=0;i<e.length&&s;i++)s=s[e[i]];return s}}const Bd=Symbol("_vte"),zd=n=>n.__isTeleport,jd=Symbol("_leaveCb");function Po(n,t){n.shapeFlag&6&&n.component?(n.transition=t,Po(n.component.subTree,t)):n.shapeFlag&128?(n.ssContent.transition=t.clone(n.ssContent),n.ssFallback.transition=t.clone(n.ssFallback)):n.transition=t}function sh(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}const lr=new WeakMap;function Gn(n,t,e,s,i=!1){if(mt(n)){n.forEach((g,p)=>Gn(g,t&&(mt(t)?t[p]:t),e,s,i));return}if(Vn(s)&&!i){s.shapeFlag&512&&s.type.__asyncResolved&&s.component.subTree.component&&Gn(n,t,e,s.component.subTree);return}const r=s.shapeFlag&4?Nr(s.component):s.el,a=i?null:r,{i:o,r:l}=n,c=t&&t.r,h=o.refs===Rt?o.refs={}:o.refs,u=o.setupState,d=Ct(u),f=u===Rt?xc:g=>kt(d,g);if(c!=null&&c!==l){if(gl(t),Vt(c))h[c]=null,f(c)&&(u[c]=null);else if(le(c)){c.value=null;const g=t;g.k&&(h[g.k]=null)}}if(wt(l))vi(l,o,12,[a,h]);else{const g=Vt(l),p=le(l);if(g||p){const y=()=>{if(n.f){const m=g?f(l)?u[l]:h[l]:l.value;if(i)mt(m)&&bo(m,r);else if(mt(m))m.includes(r)||m.push(r);else if(g)h[l]=[r],f(l)&&(u[l]=h[l]);else{const v=[r];l.value=v,n.k&&(h[n.k]=v)}}else g?(h[l]=a,f(l)&&(u[l]=a)):p&&(l.value=a,n.k&&(h[n.k]=a))};if(a){const m=()=>{y(),lr.delete(n)};m.id=-1,lr.set(n,m),Se(m,e)}else gl(n),y()}}}function gl(n){const t=lr.get(n);t&&(t.flags|=8,lr.delete(n))}Pr().requestIdleCallback;Pr().cancelIdleCallback;const Vn=n=>!!n.type.__asyncLoader,nh=n=>n.type.__isKeepAlive;function $d(n,t){ih(n,"a",t)}function Hd(n,t){ih(n,"da",t)}function ih(n,t,e=pe){const s=n.__wdc||(n.__wdc=()=>{let i=e;for(;i;){if(i.isDeactivated)return;i=i.parent}return n()});if(Lr(t,s,e),e){let i=e.parent;for(;i&&i.parent;)nh(i.parent.vnode)&&Ud(s,t,e,i),i=i.parent}}function Ud(n,t,e,s){const i=Lr(t,n,s,!0);ah(()=>{bo(s[t],i)},e)}function Lr(n,t,e=pe,s=!1){if(e){const i=e[n]||(e[n]=[]),r=t.__weh||(t.__weh=(...a)=>{us();const o=_i(e),l=Ye(t,e,n,a);return o(),ds(),l});return s?i.unshift(r):i.push(r),r}}const gs=n=>(t,e=pe)=>{(!oi||n==="sp")&&Lr(n,(...s)=>t(...s),e)},Wd=gs("bm"),rh=gs("m"),Gd=gs("bu"),Vd=gs("u"),Kd=gs("bum"),ah=gs("um"),qd=gs("sp"),Xd=gs("rtg"),Yd=gs("rtc");function Zd(n,t=pe){Lr("ec",n,t)}const Jd=Symbol.for("v-ndc");function Qd(n,t,e,s){let i;const r=e,a=mt(n);if(a||Vt(n)){const o=a&&Ws(n);let l=!1,c=!1;o&&(l=!Ie(n),c=fs(n),n=Mr(n)),i=new Array(n.length);for(let h=0,u=n.length;h<u;h++)i[h]=t(l?c?yn(Be(n[h])):Be(n[h]):n[h],h,void 0,r)}else if(typeof n=="number"){i=new Array(n);for(let o=0;o<n;o++)i[o]=t(o+1,o,void 0,r)}else if(Lt(n))if(n[Symbol.iterator])i=Array.from(n,(o,l)=>t(o,l,void 0,r));else{const o=Object.keys(n);i=new Array(o.length);for(let l=0,c=o.length;l<c;l++){const h=o[l];i[l]=t(n[h],h,l,r)}}else i=[];return i}const ka=n=>n?Ch(n)?Nr(n):ka(n.parent):null,Kn=ce(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>ka(n.parent),$root:n=>ka(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>lh(n),$forceUpdate:n=>n.f||(n.f=()=>{To(n.update)}),$nextTick:n=>n.n||(n.n=ko.bind(n.proxy)),$watch:n=>Nd.bind(n)}),sa=(n,t)=>n!==Rt&&!n.__isScriptSetup&&kt(n,t),tf={get({_:n},t){if(t==="__v_skip")return!0;const{ctx:e,setupState:s,data:i,props:r,accessCache:a,type:o,appContext:l}=n;if(t[0]!=="$"){const d=a[t];if(d!==void 0)switch(d){case 1:return s[t];case 2:return i[t];case 4:return e[t];case 3:return r[t]}else{if(sa(s,t))return a[t]=1,s[t];if(i!==Rt&&kt(i,t))return a[t]=2,i[t];if(kt(r,t))return a[t]=3,r[t];if(e!==Rt&&kt(e,t))return a[t]=4,e[t];Ta&&(a[t]=0)}}const c=Kn[t];let h,u;if(c)return t==="$attrs"&&ne(n.attrs,"get",""),c(n);if((h=o.__cssModules)&&(h=h[t]))return h;if(e!==Rt&&kt(e,t))return a[t]=4,e[t];if(u=l.config.globalProperties,kt(u,t))return u[t]},set({_:n},t,e){const{data:s,setupState:i,ctx:r}=n;return sa(i,t)?(i[t]=e,!0):s!==Rt&&kt(s,t)?(s[t]=e,!0):kt(n.props,t)||t[0]==="$"&&t.slice(1)in n?!1:(r[t]=e,!0)},has({_:{data:n,setupState:t,accessCache:e,ctx:s,appContext:i,props:r,type:a}},o){let l;return!!(e[o]||n!==Rt&&o[0]!=="$"&&kt(n,o)||sa(t,o)||kt(r,o)||kt(s,o)||kt(Kn,o)||kt(i.config.globalProperties,o)||(l=a.__cssModules)&&l[o])},defineProperty(n,t,e){return e.get!=null?n._.accessCache[t]=0:kt(e,"value")&&this.set(n,t,e.value,null),Reflect.defineProperty(n,t,e)}};function ml(n){return mt(n)?n.reduce((t,e)=>(t[e]=null,t),{}):n}let Ta=!0;function ef(n){const t=lh(n),e=n.proxy,s=n.ctx;Ta=!1,t.beforeCreate&&bl(t.beforeCreate,n,"bc");const{data:i,computed:r,methods:a,watch:o,provide:l,inject:c,created:h,beforeMount:u,mounted:d,beforeUpdate:f,updated:g,activated:p,deactivated:y,beforeDestroy:m,beforeUnmount:v,destroyed:w,unmounted:A,render:S,renderTracked:k,renderTriggered:C,errorCaptured:z,serverPrefetch:T,expose:V,inheritAttrs:Z,components:P,directives:U,filters:_}=t;if(c&&sf(c,s,null),a)for(const L in a){const et=a[L];wt(et)&&(s[L]=et.bind(e))}if(i){const L=i.call(e,e);Lt(L)&&(n.data=xo(L))}if(Ta=!0,r)for(const L in r){const et=r[L],N=wt(et)?et.bind(e,e):wt(et.get)?et.get.bind(e,e):qe,W=!wt(et)&&wt(et.set)?et.set.bind(e):qe,I=Br({get:N,set:W});Object.defineProperty(s,L,{enumerable:!0,configurable:!0,get:()=>I.value,set:D=>I.value=D})}if(o)for(const L in o)oh(o[L],s,e,L);if(l){const L=wt(l)?l.call(e):l;Reflect.ownKeys(L).forEach(et=>{Ld(et,L[et])})}h&&bl(h,n,"c");function Y(L,et){mt(et)?et.forEach(N=>L(N.bind(e))):et&&L(et.bind(e))}if(Y(Wd,u),Y(rh,d),Y(Gd,f),Y(Vd,g),Y($d,p),Y(Hd,y),Y(Zd,z),Y(Yd,k),Y(Xd,C),Y(Kd,v),Y(ah,A),Y(qd,T),mt(V))if(V.length){const L=n.exposed||(n.exposed={});V.forEach(et=>{Object.defineProperty(L,et,{get:()=>e[et],set:N=>e[et]=N,enumerable:!0})})}else n.exposed||(n.exposed={});S&&n.render===qe&&(n.render=S),Z!=null&&(n.inheritAttrs=Z),P&&(n.components=P),U&&(n.directives=U),T&&sh(n)}function sf(n,t,e=qe){mt(n)&&(n=Pa(n));for(const s in n){const i=n[s];let r;Lt(i)?"default"in i?r=Ki(i.from||s,i.default,!0):r=Ki(i.from||s):r=Ki(i),le(r)?Object.defineProperty(t,s,{enumerable:!0,configurable:!0,get:()=>r.value,set:a=>r.value=a}):t[s]=r}}function bl(n,t,e){Ye(mt(n)?n.map(s=>s.bind(t.proxy)):n.bind(t.proxy),t,e)}function oh(n,t,e,s){let i=s.includes(".")?eh(e,s):()=>e[s];if(Vt(n)){const r=t[n];wt(r)&&Wn(i,r)}else if(wt(n))Wn(i,n.bind(e));else if(Lt(n))if(mt(n))n.forEach(r=>oh(r,t,e,s));else{const r=wt(n.handler)?n.handler.bind(e):t[n.handler];wt(r)&&Wn(i,r,n)}}function lh(n){const t=n.type,{mixins:e,extends:s}=t,{mixins:i,optionsCache:r,config:{optionMergeStrategies:a}}=n.appContext,o=r.get(t);let l;return o?l=o:!i.length&&!e&&!s?l=t:(l={},i.length&&i.forEach(c=>cr(l,c,a,!0)),cr(l,t,a)),Lt(t)&&r.set(t,l),l}function cr(n,t,e,s=!1){const{mixins:i,extends:r}=t;r&&cr(n,r,e,!0),i&&i.forEach(a=>cr(n,a,e,!0));for(const a in t)if(!(s&&a==="expose")){const o=nf[a]||e&&e[a];n[a]=o?o(n[a],t[a]):t[a]}return n}const nf={data:yl,props:vl,emits:vl,methods:Dn,computed:Dn,beforeCreate:he,created:he,beforeMount:he,mounted:he,beforeUpdate:he,updated:he,beforeDestroy:he,beforeUnmount:he,destroyed:he,unmounted:he,activated:he,deactivated:he,errorCaptured:he,serverPrefetch:he,components:Dn,directives:Dn,watch:af,provide:yl,inject:rf};function yl(n,t){return t?n?function(){return ce(wt(n)?n.call(this,this):n,wt(t)?t.call(this,this):t)}:t:n}function rf(n,t){return Dn(Pa(n),Pa(t))}function Pa(n){if(mt(n)){const t={};for(let e=0;e<n.length;e++)t[n[e]]=n[e];return t}return n}function he(n,t){return n?[...new Set([].concat(n,t))]:t}function Dn(n,t){return n?ce(Object.create(null),n,t):t}function vl(n,t){return n?mt(n)&&mt(t)?[...new Set([...n,...t])]:ce(Object.create(null),ml(n),ml(t??{})):t}function af(n,t){if(!n)return t;if(!t)return n;const e=ce(Object.create(null),n);for(const s in t)e[s]=he(n[s],t[s]);return e}function ch(){return{app:null,config:{isNativeTag:xc,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let of=0;function lf(n,t){return function(s,i=null){wt(s)||(s=ce({},s)),i!=null&&!Lt(i)&&(i=null);const r=ch(),a=new WeakSet,o=[];let l=!1;const c=r.app={_uid:of++,_component:s,_props:i,_container:null,_context:r,_instance:null,version:$f,get config(){return r.config},set config(h){},use(h,...u){return a.has(h)||(h&&wt(h.install)?(a.add(h),h.install(c,...u)):wt(h)&&(a.add(h),h(c,...u))),c},mixin(h){return r.mixins.includes(h)||r.mixins.push(h),c},component(h,u){return u?(r.components[h]=u,c):r.components[h]},directive(h,u){return u?(r.directives[h]=u,c):r.directives[h]},mount(h,u,d){if(!l){const f=c._ceVNode||Me(s,i);return f.appContext=r,d===!0?d="svg":d===!1&&(d=void 0),n(f,h,d),l=!0,c._container=h,h.__vue_app__=c,Nr(f.component)}},onUnmount(h){o.push(h)},unmount(){l&&(Ye(o,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(h,u){return r.provides[h]=u,c},runWithContext(h){const u=dn;dn=c;try{return h()}finally{dn=u}}};return c}}let dn=null;const cf=(n,t)=>t==="modelValue"||t==="model-value"?n.modelModifiers:n[`${t}Modifiers`]||n[`${Es(t)}Modifiers`]||n[`${Js(t)}Modifiers`];function hf(n,t,...e){if(n.isUnmounted)return;const s=n.vnode.props||Rt;let i=e;const r=t.startsWith("update:"),a=r&&cf(s,t.slice(7));a&&(a.trim&&(i=e.map(h=>Vt(h)?h.trim():h)),a.number&&(i=e.map(Tr)));let o,l=s[o=Zr(t)]||s[o=Zr(Es(t))];!l&&r&&(l=s[o=Zr(Js(t))]),l&&Ye(l,n,6,i);const c=s[o+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[o])return;n.emitted[o]=!0,Ye(c,n,6,i)}}const uf=new WeakMap;function hh(n,t,e=!1){const s=e?uf:t.emitsCache,i=s.get(n);if(i!==void 0)return i;const r=n.emits;let a={},o=!1;if(!wt(n)){const l=c=>{const h=hh(c,t,!0);h&&(o=!0,ce(a,h))};!e&&t.mixins.length&&t.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!r&&!o?(Lt(n)&&s.set(n,null),null):(mt(r)?r.forEach(l=>a[l]=null):ce(a,r),Lt(n)&&s.set(n,a),a)}function Dr(n,t){return!n||!Er(t)?!1:(t=t.slice(2).replace(/Once$/,""),kt(n,t[0].toLowerCase()+t.slice(1))||kt(n,Js(t))||kt(n,t))}function _l(n){const{type:t,vnode:e,proxy:s,withProxy:i,propsOptions:[r],slots:a,attrs:o,emit:l,render:c,renderCache:h,props:u,data:d,setupState:f,ctx:g,inheritAttrs:p}=n,y=or(n);let m,v;try{if(e.shapeFlag&4){const A=i||s,S=A;m=Ke(c.call(S,A,h,u,f,d,g)),v=o}else{const A=t;m=Ke(A.length>1?A(u,{attrs:o,slots:a,emit:l}):A(u,null)),v=t.props?o:df(o)}}catch(A){qn.length=0,Or(A,n,1),m=Me(Cs)}let w=m;if(v&&p!==!1){const A=Object.keys(v),{shapeFlag:S}=w;A.length&&S&7&&(r&&A.some(mo)&&(v=ff(v,r)),w=vn(w,v,!1,!0))}return e.dirs&&(w=vn(w,null,!1,!0),w.dirs=w.dirs?w.dirs.concat(e.dirs):e.dirs),e.transition&&Po(w,e.transition),m=w,or(y),m}const df=n=>{let t;for(const e in n)(e==="class"||e==="style"||Er(e))&&((t||(t={}))[e]=n[e]);return t},ff=(n,t)=>{const e={};for(const s in n)(!mo(s)||!(s.slice(9)in t))&&(e[s]=n[s]);return e};function pf(n,t,e){const{props:s,children:i,component:r}=n,{props:a,children:o,patchFlag:l}=t,c=r.emitsOptions;if(t.dirs||t.transition)return!0;if(e&&l>=0){if(l&1024)return!0;if(l&16)return s?wl(s,a,c):!!a;if(l&8){const h=t.dynamicProps;for(let u=0;u<h.length;u++){const d=h[u];if(a[d]!==s[d]&&!Dr(c,d))return!0}}}else return(i||o)&&(!o||!o.$stable)?!0:s===a?!1:s?a?wl(s,a,c):!0:!!a;return!1}function wl(n,t,e){const s=Object.keys(t);if(s.length!==Object.keys(n).length)return!0;for(let i=0;i<s.length;i++){const r=s[i];if(t[r]!==n[r]&&!Dr(e,r))return!0}return!1}function gf({vnode:n,parent:t},e){for(;t;){const s=t.subTree;if(s.suspense&&s.suspense.activeBranch===n&&(s.el=n.el),s===n)(n=t.vnode).el=e,t=t.parent;else break}}const uh={},dh=()=>Object.create(uh),fh=n=>Object.getPrototypeOf(n)===uh;function mf(n,t,e,s=!1){const i={},r=dh();n.propsDefaults=Object.create(null),ph(n,t,i,r);for(const a in n.propsOptions[0])a in i||(i[a]=void 0);e?n.props=s?i:_d(i):n.type.props?n.props=i:n.props=r,n.attrs=r}function bf(n,t,e,s){const{props:i,attrs:r,vnode:{patchFlag:a}}=n,o=Ct(i),[l]=n.propsOptions;let c=!1;if((s||a>0)&&!(a&16)){if(a&8){const h=n.vnode.dynamicProps;for(let u=0;u<h.length;u++){let d=h[u];if(Dr(n.emitsOptions,d))continue;const f=t[d];if(l)if(kt(r,d))f!==r[d]&&(r[d]=f,c=!0);else{const g=Es(d);i[g]=Ra(l,o,g,f,n,!1)}else f!==r[d]&&(r[d]=f,c=!0)}}}else{ph(n,t,i,r)&&(c=!0);let h;for(const u in o)(!t||!kt(t,u)&&((h=Js(u))===u||!kt(t,h)))&&(l?e&&(e[u]!==void 0||e[h]!==void 0)&&(i[u]=Ra(l,o,u,void 0,n,!0)):delete i[u]);if(r!==o)for(const u in r)(!t||!kt(t,u))&&(delete r[u],c=!0)}c&&is(n.attrs,"set","")}function ph(n,t,e,s){const[i,r]=n.propsOptions;let a=!1,o;if(t)for(let l in t){if($n(l))continue;const c=t[l];let h;i&&kt(i,h=Es(l))?!r||!r.includes(h)?e[h]=c:(o||(o={}))[h]=c:Dr(n.emitsOptions,l)||(!(l in s)||c!==s[l])&&(s[l]=c,a=!0)}if(r){const l=Ct(e),c=o||Rt;for(let h=0;h<r.length;h++){const u=r[h];e[u]=Ra(i,l,u,c[u],n,!kt(c,u))}}return a}function Ra(n,t,e,s,i,r){const a=n[e];if(a!=null){const o=kt(a,"default");if(o&&s===void 0){const l=a.default;if(a.type!==Function&&!a.skipFactory&&wt(l)){const{propsDefaults:c}=i;if(e in c)s=c[e];else{const h=_i(i);s=c[e]=l.call(null,t),h()}}else s=l;i.ce&&i.ce._setProp(e,s)}a[0]&&(r&&!o?s=!1:a[1]&&(s===""||s===Js(e))&&(s=!0))}return s}const yf=new WeakMap;function gh(n,t,e=!1){const s=e?yf:t.propsCache,i=s.get(n);if(i)return i;const r=n.props,a={},o=[];let l=!1;if(!wt(n)){const h=u=>{l=!0;const[d,f]=gh(u,t,!0);ce(a,d),f&&o.push(...f)};!e&&t.mixins.length&&t.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!r&&!l)return Lt(n)&&s.set(n,cn),cn;if(mt(r))for(let h=0;h<r.length;h++){const u=Es(r[h]);Al(u)&&(a[u]=Rt)}else if(r)for(const h in r){const u=Es(h);if(Al(u)){const d=r[h],f=a[u]=mt(d)||wt(d)?{type:d}:ce({},d),g=f.type;let p=!1,y=!0;if(mt(g))for(let m=0;m<g.length;++m){const v=g[m],w=wt(v)&&v.name;if(w==="Boolean"){p=!0;break}else w==="String"&&(y=!1)}else p=wt(g)&&g.name==="Boolean";f[0]=p,f[1]=y,(p||kt(f,"default"))&&o.push(u)}}const c=[a,o];return Lt(n)&&s.set(n,c),c}function Al(n){return n[0]!=="$"&&!$n(n)}const Ro=n=>n==="_"||n==="_ctx"||n==="$stable",Io=n=>mt(n)?n.map(Ke):[Ke(n)],vf=(n,t,e)=>{if(t._n)return t;const s=Od((...i)=>Io(t(...i)),e);return s._c=!1,s},mh=(n,t,e)=>{const s=n._ctx;for(const i in n){if(Ro(i))continue;const r=n[i];if(wt(r))t[i]=vf(i,r,s);else if(r!=null){const a=Io(r);t[i]=()=>a}}},bh=(n,t)=>{const e=Io(t);n.slots.default=()=>e},yh=(n,t,e)=>{for(const s in t)(e||!Ro(s))&&(n[s]=t[s])},_f=(n,t,e)=>{const s=n.slots=dh();if(n.vnode.shapeFlag&32){const i=t._;i?(yh(s,t,e),e&&Pc(s,"_",i,!0)):mh(t,s)}else t&&bh(n,t)},wf=(n,t,e)=>{const{vnode:s,slots:i}=n;let r=!0,a=Rt;if(s.shapeFlag&32){const o=t._;o?e&&o===1?r=!1:yh(i,t,e):(r=!t.$stable,mh(t,i)),a=t}else t&&(bh(n,t),a={default:1});if(r)for(const o in i)!Ro(o)&&a[o]==null&&delete i[o]},Se=Cf;function Af(n){return Sf(n)}function Sf(n,t){const e=Pr();e.__VUE__=!0;const{insert:s,remove:i,patchProp:r,createElement:a,createText:o,createComment:l,setText:c,setElementText:h,parentNode:u,nextSibling:d,setScopeId:f=qe,insertStaticContent:g}=n,p=(M,$,b,F=null,O=null,x=null,E=void 0,R=null,H=!!$.dynamicChildren)=>{if(M===$)return;M&&!Tn(M,$)&&(F=nt(M),D(M,O,x,!0),M=null),$.patchFlag===-2&&(H=!1,$.dynamicChildren=null);const{type:j,ref:B,shapeFlag:K}=$;switch(j){case Fr:y(M,$,b,F);break;case Cs:m(M,$,b,F);break;case ia:M==null&&v($,b,F,E);break;case De:P(M,$,b,F,O,x,E,R,H);break;default:K&1?S(M,$,b,F,O,x,E,R,H):K&6?U(M,$,b,F,O,x,E,R,H):(K&64||K&128)&&j.process(M,$,b,F,O,x,E,R,H,St)}B!=null&&O?Gn(B,M&&M.ref,x,$||M,!$):B==null&&M&&M.ref!=null&&Gn(M.ref,null,x,M,!0)},y=(M,$,b,F)=>{if(M==null)s($.el=o($.children),b,F);else{const O=$.el=M.el;$.children!==M.children&&c(O,$.children)}},m=(M,$,b,F)=>{M==null?s($.el=l($.children||""),b,F):$.el=M.el},v=(M,$,b,F)=>{[M.el,M.anchor]=g(M.children,$,b,F,M.el,M.anchor)},w=({el:M,anchor:$},b,F)=>{let O;for(;M&&M!==$;)O=d(M),s(M,b,F),M=O;s($,b,F)},A=({el:M,anchor:$})=>{let b;for(;M&&M!==$;)b=d(M),i(M),M=b;i($)},S=(M,$,b,F,O,x,E,R,H)=>{if($.type==="svg"?E="svg":$.type==="math"&&(E="mathml"),M==null)k($,b,F,O,x,E,R,H);else{const j=M.el&&M.el._isVueCE?M.el:null;try{j&&j._beginPatch(),T(M,$,O,x,E,R,H)}finally{j&&j._endPatch()}}},k=(M,$,b,F,O,x,E,R)=>{let H,j;const{props:B,shapeFlag:K,transition:Q,dirs:J}=M;if(H=M.el=a(M.type,x,B&&B.is,B),K&8?h(H,M.children):K&16&&z(M.children,H,null,F,O,na(M,x),E,R),J&&Ls(M,null,F,"created"),C(H,M,M.scopeId,E,F),B){for(const ut in B)ut!=="value"&&!$n(ut)&&r(H,ut,null,B[ut],x,F);"value"in B&&r(H,"value",null,B.value,x),(j=B.onVnodeBeforeMount)&&je(j,F,M)}J&&Ls(M,null,F,"beforeMount");const st=xf(O,Q);st&&Q.beforeEnter(H),s(H,$,b),((j=B&&B.onVnodeMounted)||st||J)&&Se(()=>{j&&je(j,F,M),st&&Q.enter(H),J&&Ls(M,null,F,"mounted")},O)},C=(M,$,b,F,O)=>{if(b&&f(M,b),F)for(let x=0;x<F.length;x++)f(M,F[x]);if(O){let x=O.subTree;if($===x||Ah(x.type)&&(x.ssContent===$||x.ssFallback===$)){const E=O.vnode;C(M,E,E.scopeId,E.slotScopeIds,O.parent)}}},z=(M,$,b,F,O,x,E,R,H=0)=>{for(let j=H;j<M.length;j++){const B=M[j]=R?vs(M[j]):Ke(M[j]);p(null,B,$,b,F,O,x,E,R)}},T=(M,$,b,F,O,x,E)=>{const R=$.el=M.el;let{patchFlag:H,dynamicChildren:j,dirs:B}=$;H|=M.patchFlag&16;const K=M.props||Rt,Q=$.props||Rt;let J;if(b&&Ds(b,!1),(J=Q.onVnodeBeforeUpdate)&&je(J,b,$,M),B&&Ls($,M,b,"beforeUpdate"),b&&Ds(b,!0),(K.innerHTML&&Q.innerHTML==null||K.textContent&&Q.textContent==null)&&h(R,""),j?V(M.dynamicChildren,j,R,b,F,na($,O),x):E||et(M,$,R,null,b,F,na($,O),x,!1),H>0){if(H&16)Z(R,K,Q,b,O);else if(H&2&&K.class!==Q.class&&r(R,"class",null,Q.class,O),H&4&&r(R,"style",K.style,Q.style,O),H&8){const st=$.dynamicProps;for(let ut=0;ut<st.length;ut++){const ct=st[ut],Tt=K[ct],$t=Q[ct];($t!==Tt||ct==="value")&&r(R,ct,Tt,$t,O,b)}}H&1&&M.children!==$.children&&h(R,$.children)}else!E&&j==null&&Z(R,K,Q,b,O);((J=Q.onVnodeUpdated)||B)&&Se(()=>{J&&je(J,b,$,M),B&&Ls($,M,b,"updated")},F)},V=(M,$,b,F,O,x,E)=>{for(let R=0;R<$.length;R++){const H=M[R],j=$[R],B=H.el&&(H.type===De||!Tn(H,j)||H.shapeFlag&198)?u(H.el):b;p(H,j,B,null,F,O,x,E,!0)}},Z=(M,$,b,F,O)=>{if($!==b){if($!==Rt)for(const x in $)!$n(x)&&!(x in b)&&r(M,x,$[x],null,O,F);for(const x in b){if($n(x))continue;const E=b[x],R=$[x];E!==R&&x!=="value"&&r(M,x,R,E,O,F)}"value"in b&&r(M,"value",$.value,b.value,O)}},P=(M,$,b,F,O,x,E,R,H)=>{const j=$.el=M?M.el:o(""),B=$.anchor=M?M.anchor:o("");let{patchFlag:K,dynamicChildren:Q,slotScopeIds:J}=$;J&&(R=R?R.concat(J):J),M==null?(s(j,b,F),s(B,b,F),z($.children||[],b,B,O,x,E,R,H)):K>0&&K&64&&Q&&M.dynamicChildren&&M.dynamicChildren.length===Q.length?(V(M.dynamicChildren,Q,b,O,x,E,R),($.key!=null||O&&$===O.subTree)&&vh(M,$,!0)):et(M,$,b,B,O,x,E,R,H)},U=(M,$,b,F,O,x,E,R,H)=>{$.slotScopeIds=R,M==null?$.shapeFlag&512?O.ctx.activate($,b,F,E,H):_($,b,F,O,x,E,H):q(M,$,H)},_=(M,$,b,F,O,x,E)=>{const R=M.component=Lf(M,F,O);if(nh(M)&&(R.ctx.renderer=St),Ff(R,!1,E),R.asyncDep){if(O&&O.registerDep(R,Y,E),!M.el){const H=R.subTree=Me(Cs);m(null,H,$,b),M.placeholder=H.el}}else Y(R,M,$,b,O,x,E)},q=(M,$,b)=>{const F=$.component=M.component;if(pf(M,$,b))if(F.asyncDep&&!F.asyncResolved){L(F,$,b);return}else F.next=$,F.update();else $.el=M.el,F.vnode=$},Y=(M,$,b,F,O,x,E)=>{const R=()=>{if(M.isMounted){let{next:K,bu:Q,u:J,parent:st,vnode:ut}=M;{const te=_h(M);if(te){K&&(K.el=ut.el,L(M,K,E)),te.asyncDep.then(()=>{M.isUnmounted||R()});return}}let ct=K,Tt;Ds(M,!1),K?(K.el=ut.el,L(M,K,E)):K=ut,Q&&Vi(Q),(Tt=K.props&&K.props.onVnodeBeforeUpdate)&&je(Tt,st,K,ut),Ds(M,!0);const $t=_l(M),Bt=M.subTree;M.subTree=$t,p(Bt,$t,u(Bt.el),nt(Bt),M,O,x),K.el=$t.el,ct===null&&gf(M,$t.el),J&&Se(J,O),(Tt=K.props&&K.props.onVnodeUpdated)&&Se(()=>je(Tt,st,K,ut),O)}else{let K;const{el:Q,props:J}=$,{bm:st,m:ut,parent:ct,root:Tt,type:$t}=M,Bt=Vn($);Ds(M,!1),st&&Vi(st),!Bt&&(K=J&&J.onVnodeBeforeMount)&&je(K,ct,$),Ds(M,!0);{Tt.ce&&Tt.ce._def.shadowRoot!==!1&&Tt.ce._injectChildStyle($t);const te=M.subTree=_l(M);p(null,te,b,F,M,O,x),$.el=te.el}if(ut&&Se(ut,O),!Bt&&(K=J&&J.onVnodeMounted)){const te=$;Se(()=>je(K,ct,te),O)}($.shapeFlag&256||ct&&Vn(ct.vnode)&&ct.vnode.shapeFlag&256)&&M.a&&Se(M.a,O),M.isMounted=!0,$=b=F=null}};M.scope.on();const H=M.effect=new Oc(R);M.scope.off();const j=M.update=H.run.bind(H),B=M.job=H.runIfDirty.bind(H);B.i=M,B.id=M.uid,H.scheduler=()=>To(B),Ds(M,!0),j()},L=(M,$,b)=>{$.component=M;const F=M.vnode.props;M.vnode=$,M.next=null,bf(M,$.props,F,b),wf(M,$.children,b),us(),pl(M),ds()},et=(M,$,b,F,O,x,E,R,H=!1)=>{const j=M&&M.children,B=M?M.shapeFlag:0,K=$.children,{patchFlag:Q,shapeFlag:J}=$;if(Q>0){if(Q&128){W(j,K,b,F,O,x,E,R,H);return}else if(Q&256){N(j,K,b,F,O,x,E,R,H);return}}J&8?(B&16&&it(j,O,x),K!==j&&h(b,K)):B&16?J&16?W(j,K,b,F,O,x,E,R,H):it(j,O,x,!0):(B&8&&h(b,""),J&16&&z(K,b,F,O,x,E,R,H))},N=(M,$,b,F,O,x,E,R,H)=>{M=M||cn,$=$||cn;const j=M.length,B=$.length,K=Math.min(j,B);let Q;for(Q=0;Q<K;Q++){const J=$[Q]=H?vs($[Q]):Ke($[Q]);p(M[Q],J,b,null,O,x,E,R,H)}j>B?it(M,O,x,!0,!1,K):z($,b,F,O,x,E,R,H,K)},W=(M,$,b,F,O,x,E,R,H)=>{let j=0;const B=$.length;let K=M.length-1,Q=B-1;for(;j<=K&&j<=Q;){const J=M[j],st=$[j]=H?vs($[j]):Ke($[j]);if(Tn(J,st))p(J,st,b,null,O,x,E,R,H);else break;j++}for(;j<=K&&j<=Q;){const J=M[K],st=$[Q]=H?vs($[Q]):Ke($[Q]);if(Tn(J,st))p(J,st,b,null,O,x,E,R,H);else break;K--,Q--}if(j>K){if(j<=Q){const J=Q+1,st=J<B?$[J].el:F;for(;j<=Q;)p(null,$[j]=H?vs($[j]):Ke($[j]),b,st,O,x,E,R,H),j++}}else if(j>Q)for(;j<=K;)D(M[j],O,x,!0),j++;else{const J=j,st=j,ut=new Map;for(j=st;j<=Q;j++){const Qt=$[j]=H?vs($[j]):Ke($[j]);Qt.key!=null&&ut.set(Qt.key,j)}let ct,Tt=0;const $t=Q-st+1;let Bt=!1,te=0;const Pt=new Array($t);for(j=0;j<$t;j++)Pt[j]=0;for(j=J;j<=K;j++){const Qt=M[j];if(Tt>=$t){D(Qt,O,x,!0);continue}let Ht;if(Qt.key!=null)Ht=ut.get(Qt.key);else for(ct=st;ct<=Q;ct++)if(Pt[ct-st]===0&&Tn(Qt,$[ct])){Ht=ct;break}Ht===void 0?D(Qt,O,x,!0):(Pt[Ht-st]=j+1,Ht>=te?te=Ht:Bt=!0,p(Qt,$[Ht],b,null,O,x,E,R,H),Tt++)}const Os=Bt?Ef(Pt):cn;for(ct=Os.length-1,j=$t-1;j>=0;j--){const Qt=st+j,Ht=$[Qt],En=$[Qt+1],Ti=Qt+1<B?En.el||wh(En):F;Pt[j]===0?p(null,Ht,b,Ti,O,x,E,R,H):Bt&&(ct<0||j!==Os[ct]?I(Ht,b,Ti,2):ct--)}}},I=(M,$,b,F,O=null)=>{const{el:x,type:E,transition:R,children:H,shapeFlag:j}=M;if(j&6){I(M.component.subTree,$,b,F);return}if(j&128){M.suspense.move($,b,F);return}if(j&64){E.move(M,$,b,St);return}if(E===De){s(x,$,b);for(let K=0;K<H.length;K++)I(H[K],$,b,F);s(M.anchor,$,b);return}if(E===ia){w(M,$,b);return}if(F!==2&&j&1&&R)if(F===0)R.beforeEnter(x),s(x,$,b),Se(()=>R.enter(x),O);else{const{leave:K,delayLeave:Q,afterLeave:J}=R,st=()=>{M.ctx.isUnmounted?i(x):s(x,$,b)},ut=()=>{x._isLeaving&&x[jd](!0),K(x,()=>{st(),J&&J()})};Q?Q(x,st,ut):ut()}else s(x,$,b)},D=(M,$,b,F=!1,O=!1)=>{const{type:x,props:E,ref:R,children:H,dynamicChildren:j,shapeFlag:B,patchFlag:K,dirs:Q,cacheIndex:J}=M;if(K===-2&&(O=!1),R!=null&&(us(),Gn(R,null,b,M,!0),ds()),J!=null&&($.renderCache[J]=void 0),B&256){$.ctx.deactivate(M);return}const st=B&1&&Q,ut=!Vn(M);let ct;if(ut&&(ct=E&&E.onVnodeBeforeUnmount)&&je(ct,$,M),B&6)tt(M.component,b,F);else{if(B&128){M.suspense.unmount(b,F);return}st&&Ls(M,null,$,"beforeUnmount"),B&64?M.type.remove(M,$,b,St,F):j&&!j.hasOnce&&(x!==De||K>0&&K&64)?it(j,$,b,!1,!0):(x===De&&K&384||!O&&B&16)&&it(H,$,b),F&&G(M)}(ut&&(ct=E&&E.onVnodeUnmounted)||st)&&Se(()=>{ct&&je(ct,$,M),st&&Ls(M,null,$,"unmounted")},b)},G=M=>{const{type:$,el:b,anchor:F,transition:O}=M;if($===De){X(b,F);return}if($===ia){A(M);return}const x=()=>{i(b),O&&!O.persisted&&O.afterLeave&&O.afterLeave()};if(M.shapeFlag&1&&O&&!O.persisted){const{leave:E,delayLeave:R}=O,H=()=>E(b,x);R?R(M.el,x,H):H()}else x()},X=(M,$)=>{let b;for(;M!==$;)b=d(M),i(M),M=b;i($)},tt=(M,$,b)=>{const{bum:F,scope:O,job:x,subTree:E,um:R,m:H,a:j}=M;Sl(H),Sl(j),F&&Vi(F),O.stop(),x&&(x.flags|=8,D(E,M,$,b)),R&&Se(R,$),Se(()=>{M.isUnmounted=!0},$)},it=(M,$,b,F=!1,O=!1,x=0)=>{for(let E=x;E<M.length;E++)D(M[E],$,b,F,O)},nt=M=>{if(M.shapeFlag&6)return nt(M.component.subTree);if(M.shapeFlag&128)return M.suspense.next();const $=d(M.anchor||M.el),b=$&&$[Bd];return b?d(b):$};let rt=!1;const yt=(M,$,b)=>{let F;M==null?$._vnode&&(D($._vnode,null,null,!0),F=$._vnode.component):p($._vnode||null,M,$,null,null,null,b),$._vnode=M,rt||(rt=!0,pl(F),Zc(),rt=!1)},St={p,um:D,m:I,r:G,mt:_,mc:z,pc:et,pbc:V,n:nt,o:n};return{render:yt,hydrate:void 0,createApp:lf(yt)}}function na({type:n,props:t},e){return e==="svg"&&n==="foreignObject"||e==="mathml"&&n==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:e}function Ds({effect:n,job:t},e){e?(n.flags|=32,t.flags|=4):(n.flags&=-33,t.flags&=-5)}function xf(n,t){return(!n||n&&!n.pendingBranch)&&t&&!t.persisted}function vh(n,t,e=!1){const s=n.children,i=t.children;if(mt(s)&&mt(i))for(let r=0;r<s.length;r++){const a=s[r];let o=i[r];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=i[r]=vs(i[r]),o.el=a.el),!e&&o.patchFlag!==-2&&vh(a,o)),o.type===Fr&&(o.patchFlag!==-1?o.el=a.el:o.__elIndex=r+(n.type===De?1:0)),o.type===Cs&&!o.el&&(o.el=a.el)}}function Ef(n){const t=n.slice(),e=[0];let s,i,r,a,o;const l=n.length;for(s=0;s<l;s++){const c=n[s];if(c!==0){if(i=e[e.length-1],n[i]<c){t[s]=i,e.push(s);continue}for(r=0,a=e.length-1;r<a;)o=r+a>>1,n[e[o]]<c?r=o+1:a=o;c<n[e[r]]&&(r>0&&(t[s]=e[r-1]),e[r]=s)}}for(r=e.length,a=e[r-1];r-- >0;)e[r]=a,a=t[a];return e}function _h(n){const t=n.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:_h(t)}function Sl(n){if(n)for(let t=0;t<n.length;t++)n[t].flags|=8}function wh(n){if(n.placeholder)return n.placeholder;const t=n.component;return t?wh(t.subTree):null}const Ah=n=>n.__isSuspense;function Cf(n,t){t&&t.pendingBranch?mt(n)?t.effects.push(...n):t.effects.push(n):Md(n)}const De=Symbol.for("v-fgt"),Fr=Symbol.for("v-txt"),Cs=Symbol.for("v-cmt"),ia=Symbol.for("v-stc"),qn=[];let Ce=null;function Xt(n=!1){qn.push(Ce=n?null:[])}function kf(){qn.pop(),Ce=qn[qn.length-1]||null}let ai=1;function xl(n,t=!1){ai+=n,n<0&&Ce&&t&&(Ce.hasOnce=!0)}function Sh(n){return n.dynamicChildren=ai>0?Ce||cn:null,kf(),ai>0&&Ce&&Ce.push(n),n}function ie(n,t,e,s,i,r){return Sh(at(n,t,e,s,i,r,!0))}function Ia(n,t,e,s,i){return Sh(Me(n,t,e,s,i,!0))}function xh(n){return n?n.__v_isVNode===!0:!1}function Tn(n,t){return n.type===t.type&&n.key===t.key}const Eh=({key:n})=>n??null,qi=({ref:n,ref_key:t,ref_for:e})=>(typeof n=="number"&&(n=""+n),n!=null?Vt(n)||le(n)||wt(n)?{i:Re,r:n,k:t,f:!!e}:n:null);function at(n,t=null,e=null,s=0,i=null,r=n===De?0:1,a=!1,o=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:t,key:t&&Eh(t),ref:t&&qi(t),scopeId:Qc,slotScopeIds:null,children:e,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:s,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:Re};return o?(Mo(l,e),r&128&&n.normalize(l)):e&&(l.shapeFlag|=Vt(e)?8:16),ai>0&&!a&&Ce&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&Ce.push(l),l}const Me=Tf;function Tf(n,t=null,e=null,s=0,i=null,r=!1){if((!n||n===Jd)&&(n=Cs),xh(n)){const o=vn(n,t,!0);return e&&Mo(o,e),ai>0&&!r&&Ce&&(o.shapeFlag&6?Ce[Ce.indexOf(n)]=o:Ce.push(o)),o.patchFlag=-2,o}if(jf(n)&&(n=n.__vccOpts),t){t=Pf(t);let{class:o,style:l}=t;o&&!Vt(o)&&(t.class=yi(o)),Lt(l)&&(Co(l)&&!mt(l)&&(l=ce({},l)),t.style=Rr(l))}const a=Vt(n)?1:Ah(n)?128:zd(n)?64:Lt(n)?4:wt(n)?2:0;return at(n,t,e,s,i,a,r,!0)}function Pf(n){return n?Co(n)||fh(n)?ce({},n):n:null}function vn(n,t,e=!1,s=!1){const{props:i,ref:r,patchFlag:a,children:o,transition:l}=n,c=t?If(i||{},t):i,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&Eh(c),ref:t&&t.ref?e&&r?mt(r)?r.concat(qi(t)):[r,qi(t)]:qi(t):r,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:o,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:t&&n.type!==De?a===-1?16:a|16:a,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&vn(n.ssContent),ssFallback:n.ssFallback&&vn(n.ssFallback),placeholder:n.placeholder,el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&s&&Po(h,l.clone(h)),h}function Rf(n=" ",t=0){return Me(Fr,null,n,t)}function hr(n="",t=!1){return t?(Xt(),Ia(Cs,null,n)):Me(Cs,null,n)}function Ke(n){return n==null||typeof n=="boolean"?Me(Cs):mt(n)?Me(De,null,n.slice()):xh(n)?vs(n):Me(Fr,null,String(n))}function vs(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:vn(n)}function Mo(n,t){let e=0;const{shapeFlag:s}=n;if(t==null)t=null;else if(mt(t))e=16;else if(typeof t=="object")if(s&65){const i=t.default;i&&(i._c&&(i._d=!1),Mo(n,i()),i._c&&(i._d=!0));return}else{e=32;const i=t._;!i&&!fh(t)?t._ctx=Re:i===3&&Re&&(Re.slots._===1?t._=1:(t._=2,n.patchFlag|=1024))}else wt(t)?(t={default:t,_ctx:Re},e=32):(t=String(t),s&64?(e=16,t=[Rf(t)]):e=8);n.children=t,n.shapeFlag|=e}function If(...n){const t={};for(let e=0;e<n.length;e++){const s=n[e];for(const i in s)if(i==="class")t.class!==s.class&&(t.class=yi([t.class,s.class]));else if(i==="style")t.style=Rr([t.style,s.style]);else if(Er(i)){const r=t[i],a=s[i];a&&r!==a&&!(mt(r)&&r.includes(a))&&(t[i]=r?[].concat(r,a):a)}else i!==""&&(t[i]=s[i])}return t}function je(n,t,e,s=null){Ye(n,t,7,[e,s])}const Mf=ch();let Of=0;function Lf(n,t,e){const s=n.type,i=(t?t.appContext:n.appContext)||Mf,r={uid:Of++,vnode:n,type:s,parent:t,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new td(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(i.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:gh(s,i),emitsOptions:hh(s,i),emit:null,emitted:null,propsDefaults:Rt,inheritAttrs:s.inheritAttrs,ctx:Rt,data:Rt,props:Rt,attrs:Rt,slots:Rt,refs:Rt,setupState:Rt,setupContext:null,suspense:e,suspenseId:e?e.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=t?t.root:r,r.emit=hf.bind(null,r),n.ce&&n.ce(r),r}let pe=null;const Df=()=>pe||Re;let ur,Ma;{const n=Pr(),t=(e,s)=>{let i;return(i=n[e])||(i=n[e]=[]),i.push(s),r=>{i.length>1?i.forEach(a=>a(r)):i[0](r)}};ur=t("__VUE_INSTANCE_SETTERS__",e=>pe=e),Ma=t("__VUE_SSR_SETTERS__",e=>oi=e)}const _i=n=>{const t=pe;return ur(n),n.scope.on(),()=>{n.scope.off(),ur(t)}},El=()=>{pe&&pe.scope.off(),ur(null)};function Ch(n){return n.vnode.shapeFlag&4}let oi=!1;function Ff(n,t=!1,e=!1){t&&Ma(t);const{props:s,children:i}=n.vnode,r=Ch(n);mf(n,s,r,t),_f(n,i,e||t);const a=r?Nf(n,t):void 0;return t&&Ma(!1),a}function Nf(n,t){const e=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,tf);const{setup:s}=e;if(s){us();const i=n.setupContext=s.length>1?zf(n):null,r=_i(n),a=vi(s,n,0,[n.props,i]),o=Ec(a);if(ds(),r(),(o||n.sp)&&!Vn(n)&&sh(n),o){if(a.then(El,El),t)return a.then(l=>{Cl(n,l)}).catch(l=>{Or(l,n,0)});n.asyncDep=a}else Cl(n,a)}else kh(n)}function Cl(n,t,e){wt(t)?n.type.__ssrInlineRender?n.ssrRender=t:n.render=t:Lt(t)&&(n.setupState=qc(t)),kh(n)}function kh(n,t,e){const s=n.type;n.render||(n.render=s.render||qe);{const i=_i(n);us();try{ef(n)}finally{ds(),i()}}}const Bf={get(n,t){return ne(n,"get",""),n[t]}};function zf(n){const t=e=>{n.exposed=e||{}};return{attrs:new Proxy(n.attrs,Bf),slots:n.slots,emit:n.emit,expose:t}}function Nr(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(qc(wd(n.exposed)),{get(t,e){if(e in t)return t[e];if(e in Kn)return Kn[e](n)},has(t,e){return e in t||e in Kn}})):n.proxy}function jf(n){return wt(n)&&"__vccOpts"in n}const Br=(n,t)=>kd(n,t,oi),$f="3.5.27";/**
* @vue/runtime-dom v3.5.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Oa;const kl=typeof window<"u"&&window.trustedTypes;if(kl)try{Oa=kl.createPolicy("vue",{createHTML:n=>n})}catch{}const Th=Oa?n=>Oa.createHTML(n):n=>n,Hf="http://www.w3.org/2000/svg",Uf="http://www.w3.org/1998/Math/MathML",es=typeof document<"u"?document:null,Tl=es&&es.createElement("template"),Wf={insert:(n,t,e)=>{t.insertBefore(n,e||null)},remove:n=>{const t=n.parentNode;t&&t.removeChild(n)},createElement:(n,t,e,s)=>{const i=t==="svg"?es.createElementNS(Hf,n):t==="mathml"?es.createElementNS(Uf,n):e?es.createElement(n,{is:e}):es.createElement(n);return n==="select"&&s&&s.multiple!=null&&i.setAttribute("multiple",s.multiple),i},createText:n=>es.createTextNode(n),createComment:n=>es.createComment(n),setText:(n,t)=>{n.nodeValue=t},setElementText:(n,t)=>{n.textContent=t},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>es.querySelector(n),setScopeId(n,t){n.setAttribute(t,"")},insertStaticContent(n,t,e,s,i,r){const a=e?e.previousSibling:t.lastChild;if(i&&(i===r||i.nextSibling))for(;t.insertBefore(i.cloneNode(!0),e),!(i===r||!(i=i.nextSibling)););else{Tl.innerHTML=Th(s==="svg"?`<svg>${n}</svg>`:s==="mathml"?`<math>${n}</math>`:n);const o=Tl.content;if(s==="svg"||s==="mathml"){const l=o.firstChild;for(;l.firstChild;)o.appendChild(l.firstChild);o.removeChild(l)}t.insertBefore(o,e)}return[a?a.nextSibling:t.firstChild,e?e.previousSibling:t.lastChild]}},Gf=Symbol("_vtc");function Vf(n,t,e){const s=n[Gf];s&&(t=(t?[t,...s]:[...s]).join(" ")),t==null?n.removeAttribute("class"):e?n.setAttribute("class",t):n.className=t}const Pl=Symbol("_vod"),Kf=Symbol("_vsh"),qf=Symbol(""),Xf=/(?:^|;)\s*display\s*:/;function Yf(n,t,e){const s=n.style,i=Vt(e);let r=!1;if(e&&!i){if(t)if(Vt(t))for(const a of t.split(";")){const o=a.slice(0,a.indexOf(":")).trim();e[o]==null&&Xi(s,o,"")}else for(const a in t)e[a]==null&&Xi(s,a,"");for(const a in e)a==="display"&&(r=!0),Xi(s,a,e[a])}else if(i){if(t!==e){const a=s[qf];a&&(e+=";"+a),s.cssText=e,r=Xf.test(e)}}else t&&n.removeAttribute("style");Pl in n&&(n[Pl]=r?s.display:"",n[Kf]&&(s.display="none"))}const Rl=/\s*!important$/;function Xi(n,t,e){if(mt(e))e.forEach(s=>Xi(n,t,s));else if(e==null&&(e=""),t.startsWith("--"))n.setProperty(t,e);else{const s=Zf(n,t);Rl.test(e)?n.setProperty(Js(s),e.replace(Rl,""),"important"):n[s]=e}}const Il=["Webkit","Moz","ms"],ra={};function Zf(n,t){const e=ra[t];if(e)return e;let s=Es(t);if(s!=="filter"&&s in n)return ra[t]=s;s=Tc(s);for(let i=0;i<Il.length;i++){const r=Il[i]+s;if(r in n)return ra[t]=r}return t}const Ml="http://www.w3.org/1999/xlink";function Ol(n,t,e,s,i,r=Zu(t)){s&&t.startsWith("xlink:")?e==null?n.removeAttributeNS(Ml,t.slice(6,t.length)):n.setAttributeNS(Ml,t,e):e==null||r&&!Rc(e)?n.removeAttribute(t):n.setAttribute(t,r?"":Xe(e)?String(e):e)}function Ll(n,t,e,s,i){if(t==="innerHTML"||t==="textContent"){e!=null&&(n[t]=t==="innerHTML"?Th(e):e);return}const r=n.tagName;if(t==="value"&&r!=="PROGRESS"&&!r.includes("-")){const o=r==="OPTION"?n.getAttribute("value")||"":n.value,l=e==null?n.type==="checkbox"?"on":"":String(e);(o!==l||!("_value"in n))&&(n.value=l),e==null&&n.removeAttribute(t),n._value=e;return}let a=!1;if(e===""||e==null){const o=typeof n[t];o==="boolean"?e=Rc(e):e==null&&o==="string"?(e="",a=!0):o==="number"&&(e=0,a=!0)}try{n[t]=e}catch{}a&&n.removeAttribute(i||t)}function js(n,t,e,s){n.addEventListener(t,e,s)}function Jf(n,t,e,s){n.removeEventListener(t,e,s)}const Dl=Symbol("_vei");function Qf(n,t,e,s,i=null){const r=n[Dl]||(n[Dl]={}),a=r[t];if(s&&a)a.value=s;else{const[o,l]=tp(t);if(s){const c=r[t]=np(s,i);js(n,o,c,l)}else a&&(Jf(n,o,a,l),r[t]=void 0)}}const Fl=/(?:Once|Passive|Capture)$/;function tp(n){let t;if(Fl.test(n)){t={};let s;for(;s=n.match(Fl);)n=n.slice(0,n.length-s[0].length),t[s[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Js(n.slice(2)),t]}let aa=0;const ep=Promise.resolve(),sp=()=>aa||(ep.then(()=>aa=0),aa=Date.now());function np(n,t){const e=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=e.attached)return;Ye(ip(s,e.value),t,5,[s])};return e.value=n,e.attached=sp(),e}function ip(n,t){if(mt(t)){const e=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{e.call(n),n._stopped=!0},t.map(s=>i=>!i._stopped&&s&&s(i))}else return t}const Nl=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,rp=(n,t,e,s,i,r)=>{const a=i==="svg";t==="class"?Vf(n,s,a):t==="style"?Yf(n,e,s):Er(t)?mo(t)||Qf(n,t,e,s,r):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):ap(n,t,s,a))?(Ll(n,t,s),!n.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&Ol(n,t,s,a,r,t!=="value")):n._isVueCE&&(/[A-Z]/.test(t)||!Vt(s))?Ll(n,Es(t),s,r,t):(t==="true-value"?n._trueValue=s:t==="false-value"&&(n._falseValue=s),Ol(n,t,s,a))};function ap(n,t,e,s){if(s)return!!(t==="innerHTML"||t==="textContent"||t in n&&Nl(t)&&wt(e));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="autocorrect"||t==="sandbox"&&n.tagName==="IFRAME"||t==="form"||t==="list"&&n.tagName==="INPUT"||t==="type"&&n.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const i=n.tagName;if(i==="IMG"||i==="VIDEO"||i==="CANVAS"||i==="SOURCE")return!1}return Nl(t)&&Vt(e)?!1:t in n}const dr=n=>{const t=n.props["onUpdate:modelValue"]||!1;return mt(t)?e=>Vi(t,e):t};function op(n){n.target.composing=!0}function Bl(n){const t=n.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const fn=Symbol("_assign");function zl(n,t,e){return t&&(n=n.trim()),e&&(n=Tr(n)),n}const Yi={created(n,{modifiers:{lazy:t,trim:e,number:s}},i){n[fn]=dr(i);const r=s||i.props&&i.props.type==="number";js(n,t?"change":"input",a=>{a.target.composing||n[fn](zl(n.value,e,r))}),(e||r)&&js(n,"change",()=>{n.value=zl(n.value,e,r)}),t||(js(n,"compositionstart",op),js(n,"compositionend",Bl),js(n,"change",Bl))},mounted(n,{value:t}){n.value=t??""},beforeUpdate(n,{value:t,oldValue:e,modifiers:{lazy:s,trim:i,number:r}},a){if(n[fn]=dr(a),n.composing)return;const o=(r||n.type==="number")&&!/^0\d/.test(n.value)?Tr(n.value):n.value,l=t??"";o!==l&&(document.activeElement===n&&n.type!=="range"&&(s&&t===e||i&&n.value.trim()===l)||(n.value=l))}},lp={deep:!0,created(n,{value:t,modifiers:{number:e}},s){const i=Cr(t);js(n,"change",()=>{const r=Array.prototype.filter.call(n.options,a=>a.selected).map(a=>e?Tr(fr(a)):fr(a));n[fn](n.multiple?i?new Set(r):r:r[0]),n._assigning=!0,ko(()=>{n._assigning=!1})}),n[fn]=dr(s)},mounted(n,{value:t}){jl(n,t)},beforeUpdate(n,t,e){n[fn]=dr(e)},updated(n,{value:t}){n._assigning||jl(n,t)}};function jl(n,t){const e=n.multiple,s=mt(t);if(!(e&&!s&&!Cr(t))){for(let i=0,r=n.options.length;i<r;i++){const a=n.options[i],o=fr(a);if(e)if(s){const l=typeof o;l==="string"||l==="number"?a.selected=t.some(c=>String(c)===String(o)):a.selected=Qu(t,o)>-1}else a.selected=t.has(o);else if(Ir(fr(a),t)){n.selectedIndex!==i&&(n.selectedIndex=i);return}}!e&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function fr(n){return"_value"in n?n._value:n.value}const cp=["ctrl","shift","alt","meta"],hp={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,t)=>cp.some(e=>n[`${e}Key`]&&!t.includes(e))},pr=(n,t)=>{const e=n._withMods||(n._withMods={}),s=t.join(".");return e[s]||(e[s]=(i,...r)=>{for(let a=0;a<t.length;a++){const o=hp[t[a]];if(o&&o(i,t))return}return n(i,...r)})},up=ce({patchProp:rp},Wf);let $l;function dp(){return $l||($l=Af(up))}const fp=(...n)=>{const t=dp().createApp(...n),{mount:e}=t;return t.mount=s=>{const i=gp(s);if(!i)return;const r=t._component;!wt(r)&&!r.render&&!r.template&&(r.template=i.innerHTML),i.nodeType===1&&(i.textContent="");const a=e(i,!1,pp(i));return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),a},t};function pp(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function gp(n){return Vt(n)?document.querySelector(n):n}const wi=(n,t)=>{const e=n.__vccOpts||n;for(const[s,i]of t)e[s]=i;return e},mp={class:"pdf-uploader"},bp={__name:"PdfUploader",emits:["upload"],setup(n,{emit:t}){const e=t,s=Jt(null),i=Jt(!1);function r(){s.value?.click()}function a(l){const c=l.target.files[0];c&&c.type==="application/pdf"&&e("upload",c)}function o(l){i.value=!1;const c=l.dataTransfer.files[0];c&&c.type==="application/pdf"&&e("upload",c)}return(l,c)=>(Xt(),ie("div",mp,[at("div",{class:yi(["upload-area",{dragging:i.value}]),onDragover:c[0]||(c[0]=pr(h=>i.value=!0,["prevent"])),onDragleave:c[1]||(c[1]=h=>i.value=!1),onDrop:pr(o,["prevent"]),onClick:r},[at("input",{ref_key:"fileInput",ref:s,type:"file",accept:".pdf",onChange:a,hidden:""},null,544),c[2]||(c[2]=at("div",{class:"upload-icon"},"",-1)),c[3]||(c[3]=at("p",null,"PDF    ",-1))],34)]))}},yp=wi(bp,[["__scopeId","data-v-16c55db2"]]);var Xn={};Xn.d=(n,t)=>{for(var e in t)Xn.o(t,e)&&!Xn.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})};Xn.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var bt=globalThis.pdfjsLib={};Xn.d(bt,{AbortException:()=>ks,AnnotationEditorLayer:()=>ss,AnnotationEditorParamsType:()=>xt,AnnotationEditorType:()=>vt,AnnotationEditorUIManager:()=>Ts,AnnotationLayer:()=>fm,AnnotationMode:()=>ws,ColorPicker:()=>Pe,DOMSVGFactory:()=>Wo,DrawLayer:()=>ue,FeatureTest:()=>me,GlobalWorkerOptions:()=>Zn,ImageKind:()=>Zi,InvalidPDFException:()=>Da,MissingPDFException:()=>li,OPS:()=>Le,OutputScale:()=>Fa,PDFDataRangeTransport:()=>Kh,PDFDateString:()=>Ih,PDFWorker:()=>Zt,PasswordResponses:()=>Ap,PermissionFlag:()=>wp,PixelsPerInch:()=>_n,RenderingCancelledException:()=>Do,TextLayer:()=>de,TouchManager:()=>Gr,UnexpectedResponseException:()=>gr,Util:()=>ht,VerbosityLevel:()=>zr,XfaLayer:()=>Xh,build:()=>Kg,createValidAbsoluteUrl:()=>Cp,fetchData:()=>Ur,getDocument:()=>Bg,getFilenameFromUrl:()=>Dp,getPdfFilenameFromUrl:()=>Fp,getXfaPageViewport:()=>Np,isDataScheme:()=>Wr,isPdfFile:()=>Fo,noContextMenu:()=>ze,normalizeUnicode:()=>Mp,setLayerDimensions:()=>qs,shadow:()=>At,stopEvent:()=>Ee,version:()=>Vg});const re=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Ph=[1,0,0,1,0,0],La=[.001,0,0,.001,0,0],vp=1e7,oa=1.35,xe={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},ws={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},_p="pdfjs_internal_editor_",vt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},xt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},wp={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ee={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Zi={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Kt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},Pn={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},zr={ERRORS:0,WARNINGS:1,INFOS:5},Le={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},Ap={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let jr=zr.WARNINGS;function Sp(n){Number.isInteger(n)&&(jr=n)}function xp(){return jr}function $r(n){jr>=zr.INFOS&&console.log(`Info: ${n}`)}function _t(n){jr>=zr.WARNINGS&&console.log(`Warning: ${n}`)}function Mt(n){throw new Error(n)}function Wt(n,t){n||Mt(t)}function Ep(n){switch(n?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Cp(n,t=null,e=null){if(!n)return null;try{if(e&&typeof n=="string"&&(e.addDefaultProtocol&&n.startsWith("www.")&&n.match(/\./g)?.length>=2&&(n=`http://${n}`),e.tryConvertEncoding))try{n=Ip(n)}catch{}const s=t?new URL(n,t):new URL(n);if(Ep(s))return s}catch{}return null}function At(n,t,e,s=!1){return Object.defineProperty(n,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const Ms=function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t}();class Hl extends Ms{constructor(t,e){super(t,"PasswordException"),this.code=e}}class la extends Ms{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Da extends Ms{constructor(t){super(t,"InvalidPDFException")}}class li extends Ms{constructor(t){super(t,"MissingPDFException")}}class gr extends Ms{constructor(t,e){super(t,"UnexpectedResponseException"),this.status=e}}class kp extends Ms{constructor(t){super(t,"FormatError")}}class ks extends Ms{constructor(t){super(t,"AbortException")}}function Rh(n){(typeof n!="object"||n?.length===void 0)&&Mt("Invalid argument for bytesToString");const t=n.length,e=8192;if(t<e)return String.fromCharCode.apply(null,n);const s=[];for(let i=0;i<t;i+=e){const r=Math.min(i+e,t),a=n.subarray(i,r);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function Hr(n){typeof n!="string"&&Mt("Invalid argument for stringToBytes");const t=n.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=n.charCodeAt(s)&255;return e}function Tp(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function Oo(n){const t=Object.create(null);for(const[e,s]of n)t[e]=s;return t}function Pp(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function Rp(){try{return new Function(""),!0}catch{return!1}}class me{static get isLittleEndian(){return At(this,"isLittleEndian",Pp())}static get isEvalSupported(){return At(this,"isEvalSupported",Rp())}static get isOffscreenCanvasSupported(){return At(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return At(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?At(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):At(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return At(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const ca=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));class ht{static makeHexColor(t,e,s){return`#${ca[t]}${ca[e]}${ca[s]}`}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){const s=t[0]*e[0]+t[1]*e[2]+e[4],i=t[0]*e[1]+t[1]*e[3]+e[5];return[s,i]}static applyInverseTransform(t,e){const s=e[0]*e[3]-e[1]*e[2],i=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/s,r=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/s;return[i,r]}static getAxialAlignedBoundingBox(t,e){const s=this.applyTransform(t,e),i=this.applyTransform(t.slice(2,4),e),r=this.applyTransform([t[0],t[3]],e),a=this.applyTransform([t[2],t[1]],e);return[Math.min(s[0],i[0],r[0],a[0]),Math.min(s[1],i[1],r[1],a[1]),Math.max(s[0],i[0],r[0],a[0]),Math.max(s[1],i[1],r[1],a[1])]}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){const e=[t[0],t[2],t[1],t[3]],s=t[0]*e[0]+t[1]*e[2],i=t[0]*e[1]+t[1]*e[3],r=t[2]*e[0]+t[3]*e[2],a=t[2]*e[1]+t[3]*e[3],o=(s+a)/2,l=Math.sqrt((s+a)**2-4*(s*a-r*i))/2,c=o+l||1,h=o-l||1;return[Math.sqrt(c),Math.sqrt(h)]}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>i)return null;const r=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),a=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return r>a?null:[s,r,i,a]}static#t(t,e,s,i,r,a,o,l,c,h){if(c<=0||c>=1)return;const u=1-c,d=c*c,f=d*c,g=u*(u*(u*t+3*c*e)+3*d*s)+f*i,p=u*(u*(u*r+3*c*a)+3*d*o)+f*l;h[0]=Math.min(h[0],g),h[1]=Math.min(h[1],p),h[2]=Math.max(h[2],g),h[3]=Math.max(h[3],p)}static#e(t,e,s,i,r,a,o,l,c,h,u,d){if(Math.abs(c)<1e-12){Math.abs(h)>=1e-12&&this.#t(t,e,s,i,r,a,o,l,-u/h,d);return}const f=h**2-4*u*c;if(f<0)return;const g=Math.sqrt(f),p=2*c;this.#t(t,e,s,i,r,a,o,l,(-h+g)/p,d),this.#t(t,e,s,i,r,a,o,l,(-h-g)/p,d)}static bezierBoundingBox(t,e,s,i,r,a,o,l,c){return c?(c[0]=Math.min(c[0],t,o),c[1]=Math.min(c[1],e,l),c[2]=Math.max(c[2],t,o),c[3]=Math.max(c[3],e,l)):c=[Math.min(t,o),Math.min(e,l),Math.max(t,o),Math.max(e,l)],this.#e(t,s,r,o,e,i,a,l,3*(-t+3*(s-r)+o),6*(t-2*s+r),3*(s-t),c),this.#e(t,s,r,o,e,i,a,l,3*(-e+3*(i-a)+l),6*(e-2*i+a),3*(i-e),c),c}}function Ip(n){return decodeURIComponent(escape(n))}let ha=null,Ul=null;function Mp(n){return ha||(ha=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ul=new Map([["","t"]])),n.replaceAll(ha,(t,e,s)=>e?e.normalize("NFKC"):Ul.get(s))}function Op(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),Rh(n)}const Lo="pdfjs_internal_id_";function Lp(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(Rh(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...t){return new Promise(e=>{e(n(...t))})});const ts="http://www.w3.org/2000/svg";class _n{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Ur(n,t="text"){if(Fn(n,document.baseURI)){const e=await fetch(n);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class Ai{constructor({viewBox:t,userUnit:e,scale:s,rotation:i,offsetX:r=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=t,this.userUnit=e,this.scale=s,this.rotation=i,this.offsetX=r,this.offsetY=a,s*=e;const l=(t[2]+t[0])/2,c=(t[3]+t[1])/2;let h,u,d,f;switch(i%=360,i<0&&(i+=360),i){case 180:h=-1,u=0,d=0,f=1;break;case 90:h=0,u=1,d=1,f=0;break;case 270:h=0,u=-1,d=-1,f=0;break;case 0:h=1,u=0,d=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(d=-d,f=-f);let g,p,y,m;h===0?(g=Math.abs(c-t[1])*s+r,p=Math.abs(l-t[0])*s+a,y=(t[3]-t[1])*s,m=(t[2]-t[0])*s):(g=Math.abs(l-t[0])*s+r,p=Math.abs(c-t[1])*s+a,y=(t[2]-t[0])*s,m=(t[3]-t[1])*s),this.transform=[h*s,u*s,d*s,f*s,g-h*s*l-d*s*c,p-u*s*l-f*s*c],this.width=y,this.height=m}get rawDims(){const{userUnit:t,viewBox:e}=this,s=e.map(i=>i*t);return At(this,"rawDims",{pageWidth:s[2]-s[0],pageHeight:s[3]-s[1],pageX:s[0],pageY:s[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new Ai({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(t,e){return ht.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){const e=ht.applyTransform([t[0],t[1]],this.transform),s=ht.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){return ht.applyInverseTransform([t,e],this.transform)}}class Do extends Ms{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Wr(n){const t=n.length;let e=0;for(;e<t&&n[e].trim()==="";)e++;return n.substring(e,e+5).toLowerCase()==="data:"}function Fo(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function Dp(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function Fp(n,t="document.pdf"){if(typeof n!="string")return t;if(Wr(n))return _t('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=e.exec(n);let r=s.exec(i[1])||s.exec(i[2])||s.exec(i[3]);if(r&&(r=r[0],r.includes("%")))try{r=s.exec(decodeURIComponent(r))[0]}catch{}return r||t}class Wl{started=Object.create(null);times=[];time(t){t in this.started&&_t(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||_t(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:i,end:r}of this.times)t.push(`${s.padEnd(e)} ${r-i}ms
`);return t.join("")}}function Fn(n,t){try{const{protocol:e}=t?new URL(n,t):new URL(n);return e==="http:"||e==="https:"}catch{return!1}}function ze(n){n.preventDefault()}function Ee(n){n.preventDefault(),n.stopPropagation()}class Ih{static#t;static toDateObject(t){if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const s=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(e[3],10);r=r>=1&&r<=31?r:1;let a=parseInt(e[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;const c=e[7]||"Z";let h=parseInt(e[8],10);h=h>=0&&h<=23?h:0;let u=parseInt(e[9],10)||0;return u=u>=0&&u<=59?u:0,c==="-"?(a+=h,o+=u):c==="+"&&(a-=h,o-=u),new Date(Date.UTC(s,i,r,a,o,l))}}function Np(n,{scale:t=1,rotation:e=0}){const{width:s,height:i}=n.attributes.style,r=[0,0,parseInt(s),parseInt(i)];return new Ai({viewBox:r,userUnit:1,scale:t,rotation:e})}function No(n){if(n.startsWith("#")){const t=parseInt(n.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(t=>parseInt(t)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(_t(`Not a valid color format: "${n}"`),[0,0,0])}function Bp(n){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const e of n.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;n.set(e,No(s))}t.remove()}function Ft(n){const{a:t,b:e,c:s,d:i,e:r,f:a}=n.getTransform();return[t,e,s,i,r,a]}function $e(n){const{a:t,b:e,c:s,d:i,e:r,f:a}=n.getTransform().invertSelf();return[t,e,s,i,r,a]}function qs(n,t,e=!1,s=!0){if(t instanceof Ai){const{pageWidth:i,pageHeight:r}=t.rawDims,{style:a}=n,o=me.isCSSRoundSupported,l=`var(--scale-factor) * ${i}px`,c=`var(--scale-factor) * ${r}px`,h=o?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,u=o?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!e||t.rotation%180===0?(a.width=h,a.height=u):(a.width=u,a.height=h)}s&&n.setAttribute("data-main-rotation",t.rotation)}class Fa{constructor(){const t=window.devicePixelRatio||1;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}class Yn{#t=null;#e=null;#s;#n=null;#r=null;static#i=null;constructor(t){this.#s=t,Yn.#i||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#s._uiManager._signal;t.addEventListener("contextmenu",ze,{signal:e}),t.addEventListener("pointerdown",Yn.#l,{signal:e});const s=this.#n=document.createElement("div");s.className="buttons",t.append(s);const i=this.#s.toolbarPosition;if(i){const{style:r}=t,a=this.#s._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*a}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return this.#d(),t}get div(){return this.#t}static#l(t){t.stopPropagation()}#o(t){this.#s._focusEventsAllowed=!1,Ee(t)}#h(t){this.#s._focusEventsAllowed=!0,Ee(t)}#c(t){const e=this.#s._uiManager._signal;t.addEventListener("focusin",this.#o.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#h.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",ze,{signal:e})}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#r?.shown()}#d(){const{editorType:t,_uiManager:e}=this.#s,s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",Yn.#i[t]),this.#c(s),s.addEventListener("click",i=>{e.delete()},{signal:e._signal}),this.#n.append(s)}get#u(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#c(e),this.#n.prepend(e,this.#u),this.#r=t}addColorPicker(t){this.#e=t;const e=t.renderButton();this.#c(e),this.#n.prepend(e,this.#u)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class zp{#t=null;#e=null;#s;constructor(t){this.#s=t}#n(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",ze,{signal:this.#s._signal});const e=this.#t=document.createElement("div");return e.className="buttons",t.append(e),this.#i(),t}#r(t,e){let s=0,i=0;for(const r of t){const a=r.y+r.height;if(a<s)continue;const o=r.x+(e?r.width:0);if(a>s){i=o,s=a;continue}e?o>i&&(i=o):o<i&&(i=o)}return[e?1-i:i,s]}show(t,e,s){const[i,r]=this.#r(e,s),{style:a}=this.#e||=this.#n();t.append(this.#e),a.insetInlineEnd=`${100*i}%`,a.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#i(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=this.#s._signal;t.addEventListener("contextmenu",ze,{signal:s}),t.addEventListener("click",()=>{this.#s.highlightSelection("floating_button")},{signal:s}),this.#t.append(t)}}function mr(n,t,e){for(const s of e)t.addEventListener(s,n[s].bind(n))}class jp{#t=0;get id(){return`${_p}${this.#t++}`}}class Bo{#t=Op();#e=0;#s=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=t;const r=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return At(this,"_isSVGFittingCanvas",r)}async#n(t,e){this.#s||=new Map;let s=this.#s.get(t);if(s===null)return null;if(s?.bitmap)return s.refCounter+=1,s;try{s||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let i;if(typeof e=="string"?(s.url=e,i=await Ur(e,"blob")):e instanceof File?i=s.file=e:e instanceof Blob&&(i=e),i.type==="image/svg+xml"){const r=Bo._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((c,h)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,c()},a.onload=async()=>{const u=s.svgUrl=a.result;o.src=await r?`${u}#svgView(preserveAspectRatio(none))`:u},o.onerror=a.onerror=h});a.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){_t(i),s=null}return this.#s.set(t,s),s&&this.#s.set(s.id,s),s}async getFromFile(t){const{lastModified:e,name:s,size:i,type:r}=t;return this.#n(`${e}_${s}_${i}_${r}`,t)}async getFromUrl(t){return this.#n(t,t)}async getFromBlob(t,e){const s=await e;return this.#n(t,s)}async getFromId(t){this.#s||=new Map;const e=this.#s.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#s||=new Map;let s=this.#s.get(t);if(s?.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#s.set(t,s),this.#s.set(s.id,s),s}getSvgUrl(t){const e=this.#s.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#s||=new Map;const e=this.#s.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:s}=e;if(!e.url&&!e.file){const i=new OffscreenCanvas(s.width,s.height);i.getContext("bitmaprenderer").transferFromImageBitmap(s),e.blobPromise=i.convertToBlob()}s.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class $p{#t=[];#e=!1;#s;#n=-1;constructor(t=128){this.#s=t}add({cmd:t,undo:e,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(i&&t(),this.#e)return;const l={cmd:t,undo:e,post:s,type:r};if(this.#n===-1){this.#t.length>0&&(this.#t.length=0),this.#n=0,this.#t.push(l);return}if(a&&this.#t[this.#n].type===r){o&&(l.undo=this.#t[this.#n].undo),this.#t[this.#n]=l;return}const c=this.#n+1;c===this.#s?this.#t.splice(0,1):(this.#n=c,c<this.#t.length&&this.#t.splice(c)),this.#t.push(l)}undo(){if(this.#n===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#n];t(),e?.(),this.#e=!1,this.#n-=1}redo(){if(this.#n<this.#t.length-1){this.#n+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#n];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#t.length-1}cleanType(t){if(this.#n!==-1){for(let e=this.#n;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#n-e),this.#n=e;return}this.#t.length=0,this.#n=-1}}destroy(){this.#t=null}}class Si{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=me.platform;for(const[s,i,r={}]of t)for(const a of s){const o=a.startsWith("mac+");e&&o?(this.callbacks.set(a.slice(4),{callback:i,options:r}),this.allKeys.add(a.split("+").at(-1))):!e&&!o&&(this.callbacks.set(a,{callback:i,options:r}),this.allKeys.add(a.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(this.#t(e));if(!s)return;const{callback:i,options:{bubbles:r=!1,args:a=[],checker:o=null}}=s;o&&!o(t,e)||(i.bind(t,...a,e)(),r||Ee(e))}}class zo{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return Bp(t),At(this,"_colors",t)}convert(t){const e=No(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,i]of this._colors)if(i.every((r,a)=>r===e[a]))return zo._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?ht.makeHexColor(...e):t}}class Ts{#t=new AbortController;#e=null;#s=new Map;#n=new Map;#r=null;#i=null;#l=null;#o=new $p;#h=null;#c=null;#d=0;#u=new Set;#f=null;#a=null;#p=new Set;_editorUndoBar=null;#m=!1;#g=!1;#b=!1;#_=null;#y=null;#w=null;#S=null;#E=!1;#k=null;#P=new jp;#A=!1;#T=!1;#C=null;#I=null;#L=null;#F=null;#x=vt.NONE;#v=new Set;#O=null;#$=null;#H=null;#U={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#N=[0,0];#D=null;#B=null;#W=null;#M=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=Ts.prototype,e=a=>a.#B.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return At(this,"_keyboardManager",new Si([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&a.#B.contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&a.#B.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-r,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[r,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-r],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,r],checker:e}]]))}constructor(t,e,s,i,r,a,o,l,c,h,u,d,f){const g=this._signal=this.#t.signal;this.#B=t,this.#W=e,this.#r=s,this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:g}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:g}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:g}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:g}),i._on("setpreference",this.onSetPreference.bind(this),{signal:g}),i._on("switchannotationeditorparams",p=>this.updateParams(p.type,p.value),{signal:g}),this.#et(),this.#rt(),this.#q(),this.#i=r.annotationStorage,this.#_=r.filterFactory,this.#$=a,this.#S=o||null,this.#m=l,this.#g=c,this.#b=h,this.#F=u||null,this.viewParameters={realScale:_n.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=d||null,this._supportsPinchToZoom=f!==!1}destroy(){this.#M?.resolve(),this.#M=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#n.values())t.destroy();this.#n.clear(),this.#s.clear(),this.#p.clear(),this.#e=null,this.#v.clear(),this.#o.destroy(),this.#r?.destroy(),this.#k?.hide(),this.#k=null,this.#y&&(clearTimeout(this.#y),this.#y=null),this.#D&&(clearTimeout(this.#D),this.#D=null),this._editorUndoBar?.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#F}get useNewAltTextFlow(){return this.#g}get useNewAltTextWhenAddingImage(){return this.#b}get hcmFilter(){return At(this,"hcmFilter",this.#$?this.#_.addHCMFilter(this.#$.foreground,this.#$.background):"none")}get direction(){return At(this,"direction",getComputedStyle(this.#B).direction)}get highlightColors(){return At(this,"highlightColors",this.#S?new Map(this.#S.split(",").map(t=>t.split("=").map(e=>e.trim()))):null)}get highlightColorNames(){return At(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#c=t}setMainHighlightColorPicker(t){this.#L=t}editAltText(t,e=!1){this.#r?.editAltText(this,t,e)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#b=e;break}}onPageChanging({pageNumber:t}){this.#d=t-1}focusMainContainer(){this.#B.focus()}findParent(t,e){for(const s of this.#n.values()){const{x:i,y:r,width:a,height:o}=s.div.getBoundingClientRect();if(t>=i&&t<=i+a&&e>=r&&e<=r+o)return s}return null}disableUserSelect(t=!1){this.#W.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*_n.PDF_TO_CSS_UNITS;for(const e of this.#p)e.onScaleChanging();this.#c?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#z({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#K(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of this.#n.values())if(s.hasTextLayer(t))return s;return null}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:s,anchorOffset:i,focusNode:r,focusOffset:a}=e,o=e.toString(),c=this.#z(e).closest(".textLayer"),h=this.getSelectionBoxes(c);if(!h)return;e.empty();const u=this.#K(c),d=this.#x===vt.NONE,f=()=>{u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:h,anchorNode:s,anchorOffset:i,focusNode:r,focusOffset:a,text:o}),d&&this.showAllEditors("highlight",!0,!0)};if(d){this.switchToMode(vt.HIGHLIGHT,f);return}f()}#Q(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=this.#z(t).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(this.#k||=new zp(this),this.#k.show(s,i,this.direction==="ltr"))}addToAnnotationStorage(t){!t.isEmpty()&&this.#i&&!this.#i.has(t.id)&&this.#i.setValue(t.id,t)}#tt(){const t=document.getSelection();if(!t||t.isCollapsed){this.#O&&(this.#k?.hide(),this.#O=null,this.#R({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#O)return;const i=this.#z(t).closest(".textLayer");if(!i){this.#O&&(this.#k?.hide(),this.#O=null,this.#R({hasSelectedText:!1}));return}if(this.#k?.hide(),this.#O=e,this.#R({hasSelectedText:!0}),!(this.#x!==vt.HIGHLIGHT&&this.#x!==vt.NONE)&&(this.#x===vt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#E=this.isShiftKeyDown,!this.isShiftKeyDown)){const r=this.#x===vt.HIGHLIGHT?this.#K(i):null;r?.toggleDrawing();const a=new AbortController,o=this.combinedSignal(a),l=c=>{c.type==="pointerup"&&c.button!==0||(a.abort(),r?.toggleDrawing(!0),c.type==="pointerup"&&this.#V("main_toolbar"))};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})}}#V(t=""){this.#x===vt.HIGHLIGHT?this.highlightSelection(t):this.#m&&this.#Q()}#et(){document.addEventListener("selectionchange",this.#tt.bind(this),{signal:this._signal})}#st(){if(this.#w)return;this.#w=new AbortController;const t=this.combinedSignal(this.#w);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#nt(){this.#w?.abort(),this.#w=null}blur(){if(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#V("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#v)if(e.div.contains(t)){this.#I=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#I)return;const[t,e]=this.#I;this.#I=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#q(){if(this.#C)return;this.#C=new AbortController;const t=this.combinedSignal(this.#C);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#it(){this.#C?.abort(),this.#C=null}#X(){if(this.#h)return;this.#h=new AbortController;const t=this.combinedSignal(this.#h);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#Y(){this.#h?.abort(),this.#h=null}#rt(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#q(),this.#X()}removeEditListeners(){this.#it(),this.#Y()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of this.#a)if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of this.#a)if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of this.#v){const i=s.serialize(!0);i&&e.push(i)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const r of e.items)for(const a of this.#a)if(a.isHandlingMimeForPasting(r.type)){a.paste(r,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){_t(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const l of s){const c=await i.deserialize(l);if(!c)return;r.push(c)}const a=()=>{for(const l of r)this.#Z(l);this.#J(r)},o=()=>{for(const l of r)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(r){_t(`paste: "${r.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#x!==vt.NONE&&!this.isEditorHandlingKeyboard&&Ts._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#V("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#R(t){Object.entries(t).some(([s,i])=>this.#U[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#U,t)}),this.#x===vt.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#j([[xt.HIGHLIGHT_FREE,!0]]))}#j(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#st(),this.#X(),this.#R({isEditing:this.#x!==vt.NONE,isEmpty:this.#G(),hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:this.#o.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#nt(),this.#Y(),this.#R({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#a){this.#a=t;for(const e of this.#a)this.#j(e.defaultPropertiesToUpdate)}}getId(){return this.#P.id}get currentLayer(){return this.#n.get(this.#d)}getLayer(t){return this.#n.get(t)}get currentPageIndex(){return this.#d}addLayer(t){this.#n.set(t.pageIndex,t),this.#A?t.enable():t.disable()}removeLayer(t){this.#n.delete(t.pageIndex)}async updateMode(t,e=null,s=!1){if(this.#x!==t&&!(this.#M&&(await this.#M.promise,!this.#M))){if(this.#M=Promise.withResolvers(),this.#x=t,t===vt.NONE){this.setEditingState(!1),this.#ot(),this._editorUndoBar?.hide(),this.#M.resolve();return}this.setEditingState(!0),await this.#at(),this.unselectAll();for(const i of this.#n.values())i.updateMode(t);if(!e){s&&this.addNewEditorFromKeyboard(),this.#M.resolve();return}for(const i of this.#s.values())i.annotationElementId===e?(this.setSelected(i),i.enterInEditMode()):i.unselect();this.#M.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==this.#x&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){if(this.#a){switch(t){case xt.CREATE:this.currentLayer.addNewEditor();return;case xt.HIGHLIGHT_DEFAULT_COLOR:this.#L?.updateColor(e);break;case xt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#H||=new Map).set(t,e),this.showAllEditors("highlight",e);break}for(const s of this.#v)s.updateParams(t,e);for(const s of this.#a)s.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){for(const r of this.#s.values())r.editorType===t&&r.show(e);(this.#H?.get(xt.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#j([[xt.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#T!==t){this.#T=t;for(const e of this.#n.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#at(){if(!this.#A){this.#A=!0;const t=[];for(const e of this.#n.values())t.push(e.enable());await Promise.all(t);for(const e of this.#s.values())e.enable()}}#ot(){if(this.unselectAll(),this.#A){this.#A=!1;for(const t of this.#n.values())t.disable();for(const t of this.#s.values())t.disable()}}getEditors(t){const e=[];for(const s of this.#s.values())s.pageIndex===t&&e.push(s);return e}getEditor(t){return this.#s.get(t)}addEditor(t){this.#s.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.focusMainContainer(),this.#y=null},0)),this.#s.delete(t.id),this.unselect(t),(!t.annotationElementId||!this.#u.has(t.annotationElementId))&&this.#i?.remove(t.id)}addDeletedAnnotationElement(t){this.#u.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#u.has(t)}removeDeletedAnnotationElement(t){this.#u.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#Z(t){const e=this.#n.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#j(t.propertiesToUpdate))}get#lt(){let t=null;for(t of this.#v);return t}updateUI(t){this.#lt===t&&this.#j(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#j(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#v.has(t)){this.#v.delete(t),t.unselect(),this.#R({hasSelectedEditor:this.hasSelection});return}this.#v.add(t),t.select(),this.#j(t.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}setSelected(t){this.#c?.commitOrRemove();for(const e of this.#v)e!==t&&e.unselect();this.#v.clear(),this.#v.add(t),t.select(),this.#j(t.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}isSelected(t){return this.#v.has(t)}get firstSelectedEditor(){return this.#v.values().next().value}unselect(t){t.unselect(),this.#v.delete(t),this.#R({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#v.size!==0}get isEnterHandled(){return this.#v.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#o.undo(),this.#R({hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#G()}),this._editorUndoBar?.hide()}redo(){this.#o.redo(),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:this.#o.hasSomethingToRedo(),isEmpty:this.#G()})}addCommands(t){this.#o.add(t),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#G()})}cleanUndoStack(t){this.#o.cleanType(t)}#G(){if(this.#s.size===0)return!0;if(this.#s.size===1)for(const t of this.#s.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#v],s=()=>{this._editorUndoBar?.show(i,e.length===1?e[0].editorType:e.length);for(const r of e)r.remove()},i=()=>{for(const r of e)this.#Z(r)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#J(t){for(const e of this.#v)e.unselect();this.#v.clear();for(const e of t)e.isEmpty()||(this.#v.add(e),e.select());this.#R({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#v)t.commit();this.#J(this.#s.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#x!==vt.NONE))&&!this.#c?.commitOrRemove()&&this.hasSelection){for(const t of this.#v)t.unselect();this.#v.clear(),this.#R({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#N[0]+=t,this.#N[1]+=e;const[i,r]=this.#N,a=[...this.#v],o=1e3;this.#D&&clearTimeout(this.#D),this.#D=setTimeout(()=>{this.#D=null,this.#N[0]=this.#N[1]=0,this.addCommands({cmd:()=>{for(const l of a)this.#s.has(l.id)&&l.translateInPage(i,r)},undo:()=>{for(const l of a)this.#s.has(l.id)&&l.translateInPage(-i,-r)},mustExec:!1})},o);for(const l of a)l.translateInPage(t,e)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#f=new Map;for(const t of this.#v)this.#f.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#f)return!1;this.disableUserSelect(!1);const t=this.#f;this.#f=null;let e=!1;for(const[{x:i,y:r,pageIndex:a},o]of t)o.newX=i,o.newY=r,o.newPageIndex=a,e||=i!==o.savedX||r!==o.savedY||a!==o.savedPageIndex;if(!e)return!1;const s=(i,r,a,o)=>{if(this.#s.has(i.id)){const l=this.#n.get(o);l?i._setParentAndPosition(l,r,a):(i.pageIndex=o,i.x=r,i.y=a)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:a,newPageIndex:o}]of t)s(i,r,a,o)},undo:()=>{for(const[i,{savedX:r,savedY:a,savedPageIndex:o}]of t)s(i,r,a,o)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#f)for(const s of this.#f.keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#v.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#x}get imageManager(){return At(this,"imageManager",new Bo)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let c=0,h=e.rangeCount;c<h;c++)if(!t.contains(e.getRangeAt(c).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:a}=t.getBoundingClientRect();let o;switch(t.getAttribute("data-main-rotation")){case"90":o=(c,h,u,d)=>({x:(h-i)/a,y:1-(c+u-s)/r,width:d/a,height:u/r});break;case"180":o=(c,h,u,d)=>({x:1-(c+u-s)/r,y:1-(h+d-i)/a,width:u/r,height:d/a});break;case"270":o=(c,h,u,d)=>({x:1-(h+d-i)/a,y:(c-s)/r,width:d/a,height:u/r});break;default:o=(c,h,u,d)=>({x:(c-s)/r,y:(h-i)/a,width:u/r,height:d/a});break}const l=[];for(let c=0,h=e.rangeCount;c<h;c++){const u=e.getRangeAt(c);if(!u.collapsed)for(const{x:d,y:f,width:g,height:p}of u.getClientRects())g===0||p===0||l.push(o(d,f,g,p))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#l||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#l?.delete(t)}renderAnnotationElement(t){const e=this.#l?.get(t.data.id);if(!e)return;const s=this.#i.getRawValue(e);s&&(this.#x===vt.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}}class Ge{#t=null;#e=!1;#s=null;#n=null;#r=null;#i=null;#l=!1;#o=null;#h=null;#c=null;#d=null;#u=!1;static#f=null;static _l10n=null;constructor(t){this.#h=t,this.#u=t._uiManager.useNewAltTextFlow,Ge.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){Ge._l10n??=t}async render(){const t=this.#s=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#n=document.createElement("span");t.append(e),this.#u?(t.classList.add("new"),t.setAttribute("data-l10n-id",Ge.#f.missing),e.setAttribute("data-l10n-id",Ge.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=this.#h._uiManager._signal;t.addEventListener("contextmenu",ze,{signal:s}),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),this.#h._uiManager.editAltText(this.#h),this.#u&&this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#a}})};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(this.#l=!0,i(r))},{signal:s}),await this.#p(),t}get#a(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#s&&(this.#s.focus({focusVisible:this.#l}),this.#l=!1)}isEmpty(){return this.#u?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#u?this.#t!==null||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}async setGuessedText(t){this.#t===null&&(this.#c=t,this.#d=await Ge._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#p())}toggleAltTextBadge(t=!1){if(!this.#u||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#h.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#c===e&&(e=this.#d),{altText:e,decorative:this.#e,guessedText:this.#c,textWithDisclaimer:this.#d}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:i,cancel:r=!1}){s&&(this.#c=s,this.#d=i),!(this.#t===t&&this.#e===e)&&(r||(this.#t=t,this.#e=e),this.#p())}toggle(t=!1){this.#s&&(!t&&this.#i&&(clearTimeout(this.#i),this.#i=null),this.#s.disabled=!t)}shown(){this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#a}})}destroy(){this.#s?.remove(),this.#s=null,this.#n=null,this.#r=null,this.#o?.remove(),this.#o=null}async#p(){const t=this.#s;if(!t)return;if(this.#u){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",Ge.#f[this.#a]),this.#n?.setAttribute("data-l10n-id",Ge.#f[`${this.#a}-label`]),!this.#t){this.#r?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#r?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#r;if(!e){this.#r=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#h.id}`;const i=100,r=this.#h._uiManager._signal;r.addEventListener("abort",()=>{clearTimeout(this.#i),this.#i=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#i=setTimeout(()=>{this.#i=null,this.#r.classList.add("show"),this.#h._reportTelemetry({action:"alt_text_tooltip"})},i)},{signal:r}),t.addEventListener("mouseleave",()=>{this.#i&&(clearTimeout(this.#i),this.#i=null),this.#r?.classList.remove("show")},{signal:r})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#h.getImageForAltText()?.setAttribute("aria-describedby",e.id)}}class Gr{#t;#e=!1;#s=null;#n;#r;#i;#l;#o;#h=null;#c;#d=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:r=null,onPinchEnd:a=null,signal:o}){this.#t=t,this.#s=s,this.#n=e,this.#r=i,this.#i=r,this.#l=a,this.#c=new AbortController,this.#o=AbortSignal.any([o,this.#c.signal]),t.addEventListener("touchstart",this.#u.bind(this),{passive:!1,signal:this.#o})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return At(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}#u(t){if(this.#n?.()||t.touches.length<2)return;if(!this.#d){this.#d=new AbortController;const i=AbortSignal.any([this.#o,this.#d.signal]),r=this.#t,a={signal:i,passive:!1};r.addEventListener("touchmove",this.#f.bind(this),a),r.addEventListener("touchend",this.#a.bind(this),a),r.addEventListener("touchcancel",this.#a.bind(this),a),this.#r?.()}if(Ee(t),t.touches.length!==2||this.#s?.()){this.#h=null;return}let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]),this.#h={touch0X:e.screenX,touch0Y:e.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#f(t){if(!this.#h||t.touches.length!==2)return;let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]);const{screenX:i,screenY:r}=e,{screenX:a,screenY:o}=s,l=this.#h,{touch0X:c,touch0Y:h,touch1X:u,touch1Y:d}=l,f=u-c,g=d-h,p=a-i,y=o-r,m=Math.hypot(p,y)||1,v=Math.hypot(f,g)||1;if(!this.#e&&Math.abs(v-m)<=Gr.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=r,l.touch1X=a,l.touch1Y=o,t.preventDefault(),!this.#e){this.#e=!0;return}const w=[(i+a)/2,(r+o)/2];this.#i?.(w,v,m)}#a(t){this.#d.abort(),this.#d=null,this.#l?.(),this.#h&&(t.preventDefault(),this.#h=null,this.#e=!1)}destroy(){this.#c?.abort(),this.#c=null}}class pt{#t=null;#e=null;#s=null;#n=!1;#r=null;#i="";#l=!1;#o=null;#h=null;#c=null;#d=null;#u="";#f=!1;#a=null;#p=!1;#m=!1;#g=!1;#b=null;#_=0;#y=0;#w=null;#S=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#E=!1;#k=pt._zIndex++;static _borderLineWidth=-1;static _colorManager=new zo;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=pt.prototype._resizeWithKeyboard,e=Ts.TRANSLATE_SMALL,s=Ts.TRANSLATE_BIG;return At(this,"_resizerKeyboardManager",new Si([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],pt.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;const{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:a}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,a];const[o,l]=this.parentDimensions;this.x=t.x/o,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return At(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new Hp({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(pt._l10n??=t,pt._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),pt._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);pt._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Mt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#E}set _isDraggable(t){this.#E=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#k}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#z(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#f?this.#f=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){const[r,a]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(t+s)/r,this.y=(e+i)/a,this.fixAndSetPosition()}#P([t,e],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/t,this.y+=i/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#P(this.parentDimensions,t,e)}translateInPage(t,e){this.#a||=[this.x,this.y,this.width,this.height],this.#P(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}drag(t,e){this.#a||=[this.x,this.y,this.width,this.height];const{div:s,parentDimensions:[i,r]}=this;if(this.x+=t/i,this.y+=e/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:d}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,d)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,c]=this.getBaseTranslation();a+=l,o+=c;const{style:h}=s;h.left=`${(100*a).toFixed(2)}%`,h.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#a&&(this.#a[0]!==this.x||this.#a[1]!==this.y)}get _hasBeenResized(){return!!this.#a&&(this.#a[2]!==this.width||this.#a[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=pt,i=s/t,r=s/e;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,i]}=this;let{x:r,y:a,width:o,height:l}=this;if(o*=s,l*=i,r*=s,a*=i,this._mustFixPosition)switch(t){case 0:r=Math.max(0,Math.min(s-o,r)),a=Math.max(0,Math.min(i-l,a));break;case 90:r=Math.max(0,Math.min(s-l,r)),a=Math.min(i,Math.max(o,a));break;case 180:r=Math.min(s,Math.max(o,r)),a=Math.min(i,Math.max(l,a));break;case 270:r=Math.min(s,Math.max(l,r)),a=Math.max(0,Math.min(i-o,a));break}this.x=r/=s,this.y=a/=i;const[c,h]=this.getBaseTranslation();r+=c,a+=h,e.left=`${(100*r).toFixed(2)}%`,e.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}static#A(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return pt.#A(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return pt.#A(t,e,360-this.parentRotation)}#T(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(t,e){const[s,i]=this.parentDimensions,{style:r}=this.div;r.width=`${(100*t/s).toFixed(2)}%`,this.#l||(r.height=`${(100*e/i).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:s}=t,i=s.endsWith("%"),r=!this.#l&&e.endsWith("%");if(i&&r)return;const[a,o]=this.parentDimensions;i||(t.width=`${(100*parseFloat(s)/a).toFixed(2)}%`),!this.#l&&!r&&(t.height=`${(100*parseFloat(e)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#C(){if(this.#o)return;this.#o=document.createElement("div"),this.#o.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const i=document.createElement("div");this.#o.append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",this.#I.bind(this,s),{signal:e}),i.addEventListener("contextmenu",ze,{signal:e}),i.tabIndex=-1}this.div.prepend(this.#o)}#I(t,e){e.preventDefault();const{isMac:s}=me.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#s?.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,this.#h=[e.screenX,e.screenY];const r=new AbortController,a=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#x.bind(this,t),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Ee,{passive:!1,signal:a}),window.addEventListener("contextmenu",ze,{signal:a}),this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const c=()=>{r.abort(),this.parent.togglePointerEvents(!0),this.#s?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=o,this.div.style.cursor=l,this.#F()};window.addEventListener("pointerup",c,{signal:a}),window.addEventListener("blur",c,{signal:a})}#L(t,e,s,i){this.width=s,this.height=i,this.x=t,this.y=e;const[r,a]=this.parentDimensions;this.setDims(r*s,a*i),this.fixAndSetPosition(),this._onResized()}_onResized(){}#F(){if(!this.#c)return;const{savedX:t,savedY:e,savedWidth:s,savedHeight:i}=this.#c;this.#c=null;const r=this.x,a=this.y,o=this.width,l=this.height;r===t&&a===e&&o===s&&l===i||this.addCommands({cmd:this.#L.bind(this,r,a,o,l),undo:this.#L.bind(this,t,e,s,i),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#x(t,e){const[s,i]=this.parentDimensions,r=this.x,a=this.y,o=this.width,l=this.height,c=pt.MIN_SIZE/s,h=pt.MIN_SIZE/i,u=this.#T(this.rotation),d=(Y,L)=>[u[0]*Y+u[2]*L,u[1]*Y+u[3]*L],f=this.#T(360-this.rotation),g=(Y,L)=>[f[0]*Y+f[2]*L,f[1]*Y+f[3]*L];let p,y,m=!1,v=!1;switch(t){case"topLeft":m=!0,p=(Y,L)=>[0,0],y=(Y,L)=>[Y,L];break;case"topMiddle":p=(Y,L)=>[Y/2,0],y=(Y,L)=>[Y/2,L];break;case"topRight":m=!0,p=(Y,L)=>[Y,0],y=(Y,L)=>[0,L];break;case"middleRight":v=!0,p=(Y,L)=>[Y,L/2],y=(Y,L)=>[0,L/2];break;case"bottomRight":m=!0,p=(Y,L)=>[Y,L],y=(Y,L)=>[0,0];break;case"bottomMiddle":p=(Y,L)=>[Y/2,L],y=(Y,L)=>[Y/2,0];break;case"bottomLeft":m=!0,p=(Y,L)=>[0,L],y=(Y,L)=>[Y,0];break;case"middleLeft":v=!0,p=(Y,L)=>[0,L/2],y=(Y,L)=>[Y,L/2];break}const w=p(o,l),A=y(o,l);let S=d(...A);const k=pt._round(r+S[0]),C=pt._round(a+S[1]);let z=1,T=1,V,Z;if(e.fromKeyboard)({deltaX:V,deltaY:Z}=e);else{const{screenX:Y,screenY:L}=e,[et,N]=this.#h;[V,Z]=this.screenToPageTranslation(Y-et,L-N),this.#h[0]=Y,this.#h[1]=L}if([V,Z]=g(V/s,Z/i),m){const Y=Math.hypot(o,l);z=T=Math.max(Math.min(Math.hypot(A[0]-w[0]-V,A[1]-w[1]-Z)/Y,1/o,1/l),c/o,h/l)}else v?z=Math.max(c,Math.min(1,Math.abs(A[0]-w[0]-V)))/o:T=Math.max(h,Math.min(1,Math.abs(A[1]-w[1]-Z)))/l;const P=pt._round(o*z),U=pt._round(l*T);S=d(...y(P,U));const _=k-S[0],q=C-S[1];this.#a||=[this.x,this.y,this.width,this.height],this.width=P,this.height=U,this.x=_,this.y=q,this.setDims(s*P,i*U),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#s?.finish()}async addEditToolbar(){return this._editToolbar||this.#m?this._editToolbar:(this._editToolbar=new Yn(this),this.div.append(this._editToolbar.render()),this.#s&&await this._editToolbar.addAltText(this.#s),this._editToolbar)}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#s?.destroy())}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#s||(Ge.initialize(pt._l10n),this.#s=new Ge(this),this.#t&&(this.#s.data=this.#t,this.#t=null),await this.addEditToolbar())}get altTextData(){return this.#s?.data}set altTextData(t){this.#s&&(this.#s.data=t)}get guessedAltText(){return this.#s?.guessedText}async setGuessedAltText(t){await this.#s?.setGuessedText(t)}serializeAltText(t){return this.#s?.serialize(t)}hasAltText(){return!!this.#s&&!this.#s.isEmpty()}hasAltTextData(){return this.#s?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#n?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#N();const[t,e]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*e/t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*t/e).toFixed(2)}%`);const[s,i]=this.getInitialTranslation();return this.translate(s,i),mr(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#S||=new Gr({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#v.bind(this),onPinching:this.#O.bind(this),onPinchEnd:this.#$.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),this.div}#v(){this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#s?.toggle(!1),this.parent.togglePointerEvents(!1)}#O(t,e,s){let r=.7*(s/e)+1-.7;if(r===1)return;const a=this.#T(this.rotation),o=(k,C)=>[a[0]*k+a[2]*C,a[1]*k+a[3]*C],[l,c]=this.parentDimensions,h=this.x,u=this.y,d=this.width,f=this.height,g=pt.MIN_SIZE/l,p=pt.MIN_SIZE/c;r=Math.max(Math.min(r,1/d,1/f),g/d,p/f);const y=pt._round(d*r),m=pt._round(f*r);if(y===d&&m===f)return;this.#a||=[h,u,d,f];const v=o(d/2,f/2),w=pt._round(h+v[0]),A=pt._round(u+v[1]),S=o(y/2,m/2);this.x=w-S[0],this.y=A-S[1],this.width=y,this.height=m,this.setDims(l*y,c*m),this.fixAndSetPosition(),this._onResizing()}#$(){this.#s?.toggle(!0),this.parent.togglePointerEvents(!0),this.#F()}pointerdown(t){const{isMac:e}=me.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#f=!0,this._isDraggable){this.#U(t);return}this.#H(t)}get isSelected(){return this._uiManager.isSelected(this)}#H(t){const{isMac:e}=me.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#U(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,r=this._uiManager.combinedSignal(i),a={capture:!0,passive:!1,signal:r},o=c=>{i.abort(),this.#r=null,this.#f=!1,this._uiManager.endDragSession()||this.#H(c),s&&this._onStopDragging()};e&&(this.#_=t.clientX,this.#y=t.clientY,this.#r=t.pointerId,this.#i=t.pointerType,window.addEventListener("pointermove",c=>{s||(s=!0,this._onStartDragging());const{clientX:h,clientY:u,pointerId:d}=c;if(d!==this.#r){Ee(c);return}const[f,g]=this.screenToPageTranslation(h-this.#_,u-this.#y);this.#_=h,this.#y=u,this._uiManager.dragSelectedEditors(f,g)},a),window.addEventListener("touchmove",Ee,a),window.addEventListener("pointerdown",c=>{c.pointerType===this.#i&&(this.#S||c.isPrimary)&&o(c),Ee(c)},a));const l=c=>{if(!this.#r||this.#r===c.pointerId){o(c);return}Ee(c)};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#b&&clearTimeout(this.#b),this.#b=setTimeout(()=>{this.#b=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const i=this.parentScale,[r,a]=this.pageDimensions,[o,l]=this.pageTranslation,c=t/i,h=e/i,u=this.x*r,d=this.y*a,f=this.width*r,g=this.height*a;switch(s){case 0:return[u+c+o,a-d-h-g+l,u+c+f+o,a-d-h+l];case 90:return[u+h+o,a-d+c+l,u+h+g+o,a-d+c+f+l];case 180:return[u-c-f+o,a-d+h+l,u-c+o,a-d+h+g+l];case 270:return[u-h-g+o,a-d-c-f+l,u-h+o,a-d-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,i,r,a]=t,o=r-s,l=a-i;switch(this.rotation){case 0:return[s,e-a,o,l];case 90:return[s,e-i,l,o];case 180:return[r,e-i,o,l];case 270:return[r,e-a,l,o];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){this.#m=!0}disableEditMode(){this.#m=!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#g}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:r,innerWidth:a}=window;return e<a&&i>0&&t<r&&s>0}#N(){if(this.#d||!this.div)return;this.#d=new AbortController;const t=this._uiManager.combinedSignal(this.#d);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#N()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){Mt("An editor must be serializable")}static async deserialize(t,e,s){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s});i.rotation=t.rotation,i.#t=t.accessibilityData;const[r,a]=i.pageDimensions,[o,l,c,h]=i.getRectInCurrentCoords(t.rect,a);return i.x=o/r,i.y=l/a,i.width=c/r,i.height=h/a,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#d?.abort(),this.#d=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#b&&(clearTimeout(this.#b),this.#b=null),this.#z(),this.removeEditToolbar(),this.#w){for(const t of this.#w.values())clearTimeout(t);this.#w=null}this.parent=null,this.#S?.destroy(),this.#S=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#C(),this.#o.classList.remove("hidden"),mr(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#o.children;if(!this.#e){this.#e=Array.from(e);const a=this.#D.bind(this),o=this.#B.bind(this),l=this._uiManager._signal;for(const c of this.#e){const h=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",a,{signal:l}),c.addEventListener("blur",o,{signal:l}),c.addEventListener("focus",this.#W.bind(this,h),{signal:l}),c.setAttribute("data-l10n-id",pt._l10nResizer[h])}}const s=this.#e[0];let i=0;for(const a of e){if(a===s)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(r!==i){if(r<i)for(let o=0;o<i-r;o++)this.#o.append(this.#o.firstChild);else if(r>i)for(let o=0;o<r-i;o++)this.#o.firstChild.before(this.#o.lastChild);let a=0;for(const o of e){const c=this.#e[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",pt._l10nResizer[c])}}this.#M(0),this.#g=!0,this.#o.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#D(t){pt._resizerKeyboardManager.exec(this,t)}#B(t){this.#g&&t.relatedTarget?.parentNode!==this.#o&&this.#z()}#W(t){this.#u=this.#g?t:""}#M(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#g&&this.#x(this.#u,{deltaX:t,deltaY:e,fromKeyboard:!0})}#z(){this.#g=!1,this.#M(-1),this.#F()}_stopResizingWithKeyboard(){this.#z(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#s?.toggleAltTextBadge(!1)}unselect(){this.#o?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#s?.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(t){this.#p=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#l=!0;const s=t/e,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#w||=new Map;const{action:s}=t;let i=this.#w.get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),this.#w.delete(s),this.#w.size===0&&(this.#w=null)},pt._telemetryTimeout),this.#w.set(s,i);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#n=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#n=!0}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class Hp extends pt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Gl=3285377520,Te=4294901760,He=65535;class Mh{constructor(t){this.h1=t?t&4294967295:Gl,this.h2=t?t&4294967295:Gl}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let p=0,y=t.length;p<y;p++){const m=t.charCodeAt(p);m<=255?e[s++]=m:(e[s++]=m>>>8,e[s++]=m&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,r=s-i*4,a=new Uint32Array(e.buffer,0,i);let o=0,l=0,c=this.h1,h=this.h2;const u=3432918353,d=461845907,f=u&He,g=d&He;for(let p=0;p<i;p++)p&1?(o=a[p],o=o*u&Te|o*f&He,o=o<<15|o>>>17,o=o*d&Te|o*g&He,c^=o,c=c<<13|c>>>19,c=c*5+3864292196):(l=a[p],l=l*u&Te|l*f&He,l=l<<15|l>>>17,l=l*d&Te|l*g&He,h^=l,h=h<<13|h>>>19,h=h*5+3864292196);switch(o=0,r){case 3:o^=e[i*4+2]<<16;case 2:o^=e[i*4+1]<<8;case 1:o^=e[i*4],o=o*u&Te|o*f&He,o=o<<15|o>>>17,o=o*d&Te|o*g&He,i&1?c^=o:h^=o}this.h1=c,this.h2=h}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Te|t*36045&He,e=e*4283543511&Te|((e<<16|t>>>16)*2950163797&Te)>>>16,t^=e>>>1,t=t*444984403&Te|t*60499&He,e=e*3301882366&Te|((e<<16|t>>>16)*3120437893&Te)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const Na=Object.freeze({map:null,hash:"",transfer:void 0});class jo{#t=!1;#e=null;#s=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=this.#s.get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return this.#s.get(t)}remove(t){if(this.#s.delete(t),this.#s.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of this.#s.values())if(e instanceof pt)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=this.#s.get(t);let i=!1;if(s!==void 0)for(const[r,a]of Object.entries(e))s[r]!==a&&(i=!0,s[r]=a);else i=!0,this.#s.set(t,e);i&&this.#n(),e instanceof pt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#s.has(t)}getAll(){return this.#s.size>0?Oo(this.#s):null}setAll(t){for(const[e,s]of Object.entries(t))this.setValue(e,s)}get size(){return this.#s.size}#n(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Oh(this)}get serializable(){if(this.#s.size===0)return Na;const t=new Map,e=new Mh,s=[],i=Object.create(null);let r=!1;for(const[a,o]of this.#s){const l=o instanceof pt?o.serialize(!1,i):o;l&&(t.set(a,l),e.update(`${a}:${JSON.stringify(l)}`),r||=!!l.bitmap)}if(r)for(const a of t.values())a.bitmap&&s.push(a.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:Na}get editorStats(){let t=null;const e=new Map;for(const s of this.#s.values()){if(!(s instanceof pt))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:r}=i;e.has(r)||e.set(r,Object.getPrototypeOf(s).constructor),t||=Object.create(null);const a=t[r]||=new Map;for(const[o,l]of Object.entries(i)){if(o==="type")continue;let c=a.get(o);c||(c=new Map,a.set(o,c));const h=c.get(l)??0;c.set(l,h+1)}}for(const[s,i]of e)t[s]=i.computeTelemetryFinalData(t[s]);return t}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;const t=[];for(const e of this.#s.values())!(e instanceof pt)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}}class Oh extends jo{#t;constructor(t){super();const{map:e,hash:s,transfer:i}=t.serializable,r=structuredClone(e,i?{transfer:i}:null);this.#t={map:r,hash:s,transfer:i}}get print(){Mt("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return At(this,"modifiedIds",{ids:new Set,hash:""})}}class Up{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,_inspectFont:e}){if(!(!t||this.#t.has(t.loadedName))){if(Wt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:i,style:r}=t,a=new FontFace(s,i,r);this.addNativeFontFace(a);try{await a.load(),this.#t.add(s),e?.(t)}catch{_t(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}Mt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw _t(`Failed to load font '${s.family}': '${i}'.`),t.disableFontFace=!0,i}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return At(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let t=!1;return(re||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0),At(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){function e(){for(Wt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:e,callback:t};return s.push(i),i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return At(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(A,S){return A.charCodeAt(S)<<24|A.charCodeAt(S+1)<<16|A.charCodeAt(S+2)<<8|A.charCodeAt(S+3)&255}function i(A,S,k,C){const z=A.substring(0,S),T=A.substring(S+k);return z+C+T}let r,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let c=0;function h(A,S){if(++c>30){_t("Load test font never loaded."),S();return}if(l.font="30px "+A,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){S();return}setTimeout(h.bind(null,A,S))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let d=this._loadTestFont;d=i(d,976,u.length,u);const g=16,p=1482184792;let y=s(d,g);for(r=0,a=u.length-3;r<a;r+=4)y=y-p+s(u,r)|0;r<u.length&&(y=y-p+s(u+"XXX",r)|0),d=i(d,g,4,Tp(y));const m=`url(data:font/opentype;base64,${btoa(d)});`,v=`@font-face {font-family:"${u}";src:${m}}`;this.insertRule(v);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const A of[t.loadedName,u]){const S=this._document.createElement("span");S.textContent="Hi",S.style.fontFamily=A,w.append(S)}this._document.body.append(w),h(u,()=>{w.remove(),e.complete()})}}class Wp{constructor(t,{disableFontFace:e=!1,fontExtraProperties:s=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(const r in t)this[r]=t[r];this.disableFontFace=e===!0,this.fontExtraProperties=s===!0,this._inspectFont=i}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Lp(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const s=this.loadedName+"_path_"+e;let i;try{i=t.get(s)}catch(a){_t(`getPathGenerator - ignoring character: "${a}".`)}const r=new Path2D(i||"");return this.fontExtraProperties||t.delete(s),this.compiledGlyphs[e]=r}}const Oi={DATA:1,ERROR:2},Ut={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Vl(){}function ve(n){if(n instanceof ks||n instanceof Da||n instanceof li||n instanceof Hl||n instanceof gr||n instanceof la)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||Mt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new ks(n.message);case"InvalidPDFException":return new Da(n.message);case"MissingPDFException":return new li(n.message);case"PasswordException":return new Hl(n.message,n.code);case"UnexpectedResponseException":return new gr(n.message,n.status);case"UnknownErrorException":return new la(n.message,n.details)}return new la(n.message,n.toString())}class Nn{#t=new AbortController;constructor(t,e,s){this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#n(t);return}if(t.callback){const s=t.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],t.callback===Oi.DATA)i.resolve(t.data);else if(t.callback===Oi.ERROR)i.reject(ve(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const s=this.sourceName,i=t.sourceName,r=this.comObj;Promise.try(e,t.data).then(function(a){r.postMessage({sourceName:s,targetName:i,callback:Oi.DATA,callbackId:t.callbackId,data:a})},function(a){r.postMessage({sourceName:s,targetName:i,callback:Oi.ERROR,callbackId:t.callbackId,reason:ve(a)})});return}if(t.streamId){this.#s(t);return}e(t.data)}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(a){r.reject(a)}return r.promise}sendWithStream(t,e,s,i){const r=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{const h=Promise.withResolvers();return this.streamControllers[r]={controller:c,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:t,streamId:r,data:e,desiredSize:c.desiredSize},i),h.promise},pull:c=>{const h=Promise.withResolvers();return this.streamControllers[r].pullCall=h,l.postMessage({sourceName:a,targetName:o,stream:Ut.PULL,streamId:r,desiredSize:c.desiredSize}),h.promise},cancel:c=>{Wt(c instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[r].cancelCall=h,this.streamControllers[r].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:Ut.CANCEL,streamId:r,reason:ve(c)}),h.promise}},s)}#s(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,r=this.comObj,a=this,o=this.actionHandler[t.action],l={enqueue(c,h=1,u){if(this.isCancelled)return;const d=this.desiredSize;this.desiredSize-=h,d>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:Ut.ENQUEUE,streamId:e,chunk:c},u)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:Ut.CLOSE,streamId:e}),delete a.streamSinks[e])},error(c){Wt(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:Ut.ERROR,streamId:e,reason:ve(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(o,t.data,l).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Ut.START_COMPLETE,streamId:e,success:!0})},function(c){r.postMessage({sourceName:s,targetName:i,stream:Ut.START_COMPLETE,streamId:e,reason:ve(c)})})}#n(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,r=this.comObj,a=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case Ut.START_COMPLETE:t.success?a.startCall.resolve():a.startCall.reject(ve(t.reason));break;case Ut.PULL_COMPLETE:t.success?a.pullCall.resolve():a.pullCall.reject(ve(t.reason));break;case Ut.PULL:if(!o){r.postMessage({sourceName:s,targetName:i,stream:Ut.PULL_COMPLETE,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||Vl).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Ut.PULL_COMPLETE,streamId:e,success:!0})},function(c){r.postMessage({sourceName:s,targetName:i,stream:Ut.PULL_COMPLETE,streamId:e,reason:ve(c)})});break;case Ut.ENQUEUE:if(Wt(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(t.chunk);break;case Ut.CLOSE:if(Wt(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this.#r(a,e);break;case Ut.ERROR:Wt(a,"error should have stream controller"),a.controller.error(ve(t.reason)),this.#r(a,e);break;case Ut.CANCEL_COMPLETE:t.success?a.cancelCall.resolve():a.cancelCall.reject(ve(t.reason)),this.#r(a,e);break;case Ut.CANCEL:if(!o)break;const l=ve(t.reason);Promise.try(o.onCancel||Vl,l).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Ut.CANCEL_COMPLETE,streamId:e,success:!0})},function(c){r.postMessage({sourceName:s,targetName:i,stream:Ut.CANCEL_COMPLETE,streamId:e,reason:ve(c)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#r(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class Lh{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Mt("Abstract method `_createCanvas` called.")}}class Gp extends Lh{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class Dh{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Mt("Abstract method `_fetch` called.")}}class Fh extends Dh{async _fetch(t){const e=await Ur(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Hr(e)}}class Nh{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,r){return"none"}destroy(t=!1){}}class Vp extends Nh{#t;#e;#s;#n;#r;#i;#l=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#n=t,this.#r=e}get#o(){return this.#e||=new Map}get#h(){return this.#i||=new Map}get#c(){if(!this.#s){const t=this.#r.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const s=this.#r.createElementNS(ts,"svg");s.setAttribute("width",0),s.setAttribute("height",0),this.#s=this.#r.createElementNS(ts,"defs"),t.append(s),s.append(this.#s),this.#r.body.append(t)}return this.#s}#d(t){if(t.length===1){const l=t[0],c=new Array(256);for(let u=0;u<256;u++)c[u]=l[u]/255;const h=c.join(",");return[h,h,h]}const[e,s,i]=t,r=new Array(256),a=new Array(256),o=new Array(256);for(let l=0;l<256;l++)r[l]=e[l]/255,a[l]=s[l]/255,o[l]=i[l]/255;return[r.join(","),a.join(","),o.join(",")]}#u(t){if(this.#t===void 0){this.#t="";const e=this.#r.URL;e!==this.#r.baseURI&&(Wr(e)?_t('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=e.split("#",1)[0])}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[s,i,r]=this.#d(t),a=t.length===1?s:`${s}${i}${r}`;if(e=this.#o.get(a),e)return this.#o.set(t,e),e;const o=`g_${this.#n}_transfer_map_${this.#l++}`,l=this.#u(o);this.#o.set(t,l),this.#o.set(a,l);const c=this.#p(o);return this.#g(s,i,r,c),l}addHCMFilter(t,e){const s=`${t}-${e}`,i="base";let r=this.#h.get(i);if(r?.key===s||(r?(r.filter?.remove(),r.key=s,r.url="none",r.filter=null):(r={key:s,url:"none",filter:null},this.#h.set(i,r)),!t||!e))return r.url;const a=this.#_(t);t=ht.makeHexColor(...a);const o=this.#_(e);if(e=ht.makeHexColor(...o),this.#c.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return r.url;const l=new Array(256);for(let f=0;f<=255;f++){const g=f/255;l[f]=g<=.03928?g/12.92:((g+.055)/1.055)**2.4}const c=l.join(","),h=`g_${this.#n}_hcm_filter`,u=r.filter=this.#p(h);this.#g(c,c,c,u),this.#a(u);const d=(f,g)=>{const p=a[f]/255,y=o[f]/255,m=new Array(g+1);for(let v=0;v<=g;v++)m[v]=p+v/g*(y-p);return m.join(",")};return this.#g(d(0,5),d(1,5),d(2,5),u),r.url=this.#u(h),r.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[s]=this.#d([t]),i=`alpha_${s}`;if(e=this.#o.get(i),e)return this.#o.set(t,e),e;const r=`g_${this.#n}_alpha_map_${this.#l++}`,a=this.#u(r);this.#o.set(t,a),this.#o.set(i,a);const o=this.#p(r);return this.#b(s,o),a}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let s,i;if(t?([s]=this.#d([t]),i=`luminosity_${s}`):i="luminosity",e=this.#o.get(i),e)return this.#o.set(t,e),e;const r=`g_${this.#n}_luminosity_map_${this.#l++}`,a=this.#u(r);this.#o.set(t,a),this.#o.set(i,a);const o=this.#p(r);return this.#f(o),t&&this.#b(s,o),a}addHighlightHCMFilter(t,e,s,i,r){const a=`${e}-${s}-${i}-${r}`;let o=this.#h.get(t);if(o?.key===a||(o?(o.filter?.remove(),o.key=a,o.url="none",o.filter=null):(o={key:a,url:"none",filter:null},this.#h.set(t,o)),!e||!s))return o.url;const[l,c]=[e,s].map(this.#_.bind(this));let h=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[d,f]=[i,r].map(this.#_.bind(this));u<h&&([h,u,d,f]=[u,h,f,d]),this.#c.style.color="";const g=(m,v,w)=>{const A=new Array(256),S=(u-h)/w,k=m/255,C=(v-m)/(255*w);let z=0;for(let T=0;T<=w;T++){const V=Math.round(h+T*S),Z=k+T*C;for(let P=z;P<=V;P++)A[P]=Z;z=V+1}for(let T=z;T<256;T++)A[T]=A[z-1];return A.join(",")},p=`g_${this.#n}_hcm_${t}_filter`,y=o.filter=this.#p(p);return this.#a(y),this.#g(g(d[0],f[0],5),g(d[1],f[1],5),g(d[2],f[2],5),y),o.url=this.#u(p),o.url}destroy(t=!1){t&&this.#i?.size||(this.#s?.parentNode.parentNode.remove(),this.#s=null,this.#e?.clear(),this.#e=null,this.#i?.clear(),this.#i=null,this.#l=0)}#f(t){const e=this.#r.createElementNS(ts,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#a(t){const e=this.#r.createElementNS(ts,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#p(t){const e=this.#r.createElementNS(ts,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#c.append(e),e}#m(t,e,s){const i=this.#r.createElementNS(ts,e);i.setAttribute("type","discrete"),i.setAttribute("tableValues",s),t.append(i)}#g(t,e,s,i){const r=this.#r.createElementNS(ts,"feComponentTransfer");i.append(r),this.#m(r,"feFuncR",t),this.#m(r,"feFuncG",e),this.#m(r,"feFuncB",s)}#b(t,e){const s=this.#r.createElementNS(ts,"feComponentTransfer");e.append(s),this.#m(s,"feFuncA",t)}#_(t){return this.#c.style.color=t,No(getComputedStyle(this.#c).getPropertyValue("color"))}}class Bh{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Mt("Abstract method `_fetch` called.")}}class zh extends Bh{async _fetch(t){const e=await Ur(t,"arraybuffer");return new Uint8Array(e)}}re&&_t("Please use the `legacy` build in Node.js environments.");async function jh(n){const e=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(e)}class Kp extends Nh{}class qp extends Lh{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class Xp extends Dh{async _fetch(t){return jh(t)}}class Yp extends Bh{async _fetch(t){return jh(t)}}const se={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ba(n,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,s),n.clip(i)}class $o{getPattern(){Mt("Abstract method `getPattern` called.")}}class Zp extends $o{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)e.addColorStop(s[0],s[1]);return e}getPattern(t,e,s,i){let r;if(i===se.STROKE||i===se.FILL){const a=e.current.getClippedPathBoundingBox(i,Ft(t))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,c=e.cachedCanvases.getCanvas("pattern",o,l),h=c.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-a[0],-a[1]),s=ht.transform(s,[1,0,0,1,a[0],a[1]]),h.transform(...e.baseTransform),this.matrix&&h.transform(...this.matrix),Ba(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),r=t.createPattern(c.canvas,"no-repeat");const u=new DOMMatrix(s);r.setTransform(u)}else Ba(t,this._bbox),r=this._createGradient(t);return r}}function ua(n,t,e,s,i,r,a,o){const l=t.coords,c=t.colors,h=n.data,u=n.width*4;let d;l[e+1]>l[s+1]&&(d=e,e=s,s=d,d=r,r=a,a=d),l[s+1]>l[i+1]&&(d=s,s=i,i=d,d=a,a=o,o=d),l[e+1]>l[s+1]&&(d=e,e=s,s=d,d=r,r=a,a=d);const f=(l[e]+t.offsetX)*t.scaleX,g=(l[e+1]+t.offsetY)*t.scaleY,p=(l[s]+t.offsetX)*t.scaleX,y=(l[s+1]+t.offsetY)*t.scaleY,m=(l[i]+t.offsetX)*t.scaleX,v=(l[i+1]+t.offsetY)*t.scaleY;if(g>=v)return;const w=c[r],A=c[r+1],S=c[r+2],k=c[a],C=c[a+1],z=c[a+2],T=c[o],V=c[o+1],Z=c[o+2],P=Math.round(g),U=Math.round(v);let _,q,Y,L,et,N,W,I;for(let D=P;D<=U;D++){if(D<y){const nt=D<g?0:(g-D)/(g-y);_=f-(f-p)*nt,q=w-(w-k)*nt,Y=A-(A-C)*nt,L=S-(S-z)*nt}else{let nt;D>v?nt=1:y===v?nt=0:nt=(y-D)/(y-v),_=p-(p-m)*nt,q=k-(k-T)*nt,Y=C-(C-V)*nt,L=z-(z-Z)*nt}let G;D<g?G=0:D>v?G=1:G=(g-D)/(g-v),et=f-(f-m)*G,N=w-(w-T)*G,W=A-(A-V)*G,I=S-(S-Z)*G;const X=Math.round(Math.min(_,et)),tt=Math.round(Math.max(_,et));let it=u*D+X*4;for(let nt=X;nt<=tt;nt++)G=(_-nt)/(_-et),G<0?G=0:G>1&&(G=1),h[it++]=q-(q-N)*G|0,h[it++]=Y-(Y-W)*G|0,h[it++]=L-(L-I)*G|0,h[it++]=255}}function Jp(n,t,e){const s=t.coords,i=t.colors;let r,a;switch(t.type){case"lattice":const o=t.verticesPerRow,l=Math.floor(s.length/o)-1,c=o-1;for(r=0;r<l;r++){let h=r*o;for(let u=0;u<c;u++,h++)ua(n,e,s[h],s[h+1],s[h+o],i[h],i[h+1],i[h+o]),ua(n,e,s[h+o+1],s[h+1],s[h+o],i[h+o+1],i[h+1],i[h+o])}break;case"triangles":for(r=0,a=s.length;r<a;r+=3)ua(n,e,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class Qp extends $o{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[7],this._background=t[8],this.matrix=null}_createMeshCanvas(t,e,s){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-o,h=Math.ceil(this._bounds[3])-l,u=Math.min(Math.ceil(Math.abs(c*t[0]*1.1)),3e3),d=Math.min(Math.ceil(Math.abs(h*t[1]*1.1)),3e3),f=c/u,g=h/d,p={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/f,scaleY:1/g},y=u+2*2,m=d+2*2,v=s.getCanvas("mesh",y,m),w=v.context,A=w.createImageData(u,d);if(e){const k=A.data;for(let C=0,z=k.length;C<z;C+=4)k[C]=e[0],k[C+1]=e[1],k[C+2]=e[2],k[C+3]=255}for(const k of this._figures)Jp(A,k,p);return w.putImageData(A,2,2),{canvas:v.canvas,offsetX:o-2*f,offsetY:l-2*g,scaleX:f,scaleY:g}}getPattern(t,e,s,i){Ba(t,this._bbox);let r;if(i===se.SHADING)r=ht.singularValueDecompose2dScale(Ft(t));else if(r=ht.singularValueDecompose2dScale(e.baseTransform),this.matrix){const o=ht.singularValueDecompose2dScale(this.matrix);r=[r[0]*o[0],r[1]*o[1]]}const a=this._createMeshCanvas(r,i===se.SHADING?null:this._background,e.cachedCanvases);return i!==se.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(a.offsetX,a.offsetY),t.scale(a.scaleX,a.scaleY),t.createPattern(a.canvas,"no-repeat")}}class tg extends $o{getPattern(){return"hotpink"}}function eg(n){switch(n[0]){case"RadialAxial":return new Zp(n);case"Mesh":return new Qp(n);case"Dummy":return new tg}throw new Error(`Unknown IR type: ${n[0]}`)}const Kl={COLORED:1,UNCOLORED:2};class Ho{static MAX_PATTERN_SIZE=3e3;constructor(t,e,s,i,r){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=e,this.ctx=s,this.canvasGraphicsFactory=i,this.baseTransform=r}createPatternCanvas(t){const{bbox:e,operatorList:s,paintType:i,tilingType:r,color:a,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),$r("TilingType: "+r);const h=e[0],u=e[1],d=e[2],f=e[3],g=d-h,p=f-u,y=ht.singularValueDecompose2dScale(this.matrix),m=ht.singularValueDecompose2dScale(this.baseTransform),v=y[0]*m[0],w=y[1]*m[1];let A=g,S=p,k=!1,C=!1;const z=Math.ceil(l*v),T=Math.ceil(c*w),V=Math.ceil(g*v),Z=Math.ceil(p*w);z>=V?A=l:k=!0,T>=Z?S=c:C=!0;const P=this.getSizeAndScale(A,this.ctx.canvas.width,v),U=this.getSizeAndScale(S,this.ctx.canvas.height,w),_=t.cachedCanvases.getCanvas("pattern",P.size,U.size),q=_.context,Y=o.createCanvasGraphics(q);if(Y.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(Y,i,a),q.translate(-P.scale*h,-U.scale*u),Y.transform(P.scale,0,0,U.scale,0,0),q.save(),this.clipBbox(Y,h,u,d,f),Y.baseTransform=Ft(Y.ctx),Y.executeOperatorList(s),Y.endDrawing(),q.restore(),k||C){const L=_.canvas;k&&(A=l),C&&(S=c);const et=this.getSizeAndScale(A,this.ctx.canvas.width,v),N=this.getSizeAndScale(S,this.ctx.canvas.height,w),W=et.size,I=N.size,D=t.cachedCanvases.getCanvas("pattern-workaround",W,I),G=D.context,X=k?Math.floor(g/l):0,tt=C?Math.floor(p/c):0;for(let it=0;it<=X;it++)for(let nt=0;nt<=tt;nt++)G.drawImage(L,W*it,I*nt,W,I,0,0,W,I);return{canvas:D.canvas,scaleX:et.scale,scaleY:N.scale,offsetX:h,offsetY:u}}return{canvas:_.canvas,scaleX:P.scale,scaleY:U.scale,offsetX:h,offsetY:u}}getSizeAndScale(t,e,s){const i=Math.max(Ho.MAX_PATTERN_SIZE,e);let r=Math.ceil(t*s);return r>=i?r=i:s=r/t,{scale:s,size:r}}clipBbox(t,e,s,i,r){const a=i-e,o=r-s;t.ctx.rect(e,s,a,o),t.current.updateRectMinMax(Ft(t.ctx),[e,s,i,r]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const i=t.ctx,r=t.current;switch(e){case Kl.COLORED:const a=this.ctx;i.fillStyle=a.fillStyle,i.strokeStyle=a.strokeStyle,r.fillColor=a.fillStyle,r.strokeColor=a.strokeStyle;break;case Kl.UNCOLORED:const o=ht.makeHexColor(s[0],s[1],s[2]);i.fillStyle=o,i.strokeStyle=o,r.fillColor=o,r.strokeColor=o;break;default:throw new kp(`Unsupported paint type: ${e}`)}}getPattern(t,e,s,i){let r=s;i!==se.SHADING&&(r=ht.transform(r,e.baseTransform),this.matrix&&(r=ht.transform(r,this.matrix)));const a=this.createPatternCanvas(e);let o=new DOMMatrix(r);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const l=t.createPattern(a.canvas,"repeat");return l.setTransform(o),l}}function sg({src:n,srcPos:t=0,dest:e,width:s,height:i,nonBlackColor:r=4294967295,inverseDecode:a=!1}){const o=me.isLittleEndian?4278190080:255,[l,c]=a?[r,o]:[o,r],h=s>>3,u=s&7,d=n.length;e=new Uint32Array(e.buffer);let f=0;for(let g=0;g<i;g++){for(const y=t+h;t<y;t++){const m=t<d?n[t]:255;e[f++]=m&128?c:l,e[f++]=m&64?c:l,e[f++]=m&32?c:l,e[f++]=m&16?c:l,e[f++]=m&8?c:l,e[f++]=m&4?c:l,e[f++]=m&2?c:l,e[f++]=m&1?c:l}if(u===0)continue;const p=t<d?n[t++]:255;for(let y=0;y<u;y++)e[f++]=p&1<<7-y?c:l}return{srcPos:t,destPos:f}}const ql=16,Xl=100,ng=15,Yl=10,Zl=1e3,we=16;function ig(n,t){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){t.save(),this.__originalSave()},n.restore=function(){t.restore(),this.__originalRestore()},n.translate=function(s,i){t.translate(s,i),this.__originalTranslate(s,i)},n.scale=function(s,i){t.scale(s,i),this.__originalScale(s,i)},n.transform=function(s,i,r,a,o,l){t.transform(s,i,r,a,o,l),this.__originalTransform(s,i,r,a,o,l)},n.setTransform=function(s,i,r,a,o,l){t.setTransform(s,i,r,a,o,l),this.__originalSetTransform(s,i,r,a,o,l)},n.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},n.rotate=function(s){t.rotate(s),this.__originalRotate(s)},n.clip=function(s){t.clip(s),this.__originalClip(s)},n.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},n.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},n.bezierCurveTo=function(e,s,i,r,a,o){t.bezierCurveTo(e,s,i,r,a,o),this.__originalBezierCurveTo(e,s,i,r,a,o)},n.rect=function(e,s,i,r){t.rect(e,s,i,r),this.__originalRect(e,s,i,r)},n.closePath=function(){t.closePath(),this.__originalClosePath()},n.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class rg{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,s)):(i=this.canvasFactory.create(e,s),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Li(n,t,e,s,i,r,a,o,l,c){const[h,u,d,f,g,p]=Ft(n);if(u===0&&d===0){const v=a*h+g,w=Math.round(v),A=o*f+p,S=Math.round(A),k=(a+l)*h+g,C=Math.abs(Math.round(k)-w)||1,z=(o+c)*f+p,T=Math.abs(Math.round(z)-S)||1;return n.setTransform(Math.sign(h),0,0,Math.sign(f),w,S),n.drawImage(t,e,s,i,r,0,0,C,T),n.setTransform(h,u,d,f,g,p),[C,T]}if(h===0&&f===0){const v=o*d+g,w=Math.round(v),A=a*u+p,S=Math.round(A),k=(o+c)*d+g,C=Math.abs(Math.round(k)-w)||1,z=(a+l)*u+p,T=Math.abs(Math.round(z)-S)||1;return n.setTransform(0,Math.sign(u),Math.sign(d),0,w,S),n.drawImage(t,e,s,i,r,0,0,T,C),n.setTransform(h,u,d,f,g,p),[T,C]}n.drawImage(t,e,s,i,r,a,o,l,c);const y=Math.hypot(h,u),m=Math.hypot(d,f);return[y*l,m*c]}function ag(n){const{width:t,height:e}=n;if(t>Zl||e>Zl)return null;const s=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=t+1;let a=new Uint8Array(r*(e+1)),o,l,c;const h=t+7&-8;let u=new Uint8Array(h*e),d=0;for(const m of n.data){let v=128;for(;v>0;)u[d++]=m&v?0:255,v>>=1}let f=0;for(d=0,u[d]!==0&&(a[0]=1,++f),l=1;l<t;l++)u[d]!==u[d+1]&&(a[l]=u[d]?2:1,++f),d++;for(u[d]!==0&&(a[l]=2,++f),o=1;o<e;o++){d=o*h,c=o*r,u[d-h]!==u[d]&&(a[c]=u[d]?1:8,++f);let m=(u[d]?4:0)+(u[d-h]?8:0);for(l=1;l<t;l++)m=(m>>2)+(u[d+1]?4:0)+(u[d-h+1]?8:0),i[m]&&(a[c+l]=i[m],++f),d++;if(u[d-h]!==u[d]&&(a[c+l]=u[d]?2:4,++f),f>s)return null}for(d=h*(e-1),c=o*r,u[d]!==0&&(a[c]=8,++f),l=1;l<t;l++)u[d]!==u[d+1]&&(a[c+l]=u[d]?4:8,++f),d++;if(u[d]!==0&&(a[c+l]=4,++f),f>s)return null;const g=new Int32Array([0,r,-1,0,-r,0,0,0,1]),p=new Path2D;for(o=0;f&&o<=e;o++){let m=o*r;const v=m+t;for(;m<v&&!a[m];)m++;if(m===v)continue;p.moveTo(m%r,o);const w=m;let A=a[m];do{const S=g[A];do m+=S;while(!a[m]);const k=a[m];k!==5&&k!==10?(A=k,a[m]=0):(A=k&51*A>>4,a[m]&=A>>2|A<<2),p.lineTo(m%r,m/r|0),a[m]||--f}while(w!==m);--o}return u=null,a=null,function(m){m.save(),m.scale(1/t,-1/e),m.translate(0,-e),m.fill(p),m.beginPath(),m.restore()}}class Jl{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Ph,this.textMatrixScale=1,this.fontMatrix=La,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=ee.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}setCurrentPoint(t,e){this.x=t,this.y=e}updatePathMinMax(t,e,s){[e,s]=ht.applyTransform([e,s],t),this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(t,e){const s=ht.applyTransform(e,t),i=ht.applyTransform(e.slice(2),t),r=ht.applyTransform([e[0],e[3]],t),a=ht.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,s[0],i[0],r[0],a[0]),this.minY=Math.min(this.minY,s[1],i[1],r[1],a[1]),this.maxX=Math.max(this.maxX,s[0],i[0],r[0],a[0]),this.maxY=Math.max(this.maxY,s[1],i[1],r[1],a[1])}updateScalingPathMinMax(t,e){ht.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,s,i,r,a,o,l,c,h){const u=ht.bezierBoundingBox(e,s,i,r,a,o,l,c,h);h||this.updateRectMinMax(t,u)}getPathBoundingBox(t=se.FILL,e=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(t===se.STROKE){e||Mt("Stroke bounding box must include transform.");const i=ht.singularValueDecompose2dScale(e),r=i[0]*this.lineWidth/2,a=i[1]*this.lineWidth/2;s[0]-=r,s[1]-=a,s[2]+=r,s[3]+=a}return s}updateClipFromPath(){const t=ht.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=se.FILL,e=null){return ht.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function Ql(n,t){if(t instanceof ImageData){n.putImageData(t,0,0);return}const e=t.height,s=t.width,i=e%we,r=(e-i)/we,a=i===0?r:r+1,o=n.createImageData(s,we);let l=0,c;const h=t.data,u=o.data;let d,f,g,p;if(t.kind===Zi.GRAYSCALE_1BPP){const y=h.byteLength,m=new Uint32Array(u.buffer,0,u.byteLength>>2),v=m.length,w=s+7>>3,A=4294967295,S=me.isLittleEndian?4278190080:255;for(d=0;d<a;d++){for(g=d<r?we:i,c=0,f=0;f<g;f++){const k=y-l;let C=0;const z=k>w?s:k*8-7,T=z&-8;let V=0,Z=0;for(;C<T;C+=8)Z=h[l++],m[c++]=Z&128?A:S,m[c++]=Z&64?A:S,m[c++]=Z&32?A:S,m[c++]=Z&16?A:S,m[c++]=Z&8?A:S,m[c++]=Z&4?A:S,m[c++]=Z&2?A:S,m[c++]=Z&1?A:S;for(;C<z;C++)V===0&&(Z=h[l++],V=128),m[c++]=Z&V?A:S,V>>=1}for(;c<v;)m[c++]=0;n.putImageData(o,0,d*we)}}else if(t.kind===Zi.RGBA_32BPP){for(f=0,p=s*we*4,d=0;d<r;d++)u.set(h.subarray(l,l+p)),l+=p,n.putImageData(o,0,f),f+=we;d<a&&(p=s*i*4,u.set(h.subarray(l,l+p)),n.putImageData(o,0,f))}else if(t.kind===Zi.RGB_24BPP)for(g=we,p=s*g,d=0;d<a;d++){for(d>=r&&(g=i,p=s*g),c=0,f=p;f--;)u[c++]=h[l++],u[c++]=h[l++],u[c++]=h[l++],u[c++]=255;n.putImageData(o,0,d*we)}else throw new Error(`bad image kind: ${t.kind}`)}function tc(n,t){if(t.bitmap){n.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,i=e%we,r=(e-i)/we,a=i===0?r:r+1,o=n.createImageData(s,we);let l=0;const c=t.data,h=o.data;for(let u=0;u<a;u++){const d=u<r?we:i;({srcPos:l}=sg({src:c,srcPos:l,dest:h,width:s,height:d,nonBlackColor:0})),n.putImageData(o,0,u*we)}}function Rn(n,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)n[s]!==void 0&&(t[s]=n[s]);n.setLineDash!==void 0&&(t.setLineDash(n.getLineDash()),t.lineDashOffset=n.lineDashOffset)}function Di(n){if(n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0),!re){const{filter:t}=n;t!=="none"&&t!==""&&(n.filter="none")}}function ec(n,t){if(t)return!0;const e=ht.singularValueDecompose2dScale(n);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*_n.PDF_TO_CSS_UNITS);return e[0]<=s&&e[1]<=s}const og=["butt","round","square"],lg=["miter","round","bevel"],cg={},sc={};class pn{constructor(t,e,s,i,r,{optionalContentConfig:a,markedContentStack:o=null},l,c){this.ctx=t,this.current=new Jl(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new rg(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:i=null}){const r=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,a),this.ctx.fillStyle=o,s){const l=this.cachedCanvases.getCanvas("transparent",r,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Ft(this.compositeCtx))}this.ctx.save(),Di(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Ft(this.ctx)}executeOperatorList(t,e,s,i){const r=t.argsArray,a=t.fnArray;let o=e||0;const l=r.length;if(l===o)return o;const c=l-o>Yl&&typeof s=="function",h=c?Date.now()+ng:0;let u=0;const d=this.commonObjs,f=this.objs;let g;for(;;){if(i!==void 0&&o===i.nextBreakPoint)return i.breakIt(o,s),o;if(g=a[o],g!==Le.dependency)this[g].apply(this,r[o]);else for(const p of r[o]){const y=p.startsWith("g_")?d:f;if(!y.has(p))return y.get(p,s),o}if(o++,o===l)return o;if(c&&++u>Yl){if(Date.now()>h)return s(),o;u=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const s=t.width??t.displayWidth,i=t.height??t.displayHeight;let r=Math.max(Math.hypot(e[0],e[1]),1),a=Math.max(Math.hypot(e[2],e[3]),1),o=s,l=i,c="prescale1",h,u;for(;r>2&&o>1||a>2&&l>1;){let d=o,f=l;r>2&&o>1&&(d=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),r/=o/d),a>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/f),h=this.cachedCanvases.getCanvas(c,d,f),u=h.context,u.clearRect(0,0,d,f),u.drawImage(t,0,0,o,l,0,0,d,f),t=h.canvas,o=d,l=f,c=c==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:o,paintHeight:l}}_createMaskCanvas(t){const e=this.ctx,{width:s,height:i}=t,r=this.current.fillColor,a=this.current.patternFill,o=Ft(e);let l,c,h,u;if((t.bitmap||t.data)&&t.count>1){const z=t.bitmap||t.data.buffer;c=JSON.stringify(a?o:[o.slice(0,4),r]),l=this._cachedBitmapsMap.get(z),l||(l=new Map,this._cachedBitmapsMap.set(z,l));const T=l.get(c);if(T&&!a){const V=Math.round(Math.min(o[0],o[2])+o[4]),Z=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:T,offsetX:V,offsetY:Z}}h=T}h||(u=this.cachedCanvases.getCanvas("maskCanvas",s,i),tc(u.context,t));let d=ht.transform(o,[1/s,0,0,-1/i,0,0]);d=ht.transform(d,[1,0,0,1,0,-i]);const[f,g,p,y]=ht.getAxialAlignedBoundingBox([0,0,s,i],d),m=Math.round(p-f)||1,v=Math.round(y-g)||1,w=this.cachedCanvases.getCanvas("fillCanvas",m,v),A=w.context,S=f,k=g;A.translate(-S,-k),A.transform(...d),h||(h=this._scaleImage(u.canvas,$e(A)),h=h.img,l&&a&&l.set(c,h)),A.imageSmoothingEnabled=ec(Ft(A),t.interpolate),Li(A,h,0,0,h.width,h.height,0,0,s,i),A.globalCompositeOperation="source-in";const C=ht.transform($e(A),[1,0,0,1,-S,-k]);return A.fillStyle=a?r.getPattern(e,this,C,se.FILL):r,A.fillRect(0,0,s,i),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,w.canvas)),{canvas:w.canvas,offsetX:Math.round(S),offsetY:Math.round(k)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=og[t]}setLineJoin(t){this.ctx.lineJoin=lg[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(t),s.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,s]of t)switch(e){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,t,e);this.suspendedCtx=this.ctx,this.ctx=i.context;const r=this.ctx;r.setTransform(...Ft(this.suspendedCtx)),Rn(this.suspendedCtx,r),ig(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Rn(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,i){const r=i[0],a=i[1],o=i[2]-r,l=i[3]-a;o===0||l===0||(this.genericComposeSMask(e.context,s,o,l,e.subtype,e.backdrop,e.transferMap,r,a,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,i,r,a,o,l,c,h,u){let d=t.canvas,f=l-h,g=c-u;if(a){const y=ht.makeHexColor(...a);if(f<0||g<0||f+s>d.width||g+i>d.height){const m=this.cachedCanvases.getCanvas("maskExtension",s,i),v=m.context;v.drawImage(d,-f,-g),v.globalCompositeOperation="destination-atop",v.fillStyle=y,v.fillRect(0,0,s,i),v.globalCompositeOperation="source-over",d=m.canvas,f=g=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const m=new Path2D;m.rect(f,g,s,i),t.clip(m),t.globalCompositeOperation="destination-atop",t.fillStyle=y,t.fillRect(f,g,s,i),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),r==="Alpha"&&o?e.filter=this.filterFactory.addAlphaFilter(o):r==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(o));const p=new Path2D;p.rect(l,c,s,i),e.clip(p),e.globalCompositeOperation="destination-in",e.drawImage(d,f,g,s,i,l,c,s,i),e.restore()}save(){this.inSMaskMode?(Rn(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Rn(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(t,e,s,i,r,a){this.ctx.transform(t,e,s,i,r,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s){const i=this.ctx,r=this.current;let a=r.x,o=r.y,l,c;const h=Ft(i),u=h[0]===0&&h[3]===0||h[1]===0&&h[2]===0,d=u?s.slice(0):null;for(let f=0,g=0,p=t.length;f<p;f++)switch(t[f]|0){case Le.rectangle:a=e[g++],o=e[g++];const y=e[g++],m=e[g++],v=a+y,w=o+m;i.moveTo(a,o),y===0||m===0?i.lineTo(v,w):(i.lineTo(v,o),i.lineTo(v,w),i.lineTo(a,w)),u||r.updateRectMinMax(h,[a,o,v,w]),i.closePath();break;case Le.moveTo:a=e[g++],o=e[g++],i.moveTo(a,o),u||r.updatePathMinMax(h,a,o);break;case Le.lineTo:a=e[g++],o=e[g++],i.lineTo(a,o),u||r.updatePathMinMax(h,a,o);break;case Le.curveTo:l=a,c=o,a=e[g+4],o=e[g+5],i.bezierCurveTo(e[g],e[g+1],e[g+2],e[g+3],a,o),r.updateCurvePathMinMax(h,l,c,e[g],e[g+1],e[g+2],e[g+3],a,o,d),g+=6;break;case Le.curveTo2:l=a,c=o,i.bezierCurveTo(a,o,e[g],e[g+1],e[g+2],e[g+3]),r.updateCurvePathMinMax(h,l,c,a,o,e[g],e[g+1],e[g+2],e[g+3],d),a=e[g+2],o=e[g+3],g+=4;break;case Le.curveTo3:l=a,c=o,a=e[g+2],o=e[g+3],i.bezierCurveTo(e[g],e[g+1],a,o,a,o),r.updateCurvePathMinMax(h,l,c,e[g],e[g+1],a,o,a,o,d),g+=4;break;case Le.closePath:i.closePath();break}u&&r.updateScalingPathMinMax(h,d),r.setCurrentPoint(a,o)}closePath(){this.ctx.closePath()}stroke(t=!0){const e=this.ctx,s=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&s?.getPattern?(e.save(),e.strokeStyle=s.getPattern(e,this,$e(e),se.STROKE),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(t=!0){const e=this.ctx,s=this.current.fillColor,i=this.current.patternFill;let r=!1;i&&(e.save(),e.fillStyle=s.getPattern(e,this,$e(e),se.FILL),r=!0);const a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),r&&e.restore(),t&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=cg}eoClip(){this.pendingClip=sc}beginText(){this.current.textMatrix=Ph,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}const s=new Path2D,i=e.getTransform().invertSelf();for(const{transform:r,x:a,y:o,fontSize:l,path:c}of t)s.addPath(c,new DOMMatrix(r).preMultiplySelf(i).translate(a,o).scale(l,-l));e.clip(s),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){const s=this.commonObjs.get(t),i=this.current;if(!s)throw new Error(`Can't find font for ${t}`);if(i.fontMatrix=s.fontMatrix||La,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&_t("Invalid font matrix for font "+t),e<0?(e=-e,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=e,s.isType3Font)return;const r=s.loadedName||"sans-serif",a=s.systemFontInfo?.css||`"${r}", ${s.fallbackName}`;let o="normal";s.black?o="900":s.bold&&(o="bold");const l=s.italic?"italic":"normal";let c=e;e<ql?c=ql:e>Xl&&(c=Xl),this.current.fontSizeScale=e/c,this.ctx.font=`${l} ${o} ${c}px ${a}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,s,i,r,a){this.current.textMatrix=[t,e,s,i,r,a],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#s(t,e,s){const i=new Path2D;return i.addPath(t,new DOMMatrix(s).invertSelf().multiplySelf(e)),i}paintChar(t,e,s,i,r){const a=this.ctx,o=this.current,l=o.font,c=o.textRenderingMode,h=o.fontSize/o.fontSizeScale,u=c&ee.FILL_STROKE_MASK,d=!!(c&ee.ADD_TO_PATH_FLAG),f=o.patternFill&&!l.missingFile,g=o.patternStroke&&!l.missingFile;let p;if((l.disableFontFace||d||f||g)&&(p=l.getPathGenerator(this.commonObjs,t)),l.disableFontFace||f||g){if(a.save(),a.translate(e,s),a.scale(h,-h),u===ee.FILL||u===ee.FILL_STROKE)if(i){const y=a.getTransform();a.setTransform(...i),a.fill(this.#s(p,y,i))}else a.fill(p);if(u===ee.STROKE||u===ee.FILL_STROKE)if(r){const y=a.getTransform();a.setTransform(...r),a.stroke(this.#s(p,y,r))}else a.lineWidth/=h,a.stroke(p);a.restore()}else(u===ee.FILL||u===ee.FILL_STROKE)&&a.fillText(t,e,s),(u===ee.STROKE||u===ee.FILL_STROKE)&&a.strokeText(t,e,s);d&&(this.pendingTextPaths||=[]).push({transform:Ft(a),x:e,y:s,fontSize:h,path:p})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){s=!0;break}return At(this,"isFontSubpixelAAEnabled",s)}showText(t){const e=this.current,s=e.font;if(s.isType3Font)return this.showType3Text(t);const i=e.fontSize;if(i===0)return;const r=this.ctx,a=e.fontSizeScale,o=e.charSpacing,l=e.wordSpacing,c=e.fontDirection,h=e.textHScale*c,u=t.length,d=s.vertical,f=d?1:-1,g=s.defaultVMetrics,p=i*e.fontMatrix[0],y=e.textRenderingMode===ee.FILL&&!s.disableFontFace&&!e.patternFill;r.save(),r.transform(...e.textMatrix),r.translate(e.x,e.y+e.textRise),c>0?r.scale(h,-1):r.scale(h,1);let m,v;if(e.patternFill){r.save();const C=e.fillColor.getPattern(r,this,$e(r),se.FILL);m=Ft(r),r.restore(),r.fillStyle=C}if(e.patternStroke){r.save();const C=e.strokeColor.getPattern(r,this,$e(r),se.STROKE);v=Ft(r),r.restore(),r.strokeStyle=C}let w=e.lineWidth;const A=e.textMatrixScale;if(A===0||w===0){const C=e.textRenderingMode&ee.FILL_STROKE_MASK;(C===ee.STROKE||C===ee.FILL_STROKE)&&(w=this.getSinglePixelWidth())}else w/=A;if(a!==1&&(r.scale(a,a),w/=a),r.lineWidth=w,s.isInvalidPDFjsFont){const C=[];let z=0;for(const T of t)C.push(T.unicode),z+=T.width;r.fillText(C.join(""),0,0),e.x+=z*p*h,r.restore(),this.compose();return}let S=0,k;for(k=0;k<u;++k){const C=t[k];if(typeof C=="number"){S+=f*C*i/1e3;continue}let z=!1;const T=(C.isSpace?l:0)+o,V=C.fontChar,Z=C.accent;let P,U,_=C.width;if(d){const Y=C.vmetric||g,L=-(C.vmetric?Y[1]:_*.5)*p,et=Y[2]*p;_=Y?-Y[0]:_,P=L/a,U=(S+et)/a}else P=S/a,U=0;if(s.remeasure&&_>0){const Y=r.measureText(V).width*1e3/i*a;if(_<Y&&this.isFontSubpixelAAEnabled){const L=_/Y;z=!0,r.save(),r.scale(L,1),P/=L}else _!==Y&&(P+=(_-Y)/2e3*i/a)}if(this.contentVisible&&(C.isInFont||s.missingFile)){if(y&&!Z)r.fillText(V,P,U);else if(this.paintChar(V,P,U,m,v),Z){const Y=P+i*Z.offset.x/a,L=U-i*Z.offset.y/a;this.paintChar(Z.fontChar,Y,L,m,v)}}const q=d?_*p-T*c:_*p+T*c;S+=q,z&&r.restore()}d?e.y-=S:e.x+=S*h,r.restore(),this.compose()}showType3Text(t){const e=this.ctx,s=this.current,i=s.font,r=s.fontSize,a=s.fontDirection,o=i.vertical?1:-1,l=s.charSpacing,c=s.wordSpacing,h=s.textHScale*a,u=s.fontMatrix||La,d=t.length,f=s.textRenderingMode===ee.INVISIBLE;let g,p,y,m;if(!(f||r===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...s.textMatrix),e.translate(s.x,s.y),e.scale(h,a),g=0;g<d;++g){if(p=t[g],typeof p=="number"){m=o*p*r/1e3,this.ctx.translate(m,0),s.x+=m*h;continue}const v=(p.isSpace?c:0)+l,w=i.charProcOperatorList[p.operatorListId];if(!w){_t(`Type3 character "${p.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=p,this.save(),e.scale(r,r),e.transform(...u),this.executeOperatorList(w),this.restore()),y=ht.applyTransform([p.width,0],u)[0]*r+v,e.translate(y,0),s.x+=y*h}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,s,i,r,a){this.ctx.rect(s,i,r-s,a-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const s=t[1],i=this.baseTransform||Ft(this.ctx),r={createCanvasGraphics:a=>new pn(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new Ho(t,s,this.ctx,r,i)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,s){this.ctx.strokeStyle=this.current.strokeColor=ht.makeHexColor(t,e,s),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e,s){this.ctx.fillStyle=this.current.fillColor=ht.makeHexColor(t,e,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let s;return this.cachedPatterns.has(t)?s=this.cachedPatterns.get(t):(s=eg(this.getObject(t)),this.cachedPatterns.set(t,s)),e&&(s.matrix=e),s}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const s=this._getPattern(t);e.fillStyle=s.getPattern(e,this,$e(e),se.SHADING);const i=$e(e);if(i){const{width:r,height:a}=e.canvas,[o,l,c,h]=ht.getAxialAlignedBoundingBox([0,0,r,a],i);this.ctx.fillRect(o,l,c-o,h-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Mt("Should not call beginInlineImage")}beginImageData(){Mt("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=Ft(this.ctx),e)){const s=e[2]-e[0],i=e[3]-e[1];this.ctx.rect(e[0],e[1],s,i),this.current.updateRectMinMax(Ft(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||$r("TODO: Support non-isolated groups."),t.knockout&&_t("Knockout groups not supported.");const s=Ft(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let i=ht.getAxialAlignedBoundingBox(t.bbox,Ft(e));const r=[0,0,e.canvas.width,e.canvas.height];i=ht.intersect(i,r)||[0,0,0,0];const a=Math.floor(i[0]),o=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-a,1),c=Math.max(Math.ceil(i[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,c]);let h="groupAt"+this.groupLevel;t.smask&&(h+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(h,l,c),d=u.context;d.translate(-a,-o),d.transform(...s),t.smask?this.smaskStack.push({canvas:u.canvas,context:d,offsetX:a,offsetY:o,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(a,o),e.save()),Rn(e,d),this.ctx=d,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=Ft(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const r=ht.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],i);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(t,e,s,i,r){if(this.#t(),Di(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const a=e[2]-e[0],o=e[3]-e[1];if(r&&this.annotationCanvasMap){s=s.slice(),s[4]-=e[0],s[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=a,e[3]=o;const[l,c]=ht.singularValueDecompose2dScale(Ft(this.ctx)),{viewportScale:h}=this,u=Math.ceil(a*this.outputScaleX*h),d=Math.ceil(o*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(u,d);const{canvas:f,context:g}=this.annotationCanvas;this.annotationCanvasMap.set(t,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=g,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,o*c),Di(this.ctx)}else Di(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],a,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new Jl(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const s=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=ag(t)),i.compiled)){i.compiled(s);return}const r=this._createMaskCanvas(t),a=r.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(a,r.offsetX,r.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s=0,i=0,r,a){if(!this.contentVisible)return;t=this.getObject(t.data,t);const o=this.ctx;o.save();const l=Ft(o);o.transform(e,s,i,r,0,0);const c=this._createMaskCanvas(t);o.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let h=0,u=a.length;h<u;h+=2){const d=ht.transform(l,[e,s,i,r,a[h],a[h+1]]),[f,g]=ht.applyTransform([0,0],d);o.drawImage(c.canvas,f,g)}o.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const r of t){const{data:a,width:o,height:l,transform:c}=r,h=this.cachedCanvases.getCanvas("maskCanvas",o,l),u=h.context;u.save();const d=this.getObject(a,r);tc(u,d),u.globalCompositeOperation="source-in",u.fillStyle=i?s.getPattern(u,this,$e(e),se.FILL):s,u.fillRect(0,0,o,l),u.restore(),e.save(),e.transform(...c),e.scale(1,-1),Li(e,h.canvas,0,0,o,l,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){_t("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,s,i){if(!this.contentVisible)return;const r=this.getObject(t);if(!r){_t("Dependent image isn't ready yet");return}const a=r.width,o=r.height,l=[];for(let c=0,h=i.length;c<h;c+=2)l.push({transform:[e,0,0,s,i[c],i[c+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(r,l)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:i}=t,r=this.cachedCanvases.getCanvas("inlineImage",s,i),a=r.context;return a.filter=this.current.transferMaps,a.drawImage(e,0,0),a.filter="none",r.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,s=t.height,i=this.ctx;if(this.save(),!re){const{filter:o}=i;o!=="none"&&o!==""&&(i.filter="none")}i.scale(1/e,-1/s);let r;if(t.bitmap)r=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)r=t;else{const l=this.cachedCanvases.getCanvas("inlineImage",e,s).context;Ql(l,t),r=this.applyTransferMapsToCanvas(l)}const a=this._scaleImage(r,$e(i));i.imageSmoothingEnabled=ec(Ft(i),t.interpolate),Li(i,a.img,0,0,a.paintWidth,a.paintHeight,0,-s,e,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx;let i;if(t.bitmap)i=t.bitmap;else{const r=t.width,a=t.height,l=this.cachedCanvases.getCanvas("inlineImage",r,a).context;Ql(l,t),i=this.applyTransferMapsToCanvas(l)}for(const r of e)s.save(),s.transform(...r.transform),s.scale(1,-1),Li(s,i,r.x,r.y,r.w,r.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){const e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const s=this.ctx;this.pendingClip&&(e||(this.pendingClip===sc?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Ft(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:i,d:r}=this.ctx.getTransform();let a,o;if(s===0&&i===0){const l=Math.abs(e),c=Math.abs(r);if(l===c)if(t===0)a=o=1/l;else{const h=l*t;a=o=h<1?1/h:1}else if(t===0)a=1/l,o=1/c;else{const h=l*t,u=c*t;a=h<1?1/h:1,o=u<1?1/u:1}}else{const l=Math.abs(e*r-s*i),c=Math.hypot(e,s),h=Math.hypot(i,r);if(t===0)a=h/l,o=c/l;else{const u=t*l;a=h>u?h/u:1,o=c>u?c/u:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t){const{ctx:e}=this,{lineWidth:s}=this.current,[i,r]=this.getScaleForStroking();if(e.lineWidth=s||1,i===1&&r===1){e.stroke();return}const a=e.getLineDash();if(t&&e.save(),e.scale(i,r),a.length>0){const o=Math.max(i,r);e.setLineDash(a.map(l=>l/o)),e.lineDashOffset/=o}e.stroke(),t&&e.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const n in Le)pn.prototype[n]!==void 0&&(pn.prototype[Le[n]]=pn.prototype[n]);class Zn{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class hg{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}getAll(){return Oo(this.#t)}has(t){return this.#t.has(t)}}const an=Symbol("INTERNAL");class ug{#t=!1;#e=!1;#s=!1;#n=!0;constructor(t,{name:e,intent:s,usage:i,rbGroups:r}){this.#t=!!(t&xe.DISPLAY),this.#e=!!(t&xe.PRINT),this.name=e,this.intent=s,this.usage=i,this.rbGroups=r}get visible(){if(this.#s)return this.#n;if(!this.#n)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,s=!1){t!==an&&Mt("Internal method `_setVisible` called."),this.#s=s,this.#n=e}}class dg{#t=null;#e=new Map;#s=null;#n=null;constructor(t,e=xe.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#n=t.order;for(const s of t.groups)this.#e.set(s.id,new ug(e,s));if(t.baseState==="OFF")for(const s of this.#e.values())s._setVisible(an,!1);for(const s of t.on)this.#e.get(s)._setVisible(an,!0);for(const s of t.off)this.#e.get(s)._setVisible(an,!1);this.#s=this.getHash()}}#r(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let i=1;i<e;i++){const r=t[i];let a;if(Array.isArray(r))a=this.#r(r);else if(this.#e.has(r))a=this.#e.get(r).visible;else return _t(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return s==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return $r("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(_t(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#r(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return _t(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return _t(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return _t(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return _t(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return _t(`Unknown optional content policy ${t.policy}.`),!0}return _t(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){const i=this.#e.get(t);if(!i){_t(`Optional content group not found: ${t}`);return}if(s&&e&&i.rbGroups.length)for(const r of i.rbGroups)for(const a of r)a!==t&&this.#e.get(a)?._setVisible(an,!1,!0);i._setVisible(an,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let s;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const r=this.#e.get(i);if(r)switch(s){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!r.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#n?this.#n.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?Oo(this.#e):null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new Mh;for(const[e,s]of this.#e)t.update(`${e}:${s.visible}`);return this.#t=t.hexdigest()}}class fg{constructor(t,{disableRange:e=!1,disableStream:s=!1}){Wt(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:a,contentDispositionFilename:o}=t;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,r?.length>0){const l=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),t.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(r){return r._begin!==t?!1:(r._enqueue(s),!0)});Wt(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){Wt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new pg(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new gg(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class pg{constructor(t,e,s=!1,i=null){this._stream=t,this._done=s||!1,this._filename=Fo(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class gg{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function mg(n){let t=!0,e=s("filename\\*","i").exec(n);if(e){e=e[1];let h=o(e);return h=unescape(h),h=l(h),h=c(h),r(h)}if(e=a(n),e){const h=c(e);return r(h)}if(e=s("filename","i").exec(n),e){e=e[1];let h=o(e);return h=c(h),r(h)}function s(h,u){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function i(h,u){if(h){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const d=new TextDecoder(h,{fatal:!0}),f=Hr(u);u=d.decode(f),t=!1}catch{}}return u}function r(h){return t&&/[\x80-\xff]/.test(h)&&(h=i("utf-8",h),t&&(h=i("iso-8859-1",h))),h}function a(h){const u=[];let d;const f=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(d=f.exec(h))!==null;){let[,p,y,m]=d;if(p=parseInt(p,10),p in u){if(p===0)break;continue}u[p]=[y,m]}const g=[];for(let p=0;p<u.length&&p in u;++p){let[y,m]=u[p];m=o(m),y&&(m=unescape(m),p===0&&(m=l(m))),g.push(m)}return g.join("")}function o(h){if(h.startsWith('"')){const u=h.slice(1).split('\\"');for(let d=0;d<u.length;++d){const f=u[d].indexOf('"');f!==-1&&(u[d]=u[d].slice(0,f),u.length=d+1),u[d]=u[d].replaceAll(/\\(.)/g,"$1")}h=u.join('"')}return h}function l(h){const u=h.indexOf("'");if(u===-1)return h;const d=h.slice(0,u),g=h.slice(u+1).replace(/^[^']*'/,"");return i(d,g)}function c(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,d,f,g){if(f==="q"||f==="Q")return g=g.replaceAll("_"," "),g=g.replaceAll(/=([0-9a-fA-F]{2})/g,function(p,y){return String.fromCharCode(parseInt(y,16))}),i(d,g);try{g=atob(g)}catch{}return i(d,g)})}return""}function $h(n,t){const e=new Headers;if(!n||!t||typeof t!="object")return e;for(const s in t){const i=t[s];i!==void 0&&e.append(s,i)}return e}function Vr(n){try{return new URL(n).origin}catch{}return null}function Hh({responseHeaders:n,isHttp:t,rangeChunkSize:e,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(n.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*e)||s||!t||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function Uh(n){const t=n.get("Content-Disposition");if(t){let e=mg(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Fo(e))return e}return null}function Kr(n,t){return n===404||n===0&&t.startsWith("file:")?new li('Missing PDF "'+t+'".'):new gr(`Unexpected server response (${n}) while retrieving PDF "${t}".`,n)}function Wh(n){return n===200||n===206}function Gh(n,t,e){return{method:"GET",headers:n,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Vh(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(_t(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class nc{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=$h(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Wt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new bg(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new yg(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class bg{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers),i=e.url;fetch(i,Gh(s,this._withCredentials,this._abortController)).then(r=>{if(t._responseOrigin=Vr(r.url),!Wh(r.status))throw Kr(r.status,i);this._reader=r.body.getReader(),this._headersCapability.resolve();const a=r.headers,{allowRangeRequests:o,suggestedLength:l}=Hh({responseHeaders:a,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=Uh(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ks("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Vh(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class yg{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const r=new Headers(t.headers);r.append("Range",`bytes=${e}-${s-1}`);const a=i.url;fetch(a,Gh(r,this._withCredentials,this._abortController)).then(o=>{const l=Vr(o.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!Wh(o.status))throw Kr(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Vh(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const da=200,fa=206;function vg(n){const t=n.response;return typeof t!="string"?t:Hr(t).buffer}class _g{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:s}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=$h(this.isHttp,e),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[r,a]of this.headers)e.setRequestHeader(r,a);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=fa):i.expectedStatus=da,e.responseType="arraybuffer",Wt(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){const s=this.pendingRequests[t];s&&s.onProgress?.(e)}onStateChange(t,e){const s=this.pendingRequests[t];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],i.status===0&&this.isHttp){s.onError(i.status);return}const r=i.status||da;if(!(r===da&&s.expectedStatus===fa)&&r!==s.expectedStatus){s.onError(i.status);return}const o=vg(i);if(r===fa){const l=i.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?s.onDone({begin:parseInt(c[1],10),chunk:o}):(_t('Missing or invalid "Content-Range" header.'),s.onError(0))}else o?s.onDone({begin:0,chunk:o}):s.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class wg{constructor(t){this._source=t,this._manager=new _g(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return Wt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Ag(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new Sg(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Ag{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Vr(e.responseURL);const s=e.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...c]=o.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:a}=Hh({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=Uh(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Kr(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Sg{constructor(t,e,s){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=Vr(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=Kr(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const xg=/^[a-z][a-z0-9\-+.]+:/i;function Eg(n){if(xg.test(n))return new URL(n);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(n))}class Cg{constructor(t){this.source=t,this.url=Eg(t.url),Wt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Wt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new kg(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new Tg(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class kg{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=new li(`Missing PDF "${this._url}".`)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ks("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Tg{constructor(t,e,s){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=t.source;this._isStreamingSupported=!i.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Pg=1e5,ye=30,Rg=.8;class de{#t=Promise.withResolvers();#e=null;#s=!1;#n=!!globalThis.FontInspector?.enabled;#r=null;#i=null;#l=0;#o=0;#h=null;#c=null;#d=0;#u=0;#f=Object.create(null);#a=[];#p=null;#m=[];#g=new WeakMap;#b=null;static#_=new Map;static#y=new Map;static#w=new WeakMap;static#S=null;static#E=new Set;constructor({textContentSource:t,container:e,viewport:s}){if(t instanceof ReadableStream)this.#p=t;else if(typeof t=="object")this.#p=new ReadableStream({start(l){l.enqueue(t),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#c=e,this.#u=s.scale*(globalThis.devicePixelRatio||1),this.#d=s.rotation,this.#i={div:null,properties:null,ctx:null};const{pageWidth:i,pageHeight:r,pageX:a,pageY:o}=s.rawDims;this.#b=[1,0,0,-1,-a,o+r],this.#o=i,this.#l=r,de.#I(),qs(e,s),this.#t.promise.finally(()=>{de.#E.delete(this),this.#i=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=me.platform;return At(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#h.read().then(({value:e,done:s})=>{if(s){this.#t.resolve();return}this.#r??=e.lang,Object.assign(this.#f,e.styles),this.#k(e.items),t()},this.#t.reject)};return this.#h=this.#p.getReader(),de.#E.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const s=t.scale*(globalThis.devicePixelRatio||1),i=t.rotation;if(i!==this.#d&&(e?.(),this.#d=i,qs(this.#c,{rotation:i})),s!==this.#u){e?.(),this.#u=s;const r={div:null,properties:null,ctx:de.#T(this.#r)};for(const a of this.#m)r.properties=this.#g.get(a),r.div=a,this.#A(r)}}cancel(){const t=new ks("TextLayer task cancelled.");this.#h?.cancel(t).catch(()=>{}),this.#h=null,this.#t.reject(t)}get textDivs(){return this.#m}get textContentItemsStr(){return this.#a}#k(t){if(this.#s)return;this.#i.ctx??=de.#T(this.#r);const e=this.#m,s=this.#a;for(const i of t){if(e.length>Pg){_t("Ignoring additional textDivs for performance reasons."),this.#s=!0;return}if(i.str===void 0){if(i.type==="beginMarkedContentProps"||i.type==="beginMarkedContent"){const r=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),i.id!==null&&this.#e.setAttribute("id",`${i.id}`),r.append(this.#e)}else i.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}s.push(i.str),this.#P(i)}}#P(t){const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#m.push(e);const i=ht.transform(this.#b,t.transform);let r=Math.atan2(i[1],i[0]);const a=this.#f[t.fontName];a.vertical&&(r+=Math.PI/2);let o=this.#n&&a.fontSubstitution||a.fontFamily;o=de.fontFamilyMap.get(o)||o;const l=Math.hypot(i[2],i[3]),c=l*de.#L(o,this.#r);let h,u;r===0?(h=i[4],u=i[5]-c):(h=i[4]+c*Math.sin(r),u=i[5]-c*Math.cos(r));const d="calc(var(--scale-factor)*",f=e.style;this.#e===this.#c?(f.left=`${(100*h/this.#o).toFixed(2)}%`,f.top=`${(100*u/this.#l).toFixed(2)}%`):(f.left=`${d}${h.toFixed(2)}px)`,f.top=`${d}${u.toFixed(2)}px)`),f.fontSize=`${d}${(de.#S*l).toFixed(2)}px)`,f.fontFamily=o,s.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#n&&(e.dataset.fontName=a.fontSubstitutionLoadedName||t.fontName),r!==0&&(s.angle=r*(180/Math.PI));let g=!1;if(t.str.length>1)g=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const p=Math.abs(t.transform[0]),y=Math.abs(t.transform[3]);p!==y&&Math.max(p,y)/Math.min(p,y)>1.5&&(g=!0)}if(g&&(s.canvasWidth=a.vertical?t.height:t.width),this.#g.set(e,s),this.#i.div=e,this.#i.properties=s,this.#A(this.#i),s.hasText&&this.#e.append(e),s.hasEOL){const p=document.createElement("br");p.setAttribute("role","presentation"),this.#e.append(p)}}#A(t){const{div:e,properties:s,ctx:i}=t,{style:r}=e;let a="";if(de.#S>1&&(a=`scale(${1/de.#S})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:o}=r,{canvasWidth:l,fontSize:c}=s;de.#C(i,c*this.#u,o);const{width:h}=i.measureText(e.textContent);h>0&&(a=`scaleX(${l*this.#u/h}) ${a}`)}s.angle!==0&&(a=`rotate(${s.angle}deg) ${a}`),a.length>0&&(r.transform=a)}static cleanup(){if(!(this.#E.size>0)){this.#_.clear();for(const{canvas:t}of this.#y.values())t.remove();this.#y.clear()}}static#T(t=null){let e=this.#y.get(t||="");if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#y.set(t,e),this.#w.set(e,{size:0,family:""})}return e}static#C(t,e,s){const i=this.#w.get(t);e===i.size&&s===i.family||(t.font=`${e}px ${s}`,i.size=e,i.family=s)}static#I(){if(this.#S!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#S=t.getBoundingClientRect().height,t.remove()}static#L(t,e){const s=this.#_.get(t);if(s)return s;const i=this.#T(e);i.canvas.width=i.canvas.height=ye,this.#C(i,ye,t);const r=i.measureText("");let a=r.fontBoundingBoxAscent,o=Math.abs(r.fontBoundingBoxDescent);if(a){const h=a/(a+o);return this.#_.set(t,h),i.canvas.width=i.canvas.height=0,h}i.strokeStyle="red",i.clearRect(0,0,ye,ye),i.strokeText("g",0,0);let l=i.getImageData(0,0,ye,ye).data;o=0;for(let h=l.length-1-3;h>=0;h-=4)if(l[h]>0){o=Math.ceil(h/4/ye);break}i.clearRect(0,0,ye,ye),i.strokeText("A",0,ye),l=i.getImageData(0,0,ye,ye).data,a=0;for(let h=0,u=l.length;h<u;h+=4)if(l[h]>0){a=ye-Math.floor(h/4/ye);break}i.canvas.width=i.canvas.height=0;const c=a?a/(a+o):Rg;return this.#_.set(t,c),c}}class ci{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function i(r){if(!r)return;let a=null;const o=r.name;if(o==="#text")a=r.value;else if(ci.shouldBuildText(o))r?.attributes?.textContent?a=r.attributes.textContent:r.value&&(a=r.value);else return;if(a!==null&&e.push({str:a}),!!r.children)for(const l of r.children)i(l)}return i(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const Ig=65536,Mg=100,Og=5e3,Lg=re?qp:Gp,Dg=re?Xp:Fh,Fg=re?Kp:Vp,Ng=re?Yp:zh;function Bg(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const t=new Uo,{docId:e}=t,s=n.url?zg(n.url):null,i=n.data?jg(n.data):null,r=n.httpHeaders||null,a=n.withCredentials===!0,o=n.password??null,l=n.range instanceof Kh?n.range:null,c=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:Ig;let h=n.worker instanceof Zt?n.worker:null;const u=n.verbosity,d=typeof n.docBaseUrl=="string"&&!Wr(n.docBaseUrl)?n.docBaseUrl:null,f=typeof n.cMapUrl=="string"?n.cMapUrl:null,g=n.cMapPacked!==!1,p=n.CMapReaderFactory||Dg,y=typeof n.standardFontDataUrl=="string"?n.standardFontDataUrl:null,m=n.StandardFontDataFactory||Ng,v=n.stopAtErrors!==!0,w=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,A=n.isEvalSupported!==!1,S=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!re,k=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!re&&(me.platform.isFirefox||!globalThis.chrome),C=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,z=typeof n.disableFontFace=="boolean"?n.disableFontFace:re,T=n.fontExtraProperties===!0,V=n.enableXfa===!0,Z=n.ownerDocument||globalThis.document,P=n.disableRange===!0,U=n.disableStream===!0,_=n.disableAutoFetch===!0,q=n.pdfBug===!0,Y=n.CanvasFactory||Lg,L=n.FilterFactory||Fg,et=n.enableHWA===!0,N=l?l.length:n.length??NaN,W=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!re&&!z,I=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:p===Fh&&m===zh&&f&&y&&Fn(f,document.baseURI)&&Fn(y,document.baseURI),D=null;Sp(u);const G={canvasFactory:new Y({ownerDocument:Z,enableHWA:et}),filterFactory:new L({docId:e,ownerDocument:Z}),cMapReaderFactory:I?null:new p({baseUrl:f,isCompressed:g}),standardFontDataFactory:I?null:new m({baseUrl:y})};if(!h){const it={verbosity:u,port:Zn.workerPort};h=it.port?Zt.fromPort(it):new Zt(it),t._worker=h}const X={docId:e,apiVersion:"4.10.38",data:i,password:o,disableAutoFetch:_,rangeChunkSize:c,length:N,docBaseUrl:d,enableXfa:V,evaluatorOptions:{maxImageSize:w,disableFontFace:z,ignoreErrors:v,isEvalSupported:A,isOffscreenCanvasSupported:S,isImageDecoderSupported:k,canvasMaxAreaInBytes:C,fontExtraProperties:T,useSystemFonts:W,cMapUrl:I?f:null,standardFontDataUrl:I?y:null}},tt={disableFontFace:z,fontExtraProperties:T,ownerDocument:Z,pdfBug:q,styleElement:D,loadingParams:{disableAutoFetch:_,enableXfa:V}};return h.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const it=h.messageHandler.sendWithPromise("GetDocRequest",X,i?[i.buffer]:null);let nt;if(l)nt=new fg(l,{disableRange:P,disableStream:U});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");let rt;if(re)if(Fn(s)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");rt=nc}else rt=Cg;else rt=Fn(s)?nc:wg;nt=new rt({url:s,length:N,httpHeaders:r,withCredentials:a,rangeChunkSize:c,disableRange:P,disableStream:U})}return it.then(rt=>{if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const yt=new Nn(e,rt,h.port),St=new Wg(yt,t,nt,tt,G);t._transport=St,yt.send("Ready",null)})}).catch(t._capability.reject),t}function zg(n){if(n instanceof URL)return n.href;try{return new URL(n,window.location).href}catch{if(re&&typeof n=="string")return n}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function jg(n){if(re&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return Hr(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n?.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function ic(n){return typeof n=="object"&&Number.isInteger(n?.num)&&n.num>=0&&Number.isInteger(n?.gen)&&n.gen>=0}class Uo{static#t=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${Uo.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}}class Kh{constructor(t,e,s=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const s of this._rangeListeners)s(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners)s(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){Mt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class $g{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return At(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Hg{#t=null;#e=!1;constructor(t,e,s,i=!1){this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=i?new Wl:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new qh,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new Ai({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return At(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,viewport:e,intent:s="display",annotationMode:i=ws.ENABLE,transform:r=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:h=null,isEditing:u=!1}){this._stats?.time("Overall");const d=this._transport.getRenderingIntent(s,i,h,u),{renderingIntent:f,cacheKey:g}=d;this.#e=!1,this.#n(),o||=this._transport.getOptionalContentConfig(f);let p=this._intentStates.get(g);p||(p=Object.create(null),this._intentStates.set(g,p)),p.streamReaderCancelTimeout&&(clearTimeout(p.streamReaderCancelTimeout),p.streamReaderCancelTimeout=null);const y=!!(f&xe.PRINT);p.displayReadyCapability||(p.displayReadyCapability=Promise.withResolvers(),p.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(d));const m=A=>{p.renderTasks.delete(v),(this._maybeCleanupAfterRender||y)&&(this.#e=!0),this.#s(!y),A?(v.capability.reject(A),this._abortOperatorList({intentState:p,reason:A instanceof Error?A:new Error(A)})):v.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},v=new ln({callback:m,params:{canvasContext:t,viewport:e,transform:r,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:p.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!y,pdfBug:this._pdfBug,pageColors:c});(p.renderTasks||=new Set).add(v);const w=v.task;return Promise.all([p.displayReadyCapability.promise,o]).then(([A,S])=>{if(this.destroyed){m();return}if(this._stats?.time("Rendering"),!(S.renderingIntent&f))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");v.initializeGraphics({transparency:A,optionalContentConfig:S}),v.operatorListChanged()}).catch(m),w}getOperatorList({intent:t="display",annotationMode:e=ws.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){function r(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(t,e,s,i,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||=new Set).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>ci.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,i){function r(){a.read().then(function({value:l,done:c}){if(c){s(o);return}o.lang??=l.lang,Object.assign(o.styles,l.styles),o.items.push(...l.items),r()},i)}const a=e.getReader(),o={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),this.#e=!1,this.#n(),Promise.all(t)}cleanup(t=!1){this.#e=!0;const e=this.#s(!1);return t&&e&&(this._stats&&=new Wl),e}#s(t=!1){if(this.#n(),!this.#e||this.destroyed)return!1;if(t)return this.#t=setTimeout(()=>{this.#t=null,this.#s(!1)},Og),!1;for(const{renderTasks:e,operatorList:s}of this._intentStates.values())if(e.size>0||!s.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#n(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(t,e){const s=this._intentStates.get(e);s&&(this._stats?.timeEnd("Page Request"),s.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&this.#s(!0)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){const{map:r,transfer:a}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:r,modifiedIds:i},a).getReader(),c=this._intentStates.get(e);c.streamReader=l;const h=()=>{l.read().then(({value:u,done:d})=>{if(d){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,c),h())},u=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const d of c.renderTasks)d.operatorListChanged();this.#s(!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(u);else if(c.opListReadCapability)c.opListReadCapability.reject(u);else throw u}})};h()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof Do){let i=Mg;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new ks(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}class Ug{#t=new Map;#e=Promise.resolve();postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[i]of this.#t)i.call(this,s)})}addEventListener(t,e,s=null){let i=null;if(s?.signal instanceof AbortSignal){const{signal:r}=s;if(r.aborted){_t("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(t,e);i=()=>r.removeEventListener("abort",a),r.addEventListener("abort",a)}this.#t.set(e,i)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}class Zt{static#t=0;static#e=!1;static#s;static{re&&(this.#e=!0,Zn.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(t,e)=>{let s;try{if(s=new URL(t),!s.origin||s.origin==="null")return!1}catch{return!1}const i=new URL(e,s);return s.origin===i.origin},this._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}}constructor({name:t=null,port:e=null,verbosity:s=xp()}={}){if(this.name=t,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if(Zt.#s?.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(Zt.#s||=new WeakMap).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}#n(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new Nn("main","worker",t),this._messageHandler.on("ready",function(){}),this.#n()}_initialize(){if(Zt.#e||Zt.#r){this._setupFakeWorker();return}let{workerSrc:t}=Zt;try{Zt._isSameOrigin(window.location.href,t)||(t=Zt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new Nn("main","worker",e),i=()=>{r.abort(),s.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController;e.addEventListener("error",()=>{this._webWorker||i()},{signal:r.signal}),s.on("test",o=>{if(r.abort(),this.destroyed||!o){i();return}this._messageHandler=s,this._port=e,this._webWorker=e,this.#n()}),s.on("ready",o=>{if(r.abort(),this.destroyed){i();return}try{a()}catch{this._setupFakeWorker()}});const a=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};a();return}catch{$r("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){Zt.#e||(_t("Setting up fake worker."),Zt.#e=!0),Zt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new Ug;this._port=e;const s=`fake${Zt.#t++}`,i=new Nn(s+"_worker",s,e);t.setup(i,e),this._messageHandler=new Nn(s,s+"_worker",e),this.#n()}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,Zt.#s?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(t){if(!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const e=this.#s?.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Zt(t)}static get workerSrc(){if(Zn.workerSrc)return Zn.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#r(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return At(this,"_setupFakeWorkerGlobal",(async()=>this.#r?this.#r:(await import(this.workerSrc)).WorkerMessageHandler)())}}class Wg{#t=new Map;#e=new Map;#s=new Map;#n=new Map;#r=null;constructor(t,e,s,i,r){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new qh,this.fontLoader=new Up({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#i(t,e=null){const s=this.#t.get(t);if(s)return s;const i=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,i),i}get annotationStorage(){return At(this,"annotationStorage",new jo)}getRenderingIntent(t,e=ws.ENABLE,s=null,i=!1,r=!1){let a=xe.DISPLAY,o=Na;switch(t){case"any":a=xe.ANY;break;case"display":break;case"print":a=xe.PRINT;break;default:_t(`getRenderingIntent - invalid intent: ${t}`)}const l=a&xe.PRINT&&s instanceof Oh?s:this.annotationStorage;switch(e){case ws.DISABLE:a+=xe.ANNOTATIONS_DISABLE;break;case ws.ENABLE:break;case ws.ENABLE_FORMS:a+=xe.ANNOTATIONS_FORMS;break;case ws.ENABLE_STORAGE:a+=xe.ANNOTATIONS_STORAGE,o=l.serializable;break;default:_t(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(a+=xe.IS_EDITING),r&&(a+=xe.OPLIST);const{ids:c,hash:h}=l.modifiedIds,u=[a,o.hash,h];return{renderingIntent:a,cacheKey:u.join("_"),annotationStorageSerializable:o,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of this.#e.values())t.push(s._destroy());this.#e.clear(),this.#s.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),de.cleanup(),this._networkStream?.cancelAllRequests(new ks("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,i)=>{Wt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:a}){if(a){i.close();return}Wt(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("ReaderHeadersReady",async s=>{await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:r,contentLength:a}=this._fullReader;return(!i||!r)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=o=>{e.onProgress?.({loaded:o.loaded,total:o.total})}),{isStreamingSupported:i,isRangeSupported:r,contentLength:a}}),t.on("GetRangeReader",(s,i)=>{Wt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(s.begin,s.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:a,done:o}){if(o){i.close();return}Wt(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{i.error(a)})},i.onCancel=a=>{r.cancel(a),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new $g(s,this))}),t.on("DocException",s=>{e._capability.reject(ve(s))}),t.on("PasswordRequest",s=>{this.#r=Promise.withResolvers();try{if(!e.onPassword)throw ve(s);const i=r=>{r instanceof Error?this.#r.reject(r):this.#r.resolve({password:r})};e.onPassword(i,s.code)}catch(i){this.#r.reject(i)}return this.#r.promise}),t.on("DataLoaded",s=>{e.onProgress?.({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;this.#e.get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,i,r])=>{if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":const{disableFontFace:a,fontExtraProperties:o,pdfBug:l}=this._params;if("error"in r){const d=r.error;_t(`Error during font loading: ${d}`),this.commonObjs.resolve(s,d);break}const c=l&&globalThis.FontInspector?.enabled?(d,f)=>globalThis.FontInspector.fontAdded(d,f):null,h=new Wp(r,{disableFontFace:a,fontExtraProperties:o,inspectFont:c});this.fontLoader.bind(h).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!o&&h.data&&(h.data=null),this.commonObjs.resolve(s,h)});break;case"CopyLocalImage":const{imageRef:u}=r;Wt(u,"The imageRef must be defined.");for(const d of this.#e.values())for(const[,f]of d.objs)if(f?.ref===u)return f.dataLen?(this.commonObjs.resolve(s,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,r);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([s,i,r,a])=>{if(this.destroyed)return;const o=this.#e.get(i);if(!o.objs.has(s)){if(o._intentStates.size===0){a?.bitmap?.close();return}switch(r){case"Image":o.objs.resolve(s,a),a?.dataLen>vp&&(o._maybeCleanupAfterRender=!0);break;case"Pattern":o.objs.resolve(s,a);break;default:throw new Error(`Got unknown object type ${r}`)}}}),t.on("DocProgress",s=>{this.destroyed||e.onProgress?.({loaded:s.loaded,total:s.total})}),t.on("FetchBuiltInCMap",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(s)}),t.on("FetchStandardFontData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&_t("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=this.#s.get(e);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&this.#n.set(r.refStr,t);const a=new Hg(e,r,this,this._params.pdfBug);return this.#e.set(e,a),a});return this.#s.set(e,i),i}getPageIndex(t){return ic(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#i("GetFieldObjects")}hasJSActions(){return this.#i("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#i("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#i("GetOptionalContentConfig").then(e=>new dg(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(i=>({info:i[0],metadata:i[1]?new hg(i[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),de.cleanup()}}cachedPageNumber(t){if(!ic(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#n.get(e)??null}}const In=Symbol("INITIAL_DATA");class qh{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:In}}get(t,e=null){if(e){const i=this.#e(t);return i.promise.then(()=>e(i.data)),null}const s=this.#t[t];if(!s||s.data===In)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=this.#t[t];return!!e&&e.data!==In}delete(t){const e=this.#t[t];return!e||e.data===In?!1:(delete this.#t[t],!0)}resolve(t,e=null){const s=this.#e(t);s.data=e,s.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==In&&(yield[t,e])}}}class Gg{#t=null;constructor(t){this.#t=t,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class ln{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:h=!1,pdfBug:u=!1,pageColors:d=null}){this.callback=t,this.params=e,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=u,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Gg(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(ln.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");ln.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:i,transform:r,background:a}=this.params;this.gfx=new pn(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:i,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),ln.#e.delete(this._canvas),this.callback(t||new Do(`Rendering cancelled, page ${this._pageIndex+1}`,e))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),ln.#e.delete(this._canvas),this.callback())))}}const Vg="4.10.38",Kg="f9bea397f";function rc(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function Mn(n){return Math.max(0,Math.min(255,255*n))}class ac{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Mn(t),[t,t,t]}static G_HTML([t]){const e=rc(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(Mn)}static RGB_HTML(t){return`#${t.map(rc).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[Mn(1-Math.min(1,t+i)),Mn(1-Math.min(1,s+i)),Mn(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const i=1-t,r=1-e,a=1-s,o=Math.min(i,r,a);return["CMYK",i,r,a,o]}}class qg{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Mt("Abstract method `_createSVG` called.")}}class Wo extends qg{_createSVG(t){return document.createElementNS(ts,t)}}class Xh{static setupStorage(t,e,s,i,r){const a=i.getValue(e,{value:null});switch(s.name){case"textarea":if(a.value!==null&&(t.textContent=a.value),r==="print")break;t.addEventListener("input",o=>{i.setValue(e,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(a.value===s.attributes.xfaOn?t.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&t.removeAttribute("checked"),r==="print")break;t.addEventListener("change",o=>{i.setValue(e,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&t.setAttribute("value",a.value),r==="print")break;t.addEventListener("input",o=>{i.setValue(e,{value:o.target.value})})}break;case"select":if(a.value!==null){t.setAttribute("value",a.value);for(const o of s.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}t.addEventListener("input",o=>{const l=o.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(e,{value:c})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:r}){const{attributes:a}=e,o=t instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${i}`);for(const[l,c]of Object.entries(a))if(c!=null)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!o||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,c)}o&&r.addLinkAttributes(t,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(t,a.dataId,e,s)}static render(t){const e=t.annotationStorage,s=t.linkService,i=t.xfaHtml,r=t.intent||"display",a=document.createElement(i.name);i.attributes&&this.setAttributes({html:a,element:i,intent:r,linkService:s});const o=r!=="richText",l=t.div;if(l.append(a),t.viewport){const u=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=u}o&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(i.children.length===0){if(i.value){const u=document.createTextNode(i.value);a.append(u),o&&ci.shouldBuildText(i.name)&&c.push(u)}return{textDivs:c}}const h=[[i,-1,a]];for(;h.length>0;){const[u,d,f]=h.at(-1);if(d+1===u.children.length){h.pop();continue}const g=u.children[++h.at(-1)[1]];if(g===null)continue;const{name:p}=g;if(p==="#text"){const m=document.createTextNode(g.value);c.push(m),f.append(m);continue}const y=g?.attributes?.xmlns?document.createElementNS(g.attributes.xmlns,p):document.createElement(p);if(f.append(y),g.attributes&&this.setAttributes({html:y,element:g,storage:e,intent:r,linkService:s}),g.children?.length>0)h.push([g,-1,y]);else if(g.value){const m=document.createTextNode(g.value);o&&ci.shouldBuildText(p)&&c.push(m),y.append(m)}}for(const u of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))u.setAttribute("readOnly",!0);return{textDivs:c}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const xi=1e3,Xg=9,Xs=new WeakSet;function xs(n){return{width:n[2]-n[0],height:n[3]-n[1]}}class Yg{static create(t){switch(t.data.annotationType){case Kt.LINK:return new Yh(t);case Kt.TEXT:return new Zg(t);case Kt.WIDGET:switch(t.data.fieldType){case"Tx":return new Jg(t);case"Btn":return t.data.radioButton?new Zh(t):t.data.checkBox?new tm(t):new em(t);case"Ch":return new sm(t);case"Sig":return new Qg(t)}return new Qs(t);case Kt.POPUP:return new za(t);case Kt.FREETEXT:return new Jh(t);case Kt.LINE:return new im(t);case Kt.SQUARE:return new rm(t);case Kt.CIRCLE:return new am(t);case Kt.POLYLINE:return new Qh(t);case Kt.CARET:return new lm(t);case Kt.INK:return new Go(t);case Kt.POLYGON:return new om(t);case Kt.HIGHLIGHT:return new tu(t);case Kt.UNDERLINE:return new cm(t);case Kt.SQUIGGLY:return new hm(t);case Kt.STRIKEOUT:return new um(t);case Kt.STAMP:return new eu(t);case Kt.FILEATTACHMENT:return new dm(t);default:return new jt(t)}}}class jt{#t=null;#e=!1;#s=null;constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:s}){return!!(t?.str||e?.str||s?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return jt._hasPopupData(this.data)}updateEdited(t){if(!this.container)return;this.#t||={rect:this.data.rect.slice(0)};const{rect:e}=t;e&&this.#n(e),this.#s?.popup.updateEdited(t)}resetEdited(){this.#t&&(this.#n(this.#t.rect),this.#s?.popup.resetEdited(),this.#t=null)}#n(t){const{container:{style:e},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:a,pageX:o,pageY:l}}}}=this;s?.splice(0,4,...t);const{width:c,height:h}=xs(t);e.left=`${100*(t[0]-o)/r}%`,e.top=`${100*(a-t[3]+l)/a}%`,i===0?(e.width=`${100*c/r}%`,e.height=`${100*h/a}%`):this.setRotation(i)}_createContainer(t){const{data:e,parent:{page:s,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",e.id),this instanceof Qs||(r.tabIndex=xi);const{style:a}=r;if(a.zIndex=this.parent.zIndex++,e.alternativeText&&(r.title=e.alternativeText),e.noRotate&&r.classList.add("norotate"),!e.rect||this instanceof za){const{rotation:p}=e;return!e.hasOwnCanvas&&p!==0&&this.setRotation(p,r),r}const{width:o,height:l}=xs(e.rect);if(!t&&e.borderStyle.width>0){a.borderWidth=`${e.borderStyle.width}px`;const p=e.borderStyle.horizontalCornerRadius,y=e.borderStyle.verticalCornerRadius;if(p>0||y>0){const v=`calc(${p}px * var(--scale-factor)) / calc(${y}px * var(--scale-factor))`;a.borderRadius=v}else if(this instanceof Zh){const v=`calc(${o}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;a.borderRadius=v}switch(e.borderStyle.style){case Pn.SOLID:a.borderStyle="solid";break;case Pn.DASHED:a.borderStyle="dashed";break;case Pn.BEVELED:_t("Unimplemented border style: beveled");break;case Pn.INSET:_t("Unimplemented border style: inset");break;case Pn.UNDERLINE:a.borderBottomStyle="solid";break}const m=e.borderColor||null;m?(this.#e=!0,a.borderColor=ht.makeHexColor(m[0]|0,m[1]|0,m[2]|0)):a.borderWidth=0}const c=ht.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:h,pageHeight:u,pageX:d,pageY:f}=i.rawDims;a.left=`${100*(c[0]-d)/h}%`,a.top=`${100*(c[1]-f)/u}%`;const{rotation:g}=e;return e.hasOwnCanvas||g===0?(a.width=`${100*o/h}%`,a.height=`${100*l/u}%`):this.setRotation(g,r),r}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims,{width:r,height:a}=xs(this.data.rect);let o,l;t%180===0?(o=100*r/s,l=100*a/i):(o=100*a/s,l=100*r/i),e.style.width=`${o}%`,e.style.height=`${l}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,i)=>{const r=i.detail[e],a=r[0],o=r.slice(1);i.target.style[s]=ac[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:ac[`${a}_rgb`](o)})};return At(this,"_commonActions",{display:e=>{const{display:s}=e.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const i of Object.keys(e.detail))(t[i]||s[i])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[i,r]of Object.entries(e)){const a=s[i];if(a){const o={detail:{[i]:r},target:t};a(o),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,i,r]=this.data.rect.map(p=>Math.fround(p));if(t.length===8){const[p,y,m,v]=t.subarray(2,6);if(i===p&&r===y&&e===m&&s===v)return}const{style:a}=this.container;let o;if(this.#e){const{borderColor:p,borderWidth:y}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${p}" stroke-width="${y}">`],this.container.classList.add("hasBorder")}const l=i-e,c=r-s,{svgFactory:h}=this,u=h.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0);const d=h.createElement("defs");u.append(d);const f=h.createElement("clipPath"),g=`clippath_${this.data.id}`;f.setAttribute("id",g),f.setAttribute("clipPathUnits","objectBoundingBox"),d.append(f);for(let p=2,y=t.length;p<y;p+=8){const m=t[p],v=t[p+1],w=t[p+2],A=t[p+3],S=h.createElement("rect"),k=(w-e)/l,C=(r-v)/c,z=(m-w)/l,T=(v-A)/c;S.setAttribute("x",k),S.setAttribute("y",C),S.setAttribute("width",z),S.setAttribute("height",T),f.append(S),o?.push(`<rect vector-effect="non-scaling-stroke" x="${k}" y="${C}" width="${z}" height="${T}"/>`)}this.#e&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(u),this.container.style.clipPath=`url(#${g})`}_createPopup(){const{data:t}=this,e=this.#s=new za({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]});this.parent.div.append(e.render())}render(){Mt("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:r,id:a,exportValues:o}of i){if(r===-1||a===e)continue;const l=typeof o=="string"?o:null,c=document.querySelector(`[data-element-id="${a}"]`);if(c&&!Xs.has(c)){_t(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:l,domElement:c})}return s}for(const i of document.getElementsByName(t)){const{exportValue:r}=i,a=i.getAttribute("data-element-id");a!==e&&Xs.has(i)&&s.push({id:a,exportValue:r,domElement:i})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}}class Yh extends jt{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let i=!1;return t.url?(e.addLinkAttributes(s,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(s,t.action),i=!0):t.attachment?(this.#e(s,t.attachment,t.attachmentDest),i=!0):t.setOCGState?(this.#s(s,t.setOCGState),i=!0):t.dest?(this._bindLink(s,t.dest),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),i=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(s,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(s),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t()}_bindNamedAction(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),this.#t()}#e(t,e,s=null){t.href=this.linkService.getAnchorUrl(""),e.description&&(t.title=e.description),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,s),!1),this.#t()}#s(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(e.actions)){const r=s.get(i);r&&(t[r]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:i}}),!1))}t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){_t('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{s?.();const{fields:i,refs:r,include:a}=e,o=[];if(i.length!==0||r.length!==0){const h=new Set(r);for(const u of i){const d=this._fieldObjects[u]||[];for(const{id:f}of d)h.add(f)}for(const u of Object.values(this._fieldObjects))for(const d of u)h.has(d.id)===a&&o.push(d)}else for(const h of Object.values(this._fieldObjects))o.push(...h);const l=this.annotationStorage,c=[];for(const h of o){const{id:u}=h;switch(c.push(u),h.type){case"text":{const f=h.defaultValue||"";l.setValue(u,{value:f});break}case"checkbox":case"radiobutton":{const f=h.defaultValue===h.exportValues;l.setValue(u,{value:f});break}case"combobox":case"listbox":{const f=h.defaultValue||"";l.setValue(u,{value:f});break}default:continue}const d=document.querySelector(`[data-element-id="${u}"]`);if(d){if(!Xs.has(d)){_t(`_bindResetFormAction - element not allowed: ${u}`);continue}}else continue;d.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}}),!1}}}class Zg extends jt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class Qs extends jt{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return me.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,r){s.includes("mouse")?t.addEventListener(s,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):t.addEventListener(s,a=>{if(s==="blur"){if(!e.focused||!a.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}r&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(a)}})})}_setEventListeners(t,e,s,i){for(const[r,a]of s)(a==="Action"||this.data.actions?.[a])&&((a==="Focus"||a==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,r,a,i),a==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):a==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":ht.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||Xg,r=t.style;let a;const o=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-o),h=Math.round(c/(oa*i))||1,u=c/h;a=Math.min(i,l(u/oa))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(i,l(c/oa))}r.fontSize=`calc(${a}px * var(--scale-factor))`,r.color=ht.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class Jg extends Qs{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,i){const r=this.annotationStorage;for(const a of this._getElementsByName(t.name,t.id))a.domElement&&(a.domElement[e]=s),r.setValue(a.id,{[i]:s})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const i=t.getValue(e,{value:this.data.fieldValue});let r=i.value||"";const a=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;a&&r.length>a&&(r=r.slice(0,a));let o=i.formattedValue||this.data.textContent?.join(`
`)||null;o&&this.data.comb&&(o=o.replaceAll(/\s+/g,""));const l={userValue:r,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=o??r,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type="text",s.setAttribute("value",o??r),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Xs.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=xi,this._setRequired(s,this.data.required),a&&(s.maxLength=a),s.addEventListener("input",h=>{t.setValue(e,{value:h.target.value}),this.setPropertyOnSiblings(s,"value",h.target.value,"value"),l.formattedValue=null}),s.addEventListener("resetform",h=>{const u=this.data.defaultFieldValue??"";s.value=l.userValue=u,l.formattedValue=null});let c=h=>{const{formattedValue:u}=l;u!=null&&(h.target.value=u),h.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",u=>{if(l.focused)return;const{target:d}=u;l.userValue&&(d.value=l.userValue),l.lastCommittedValue=d.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),s.addEventListener("updatefromsandbox",u=>{this.showElementAndHideCanvas(u.target);const d={value(f){l.userValue=f.detail.value??"",t.setValue(e,{value:l.userValue.toString()}),f.target.value=l.userValue},formattedValue(f){const{formattedValue:g}=f.detail;l.formattedValue=g,g!=null&&f.target!==document.activeElement&&(f.target.value=g),t.setValue(e,{formattedValue:g})},selRange(f){f.target.setSelectionRange(...f.detail.selRange)},charLimit:f=>{const{charLimit:g}=f.detail,{target:p}=f;if(g===0){p.removeAttribute("maxLength");return}p.setAttribute("maxLength",g);let y=l.userValue;!y||y.length<=g||(y=y.slice(0,g),p.value=l.userValue=y,t.setValue(e,{value:y}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:y,willCommit:!0,commitKey:1,selStart:p.selectionStart,selEnd:p.selectionEnd}}))}};this._dispatchEventFromSandbox(d,u)}),s.addEventListener("keydown",u=>{l.commitKey=1;let d=-1;if(u.key==="Escape"?d=0:u.key==="Enter"&&!this.data.multiLine?d=2:u.key==="Tab"&&(l.commitKey=3),d===-1)return;const{value:f}=u.target;l.lastCommittedValue!==f&&(l.lastCommittedValue=f,l.userValue=f,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:f,willCommit:!0,commitKey:d,selStart:u.target.selectionStart,selEnd:u.target.selectionEnd}}))});const h=c;c=null,s.addEventListener("blur",u=>{if(!l.focused||!u.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{value:d}=u.target;l.userValue=d,l.lastCommittedValue!==d&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:d,willCommit:!0,commitKey:l.commitKey,selStart:u.target.selectionStart,selEnd:u.target.selectionEnd}}),h(u)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",u=>{l.lastCommittedValue=null;const{data:d,target:f}=u,{value:g,selectionStart:p,selectionEnd:y}=f;let m=p,v=y;switch(u.inputType){case"deleteWordBackward":{const w=g.substring(0,p).match(/\w*[^\w]*$/);w&&(m-=w[0].length);break}case"deleteWordForward":{const w=g.substring(p).match(/^[^\w]*\w*/);w&&(v+=w[0].length);break}case"deleteContentBackward":p===y&&(m-=1);break;case"deleteContentForward":p===y&&(v+=1);break}u.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:g,change:d||"",willCommit:!1,selStart:m,selEnd:v}})}),this._setEventListeners(s,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],u=>u.target.value)}if(c&&s.addEventListener("blur",c),this.data.comb){const u=(this.data.rect[2]-this.data.rect[0])/a;s.classList.add("comb"),s.style.letterSpacing=`calc(${u}px * var(--scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Qg extends Qs{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class tm extends Qs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Xs.add(r),r.setAttribute("data-element-id",s),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=e.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",e.exportValue),r.tabIndex=xi,r.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const c of this._getElementsByName(o,s)){const h=l&&c.exportValue===e.exportValue;c.domElement&&(c.domElement.checked=h),t.setValue(c.id,{value:h})}t.setValue(s,{value:l})}),r.addEventListener("resetform",a=>{const o=e.defaultFieldValue||"Off";a.target.checked=o===e.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Zh extends Qs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(s,{value:i})),i)for(const a of this._getElementsByName(e.fieldName,s))t.setValue(a.id,{value:!1});const r=document.createElement("input");if(Xs.add(r),r.setAttribute("data-element-id",s),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=e.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=xi,r.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const c of this._getElementsByName(o,s))t.setValue(c.id,{value:!1});t.setValue(s,{value:l})}),r.addEventListener("resetform",a=>{const o=e.defaultFieldValue;a.target.checked=o!=null&&o===e.buttonValue}),this.enableScripting&&this.hasJSActions){const a=e.buttonValue;r.addEventListener("updatefromsandbox",o=>{const l={value:c=>{const h=a===c.detail.value;for(const u of this._getElementsByName(c.target.name)){const d=h&&u.id===s;u.domElement&&(u.domElement.checked=d),t.setValue(u.id,{value:d})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class em extends Yh{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class sm extends Qs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");Xs.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=xi;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",h=>{const u=this.data.defaultFieldValue;for(const d of i.options)d.selected=d.value===u});for(const h of this.data.options){const u=document.createElement("option");u.textContent=h.displayValue,u.value=h.exportValue,s.value.includes(h.exportValue)&&(u.setAttribute("selected",!0),r=!1),i.append(u)}let a=null;if(r){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),i.prepend(h),a=()=>{h.remove(),i.removeEventListener("input",a),a=null},i.addEventListener("input",a)}const o=h=>{const u=h?"value":"textContent",{options:d,multiple:f}=i;return f?Array.prototype.filter.call(d,g=>g.selected).map(g=>g[u]):d.selectedIndex===-1?null:d[d.selectedIndex][u]};let l=o(!1);const c=h=>{const u=h.target.options;return Array.prototype.map.call(u,d=>({displayValue:d.textContent,exportValue:d.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",h=>{const u={value(d){a?.();const f=d.detail.value,g=new Set(Array.isArray(f)?f:[f]);for(const p of i.options)p.selected=g.has(p.value);t.setValue(e,{value:o(!0)}),l=o(!1)},multipleSelection(d){i.multiple=!0},remove(d){const f=i.options,g=d.detail.remove;f[g].selected=!1,i.remove(g),f.length>0&&Array.prototype.findIndex.call(f,y=>y.selected)===-1&&(f[0].selected=!0),t.setValue(e,{value:o(!0),items:c(d)}),l=o(!1)},clear(d){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),l=o(!1)},insert(d){const{index:f,displayValue:g,exportValue:p}=d.detail.insert,y=i.children[f],m=document.createElement("option");m.textContent=g,m.value=p,y?y.before(m):i.append(m),t.setValue(e,{value:o(!0),items:c(d)}),l=o(!1)},items(d){const{items:f}=d.detail;for(;i.length!==0;)i.remove(0);for(const g of f){const{displayValue:p,exportValue:y}=g,m=document.createElement("option");m.textContent=p,m.value=y,i.append(m)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:o(!0),items:c(d)}),l=o(!1)},indices(d){const f=new Set(d.detail.indices);for(const g of d.target.options)g.selected=f.has(g.index);t.setValue(e,{value:o(!0)}),l=o(!1)},editable(d){d.target.disabled=!d.detail.editable}};this._dispatchEventFromSandbox(u,h)}),i.addEventListener("input",h=>{const u=o(!0),d=o(!1);t.setValue(e,{value:u}),h.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:d,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):i.addEventListener("input",function(h){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class za extends jt{constructor(t){const{data:e,elements:s}=t;super(t,{isRenderable:jt._hasPopupData(e)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const t=this.popup=new nm({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const s of this.elements)s.popup=t,s.container.ariaHasPopup="dialog",e.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(s=>`${Lo}${s}`).join(",")),this.container}}class nm{#t=this.#k.bind(this);#e=this.#C.bind(this);#s=this.#T.bind(this);#n=this.#A.bind(this);#r=null;#i=null;#l=null;#o=null;#h=null;#c=null;#d=null;#u=!1;#f=null;#a=null;#p=null;#m=null;#g=null;#b=null;#_=!1;constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:r,contentsObj:a,richText:o,parent:l,rect:c,parentRect:h,open:u}){this.#i=t,this.#g=i,this.#l=a,this.#m=o,this.#c=l,this.#r=e,this.#p=c,this.#d=h,this.#h=s,this.#o=Ih.toDateObject(r),this.trigger=s.flatMap(d=>d.getElementsToTriggerPopup());for(const d of this.trigger)d.addEventListener("click",this.#n),d.addEventListener("mouseenter",this.#s),d.addEventListener("mouseleave",this.#e),d.classList.add("popupTriggerArea");for(const d of s)d.container?.addEventListener("keydown",this.#t);this.#i.hidden=!0,u&&this.#A()}render(){if(this.#f)return;const t=this.#f=document.createElement("div");if(t.className="popup",this.#r){const r=t.style.outlineColor=ht.makeHexColor(...this.#r);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`:t.style.backgroundColor=ht.makeHexColor(...this.#r.map(o=>Math.floor(.7*(255-o)+o)))}const e=document.createElement("span");e.className="header";const s=document.createElement("h1");if(e.append(s),{dir:s.dir,str:s.textContent}=this.#g,t.append(e),this.#o){const r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),e.append(r)}const i=this.#y;if(i)Xh.render({xfaHtml:i,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const r=this._formatContents(this.#l);t.append(r)}this.#i.append(t)}get#y(){const t=this.#m,e=this.#l;return t?.str&&(!e?.str||e.str===t.str)&&this.#m.html||null}get#w(){return this.#y?.attributes?.style?.fontSize||0}get#S(){return this.#y?.attributes?.style?.color||null}#E(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:this.#S,fontSize:this.#w?`calc(${this.#w}px * var(--scale-factor))`:""}};for(const r of t.split(`
`))e.push({name:"span",value:r,attributes:i});return s}_formatContents({str:t,dir:e}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=e;const i=t.split(/(?:\r\n?|\n)/);for(let r=0,a=i.length;r<a;++r){const o=i[r];s.append(document.createTextNode(o)),r<a-1&&s.append(document.createElement("br"))}return s}#k(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#u)&&this.#A()}updateEdited({rect:t,popupContent:e}){this.#b||={contentsObj:this.#l,richText:this.#m},t&&(this.#a=null),e&&(this.#m=this.#E(e),this.#l=null),this.#f?.remove(),this.#f=null}resetEdited(){this.#b&&({contentsObj:this.#l,richText:this.#m}=this.#b,this.#b=null,this.#f?.remove(),this.#f=null,this.#a=null)}#P(){if(this.#a!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:i,pageY:r}}}=this.#c;let a=!!this.#d,o=a?this.#d:this.#p;for(const g of this.#h)if(!o||ht.intersect(g.data.rect,o)!==null){o=g.data.rect,a=!0;break}const l=ht.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),h=a?o[2]-o[0]+5:0,u=l[0]+h,d=l[1];this.#a=[100*(u-i)/e,100*(d-r)/s];const{style:f}=this.#i;f.left=`${this.#a[0]}%`,f.top=`${this.#a[1]}%`}#A(){this.#u=!this.#u,this.#u?(this.#T(),this.#i.addEventListener("click",this.#n),this.#i.addEventListener("keydown",this.#t)):(this.#C(),this.#i.removeEventListener("click",this.#n),this.#i.removeEventListener("keydown",this.#t))}#T(){this.#f||this.render(),this.isVisible?this.#u&&this.#i.classList.add("focused"):(this.#P(),this.#i.hidden=!1,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)+1e3)}#C(){this.#i.classList.remove("focused"),!(this.#u||!this.isVisible)&&(this.#i.hidden=!0,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)-1e3)}forceHide(){this.#_=this.isVisible,this.#_&&(this.#i.hidden=!0)}maybeShow(){this.#_&&(this.#f||this.#T(),this.#_=!1,this.#i.hidden=!1)}get isVisible(){return this.#i.hidden===!1}}class Jh extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=vt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class im extends jt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:e,height:s}=xs(t.rect),i=this.svgFactory.create(e,s,!0),r=this.#t=this.svgFactory.createElement("svg:line");return r.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),r.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),r.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),r.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),r.setAttribute("stroke-width",t.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class rm extends jt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:e,height:s}=xs(t.rect),i=this.svgFactory.create(e,s,!0),r=t.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",r/2),a.setAttribute("y",r/2),a.setAttribute("width",e-r),a.setAttribute("height",s-r),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class am extends jt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:e,height:s}=xs(t.rect),i=this.svgFactory.create(e,s,!0),r=t.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",e/2),a.setAttribute("cy",s/2),a.setAttribute("rx",e/2-r/2),a.setAttribute("ry",s/2-r/2),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Qh extends jt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:s,popupRef:i}}=this;if(!e)return this.container;const{width:r,height:a}=xs(t),o=this.svgFactory.create(r,a,!0);let l=[];for(let h=0,u=e.length;h<u;h+=2){const d=e[h]-t[0],f=t[3]-e[h+1];l.push(`${d},${f}`)}l=l.join(" ");const c=this.#t=this.svgFactory.createElement(this.svgElementName);return c.setAttribute("points",l),c.setAttribute("stroke-width",s.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),o.append(c),this.container.append(o),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class om extends Qh{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class lm extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Go extends jt{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?vt.HIGHLIGHT:vt.INK}#s(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:s,borderStyle:i,popupRef:r}}=this,{transform:a,width:o,height:l}=this.#s(e,t),c=this.svgFactory.create(o,l,!0),h=this.#t=this.svgFactory.createElement("svg:g");c.append(h),h.setAttribute("stroke-width",i.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",a);for(let u=0,d=s.length;u<d;u++){const f=this.svgFactory.createElement(this.svgElementName);this.#e.push(f),f.setAttribute("points",s[u].join(",")),h.append(f)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:s,rect:i}=t,r=this.#t;if(e>=0&&r.setAttribute("stroke-width",e||1),s)for(let a=0,o=this.#e.length;a<o;a++)this.#e[a].setAttribute("points",s[a].join(","));if(i){const{transform:a,width:o,height:l}=this.#s(this.data.rotation,i);r.parentElement.setAttribute("viewBox",`0 0 ${o} ${l}`),r.setAttribute("transform",a)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class tu extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=vt.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class cm extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class hm extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class um extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class eu extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=vt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class dm extends jt{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let s;e.hasAppearance||e.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#e.bind(this)),this.#t=s;const{isMac:i}=me.platform;return t.addEventListener("keydown",r=>{r.key==="Enter"&&(i?r.metaKey:r.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class fm{#t=null;#e=null;#s=new Map;#n=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:a,structTreeLayer:o}){this.div=t,this.#t=e,this.#e=s,this.#n=o||null,this.page=r,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return this.#s.size>0}async#r(t,e){const s=t.firstChild||t,i=s.id=`${Lo}${e}`,r=await this.#n?.getAriaAttributes(i);if(r)for(const[a,o]of r)s.setAttribute(a,o);this.div.append(t),this.#t?.moveElementInDOM(this.div,t,s,!1)}async render(t){const{annotations:e}=t,s=this.div;qs(s,this.viewport);const i=new Map,r={data:null,layer:s,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Wo,annotationStorage:t.annotationStorage||new jo,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const a of e){if(a.noHTML)continue;const o=a.annotationType===Kt.POPUP;if(o){const h=i.get(a.id);if(!h)continue;r.elements=h}else{const{width:h,height:u}=xs(a.rect);if(h<=0||u<=0)continue}r.data=a;const l=Yg.create(r);if(!l.isRenderable)continue;if(!o&&a.popupRef){const h=i.get(a.popupRef);h?h.push(l):i.set(a.popupRef,[l])}const c=l.render();a.hidden&&(c.style.visibility="hidden"),await this.#r(c,a.id),l._isEditable&&(this.#s.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}this.#i()}update({viewport:t}){const e=this.div;this.viewport=t,qs(e,{rotation:t.rotation}),this.#i(),e.hidden=!1}#i(){if(!this.#e)return;const t=this.div;for(const[e,s]of this.#e){const i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:r}=i;r?r.nodeName==="CANVAS"?r.replaceWith(s):r.classList.contains("annotationContent")?r.after(s):r.before(s):i.append(s)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(t){return this.#s.get(t)}}const Fi=/\r\n?|\n/g;class qt extends pt{#t;#e="";#s=`${this.id}-editor`;#n=null;#r;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=qt.prototype,e=r=>r.isEmpty(),s=Ts.TRANSLATE_SMALL,i=Ts.TRANSLATE_BIG;return At(this,"_keyboardManager",new Si([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}]]))}static _type="freetext";static _editorType=vt.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#t=t.color||qt._defaultColor||pt._defaultLineColor,this.#r=t.fontSize||qt._defaultFontSize}static initialize(t,e){pt.initialize(t,e);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case xt.FREETEXT_SIZE:qt._defaultFontSize=e;break;case xt.FREETEXT_COLOR:qt._defaultColor=e;break}}updateParams(t,e){switch(t){case xt.FREETEXT_SIZE:this.#i(e);break;case xt.FREETEXT_COLOR:this.#l(e);break}}static get defaultPropertiesToUpdate(){return[[xt.FREETEXT_SIZE,qt._defaultFontSize],[xt.FREETEXT_COLOR,qt._defaultColor||pt._defaultLineColor]]}get propertiesToUpdate(){return[[xt.FREETEXT_SIZE,this.#r],[xt.FREETEXT_COLOR,this.#t]]}#i(t){const e=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--scale-factor))`,this.translate(0,-(i-this.#r)*this.parentScale),this.#r=i,this.#h()},s=this.#r;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:xt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#l(t){const e=i=>{this.#t=this.editorDiv.style.color=i},s=this.#t;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:xt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-qt._internalPadding*t,-(qt._internalPadding+this.#r)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(vt.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#n=new AbortController;const t=this._uiManager.combinedSignal(this.#n);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#s),this._isDraggable=!0,this.#n?.abort(),this.#n=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const t=[];this.editorDiv.normalize();let e=null;for(const s of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(qt.#c(s)),e=s);return t.join(`
`)}#h(){const[t,e]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:i,div:r}=this,a=r.style.display,o=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",i.div.append(this.div),s=r.getBoundingClientRect(),r.remove(),r.style.display=a,r.classList.toggle("hidden",o)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/e):(this.width=s.height/t,this.height=s.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#e,e=this.#e=this.#o().trimEnd();if(t===e)return;const s=i=>{if(this.#e=i,!i){this.remove();return}this.#d(),this._uiManager.rebuild(this),this.#h()};this.addCommands({cmd:()=>{s(e)},undo:()=>{s(t)},mustExec:!1}),this.#h()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){qt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,e;this.width&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#s),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#r}px * var(--scale-factor))`,s.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),mr(this,this.div,["dblclick","keydown"]),this.width){const[i,r]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[o,l]=this.getInitialTranslation();[o,l]=this.pageTranslationToScreen(o,l);const[c,h]=this.pageDimensions,[u,d]=this.pageTranslation;let f,g;switch(this.rotation){case 0:f=t+(a[0]-u)/c,g=e+this.height-(a[1]-d)/h;break;case 90:f=t+(a[0]-u)/c,g=e-(a[1]-d)/h,[o,l]=[l,-o];break;case 180:f=t-this.width+(a[0]-u)/c,g=e-(a[1]-d)/h,[o,l]=[-o,-l];break;case 270:f=t+(a[0]-u-this.height*h)/c,g=e+(a[1]-d-this.width*c)/h,[o,l]=[-l,o];break}this.setAt(f*i,g*r,o,l)}else this.setAt(t*i,e*r,this.width*i,this.height*r);this.#d(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Fi,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:s}=e;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const i=qt.#f(e.getData("text")||"").replaceAll(Fi,`
`);if(!i)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const a=r.getRangeAt(0);if(!i.includes(`
`)){a.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:o,startOffset:l}=a,c=[],h=[];if(o.nodeType===Node.TEXT_NODE){const f=o.parentElement;if(h.push(o.nodeValue.slice(l).replaceAll(Fi,"")),f!==this.editorDiv){let g=c;for(const p of this.editorDiv.childNodes){if(p===f){g=h;continue}g.push(qt.#c(p))}}c.push(o.nodeValue.slice(0,l).replaceAll(Fi,""))}else if(o===this.editorDiv){let f=c,g=0;for(const p of this.editorDiv.childNodes)g++===l&&(f=h),f.push(qt.#c(p))}this.#e=`${c.join(`
`)}${i}${h.join(`
`)}`,this.#d();const u=new Range;let d=c.reduce((f,g)=>f+g.length,0);for(const{firstChild:f}of this.editorDiv.childNodes)if(f.nodeType===Node.TEXT_NODE){const g=f.nodeValue.length;if(d<=g){u.setStart(f,d),u.setEnd(f,d);break}d-=g}r.removeAllRanges(),r.addRange(u)}#d(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const t of this.#e.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#u(){return this.#e.replaceAll(""," ")}static#f(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}static async deserialize(t,e,s){let i=null;if(t instanceof Jh){const{data:{defaultAppearanceData:{fontSize:a,fontColor:o},rect:l,rotation:c,id:h,popupRef:u},textContent:d,textPosition:f,parent:{page:{pageNumber:g}}}=t;if(!d||d.length===0)return null;i=t={annotationType:vt.FREETEXT,color:Array.from(o),fontSize:a,value:d.join(`
`),position:f,pageIndex:g-1,rect:l.slice(0),rotation:c,id:h,deleted:!1,popupRef:u}}const r=await super.deserialize(t,e,s);return r.#r=t.fontSize,r.#t=ht.makeHexColor(...t.color),r.#e=qt.#f(t.value),r.annotationElementId=t.id||null,r._initialData=i,r}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=qt._internalPadding*this.parentScale,s=this.getRect(e,e),i=pt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),r={annotationType:vt.FREETEXT,color:i,fontSize:this.#r,value:this.#u(),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?r:this.annotationElementId&&!this.#a(r)?null:(r.id=this.annotationElementId,r)}#a(t){const{value:e,fontSize:s,color:i,pageIndex:r}=this._initialData;return this._hasBeenMoved||t.value!==e||t.fontSize!==s||t.color.some((a,o)=>a!==i[o])||t.pageIndex!==r}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(this.deleted)return e;const{style:s}=e;s.fontSize=`calc(${this.#r}px * var(--scale-factor))`,s.color=this.#t,e.replaceChildren();for(const r of this.#e.split(`
`)){const a=document.createElement("div");a.append(r?document.createTextNode(r):document.createElement("br")),e.append(a)}const i=qt._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(i,i),popupContent:this.#e}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class lt{static PRECISION=1e-4;toSVGPath(){Mt("Abstract method `toSVGPath` must be implemented.")}get box(){Mt("Abstract getter `box` must be implemented.")}serialize(t,e){Mt("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,i,r,a){a||=new Float32Array(t.length);for(let o=0,l=t.length;o<l;o+=2)a[o]=e+t[o]*i,a[o+1]=s+t[o+1]*r;return a}static _rescaleAndSwap(t,e,s,i,r,a){a||=new Float32Array(t.length);for(let o=0,l=t.length;o<l;o+=2)a[o]=e+t[o+1]*i,a[o+1]=s+t[o]*r;return a}static _translate(t,e,s,i){i||=new Float32Array(t.length);for(let r=0,a=t.length;r<a;r+=2)i[r]=e+t[r],i[r+1]=s+t[r+1];return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,i,r){switch(r){case 90:return[1-e/s,t/i];case 180:return[1-t/s,1-e/i];case 270:return[e/s,1-t/i];default:return[t/s,e/i]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,i,r,a){return[(t+5*s)/6,(e+5*i)/6,(5*s+r)/6,(5*i+a)/6,(s+r)/2,(i+a)/2]}}class $s{#t;#e=[];#s;#n;#r=[];#i=new Float32Array(18);#l;#o;#h;#c;#d;#u;#f=[];static#a=8;static#p=2;static#m=$s.#a+$s.#p;constructor({x:t,y:e},s,i,r,a,o=0){this.#t=s,this.#u=r*i,this.#n=a,this.#i.set([NaN,NaN,NaN,NaN,t,e],6),this.#s=o,this.#c=$s.#a*i,this.#h=$s.#m*i,this.#d=i,this.#f.push(t,e)}isEmpty(){return isNaN(this.#i[8])}#g(){const t=this.#i.subarray(4,6),e=this.#i.subarray(16,18),[s,i,r,a]=this.#t;return[(this.#l+(t[0]-e[0])/2-s)/r,(this.#o+(t[1]-e[1])/2-i)/a,(this.#l+(e[0]-t[0])/2-s)/r,(this.#o+(e[1]-t[1])/2-i)/a]}add({x:t,y:e}){this.#l=t,this.#o=e;const[s,i,r,a]=this.#t;let[o,l,c,h]=this.#i.subarray(8,12);const u=t-c,d=e-h,f=Math.hypot(u,d);if(f<this.#h)return!1;const g=f-this.#c,p=g/f,y=p*u,m=p*d;let v=o,w=l;o=c,l=h,c+=y,h+=m,this.#f?.push(t,e);const A=-m/g,S=y/g,k=A*this.#u,C=S*this.#u;return this.#i.set(this.#i.subarray(2,8),0),this.#i.set([c+k,h+C],4),this.#i.set(this.#i.subarray(14,18),12),this.#i.set([c-k,h-C],16),isNaN(this.#i[6])?(this.#r.length===0&&(this.#i.set([o+k,l+C],2),this.#r.push(NaN,NaN,NaN,NaN,(o+k-s)/r,(l+C-i)/a),this.#i.set([o-k,l-C],14),this.#e.push(NaN,NaN,NaN,NaN,(o-k-s)/r,(l-C-i)/a)),this.#i.set([v,w,o,l,c,h],6),!this.isEmpty()):(this.#i.set([v,w,o,l,c,h],6),Math.abs(Math.atan2(w-l,v-o)-Math.atan2(m,y))<Math.PI/2?([o,l,c,h]=this.#i.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((o+c)/2-s)/r,((l+h)/2-i)/a),[o,l,v,w]=this.#i.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((v+o)/2-s)/r,((w+l)/2-i)/a),!0):([v,w,o,l,c,h]=this.#i.subarray(0,6),this.#r.push(((v+5*o)/6-s)/r,((w+5*l)/6-i)/a,((5*o+c)/6-s)/r,((5*l+h)/6-i)/a,((o+c)/2-s)/r,((l+h)/2-i)/a),[c,h,o,l,v,w]=this.#i.subarray(12,18),this.#e.push(((v+5*o)/6-s)/r,((w+5*l)/6-i)/a,((5*o+c)/6-s)/r,((5*l+h)/6-i)/a,((o+c)/2-s)/r,((l+h)/2-i)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#r,e=this.#e;if(isNaN(this.#i[6])&&!this.isEmpty())return this.#b();const s=[];s.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);this.#y(s);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return this.#_(s),s.join(" ")}#b(){const[t,e,s,i]=this.#t,[r,a,o,l]=this.#g();return`M${(this.#i[2]-t)/s} ${(this.#i[3]-e)/i} L${(this.#i[4]-t)/s} ${(this.#i[5]-e)/i} L${r} ${a} L${o} ${l} L${(this.#i[16]-t)/s} ${(this.#i[17]-e)/i} L${(this.#i[14]-t)/s} ${(this.#i[15]-e)/i} Z`}#_(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#y(t){const[e,s,i,r]=this.#t,a=this.#i.subarray(4,6),o=this.#i.subarray(16,18),[l,c,h,u]=this.#g();t.push(`L${(a[0]-e)/i} ${(a[1]-s)/r} L${l} ${c} L${h} ${u} L${(o[0]-e)/i} ${(o[1]-s)/r}`)}newFreeDrawOutline(t,e,s,i,r,a){return new su(t,e,s,i,r,a)}getOutlines(){const t=this.#r,e=this.#e,s=this.#i,[i,r,a,o]=this.#t,l=new Float32Array((this.#f?.length??0)+2);for(let u=0,d=l.length-2;u<d;u+=2)l[u]=(this.#f[u]-i)/a,l[u+1]=(this.#f[u+1]-r)/o;if(l[l.length-2]=(this.#l-i)/a,l[l.length-1]=(this.#o-r)/o,isNaN(s[6])&&!this.isEmpty())return this.#w(l);const c=new Float32Array(this.#r.length+24+this.#e.length);let h=t.length;for(let u=0;u<h;u+=2){if(isNaN(t[u])){c[u]=c[u+1]=NaN;continue}c[u]=t[u],c[u+1]=t[u+1]}h=this.#E(c,h);for(let u=e.length-6;u>=6;u-=6)for(let d=0;d<6;d+=2){if(isNaN(e[u+d])){c[h]=c[h+1]=NaN,h+=2;continue}c[h]=e[u+d],c[h+1]=e[u+d+1],h+=2}return this.#S(c,h),this.newFreeDrawOutline(c,l,this.#t,this.#d,this.#s,this.#n)}#w(t){const e=this.#i,[s,i,r,a]=this.#t,[o,l,c,h]=this.#g(),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(e[2]-s)/r,(e[3]-i)/a,NaN,NaN,NaN,NaN,(e[4]-s)/r,(e[5]-i)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,(e[16]-s)/r,(e[17]-i)/a,NaN,NaN,NaN,NaN,(e[14]-s)/r,(e[15]-i)/a],0),this.newFreeDrawOutline(u,t,this.#t,this.#d,this.#s,this.#n)}#S(t,e){const s=this.#e;return t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e),e+=6}#E(t,e){const s=this.#i.subarray(4,6),i=this.#i.subarray(16,18),[r,a,o,l]=this.#t,[c,h,u,d]=this.#g();return t.set([NaN,NaN,NaN,NaN,(s[0]-r)/o,(s[1]-a)/l,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,u,d,NaN,NaN,NaN,NaN,(i[0]-r)/o,(i[1]-a)/l],e),e+=24}}class su extends lt{#t;#e=new Float32Array(4);#s;#n;#r;#i;#l;constructor(t,e,s,i,r,a){super(),this.#l=t,this.#r=e,this.#t=s,this.#i=i,this.#s=r,this.#n=a,this.lastPoint=[NaN,NaN],this.#o(a);const[o,l,c,h]=this.#e;for(let u=0,d=t.length;u<d;u+=2)t[u]=(t[u]-o)/c,t[u+1]=(t[u+1]-l)/h;for(let u=0,d=e.length;u<d;u+=2)e[u]=(e[u]-o)/c,e[u+1]=(e[u+1]-l)/h}toSVGPath(){const t=[`M${this.#l[4]} ${this.#l[5]}`];for(let e=6,s=this.#l.length;e<s;e+=6){if(isNaN(this.#l[e])){t.push(`L${this.#l[e+4]} ${this.#l[e+5]}`);continue}t.push(`C${this.#l[e]} ${this.#l[e+1]} ${this.#l[e+2]} ${this.#l[e+3]} ${this.#l[e+4]} ${this.#l[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,s,i],r){const a=s-t,o=i-e;let l,c;switch(r){case 0:l=lt._rescale(this.#l,t,i,a,-o),c=lt._rescale(this.#r,t,i,a,-o);break;case 90:l=lt._rescaleAndSwap(this.#l,t,e,a,o),c=lt._rescaleAndSwap(this.#r,t,e,a,o);break;case 180:l=lt._rescale(this.#l,s,e,-a,o),c=lt._rescale(this.#r,s,e,-a,o);break;case 270:l=lt._rescaleAndSwap(this.#l,s,i,-a,-o),c=lt._rescaleAndSwap(this.#r,s,i,-a,-o);break}return{outline:Array.from(l),points:[Array.from(c)]}}#o(t){const e=this.#l;let s=e[4],i=e[5],r=s,a=i,o=s,l=i,c=s,h=i;const u=t?Math.max:Math.min;for(let f=6,g=e.length;f<g;f+=6){if(isNaN(e[f]))r=Math.min(r,e[f+4]),a=Math.min(a,e[f+5]),o=Math.max(o,e[f+4]),l=Math.max(l,e[f+5]),h<e[f+5]?(c=e[f+4],h=e[f+5]):h===e[f+5]&&(c=u(c,e[f+4]));else{const p=ht.bezierBoundingBox(s,i,...e.slice(f,f+6));r=Math.min(r,p[0]),a=Math.min(a,p[1]),o=Math.max(o,p[2]),l=Math.max(l,p[3]),h<p[3]?(c=p[2],h=p[3]):h===p[3]&&(c=u(c,p[2]))}s=e[f+4],i=e[f+5]}const d=this.#e;d[0]=r-this.#s,d[1]=a-this.#s,d[2]=o-r+2*this.#s,d[3]=l-a+2*this.#s,this.lastPoint=[c,h]}get box(){return this.#e}newOutliner(t,e,s,i,r,a=0){return new $s(t,e,s,i,r,a)}getNewOutline(t,e){const[s,i,r,a]=this.#e,[o,l,c,h]=this.#t,u=r*c,d=a*h,f=s*c+o,g=i*h+l,p=this.newOutliner({x:this.#r[0]*u+f,y:this.#r[1]*d+g},this.#t,this.#i,t,this.#n,e??this.#s);for(let y=2;y<this.#r.length;y+=2)p.add({x:this.#r[y]*u+f,y:this.#r[y+1]*d+g});return p.getOutlines()}}class ja{#t;#e;#s=[];#n=[];constructor(t,e=0,s=0,i=!0){let r=1/0,a=-1/0,o=1/0,l=-1/0;const c=10**-4;for(const{x:y,y:m,width:v,height:w}of t){const A=Math.floor((y-e)/c)*c,S=Math.ceil((y+v+e)/c)*c,k=Math.floor((m-e)/c)*c,C=Math.ceil((m+w+e)/c)*c,z=[A,k,C,!0],T=[S,k,C,!1];this.#s.push(z,T),r=Math.min(r,A),a=Math.max(a,S),o=Math.min(o,k),l=Math.max(l,C)}const h=a-r+2*s,u=l-o+2*s,d=r-s,f=o-s,g=this.#s.at(i?-1:-2),p=[g[0],g[2]];for(const y of this.#s){const[m,v,w]=y;y[0]=(m-d)/h,y[1]=(v-f)/u,y[2]=(w-f)/u}this.#t=new Float32Array([d,f,h,u]),this.#e=p}getOutlines(){this.#s.sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of this.#s)e[3]?(t.push(...this.#h(e)),this.#l(e)):(this.#o(e),t.push(...this.#h(e)));return this.#r(t)}#r(t){const e=[],s=new Set;for(const a of t){const[o,l,c]=a;e.push([o,l,a],[o,c,a])}e.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=e.length;a<o;a+=2){const l=e[a][2],c=e[a+1][2];l.push(c),c.push(l),s.add(l),s.add(c)}const i=[];let r;for(;s.size>0;){const a=s.values().next().value;let[o,l,c,h,u]=a;s.delete(a);let d=o,f=l;for(r=[o,c],i.push(r);;){let g;if(s.has(h))g=h;else if(s.has(u))g=u;else break;s.delete(g),[o,l,c,h,u]=g,d!==o&&(r.push(d,f,o,f===l?l:c),d=o),f=f===l?c:l}r.push(d,f)}return new pm(i,this.#t,this.#e)}#i(t){const e=this.#n;let s=0,i=e.length-1;for(;s<=i;){const r=s+i>>1,a=e[r][0];if(a===t)return r;a<t?s=r+1:i=r-1}return i+1}#l([,t,e]){const s=this.#i(t);this.#n.splice(s,0,[t,e])}#o([,t,e]){const s=this.#i(t);for(let i=s;i<this.#n.length;i++){const[r,a]=this.#n[i];if(r!==t)break;if(r===t&&a===e){this.#n.splice(i,1);return}}for(let i=s-1;i>=0;i--){const[r,a]=this.#n[i];if(r!==t)break;if(r===t&&a===e){this.#n.splice(i,1);return}}}#h(t){const[e,s,i]=t,r=[[e,s,i]],a=this.#i(i);for(let o=0;o<a;o++){const[l,c]=this.#n[o];for(let h=0,u=r.length;h<u;h++){const[,d,f]=r[h];if(!(c<=d||f<=l)){if(d>=l){if(f>c)r[h][1]=c;else{if(u===1)return[];r.splice(h,1),h--,u--}continue}r[h][2]=l,f>c&&r.push([e,c,f])}}}return r}}class pm extends lt{#t;#e;constructor(t,e,s){super(),this.#e=t,this.#t=e,this.lastPoint=s}toSVGPath(){const t=[];for(const e of this.#e){let[s,i]=e;t.push(`M${s} ${i}`);for(let r=2;r<e.length;r+=2){const a=e[r],o=e[r+1];a===s?(t.push(`V${o}`),i=o):o===i&&(t.push(`H${a}`),s=a)}t.push("Z")}return t.join(" ")}serialize([t,e,s,i],r){const a=[],o=s-t,l=i-e;for(const c of this.#e){const h=new Array(c.length);for(let u=0;u<c.length;u+=2)h[u]=t+c[u]*o,h[u+1]=i-c[u+1]*l;a.push(h)}return a}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class $a extends $s{newFreeDrawOutline(t,e,s,i,r,a){return new gm(t,e,s,i,r,a)}}class gm extends su{newOutliner(t,e,s,i,r,a=0){return new $a(t,e,s,i,r,a)}}class Pe{#t=null;#e=null;#s;#n=null;#r=!1;#i=!1;#l=null;#o;#h=null;#c=null;#d;static#u=null;static get _keyboardManager(){return At(this,"_keyboardManager",new Si([[["Escape","mac+Escape"],Pe.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Pe.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Pe.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Pe.prototype._moveToPrevious],[["Home","mac+Home"],Pe.prototype._moveToBeginning],[["End","mac+End"],Pe.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#i=!1,this.#d=xt.HIGHLIGHT_COLOR,this.#l=t):(this.#i=!0,this.#d=xt.HIGHLIGHT_DEFAULT_COLOR),this.#c=t?._uiManager||e,this.#o=this.#c._eventBus,this.#s=t?.color||this.#c?.highlightColors.values().next().value||"#FFFF98",Pe.#u||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);const e=this.#c._signal;t.addEventListener("click",this.#m.bind(this),{signal:e}),t.addEventListener("keydown",this.#p.bind(this),{signal:e});const s=this.#e=document.createElement("span");return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=this.#s,t.append(s),t}renderMainDropdown(){const t=this.#n=this.#f();return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}#f(){const t=document.createElement("div"),e=this.#c._signal;t.addEventListener("contextmenu",ze,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,i]of this.#c.highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=s,r.setAttribute("data-l10n-id",Pe.#u[s]);const a=document.createElement("span");r.append(a),a.className="swatch",a.style.backgroundColor=i,r.setAttribute("aria-selected",i===this.#s),r.addEventListener("click",this.#a.bind(this,i),{signal:e}),t.append(r)}return t.addEventListener("keydown",this.#p.bind(this),{signal:e}),t}#a(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:this.#d,value:t})}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#m(t);return}const e=t.target.getAttribute("data-color");e&&this.#a(e,t)}_moveToNext(t){if(!this.#b){this.#m(t);return}if(t.target===this.#t){this.#n.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#n?.firstChild||t.target===this.#t){this.#b&&this._hideDropdownFromKeyboard();return}this.#b||this.#m(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#b){this.#m(t);return}this.#n.firstChild?.focus()}_moveToEnd(t){if(!this.#b){this.#m(t);return}this.#n.lastChild?.focus()}#p(t){Pe._keyboardManager.exec(this,t)}#m(t){if(this.#b){this.hideDropdown();return}if(this.#r=t.detail===0,this.#h||(this.#h=new AbortController,window.addEventListener("pointerdown",this.#g.bind(this),{signal:this.#c.combinedSignal(this.#h)})),this.#n){this.#n.classList.remove("hidden");return}const e=this.#n=this.#f();this.#t.append(e)}#g(t){this.#n?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#n?.classList.add("hidden"),this.#h?.abort(),this.#h=null}get#b(){return this.#n&&!this.#n.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#i){if(!this.#b){this.#l?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#n)return;const e=this.#c.highlightColors.values();for(const s of this.#n.children)s.setAttribute("aria-selected",e.next().value===t)}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#n?.remove(),this.#n=null}}class zt extends pt{#t=null;#e=0;#s;#n=null;#r=null;#i=null;#l=null;#o=0;#h=null;#c=null;#d=null;#u=!1;#f=null;#a;#p=null;#m="";#g;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=vt.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=zt.prototype;return At(this,"_keyboardManager",new Si([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||zt._defaultColor,this.#g=t.thickness||zt._defaultThickness,this.#a=t.opacity||zt._defaultOpacity,this.#s=t.boxes||null,this.#b=t.methodOfCreation||"",this.#m=t.text||"",this._isDraggable=!1,t.highlightId>-1?(this.#u=!0,this.#y(t),this.#P()):this.#s&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#l=t.focusNode,this.#o=t.focusOffset,this.#_(),this.#P(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#u?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#g,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#_(){const t=new ja(this.#s,.001);this.#c=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;const e=new ja(this.#s,.0025,.001,this._uiManager.direction==="ltr");this.#i=e.getOutlines();const{lastPoint:s}=this.#i;this.#f=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]}#y({highlightOutlines:t,highlightId:e,clipPathId:s}){this.#c=t;const i=1.5;if(this.#i=t.getNewOutline(this.#g/2+i,.0025),e>=0)this.#d=e,this.#n=s,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#i.box,path:{d:this.#i.toSVGPath()}},!0);else if(this.parent){const h=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:zt.#A(this.#c.box,(h-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:zt.#A(this.#i.box,h),path:{d:this.#i.toSVGPath()}})}const[r,a,o,l]=t.box;switch(this.rotation){case 0:this.x=r,this.y=a,this.width=o,this.height=l;break;case 90:{const[h,u]=this.parentDimensions;this.x=a,this.y=1-r,this.width=o*u/h,this.height=l*h/u;break}case 180:this.x=1-r,this.y=1-a,this.width=o,this.height=l;break;case 270:{const[h,u]=this.parentDimensions;this.x=1-a,this.y=r,this.width=o*u/h,this.height=l*h/u;break}}const{lastPoint:c}=this.#i;this.#f=[(c[0]-r)/o,(c[1]-a)/l]}static initialize(t,e){pt.initialize(t,e),zt._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case xt.HIGHLIGHT_DEFAULT_COLOR:zt._defaultColor=e;break;case xt.HIGHLIGHT_THICKNESS:zt._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#f}updateParams(t,e){switch(t){case xt.HIGHLIGHT_COLOR:this.#w(e);break;case xt.HIGHLIGHT_THICKNESS:this.#S(e);break}}static get defaultPropertiesToUpdate(){return[[xt.HIGHLIGHT_DEFAULT_COLOR,zt._defaultColor],[xt.HIGHLIGHT_THICKNESS,zt._defaultThickness]]}get propertiesToUpdate(){return[[xt.HIGHLIGHT_COLOR,this.color||zt._defaultColor],[xt.HIGHLIGHT_THICKNESS,this.#g||zt._defaultThickness],[xt.HIGHLIGHT_FREE,this.#u]]}#w(t){const e=(r,a)=>{this.color=r,this.#a=a,this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:r,"fill-opacity":a}}),this.#r?.updateColor(r)},s=this.color,i=this.#a;this.addCommands({cmd:e.bind(this,t,zt._defaultOpacity),undo:e.bind(this,s,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:xt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)}#S(t){const e=this.#g,s=i=>{this.#g=i,this.#E(i)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:xt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(this.#r=new Pe({editor:this}),t.addColorPicker(this.#r)),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#I())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#I())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#k(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#P(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#k():t&&(this.#P(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#E(t){if(!this.#u)return;this.#y({highlightOutlines:this.#c.getNewOutline(t/2)}),this.fixAndSetPosition();const[e,s]=this.parentDimensions;this.setDims(this.width*e,this.height*s)}#k(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#P(t=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#n}=t.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#a},rootClass:{highlight:!0,free:this.#u},path:{d:this.#c.toSVGPath()}},!1,!0),this.#p=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#u},bbox:this.#i.box,path:{d:this.#i.toSVGPath()}},this.#u),this.#h&&(this.#h.style.clipPath=this.#n))}static#A([t,e,s,i],r){switch(r){case 90:return[1-e-i,t,i,s];case 180:return[1-t-s,1-e-i,s,i];case 270:return[e,1-t-s,i,s]}return[t,e,s,i]}rotate(t){const{drawLayer:e}=this.parent;let s;this.#u?(t=(t-this.rotation+360)%360,s=zt.#A(this.#c.box,t)):s=zt.#A([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#d,{bbox:s,root:{"data-main-rotation":t}}),e.updateProperties(this.#p,{bbox:zt.#A(this.#i.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#m&&(t.setAttribute("aria-label",this.#m),t.setAttribute("role","mark")),this.#u?t.classList.add("free"):this.div.addEventListener("keydown",this.#T.bind(this),{signal:this._uiManager._signal});const e=this.#h=document.createElement("div");t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#n;const[s,i]=this.parentDimensions;return this.setDims(this.width*s,this.height*i),mr(this,this.#h,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#T(t){zt._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#C(!0);break;case 1:case 3:this.#C(!1);break}}#C(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#l,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#u||this.#C(!1))}get _mustFixPosition(){return!this.#u}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!t}}))}#I(){return this.#u?this.rotation:0}#L(){if(this.#u)return null;const[t,e]=this.pageDimensions,[s,i]=this.pageTranslation,r=this.#s,a=new Float32Array(r.length*8);let o=0;for(const{x:l,y:c,width:h,height:u}of r){const d=l*t+s,f=(1-c)*e+i;a[o]=a[o+4]=d,a[o+1]=a[o+3]=f,a[o+2]=a[o+6]=d+h*t,a[o+5]=a[o+7]=f-u*e,o+=8}return a}#F(t){return this.#c.serialize(t,this.#I())}static startHighlighting(t,e,{target:s,x:i,y:r}){const{x:a,y:o,width:l,height:c}=s.getBoundingClientRect(),h=new AbortController,u=t.combinedSignal(h),d=f=>{h.abort(),this.#v(t,f)};window.addEventListener("blur",d,{signal:u}),window.addEventListener("pointerup",d,{signal:u}),window.addEventListener("pointerdown",Ee,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",ze,{signal:u}),s.addEventListener("pointermove",this.#x.bind(this,t),{signal:u}),this._freeHighlight=new $a({x:i,y:r},[a,o,l,c],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#x(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#v(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,s){let i=null;if(t instanceof tu){const{data:{quadPoints:g,rect:p,rotation:y,id:m,color:v,opacity:w,popupRef:A},parent:{page:{pageNumber:S}}}=t;i=t={annotationType:vt.HIGHLIGHT,color:Array.from(v),opacity:w,quadPoints:g,boxes:null,pageIndex:S-1,rect:p.slice(0),rotation:y,id:m,deleted:!1,popupRef:A}}else if(t instanceof Go){const{data:{inkLists:g,rect:p,rotation:y,id:m,color:v,borderStyle:{rawWidth:w},popupRef:A},parent:{page:{pageNumber:S}}}=t;i=t={annotationType:vt.HIGHLIGHT,color:Array.from(v),thickness:w,inkLists:g,boxes:null,pageIndex:S-1,rect:p.slice(0),rotation:y,id:m,deleted:!1,popupRef:A}}const{color:r,quadPoints:a,inkLists:o,opacity:l}=t,c=await super.deserialize(t,e,s);c.color=ht.makeHexColor(...r),c.#a=l||1,o&&(c.#g=t.thickness),c.annotationElementId=t.id||null,c._initialData=i;const[h,u]=c.pageDimensions,[d,f]=c.pageTranslation;if(a){const g=c.#s=[];for(let p=0;p<a.length;p+=8)g.push({x:(a[p]-d)/h,y:1-(a[p+1]-f)/u,width:(a[p+2]-a[p])/h,height:(a[p+1]-a[p+5])/u});c.#_(),c.#P(),c.rotate(c.rotation)}else if(o){c.#u=!0;const g=o[0],p={x:g[0]-d,y:u-(g[1]-f)},y=new $a(p,[0,0,h,u],1,c.#g/2,!0,.001);for(let w=0,A=g.length;w<A;w+=2)p.x=g[w]-d,p.y=u-(g[w+1]-f),y.add(p);const{id:m,clipPathId:v}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:y.toSVGPath()}},!0,!0);c.#y({highlightOutlines:y.getOutlines(),highlightId:m,clipPathId:v}),c.#P()}return c}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=this.getRect(0,0),s=pt._colorManager.convert(this.color),i={annotationType:vt.HIGHLIGHT,color:s,opacity:this.#a,thickness:this.#g,quadPoints:this.#L(),outlines:this.#F(e),pageIndex:this.pageIndex,rect:e,rotation:this.#I(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#O(i)?null:(i.id=this.annotationElementId,i)}#O(t){const{color:e}=this._initialData;return t.color.some((s,i)=>s!==e[i])}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class mm{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))this.updateProperty(e,s)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){Mt("Not implemented")}}class ft extends pt{#t=null;#e;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#s=null;static#n=null;static#r=null;static#i=NaN;static#l=null;static#o=null;static#h=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,t.drawOutlines&&(this.#c(t),this.#f())}#c({drawOutlines:t,drawId:e,drawingOptions:s}){this.#t=t,this._drawingOptions||=s,e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#d(t,this.parent),this.#m(t.box)}#d(t,e){const{id:s}=e.drawLayer.draw(ft._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(t,e){const s=new Set(Object.keys(t));for(const[i,r]of Object.entries(e))s.has(i)?Object.assign(t[i],r):t[i]=r;return t}static getDefaultDrawingOptions(t){Mt("Not implemented")}static get typesMap(){Mt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,e),this._currentParent&&(ft.#s.updateProperty(s,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[s,i]of this.typesMap)t.push([s,e[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[s,i]of this.constructor.typesMap)t.push([s,e[i]]);return t}_updateProperty(t,e,s){const i=this._drawingOptions,r=i[e],a=o=>{i.updateProperty(e,o);const l=this.#t.updateProperty(e,o);l&&this.#m(l),this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties())};this.addCommands({cmd:a.bind(this,s),undo:a.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,ft._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#p()),{bbox:this.#g()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,ft._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#p()),{bbox:this.#g()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#g(t,e)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,ft._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#g()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#u(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#m(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#u()):t&&(this._uiManager.addShouldRescale(this),this.#f(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#u(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#d(this.#t,t)}}#a([t,e,s,i]){const{parentDimensions:[r,a],rotation:o}=this;switch(o){case 90:return[e,1-t,s*(a/r),i*(r/a)];case 180:return[1-t,1-e,s,i];case 270:return[1-e,t,s*(a/r),i*(r/a)];default:return[t,e,s,i]}}#p(){const{x:t,y:e,width:s,height:i,parentDimensions:[r,a],rotation:o}=this;switch(o){case 90:return[1-e,t,s*(r/a),i*(a/r)];case 180:return[1-t,1-e,s,i];case 270:return[e,1-t,s*(r/a),i*(a/r)];default:return[t,e,s,i]}}#m(t){if([this.x,this.y,this.width,this.height]=this.#a(t),this.div){this.fixAndSetPosition();const[e,s]=this.parentDimensions;this.setDims(this.width*e,this.height*s)}this._onResized()}#g(){const{x:t,y:e,width:s,height:i,rotation:r,parentRotation:a,parentDimensions:[o,l]}=this;switch((r*4+a)/90){case 1:return[1-e-i,t,i,s];case 2:return[1-t-s,1-e-i,s,i];case 3:return[e,1-t-s,i,s];case 4:return[t,e-s*(o/l),i*(l/o),s*(o/l)];case 5:return[1-e,t,s*(o/l),i*(l/o)];case 6:return[1-t-i*(l/o),1-e,i*(l/o),s*(o/l)];case 7:return[e-s*(o/l),1-t-i*(l/o),s*(o/l),i*(l/o)];case 8:return[t-s,e-i,s,i];case 9:return[1-e,t-s,i,s];case 10:return[1-t,1-e,s,i];case 11:return[e-i,1-t,i,s];case 12:return[t-i*(l/o),e,i*(l/o),s*(o/l)];case 13:return[1-e-s*(o/l),t-i*(l/o),s*(o/l),i*(l/o)];case 14:return[1-t,1-e-s*(o/l),i*(l/o),s*(o/l)];case 15:return[e,1-t,s*(o/l),i*(l/o)];default:return[t,e,s,i]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,ft._mergeSVGProperties({bbox:this.#g()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#m(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const t=super.render();t.classList.add("draw");const e=document.createElement("div");t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal";const[s,i]=this.parentDimensions;return this.setDims(this.width*s,this.height*i),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,e,s,i,r){Mt("Not implemented")}static startDrawing(t,e,s,i){const{target:r,offsetX:a,offsetY:o,pointerId:l,pointerType:c}=i;if(ft.#l&&ft.#l!==c)return;const{viewport:{rotation:h}}=t,{width:u,height:d}=r.getBoundingClientRect(),f=ft.#n=new AbortController,g=t.combinedSignal(f);if(ft.#i||=l,ft.#l??=c,window.addEventListener("pointerup",p=>{ft.#i===p.pointerId?this._endDraw(p):ft.#o?.delete(p.pointerId)},{signal:g}),window.addEventListener("pointercancel",p=>{ft.#i===p.pointerId?this._currentParent.endDrawingSession():ft.#o?.delete(p.pointerId)},{signal:g}),window.addEventListener("pointerdown",p=>{ft.#l===p.pointerType&&((ft.#o||=new Set).add(p.pointerId),ft.#s.isCancellable()&&(ft.#s.removeLastElement(),ft.#s.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",ze,{signal:g}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),r.addEventListener("touchmove",p=>{p.timeStamp===ft.#h&&Ee(p)},{signal:g}),t.toggleDrawing(),e._editorUndoBar?.hide(),ft.#s){t.drawLayer.updateProperties(this._currentDrawId,ft.#s.startNew(a,o,u,d,h));return}e.updateUIForDefaultProperties(this),ft.#s=this.createDrawerInstance(a,o,u,d,h),ft.#r=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(ft.#r.toSVGProperties(),ft.#s.defaultSVGProperties),!0,!1)}static _drawMove(t){if(ft.#h=-1,!ft.#s)return;const{offsetX:e,offsetY:s,pointerId:i}=t;if(ft.#i===i){if(ft.#o?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,ft.#s.add(e,s)),ft.#h=t.timeStamp,Ee(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,ft.#s=null,ft.#r=null,ft.#l=null,ft.#h=NaN),ft.#n&&(ft.#n.abort(),ft.#n=null,ft.#i=NaN,ft.#o=null)}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t&&e.drawLayer.updateProperties(this._currentDrawId,ft.#s.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=ft.#s,i=this._currentDrawId,r=s.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(i,s.setLastElement(r))},undo:()=>{e.drawLayer.updateProperties(i,s.removeLastElement())},mustExec:!1,type:xt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(xt.DRAW_STEP),!ft.#s.isEmpty()){const{pageDimensions:[s,i],scale:r}=e,a=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:ft.#s.getOutlines(s*r,i*r,r,this._INNER_MARGIN),drawingOptions:ft.#r,mustBeCommitted:!t});return this._cleanup(!0),a}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,s,i,r,a){Mt("Not implemented")}static async deserialize(t,e,s){const{rawDims:{pageWidth:i,pageHeight:r,pageX:a,pageY:o}}=e.viewport,l=this.deserializeDraw(a,o,i,r,this._INNER_MARGIN,t),c=await super.deserialize(t,e,s);return c.createDrawingOptions(t),c.#c({drawOutlines:l}),c.#f(),c.onScaleChanging(),c.rotate(),c}serializeDraw(t){const[e,s]=this.pageTranslation,[i,r]=this.pageDimensions;return this.#t.serialize([e,s,i,r],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class bm{#t=new Float64Array(6);#e;#s;#n;#r;#i;#l="";#o=0;#h=new qr;#c;#d;constructor(t,e,s,i,r,a){this.#c=s,this.#d=i,this.#n=r,this.#r=a,[t,e]=this.#u(t,e);const o=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#i=[t,e],this.#s=[{line:o,points:this.#i}],this.#t.set(o,0)}updateProperty(t,e){t==="stroke-width"&&(this.#r=e)}#u(t,e){return lt._normalizePoint(t,e,this.#c,this.#d,this.#n)}isEmpty(){return!this.#s||this.#s.length===0}isCancellable(){return this.#i.length<=10}add(t,e){[t,e]=this.#u(t,e);const[s,i,r,a]=this.#t.subarray(2,6),o=t-r,l=e-a;return Math.hypot(this.#c*o,this.#d*l)<=2?null:(this.#i.push(t,e),isNaN(s)?(this.#t.set([r,a,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([s,i,r,a,t,e],0),this.#e.push(...lt.createBezierPoints(s,i,r,a,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const s=this.add(t,e);return s||(this.#i.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,i,r){this.#c=s,this.#d=i,this.#n=r,[t,e]=this.#u(t,e);const a=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#i=[t,e];const o=this.#s.at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),this.#s.push({line:a,points:this.#i}),this.#t.set(a,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#s.at(-1)}setLastElement(t){return this.#s?(this.#s.push(t),this.#e=t.line,this.#i=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#h.setLastElement(t)}removeLastElement(){if(!this.#s)return this.#h.removeLastElement();this.#s.pop(),this.#l="";for(let t=0,e=this.#s.length;t<e;t++){const{line:s,points:i}=this.#s[t];this.#e=s,this.#i=i,this.#o=0,this.toSVGPath()}return{path:{d:this.#l}}}toSVGPath(){const t=lt.svgRound(this.#e[4]),e=lt.svgRound(this.#e[5]);if(this.#i.length===2)return this.#l=`${this.#l} M ${t} ${e} Z`,this.#l;if(this.#i.length<=6){const i=this.#l.lastIndexOf("M");this.#l=`${this.#l.slice(0,i)} M ${t} ${e}`,this.#o=6}if(this.#i.length===4){const i=lt.svgRound(this.#e[10]),r=lt.svgRound(this.#e[11]);return this.#l=`${this.#l} L ${i} ${r}`,this.#o=12,this.#l}const s=[];this.#o===0&&(s.push(`M ${t} ${e}`),this.#o=6);for(let i=this.#o,r=this.#e.length;i<r;i+=6){const[a,o,l,c,h,u]=this.#e.slice(i,i+6).map(lt.svgRound);s.push(`C${a} ${o} ${l} ${c} ${h} ${u}`)}return this.#l+=s.join(" "),this.#o=this.#e.length,this.#l}getOutlines(t,e,s,i){const r=this.#s.at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),this.#h.build(this.#s,t,e,s,this.#n,this.#r,i),this.#t=null,this.#e=null,this.#s=null,this.#l=null,this.#h}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class qr extends lt{#t;#e=0;#s;#n;#r;#i;#l;#o;#h;build(t,e,s,i,r,a,o){this.#r=e,this.#i=s,this.#l=i,this.#o=r,this.#h=a,this.#s=o??0,this.#n=t,this.#u()}setLastElement(t){return this.#n.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#n.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#n){if(t.push(`M${lt.svgRound(e[4])} ${lt.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12){t.push(`L${lt.svgRound(e[10])} ${lt.svgRound(e[11])}`);continue}for(let s=6,i=e.length;s<i;s+=6){const[r,a,o,l,c,h]=e.subarray(s,s+6).map(lt.svgRound);t.push(`C${r} ${a} ${o} ${l} ${c} ${h}`)}}return t.join("")}serialize([t,e,s,i],r){const a=[],o=[],[l,c,h,u]=this.#d();let d,f,g,p,y,m,v,w,A;switch(this.#o){case 0:A=lt._rescale,d=t,f=e+i,g=s,p=-i,y=t+l*s,m=e+(1-c-u)*i,v=t+(l+h)*s,w=e+(1-c)*i;break;case 90:A=lt._rescaleAndSwap,d=t,f=e,g=s,p=i,y=t+c*s,m=e+l*i,v=t+(c+u)*s,w=e+(l+h)*i;break;case 180:A=lt._rescale,d=t+s,f=e,g=-s,p=i,y=t+(1-l-h)*s,m=e+c*i,v=t+(1-l)*s,w=e+(c+u)*i;break;case 270:A=lt._rescaleAndSwap,d=t+s,f=e+i,g=-s,p=-i,y=t+(1-c-u)*s,m=e+(1-l-h)*i,v=t+(1-c)*s,w=e+(1-l)*i;break}for(const{line:S,points:k}of this.#n)a.push(A(S,d,f,g,p,r?new Array(S.length):null)),o.push(A(k,d,f,g,p,r?new Array(k.length):null));return{lines:a,points:o,rect:[y,m,v,w]}}static deserialize(t,e,s,i,r,{paths:{lines:a,points:o},rotation:l,thickness:c}){const h=[];let u,d,f,g,p;switch(l){case 0:p=lt._rescale,u=-t/s,d=e/i+1,f=1/s,g=-1/i;break;case 90:p=lt._rescaleAndSwap,u=-e/i,d=-t/s,f=1/i,g=1/s;break;case 180:p=lt._rescale,u=t/s+1,d=-e/i,f=-1/s,g=1/i;break;case 270:p=lt._rescaleAndSwap,u=e/i+1,d=t/s+1,f=-1/i,g=-1/s;break}if(!a){a=[];for(const m of o){const v=m.length;if(v===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,m[0],m[1]]));continue}if(v===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,m[0],m[1],NaN,NaN,NaN,NaN,m[2],m[3]]));continue}const w=new Float32Array(3*(v-2));a.push(w);let[A,S,k,C]=m.subarray(0,4);w.set([NaN,NaN,NaN,NaN,A,S],0);for(let z=4;z<v;z+=2){const T=m[z],V=m[z+1];w.set(lt.createBezierPoints(A,S,k,C,T,V),(z-2)*3),[A,S,k,C]=[k,C,T,V]}}}for(let m=0,v=a.length;m<v;m++)h.push({line:p(a[m].map(w=>w??NaN),u,d,f,g),points:p(o[m].map(w=>w??NaN),u,d,f,g)});const y=new qr;return y.build(h,s,i,1,l,c,r),y}#c(t=this.#h){const e=this.#s+t/2*this.#l;return this.#o%180===0?[e/this.#r,e/this.#i]:[e/this.#i,e/this.#r]}#d(){const[t,e,s,i]=this.#t,[r,a]=this.#c(0);return[t+r,e+a,s-2*r,i-2*a]}#u(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:i}of this.#n){if(i.length<=12){for(let o=4,l=i.length;o<l;o+=6){const[c,h]=i.subarray(o,o+2);t[0]=Math.min(t[0],c),t[1]=Math.min(t[1],h),t[2]=Math.max(t[2],c),t[3]=Math.max(t[3],h)}continue}let r=i[4],a=i[5];for(let o=6,l=i.length;o<l;o+=6){const[c,h,u,d,f,g]=i.subarray(o,o+6);ht.bezierBoundingBox(r,a,c,h,u,d,f,g,t),r=f,a=g}}const[e,s]=this.#c();t[0]=Math.min(1,Math.max(0,t[0]-e)),t[1]=Math.min(1,Math.max(0,t[1]-s)),t[2]=Math.min(1,Math.max(0,t[2]+e)),t[3]=Math.min(1,Math.max(0,t[3]+s)),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,s]=this.#c();this.#h=t;const[i,r]=this.#c(),[a,o]=[i-e,r-s],l=this.#t;return l[0]-=a,l[1]-=o,l[2]+=2*a,l[3]+=2*o,l}updateParentDimensions([t,e],s){const[i,r]=this.#c();this.#r=t,this.#i=e,this.#l=s;const[a,o]=this.#c(),l=a-i,c=o-r,h=this.#t;return h[0]-=l,h[1]-=c,h[2]+=2*l,h[3]+=2*c,h}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(lt.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${lt.svgRound(t)} ${lt.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let s=0,i=0,r=0,a=0,o=0,l=0;switch(this.#e){case 90:i=e/t,r=-t/e,o=t;break;case 180:s=-1,a=-1,o=t,l=e;break;case 270:i=-e/t,r=t/e,l=e;break;default:return""}return`matrix(${s} ${i} ${r} ${a} ${lt.svgRound(o)} ${lt.svgRound(l)})`}getPathResizingSVGProperties([t,e,s,i]){const[r,a]=this.#c(),[o,l,c,h]=this.#t;if(Math.abs(c-r)<=lt.PRECISION||Math.abs(h-a)<=lt.PRECISION){const p=t+s/2-(o+c/2),y=e+i/2-(l+h/2);return{path:{"transform-origin":`${lt.svgRound(t)} ${lt.svgRound(e)}`,transform:`${this.rotationTransform} translate(${p} ${y})`}}}const u=(s-2*r)/(c-2*r),d=(i-2*a)/(h-2*a),f=c/s,g=h/i;return{path:{"transform-origin":`${lt.svgRound(o)} ${lt.svgRound(l)}`,transform:`${this.rotationTransform} scale(${f} ${g}) translate(${lt.svgRound(r)} ${lt.svgRound(a)}) scale(${u} ${d}) translate(${lt.svgRound(-r)} ${lt.svgRound(-a)})`}}}getPathResizedSVGProperties([t,e,s,i]){const[r,a]=this.#c(),o=this.#t,[l,c,h,u]=o;if(o[0]=t,o[1]=e,o[2]=s,o[3]=i,Math.abs(h-r)<=lt.PRECISION||Math.abs(u-a)<=lt.PRECISION){const y=t+s/2-(l+h/2),m=e+i/2-(c+u/2);for(const{line:v,points:w}of this.#n)lt._translate(v,y,m,v),lt._translate(w,y,m,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${lt.svgRound(t)} ${lt.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const d=(s-2*r)/(h-2*r),f=(i-2*a)/(u-2*a),g=-d*(l+r)+t+r,p=-f*(c+a)+e+a;if(d!==1||f!==1||g!==0||p!==0)for(const{line:y,points:m}of this.#n)lt._rescale(y,g,p,d,f,y),lt._rescale(m,g,p,d,f,m);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${lt.svgRound(t)} ${lt.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],s){const[i,r]=s,a=this.#t,o=t-a[0],l=e-a[1];if(this.#r===i&&this.#i===r)for(const{line:c,points:h}of this.#n)lt._translate(c,o,l,c),lt._translate(h,o,l,h);else{const c=this.#r/i,h=this.#i/r;this.#r=i,this.#i=r;for(const{line:u,points:d}of this.#n)lt._rescale(u,o,l,c,h,u),lt._rescale(d,o,l,c,h,d);a[2]*=c,a[3]*=h}return a[0]=t,a[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${lt.svgRound(t)} ${lt.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${lt.svgRound(t[0])} ${lt.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class Vo extends mm{#t;constructor(t){super(),this.#t=t,super.updateProperties({fill:"none",stroke:pt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this.#t.realScale),super.updateSVGProperty(t,e)}clone(){const t=new Vo(this.#t);return t.updateAll(this),t}}class Ko extends ft{static _type="ink";static _editorType=vt.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0}static initialize(t,e){pt.initialize(t,e),this._defaultDrawingOptions=new Vo(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return At(this,"typesMap",new Map([[xt.INK_THICKNESS,"stroke-width"],[xt.INK_COLOR,"stroke"],[xt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,s,i,r){return new bm(t,e,s,i,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,s,i,r,a){return qr.deserialize(t,e,s,i,r,a)}static async deserialize(t,e,s){let i=null;if(t instanceof Go){const{data:{inkLists:a,rect:o,rotation:l,id:c,color:h,opacity:u,borderStyle:{rawWidth:d},popupRef:f},parent:{page:{pageNumber:g}}}=t;i=t={annotationType:vt.INK,color:Array.from(h),thickness:d,opacity:u,paths:{points:a},boxes:null,pageIndex:g-1,rect:o.slice(0),rotation:l,id:c,deleted:!1,popupRef:f}}const r=await super.deserialize(t,e,s);return r.annotationElementId=t.id||null,r._initialData=i,r}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:s}=this;e.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:s}){this._drawingOptions=Ko.getDefaultDrawingOptions({stroke:ht.makeHexColor(...t),"stroke-width":e,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:s,rect:i}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":a,"stroke-width":o}}=this,l={annotationType:vt.INK,color:pt._colorManager.convert(r),opacity:a,thickness:o,paths:{lines:e,points:s},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?l:this.annotationElementId&&!this.#t(l)?null:(l.id=this.annotationElementId,l)}#t(t){const{color:e,thickness:s,opacity:i,pageIndex:r}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((a,o)=>a!==e[o])||t.thickness!==s||t.opacity!==i||t.pageIndex!==r}renderAnnotationElement(t){const{points:e,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:e}),null}}class qo extends pt{#t=null;#e=null;#s=null;#n=null;#r=null;#i="";#l=null;#o=null;#h=!1;#c=!1;static _type="stamp";static _editorType=vt.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#n=t.bitmapUrl,this.#r=t.bitmapFile}static initialize(t,e){pt.initialize(t,e)}static get supportedTypes(){return At(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(e=>`image/${e}`))}static get supportedTypesStr(){return At(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,e){e.pasteEditor(vt.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#d(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#h=t.isSvg),t.file&&(this.#i=t.file.name),this.#a()}#u(){if(this.#s=null,this._uiManager.enableWaiting(!1),!!this.#l){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:r,height:a}=t||this.copyCanvas(null,null,!0).imageData,o=await s.guess({name:"altText",request:{data:i,width:r,height:a,channels:i.length/(r*a)}});if(!o)throw new Error("No response from the AI service.");if(o.error)throw new Error("Error from the AI service.");if(o.cancel)return null;if(!o.output)throw new Error("No valid response from the AI service.");const l=o.output;return await this.setGuessedAltText(l),e&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#f(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(s=>this.#d(s,!0)).finally(()=>this.#u());return}if(this.#n){const s=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(s).then(i=>this.#d(i)).finally(()=>this.#u());return}if(this.#r){const s=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(s).then(i=>this.#d(i)).finally(()=>this.#u());return}const t=document.createElement("input");t.type="file",t.accept=qo.supportedTypesStr;const e=this._uiManager._signal;this.#s=new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#d(i)}s()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:e})}).finally(()=>this.#u()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#l?.remove(),this.#l=null,this.#o&&(clearTimeout(this.#o),this.#o=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#f();return}super.rebuild(),this.div!==null&&(this.#e&&this.#l===null&&this.#f(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#n||this.#r||this.#e)}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;if(this.width&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#t?this.#a():this.#f(),this.width&&!this.annotationElementId){const[s,i]=this.parentDimensions;this.setAt(t*s,e*i,this.width*s,this.height*i)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#o!==null&&clearTimeout(this.#o);const t=200;this.#o=setTimeout(()=>{this.#o=null,this.#m()},t)}#a(){const{div:t}=this;let{width:e,height:s}=this.#t;const[i,r]=this.pageDimensions,a=.75;if(this.width)e=this.width*i,s=this.height*r;else if(e>a*i||s>a*r){const h=Math.min(a*i/e,a*r/s);e*=h,s*=h}const[o,l]=this.parentDimensions;this.setDims(e*o/i,s*l/r),this._uiManager.enableWaiting(!1);const c=this.#l=document.createElement("canvas");c.setAttribute("role","img"),this.addContainer(c),this.width=e/i,this.height=s/r,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#m(),this.#c||(this.parent.addUndoableEditor(this),this.#c=!0),this._reportTelemetry({action:"inserted_image"}),this.#i&&c.setAttribute("aria-label",this.#i)}copyCanvas(t,e,s=!1){t||(t=224);const{width:i,height:r}=this.#t,a=new Fa;let o=this.#t,l=i,c=r,h=null;if(e){if(i>e||r>e){const k=Math.min(e/i,e/r);l=Math.floor(i*k),c=Math.floor(r*k)}h=document.createElement("canvas");const d=h.width=Math.ceil(l*a.sx),f=h.height=Math.ceil(c*a.sy);this.#h||(o=this.#p(d,f));const g=h.getContext("2d");g.filter=this._uiManager.hcmFilter;let p="white",y="#cfcfd8";this._uiManager.hcmFilter!=="none"?y="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(p="#8f8f9d",y="#42414d");const m=15,v=m*a.sx,w=m*a.sy,A=new OffscreenCanvas(v*2,w*2),S=A.getContext("2d");S.fillStyle=p,S.fillRect(0,0,v*2,w*2),S.fillStyle=y,S.fillRect(0,0,v,w),S.fillRect(v,w,v,w),g.fillStyle=g.createPattern(A,"repeat"),g.fillRect(0,0,d,f),g.drawImage(o,0,0,o.width,o.height,0,0,d,f)}let u=null;if(s){let d,f;if(a.symmetric&&o.width<t&&o.height<t)d=o.width,f=o.height;else if(o=this.#t,i>t||r>t){const y=Math.min(t/i,t/r);d=Math.floor(i*y),f=Math.floor(r*y),this.#h||(o=this.#p(d,f))}const p=new OffscreenCanvas(d,f).getContext("2d",{willReadFrequently:!0});p.drawImage(o,0,0,o.width,o.height,0,0,d,f),u={width:d,height:f,data:p.getImageData(0,0,d,f).data}}return{canvas:h,width:l,height:c,imageData:u}}#p(t,e){const{width:s,height:i}=this.#t;let r=s,a=i,o=this.#t;for(;r>2*t||a>2*e;){const l=r,c=a;r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const h=new OffscreenCanvas(r,a);h.getContext("2d").drawImage(o,0,0,l,c,0,0,r,a),o=h.transferToImageBitmap()}return o}#m(){const[t,e]=this.parentDimensions,{width:s,height:i}=this,r=new Fa,a=Math.ceil(s*t*r.sx),o=Math.ceil(i*e*r.sy),l=this.#l;if(!l||l.width===a&&l.height===o)return;l.width=a,l.height=o;const c=this.#h?this.#t:this.#p(a,o),h=l.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(c,0,0,c.width,c.height,0,0,a,o)}getImageForAltText(){return this.#l}#g(t){if(t){if(this.#h){const i=this._uiManager.imageManager.getSvgUrl(this.#e);if(i)return i}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#h){const[e,s]=this.pageDimensions,i=Math.round(this.width*e*_n.PDF_TO_CSS_UNITS),r=Math.round(this.height*s*_n.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(i,r);return a.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,i,r),a.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,s){let i=null;if(t instanceof eu){const{data:{rect:g,rotation:p,id:y,structParent:m,popupRef:v},container:w,parent:{page:{pageNumber:A}}}=t,S=w.querySelector("canvas"),k=s.imageManager.getFromCanvas(w.id,S);S.remove();const C=(await e._structTree.getAriaAttributes(`${Lo}${y}`))?.get("aria-label")||"";i=t={annotationType:vt.STAMP,bitmapId:k.id,bitmap:k.bitmap,pageIndex:A-1,rect:g.slice(0),rotation:p,id:y,deleted:!1,accessibilityData:{decorative:!1,altText:C},isSvg:!1,structParent:m,popupRef:v}}const r=await super.deserialize(t,e,s),{rect:a,bitmap:o,bitmapUrl:l,bitmapId:c,isSvg:h,accessibilityData:u}=t;c&&s.imageManager.isValidId(c)?(r.#e=c,o&&(r.#t=o)):r.#n=l,r.#h=h;const[d,f]=r.pageDimensions;return r.width=(a[2]-a[0])/d,r.height=(a[3]-a[1])/f,r.annotationElementId=t.id||null,u&&(r.altTextData=u),r._initialData=i,r.#c=!!i,r}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s={annotationType:vt.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#h,structTreeParentId:this._structTreeParentId};if(t)return s.bitmapUrl=this.#g(!0),s.accessibilityData=this.serializeAltText(!0),s;const{decorative:i,altText:r}=this.serializeAltText(!1);if(!i&&r&&(s.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const o=this.#b(s);if(o.isSame)return null;o.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1}if(s.id=this.annotationElementId,e===null)return s;e.stamps||=new Map;const a=this.#h?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:a,serialized:s}),s.bitmap=this.#g(!1);else if(this.#h){const o=e.stamps.get(this.#e);a>o.area&&(o.area=a,o.serialized.bitmap.close(),o.serialized.bitmap=this.#g(!1))}return s}#b(t){const{pageIndex:e,accessibilityData:{altText:s}}=this._initialData,i=t.pageIndex===e,r=(t.accessibilityData?.alt||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&r,isSameAltText:r}}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}class ss{#t;#e=!1;#s=null;#n=null;#r=null;#i=new Map;#l=!1;#o=!1;#h=!1;#c=null;#d=null;#u=null;#f=null;#a;static _initialized=!1;static#p=new Map([qt,Ko,qo,zt].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:i,accessibilityManager:r,annotationLayer:a,drawLayer:o,textLayer:l,viewport:c,l10n:h}){const u=[...ss.#p.values()];if(!ss._initialized){ss._initialized=!0;for(const d of u)d.initialize(h,t)}t.registerEditorTypes(u),this.#a=t,this.pageIndex=e,this.div=s,this.#t=r,this.#s=a,this.viewport=c,this.#u=l,this.drawLayer=o,this._structTree=i,this.#a.addLayer(this)}get isEmpty(){return this.#i.size===0}get isInvisible(){return this.isEmpty&&this.#a.getMode()===vt.NONE}updateToolbar(t){this.#a.updateToolbar(t)}updateMode(t=this.#a.getMode()){switch(this.#y(),t){case vt.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case vt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case vt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const s of ss.#p.values())e.toggle(`${s._type}Editing`,t===s._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#u?.div}setEditingState(t){this.#a.setEditingState(t)}addCommands(t){this.#a.addCommands(t)}cleanUndoStack(t){this.#a.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#s?.div.classList.toggle("disabled",!t)}async enable(){this.#h=!0,this.div.tabIndex=0,this.togglePointerEvents(!0);const t=new Set;for(const s of this.#i.values())s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#a.removeChangedExistingAnnotation(s),t.add(s.annotationElementId));if(!this.#s){this.#h=!1;return}const e=this.#s.getEditableAnnotations();for(const s of e){if(s.hide(),this.#a.isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}this.#h=!1}disable(){this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);const t=new Map,e=new Map;for(const i of this.#i.values())if(i.disableEditing(),!!i.annotationElementId){if(i.serialize()!==null){t.set(i.annotationElementId,i);continue}else e.set(i.annotationElementId,i);this.getEditableAnnotation(i.annotationElementId)?.show(),i.remove()}if(this.#s){const i=this.#s.getEditableAnnotations();for(const r of i){const{id:a}=r.data;if(this.#a.isDeletedAnnotationElement(a))continue;let o=e.get(a);if(o){o.resetAnnotationElement(r),o.show(!1),r.show();continue}o=t.get(a),o&&(this.#a.addChangedExistingAnnotation(o),o.renderAnnotationElement(r)&&o.show(!1)),r.show()}}this.#y(),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const i of ss.#p.values())s.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(t){return this.#s?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#a.getActive()!==t&&this.#a.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#u?.div&&!this.#f){this.#f=new AbortController;const t=this.#a.combinedSignal(this.#f);this.#u.div.addEventListener("pointerdown",this.#m.bind(this),{signal:t}),this.#u.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#u?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#u.div.classList.remove("highlighting"))}#m(t){this.#a.unselectAll();const{target:e}=t;if(e===this.#u.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#u.div.contains(e)){const{isMac:s}=me.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#a.showAllEditors("highlight",!0,!0),this.#u.div.classList.add("free"),this.toggleDrawing(),zt.startHighlighting(this,this.#a.direction==="ltr",{target:this.#u.div,x:t.x,y:t.y}),this.#u.div.addEventListener("pointerup",()=>{this.#u.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#a._signal}),t.preventDefault()}}enableClick(){if(this.#n)return;this.#n=new AbortController;const t=this.#a.combinedSignal(this.#n);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#n?.abort(),this.#n=null}attach(t){this.#i.set(t.id,t);const{annotationElementId:e}=t;e&&this.#a.isDeletedAnnotationElement(e)&&this.#a.removeDeletedAnnotationElement(t)}detach(t){this.#i.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#a.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#a.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#a.addDeletedAnnotationElement(t.annotationElementId),pt.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#a.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#h),this.#a.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#r&&(t._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#a._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getNextId(){return this.#a.getId()}get#g(){return ss.#p.get(this.#a.getMode())}combinedSignal(t){return this.#a.combinedSignal(t)}#b(t){const e=this.#g;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#g?.canCreateNewEmptyEditor()}pasteEditor(t,e){this.#a.updateToolbar(t),this.#a.updateMode(t);const{offsetX:s,offsetY:i}=this.#_(),r=this.getNextId(),a=this.#b({parent:this,id:r,x:s,y:i,uiManager:this.#a,isCentered:!0,...e});a&&this.add(a)}async deserialize(t){return await ss.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#a)||null}createAndAddNewEditor(t,e,s={}){const i=this.getNextId(),r=this.#b({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:this.#a,isCentered:e,...s});return r&&this.add(r),r}#_(){const{x:t,y:e,width:s,height:i}=this.div.getBoundingClientRect(),r=Math.max(0,t),a=Math.max(0,e),o=Math.min(window.innerWidth,t+s),l=Math.min(window.innerHeight,e+i),c=(r+o)/2-t,h=(a+l)/2-e,[u,d]=this.viewport.rotation%180===0?[c,h]:[h,c];return{offsetX:u,offsetY:d}}addNewEditor(){this.createAndAddNewEditor(this.#_(),!0)}setSelected(t){this.#a.setSelected(t)}toggleSelected(t){this.#a.toggleSelected(t)}unselect(t){this.#a.unselect(t)}pointerup(t){const{isMac:e}=me.platform;if(!(t.button!==0||t.ctrlKey&&e)&&t.target===this.div&&this.#l&&(this.#l=!1,!(this.#g?.isDrawer&&this.#g.supportMultipleDrawings))){if(!this.#e){this.#e=!0;return}if(this.#a.getMode()===vt.STAMP){this.#a.unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){if(this.#a.getMode()===vt.HIGHLIGHT&&this.enableTextSelection(),this.#l){this.#l=!1;return}const{isMac:e}=me.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#l=!0,this.#g?.isDrawer){this.startDrawingSession(t);return}const s=this.#a.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(t){if(this.div.focus(),this.#c){this.#g.startDrawing(this,this.#a,!1,t);return}this.#a.setCurrentDrawingSession(this),this.#c=new AbortController;const e=this.#a.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#d=null,this.commitOrRemove())},{signal:e}),this.#g.startDrawing(this,this.#a,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#d=e);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(t=!1){return this.#c?(this.#a.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#d=null,this.#g.endDrawing(t)):null}findNewParent(t,e,s){const i=this.#a.findParent(e,s);return i===null||i===this?!1:(i.changeParent(t),!0)}commitOrRemove(){return this.#c?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#c&&this.#g.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#a.getActive()?.parent===this&&(this.#a.commitOrRemove(),this.#a.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(const t of this.#i.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#i.clear(),this.#a.removeLayer(this)}#y(){for(const t of this.#i.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,qs(this.div,t);for(const e of this.#a.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#a.commitOrRemove(),this.#y();const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,qs(this.div,{rotation:s}),e!==s)for(const i of this.#i.values())i.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#a.viewParameters.realScale}}class ue{#t=null;#e=0;#s=new Map;#n=new Map;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#s.size>0)for(const e of this.#s.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return At(this,"_svgFactory",new Wo)}static#r(t,[e,s,i,r]){const{style:a}=t;a.top=`${100*s}%`,a.left=`${100*e}%`,a.width=`${100*i}%`,a.height=`${100*r}%`}#i(){const t=ue._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#l(t,e){const s=ue._svgFactory.createElement("clipPath");t.append(s);const i=`clip_${e}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const r=ue._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${e}`),r.classList.add("clip"),i}#o(t,e){for(const[s,i]of Object.entries(e))i===null?t.removeAttribute(s):t.setAttribute(s,i)}draw(t,e=!1,s=!1){const i=this.#e++,r=this.#i(),a=ue._svgFactory.createElement("defs");r.append(a);const o=ue._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#n.set(i,o);const c=s?this.#l(a,l):null,h=ue._svgFactory.createElement("use");return r.append(h),h.setAttribute("href",`#${l}`),this.updateProperties(r,t),this.#s.set(i,r),{id:i,clipPathId:`url(#${c})`}}drawOutline(t,e){const s=this.#e++,i=this.#i(),r=ue._svgFactory.createElement("defs");i.append(r);const a=ue._svgFactory.createElement("path");r.append(a);const o=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){const u=ue._svgFactory.createElement("mask");r.append(u),l=`mask_p${this.pageIndex}_${s}`,u.setAttribute("id",l),u.setAttribute("maskUnits","objectBoundingBox");const d=ue._svgFactory.createElement("rect");u.append(d),d.setAttribute("width","1"),d.setAttribute("height","1"),d.setAttribute("fill","white");const f=ue._svgFactory.createElement("use");u.append(f),f.setAttribute("href",`#${o}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}const c=ue._svgFactory.createElement("use");i.append(c),c.setAttribute("href",`#${o}`),l&&c.setAttribute("mask",`url(#${l})`);const h=c.cloneNode();return i.append(h),c.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(i,t),this.#s.set(s,i),s}finalizeDraw(t,e){this.#n.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:s,bbox:i,rootClass:r,path:a}=e,o=typeof t=="number"?this.#s.get(t):t;if(o){if(s&&this.#o(o,s),i&&ue.#r(o,i),r){const{classList:l}=o;for(const[c,h]of Object.entries(r))l.toggle(c,h)}if(a){const c=o.firstChild.firstChild;this.#o(c,a)}}}updateParent(t,e){if(e===this)return;const s=this.#s.get(t);s&&(e.#t.append(s),this.#s.delete(t),e.#s.set(t,s))}remove(t){this.#n.delete(t),this.#t!==null&&(this.#s.get(t).remove(),this.#s.delete(t))}destroy(){this.#t=null;for(const t of this.#s.values())t.remove();this.#s.clear(),this.#n.clear()}}globalThis.pdfjsTestingUtils={HighlightOutliner:ja};bt.AbortException;bt.AnnotationEditorLayer;bt.AnnotationEditorParamsType;bt.AnnotationEditorType;bt.AnnotationEditorUIManager;bt.AnnotationLayer;bt.AnnotationMode;bt.ColorPicker;bt.DOMSVGFactory;bt.DrawLayer;bt.FeatureTest;var ym=bt.GlobalWorkerOptions;bt.ImageKind;bt.InvalidPDFException;bt.MissingPDFException;bt.OPS;bt.OutputScale;bt.PDFDataRangeTransport;bt.PDFDateString;bt.PDFWorker;bt.PasswordResponses;bt.PermissionFlag;bt.PixelsPerInch;bt.RenderingCancelledException;bt.TextLayer;bt.TouchManager;bt.UnexpectedResponseException;bt.Util;bt.VerbosityLevel;bt.XfaLayer;bt.build;bt.createValidAbsoluteUrl;bt.fetchData;var vm=bt.getDocument;bt.getFilenameFromUrl;bt.getPdfFilenameFromUrl;bt.getXfaPageViewport;bt.isDataScheme;bt.isPdfFile;bt.noContextMenu;bt.normalizeUnicode;bt.setLayerDimensions;bt.shadow;bt.stopEvent;bt.version;const _m="/assets/pdf.worker.min-yatZIOMy.mjs";ym.workerSrc=_m;function nu(){async function n(i){return await vm({data:i}).promise}async function t(i,r,a,o=1){const l=await i.getPage(r),c=l.getViewport({scale:o});a.width=c.width,a.height=c.height;const u={canvasContext:a.getContext("2d"),viewport:c};return await l.render(u).promise,a}async function e(i,r){const o=await(await i.getPage(r)).getTextContent(),l=[];let c="",h=null;for(const u of o.items){const d=u.transform[5];h!==null&&Math.abs(d-h)>5&&(c.trim()&&l.push(c.trim()),c=""),c+=u.str+" ",h=d}return c.trim()&&l.push(c.trim()),l.join(`
`)}async function s(i,r,a=2){const o=document.createElement("canvas");return await t(i,r,o,a),o.toDataURL("image/png")}return{loadPdf:n,renderPage:t,extractText:e,getPageAsImage:s}}const wm={class:"pdf-viewer"},Am={class:"viewer-toolbar"},Sm={class:"page-nav"},xm=["disabled"],Em=["value","max"],Cm=["disabled"],km={class:"zoom-controls"},Tm={key:0,class:"selection-hint"},Pm={__name:"PdfViewer",props:{pdfDoc:Object,currentPage:Number,totalPages:Number,zoom:Number},emits:["page-change","zoom-change","region-select"],setup(n,{emit:t}){const e=n,s=t,{renderPage:i}=nu(),r=Jt(null),a=Jt(null),o=Jt(!1),l=Jt({x:0,y:0}),c=Jt({x:0,y:0}),h=Br(()=>{const k=Math.min(l.value.x,c.value.x),C=Math.min(l.value.y,c.value.y),z=Math.max(l.value.x,c.value.x),T=Math.max(l.value.y,c.value.y);return{left:`${k}px`,top:`${C}px`,width:`${z-k}px`,height:`${T-C}px`}});async function u(){if(await ko(),console.log("doRender:",{hasPdfDoc:!!e.pdfDoc,hasGetPage:!!e.pdfDoc?.getPage,hasCanvas:!!a.value,page:e.currentPage,zoom:e.zoom}),e.pdfDoc&&e.pdfDoc.getPage&&a.value)try{console.log("Rendering page",e.currentPage),await i(e.pdfDoc,e.currentPage,a.value,e.zoom),console.log("Render complete")}catch(k){console.error("Page render error:",k)}}Wn([()=>e.pdfDoc,()=>e.currentPage,()=>e.zoom],u),rh(()=>{console.log("PdfViewer mounted"),u()});function d(){e.currentPage>1&&s("page-change",e.currentPage-1)}function f(){e.currentPage<e.totalPages&&s("page-change",e.currentPage+1)}function g(k){const C=parseInt(k.target.value);C>=1&&C<=e.totalPages&&s("page-change",C)}function p(){s("zoom-change",Math.min(e.zoom+.25,3))}function y(){s("zoom-change",Math.max(e.zoom-.25,.25))}function m(){s("zoom-change",1)}function v(k){const C=a.value.getBoundingClientRect();return{x:k.clientX-C.left,y:k.clientY-C.top}}function w(k){const C=v(k);o.value?(c.value=C,S(),o.value=!1):(l.value=C,c.value=C,o.value=!0)}function A(k){o.value&&(c.value=v(k))}function S(){const k=Math.min(l.value.x,c.value.x),C=Math.min(l.value.y,c.value.y),z=Math.max(l.value.x,c.value.x),T=Math.max(l.value.y,c.value.y),V=z-k,Z=T-C;if(V>10&&Z>10){const P=a.value,U=2,_=document.createElement("canvas");_.width=V*U,_.height=Z*U;const q=_.getContext("2d");q.imageSmoothingEnabled=!1,q.drawImage(P,k,C,V,Z,0,0,V*U,Z*U),s("region-select",{x:Math.round(k/e.zoom),y:Math.round(C/e.zoom),width:Math.round(V/e.zoom),height:Math.round(Z/e.zoom),imageData:_.toDataURL("image/png")})}}return(k,C)=>(Xt(),ie("div",wm,[at("div",Am,[at("div",Sm,[at("button",{onClick:d,disabled:n.currentPage<=1},"",8,xm),C[0]||(C[0]=at("span",null,"Page",-1)),at("input",{type:"number",value:n.currentPage,onChange:g,min:1,max:n.totalPages},null,40,Em),at("span",null,"/ "+ls(n.totalPages),1),at("button",{onClick:f,disabled:n.currentPage>=n.totalPages},"",8,Cm)]),at("div",km,[at("button",{onClick:y},""),at("span",null,ls(Math.round(n.zoom*100))+"%",1),at("button",{onClick:p},"+"),at("button",{onClick:m},"Reset")])]),at("div",{class:"canvas-container",ref_key:"containerRef",ref:r},[at("div",{class:"canvas-wrapper",onClick:w,onMousemove:A},[at("canvas",{ref_key:"canvasRef",ref:a},null,512),o.value?(Xt(),ie("div",{key:0,class:"selection-box",style:Rr(h.value)},null,4)):hr("",!0)],32),o.value?(Xt(),ie("div",Tm,"     ")):hr("",!0)],512)]))}},Rm=wi(Pm,[["__scopeId","data-v-5f37fafd"]]),Im={class:"region-editor"},Mm={key:0,class:"editor-content"},Om={class:"preview"},Lm=["src"],Dm={key:1,class:"no-preview"},Fm={class:"form-group"},Nm={class:"form-group"},Bm={class:"form-group"},zm={class:"form-group"},jm={class:"actions"},$m=["disabled"],Hm={key:1,class:"empty-state"},Um={__name:"RegionEditor",props:{region:Object,loading:Boolean},emits:["ocr","add","update","cancel"],setup(n,{emit:t}){const e=n,s=t,i=Jt({}),r=Br(()=>e.region?.filename&&e.region?.type);Wn(()=>e.region,o=>{o&&(i.value={...o})},{immediate:!0,deep:!0});function a(){r.value?s("update",i.value):s("add",i.value)}return(o,l)=>(Xt(),ie("div",Im,[l[12]||(l[12]=at("h3",null,"Region Editor",-1)),n.region?(Xt(),ie("div",Mm,[at("div",Om,[n.region.imageData?(Xt(),ie("img",{key:0,src:n.region.imageData,alt:"Selected region"},null,8,Lm)):(Xt(),ie("div",Dm," "))]),at("div",Fm,[l[7]||(l[7]=at("label",null,"Type",-1)),Ln(at("select",{"onUpdate:modelValue":l[0]||(l[0]=c=>i.value.type=c)},[...l[6]||(l[6]=[at("option",{value:""},"",-1),at("option",{value:"Figure"},"Figure",-1),at("option",{value:"Table"},"Table",-1)])],512),[[lp,i.value.type]])]),at("div",Nm,[l[8]||(l[8]=at("label",null,"Name",-1)),Ln(at("input",{"onUpdate:modelValue":l[1]||(l[1]=c=>i.value.name=c),placeholder:": Figure 1"},null,512),[[Yi,i.value.name]])]),at("div",Bm,[l[9]||(l[9]=at("label",null,"Caption",-1)),Ln(at("textarea",{"onUpdate:modelValue":l[2]||(l[2]=c=>i.value.caption=c),rows:"3",placeholder:""},null,512),[[Yi,i.value.caption]])]),at("div",zm,[l[10]||(l[10]=at("label",null,"Filename",-1)),Ln(at("input",{"onUpdate:modelValue":l[3]||(l[3]=c=>i.value.filename=c),placeholder:": Figure_1.png"},null,512),[[Yi,i.value.filename]])]),at("div",jm,[at("button",{onClick:l[4]||(l[4]=c=>o.$emit("ocr")),disabled:n.loading,class:"btn"},ls(n.loading?"OCR ...":"OCR "),9,$m),at("button",{onClick:a,class:"btn btn-primary"},ls(r.value?"":""),1),at("button",{onClick:l[5]||(l[5]=c=>o.$emit("cancel")),class:"btn"},"")])])):(Xt(),ie("div",Hm,[...l[11]||(l[11]=[at("p",null,"PDF  ",-1)])]))]))}},Wm=wi(Um,[["__scopeId","data-v-abb82a5e"]]),Gm={class:"region-list"},Vm={class:"list-container"},Km=["onClick"],qm={class:"region-info"},Xm={class:"region-name"},Ym={class:"region-filename"},Zm={class:"region-actions"},Jm=["onClick"],Qm=["onClick"],tb={key:0,class:"empty-state"},eb={key:0,class:"thumbnail"},sb=["src"],nb={__name:"RegionList",props:{regions:{type:Array,default:()=>[]},selectedIndex:{type:Number,default:-1}},emits:["select","edit","delete"],setup(n){return(t,e)=>(Xt(),ie("div",Gm,[at("h3",null,"Cropped Images ("+ls(n.regions.length)+")",1),at("div",Vm,[(Xt(!0),ie(De,null,Qd(n.regions,(s,i)=>(Xt(),ie("div",{key:i,class:yi(["region-item",{selected:n.selectedIndex===i}]),onClick:r=>t.$emit("select",i)},[at("div",qm,[at("span",Xm,ls(s.name||"Unnamed"),1),at("span",Ym,ls(s.filename),1)]),at("div",Zm,[at("button",{onClick:pr(r=>t.$emit("edit",i),["stop"]),title:""},"",8,Jm),at("button",{onClick:pr(r=>t.$emit("delete",i),["stop"]),title:""},"",8,Qm)])],10,Km))),128)),n.regions.length===0?(Xt(),ie("div",tb,[...e[0]||(e[0]=[at("p",null,"  ",-1)])])):hr("",!0)]),n.selectedIndex>=0&&n.regions[n.selectedIndex]?(Xt(),ie("div",eb,[at("img",{src:n.regions[n.selectedIndex].imageData,alt:"Thumbnail"},null,8,sb)])):hr("",!0)]))}},ib=wi(nb,[["__scopeId","data-v-e7c5d509"]]),rb={class:"markdown-output"},ab={class:"output-header"},ob={class:"output-content"},lb={class:"output-actions"},cb=["disabled"],hb={__name:"MarkdownOutput",props:{markdown:{type:String,default:""}},emits:["generate"],setup(n){const t=n,e=Jt(!1),s=Br(()=>t.markdown);async function i(){if(t.markdown)try{await navigator.clipboard.writeText(t.markdown),e.value=!0,setTimeout(()=>{e.value=!1},2e3)}catch(r){console.error("Failed to copy:",r)}}return(r,a)=>(Xt(),ie("div",rb,[at("div",ab,[a[2]||(a[2]=at("h3",null,"Output",-1)),at("button",{onClick:a[0]||(a[0]=o=>r.$emit("generate")),class:"btn btn-primary"},"Generate Markdown")]),at("div",ob,[Ln(at("textarea",{"onUpdate:modelValue":a[1]||(a[1]=o=>s.value=o),readonly:"",placeholder:"Markdown  ..."},null,512),[[Yi,s.value]])]),at("div",lb,[at("button",{onClick:i,class:"btn",disabled:!n.markdown},ls(e.value?"!":""),9,cb)])]))}},ub=wi(hb,[["__scopeId","data-v-e2493bc4"]]);var Ni=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function db(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fb={exports:{}};(function(n){var t=function(e){var s=Object.prototype,i=s.hasOwnProperty,r=Object.defineProperty||function(N,W,I){N[W]=I.value},a,o=typeof Symbol=="function"?Symbol:{},l=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",h=o.toStringTag||"@@toStringTag";function u(N,W,I){return Object.defineProperty(N,W,{value:I,enumerable:!0,configurable:!0,writable:!0}),N[W]}try{u({},"")}catch{u=function(W,I,D){return W[I]=D}}function d(N,W,I,D){var G=W&&W.prototype instanceof w?W:w,X=Object.create(G.prototype),tt=new Y(D||[]);return r(X,"_invoke",{value:P(N,I,tt)}),X}e.wrap=d;function f(N,W,I){try{return{type:"normal",arg:N.call(W,I)}}catch(D){return{type:"throw",arg:D}}}var g="suspendedStart",p="suspendedYield",y="executing",m="completed",v={};function w(){}function A(){}function S(){}var k={};u(k,l,function(){return this});var C=Object.getPrototypeOf,z=C&&C(C(L([])));z&&z!==s&&i.call(z,l)&&(k=z);var T=S.prototype=w.prototype=Object.create(k);A.prototype=S,r(T,"constructor",{value:S,configurable:!0}),r(S,"constructor",{value:A,configurable:!0}),A.displayName=u(S,h,"GeneratorFunction");function V(N){["next","throw","return"].forEach(function(W){u(N,W,function(I){return this._invoke(W,I)})})}e.isGeneratorFunction=function(N){var W=typeof N=="function"&&N.constructor;return W?W===A||(W.displayName||W.name)==="GeneratorFunction":!1},e.mark=function(N){return Object.setPrototypeOf?Object.setPrototypeOf(N,S):(N.__proto__=S,u(N,h,"GeneratorFunction")),N.prototype=Object.create(T),N},e.awrap=function(N){return{__await:N}};function Z(N,W){function I(X,tt,it,nt){var rt=f(N[X],N,tt);if(rt.type==="throw")nt(rt.arg);else{var yt=rt.arg,St=yt.value;return St&&typeof St=="object"&&i.call(St,"__await")?W.resolve(St.__await).then(function(Et){I("next",Et,it,nt)},function(Et){I("throw",Et,it,nt)}):W.resolve(St).then(function(Et){yt.value=Et,it(yt)},function(Et){return I("throw",Et,it,nt)})}}var D;function G(X,tt){function it(){return new W(function(nt,rt){I(X,tt,nt,rt)})}return D=D?D.then(it,it):it()}r(this,"_invoke",{value:G})}V(Z.prototype),u(Z.prototype,c,function(){return this}),e.AsyncIterator=Z,e.async=function(N,W,I,D,G){G===void 0&&(G=Promise);var X=new Z(d(N,W,I,D),G);return e.isGeneratorFunction(W)?X:X.next().then(function(tt){return tt.done?tt.value:X.next()})};function P(N,W,I){var D=g;return function(X,tt){if(D===y)throw new Error("Generator is already running");if(D===m){if(X==="throw")throw tt;return et()}for(I.method=X,I.arg=tt;;){var it=I.delegate;if(it){var nt=U(it,I);if(nt){if(nt===v)continue;return nt}}if(I.method==="next")I.sent=I._sent=I.arg;else if(I.method==="throw"){if(D===g)throw D=m,I.arg;I.dispatchException(I.arg)}else I.method==="return"&&I.abrupt("return",I.arg);D=y;var rt=f(N,W,I);if(rt.type==="normal"){if(D=I.done?m:p,rt.arg===v)continue;return{value:rt.arg,done:I.done}}else rt.type==="throw"&&(D=m,I.method="throw",I.arg=rt.arg)}}}function U(N,W){var I=W.method,D=N.iterator[I];if(D===a)return W.delegate=null,I==="throw"&&N.iterator.return&&(W.method="return",W.arg=a,U(N,W),W.method==="throw")||I!=="return"&&(W.method="throw",W.arg=new TypeError("The iterator does not provide a '"+I+"' method")),v;var G=f(D,N.iterator,W.arg);if(G.type==="throw")return W.method="throw",W.arg=G.arg,W.delegate=null,v;var X=G.arg;if(!X)return W.method="throw",W.arg=new TypeError("iterator result is not an object"),W.delegate=null,v;if(X.done)W[N.resultName]=X.value,W.next=N.nextLoc,W.method!=="return"&&(W.method="next",W.arg=a);else return X;return W.delegate=null,v}V(T),u(T,h,"Generator"),u(T,l,function(){return this}),u(T,"toString",function(){return"[object Generator]"});function _(N){var W={tryLoc:N[0]};1 in N&&(W.catchLoc=N[1]),2 in N&&(W.finallyLoc=N[2],W.afterLoc=N[3]),this.tryEntries.push(W)}function q(N){var W=N.completion||{};W.type="normal",delete W.arg,N.completion=W}function Y(N){this.tryEntries=[{tryLoc:"root"}],N.forEach(_,this),this.reset(!0)}e.keys=function(N){var W=Object(N),I=[];for(var D in W)I.push(D);return I.reverse(),function G(){for(;I.length;){var X=I.pop();if(X in W)return G.value=X,G.done=!1,G}return G.done=!0,G}};function L(N){if(N){var W=N[l];if(W)return W.call(N);if(typeof N.next=="function")return N;if(!isNaN(N.length)){var I=-1,D=function G(){for(;++I<N.length;)if(i.call(N,I))return G.value=N[I],G.done=!1,G;return G.value=a,G.done=!0,G};return D.next=D}}return{next:et}}e.values=L;function et(){return{value:a,done:!0}}return Y.prototype={constructor:Y,reset:function(N){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(q),!N)for(var W in this)W.charAt(0)==="t"&&i.call(this,W)&&!isNaN(+W.slice(1))&&(this[W]=a)},stop:function(){this.done=!0;var N=this.tryEntries[0],W=N.completion;if(W.type==="throw")throw W.arg;return this.rval},dispatchException:function(N){if(this.done)throw N;var W=this;function I(nt,rt){return X.type="throw",X.arg=N,W.next=nt,rt&&(W.method="next",W.arg=a),!!rt}for(var D=this.tryEntries.length-1;D>=0;--D){var G=this.tryEntries[D],X=G.completion;if(G.tryLoc==="root")return I("end");if(G.tryLoc<=this.prev){var tt=i.call(G,"catchLoc"),it=i.call(G,"finallyLoc");if(tt&&it){if(this.prev<G.catchLoc)return I(G.catchLoc,!0);if(this.prev<G.finallyLoc)return I(G.finallyLoc)}else if(tt){if(this.prev<G.catchLoc)return I(G.catchLoc,!0)}else if(it){if(this.prev<G.finallyLoc)return I(G.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(N,W){for(var I=this.tryEntries.length-1;I>=0;--I){var D=this.tryEntries[I];if(D.tryLoc<=this.prev&&i.call(D,"finallyLoc")&&this.prev<D.finallyLoc){var G=D;break}}G&&(N==="break"||N==="continue")&&G.tryLoc<=W&&W<=G.finallyLoc&&(G=null);var X=G?G.completion:{};return X.type=N,X.arg=W,G?(this.method="next",this.next=G.finallyLoc,v):this.complete(X)},complete:function(N,W){if(N.type==="throw")throw N.arg;return N.type==="break"||N.type==="continue"?this.next=N.arg:N.type==="return"?(this.rval=this.arg=N.arg,this.method="return",this.next="end"):N.type==="normal"&&W&&(this.next=W),v},finish:function(N){for(var W=this.tryEntries.length-1;W>=0;--W){var I=this.tryEntries[W];if(I.finallyLoc===N)return this.complete(I.completion,I.afterLoc),q(I),v}},catch:function(N){for(var W=this.tryEntries.length-1;W>=0;--W){var I=this.tryEntries[W];if(I.tryLoc===N){var D=I.completion;if(D.type==="throw"){var G=D.arg;q(I)}return G}}throw new Error("illegal catch attempt")},delegateYield:function(N,W,I){return this.delegate={iterator:L(N),resultName:W,nextLoc:I},this.method==="next"&&(this.arg=a),v}},e}(n.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(fb);var Xo=(n,t)=>`${n}-${t}-${Math.random().toString(16).slice(3,8)}`;const pb=Xo;let oc=0;var iu=({id:n,action:t,payload:e={}})=>{let s=n;return typeof s>"u"&&(s=pb("Job",oc),oc+=1),{id:s,action:t,payload:e}},An={};let Yo=!1;An.logging=Yo;An.setLogging=n=>{Yo=n};An.log=(...n)=>Yo?console.log.apply(void 0,n):null;const gb=iu,{log:Bi}=An,mb=Xo;let lc=0;var bb=()=>{const n=mb("Scheduler",lc),t={},e={};let s=[];lc+=1;const i=()=>s.length,r=()=>Object.keys(t).length,a=()=>{if(s.length!==0){const u=Object.keys(t);for(let d=0;d<u.length;d+=1)if(typeof e[u[d]]>"u"){s[0](t[u[d]]);break}}},o=(u,d)=>new Promise((f,g)=>{const p=gb({action:u,payload:d});s.push(async y=>{s.shift(),e[y.id]=p;try{f(await y[u].apply(void 0,[...d,p.id]))}catch(m){g(m)}finally{delete e[y.id],a()}}),Bi(`[${n}]: Add ${p.id} to JobQueue`),Bi(`[${n}]: JobQueue length=${s.length}`),a()});return{addWorker:u=>(t[u.id]=u,Bi(`[${n}]: Add ${u.id}`),Bi(`[${n}]: Number of workers=${r()}`),a(),u.id),addJob:async(u,...d)=>{if(r()===0)throw Error(`[${n}]: You need to have at least one worker before adding jobs`);return o(u,d)},terminate:async()=>{Object.keys(t).forEach(async u=>{await t[u].terminate()}),s=[]},getQueueLen:i,getNumWorkers:r}};function Bn(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function yb(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var vb=yb;const _b=vb;var wb=n=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":_b()?t.type="electron":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof Bn=="function"&&(t.type="node"),typeof n>"u"?t:t[n]};const Ab=wb("type")==="browser",Sb=Ab?n=>new URL(n,window.location.href).href:n=>n;var xb=n=>{const t={...n};return["corePath","workerPath","langPath"].forEach(e=>{n[e]&&(t[e]=Sb(t[e]))}),t},Eb=n=>{const t=[],e=[],s=[],i=[],r=[];return n.blocks&&n.blocks.forEach(a=>{a.paragraphs.forEach(o=>{o.lines.forEach(l=>{l.words.forEach(c=>{c.symbols.forEach(h=>{r.push({...h,page:n,block:a,paragraph:o,line:l,word:c})}),i.push({...c,page:n,block:a,paragraph:o,line:l})}),s.push({...l,page:n,block:a,paragraph:o})}),e.push({...o,page:n,block:a})}),t.push({...a,page:n})}),{...n,blocks:t,paragraphs:e,lines:s,words:i,symbols:r}},ru={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const Cb="5.1.1",kb={version:Cb};var Tb={workerBlobURL:!0,logger:()=>{}};const Pb=kb.version,Rb=Tb;var Ib={...Rb,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${Pb}/dist/worker.min.js`},Mb=({workerPath:n,workerBlobURL:t})=>{let e;if(Blob&&URL&&t){const s=new Blob([`importScripts("${n}");`],{type:"application/javascript"});e=new Worker(URL.createObjectURL(s))}else e=new Worker(n);return e},Ob=n=>{n.terminate()},Lb=(n,t)=>{n.onmessage=({data:e})=>{t(e)}},Db=async(n,t)=>{n.postMessage(t)};const pa=n=>new Promise((t,e)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=({target:{error:{code:i}}})=>{e(Error(`File could not be read! Code=${i}`))},s.readAsArrayBuffer(n)}),Ha=async n=>{let t=n;if(typeof n>"u")return"undefined";if(typeof n=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(n)?t=atob(n.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(n)).arrayBuffer();else if(typeof HTMLElement<"u"&&n instanceof HTMLElement)n.tagName==="IMG"&&(t=await Ha(n.src)),n.tagName==="VIDEO"&&(t=await Ha(n.poster)),n.tagName==="CANVAS"&&await new Promise(e=>{n.toBlob(async s=>{t=await pa(s),e()})});else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas){const e=await n.convertToBlob();t=await pa(e)}else(n instanceof File||n instanceof Blob)&&(t=await pa(n));return new Uint8Array(t)};var Fb=Ha;const Nb=Ib,Bb=Mb,zb=Ob,jb=Lb,$b=Db,Hb=Fb;var Ub={defaultOptions:Nb,spawnWorker:Bb,terminateWorker:zb,onMessage:jb,send:$b,loadImage:Hb};const Wb=xb,Gb=Eb,Oe=iu,{log:cc}=An,Vb=Xo,Fs=ru,{defaultOptions:Kb,spawnWorker:qb,terminateWorker:Xb,onMessage:Yb,loadImage:hc,send:Zb}=Ub;let uc=0;var au=async(n="eng",t=Fs.LSTM_ONLY,e={},s={})=>{const i=Vb("Worker",uc),{logger:r,errorHandler:a,...o}=Wb({...Kb,...e}),l={},c={},h=typeof n=="string"?n.split("+"):n;let u=t,d=s;const f=[Fs.DEFAULT,Fs.LSTM_ONLY].includes(t)&&!o.legacyCore;let g,p;const y=new Promise((G,X)=>{p=G,g=X}),m=G=>{g(G.message)};let v=qb(o);v.onerror=m,uc+=1;const w=(G,X)=>{l[G]=X},A=(G,X)=>{c[G]=X},S=({id:G,action:X,payload:tt})=>new Promise((it,nt)=>{cc(`[${i}]: Start ${G}, action=${X}`);const rt=`${X}-${G}`;w(rt,it),A(rt,nt),Zb(v,{workerId:i,jobId:G,action:X,payload:tt})}),k=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),C=G=>S(Oe({id:G,action:"load",payload:{options:{lstmOnly:f,corePath:o.corePath,logging:o.logging}}})),z=(G,X,tt)=>S(Oe({id:tt,action:"FS",payload:{method:"writeFile",args:[G,X]}})),T=(G,X)=>S(Oe({id:X,action:"FS",payload:{method:"readFile",args:[G,{encoding:"utf8"}]}})),V=(G,X)=>S(Oe({id:X,action:"FS",payload:{method:"unlink",args:[G]}})),Z=(G,X,tt)=>S(Oe({id:tt,action:"FS",payload:{method:G,args:X}})),P=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),U=(G,X)=>S(Oe({id:X,action:"loadLanguage",payload:{langs:G,options:{langPath:o.langPath,dataPath:o.dataPath,cachePath:o.cachePath,cacheMethod:o.cacheMethod,gzip:o.gzip,lstmOnly:[Fs.DEFAULT,Fs.LSTM_ONLY].includes(u)&&!o.legacyLang}}})),_=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),q=(G,X,tt,it)=>S(Oe({id:it,action:"initialize",payload:{langs:G,oem:X,config:tt}})),Y=(G="eng",X,tt,it)=>{if(f&&[Fs.TESSERACT_ONLY,Fs.TESSERACT_LSTM_COMBINED].includes(X))throw Error("Legacy model requested but code missing.");const nt=X||u;u=nt;const rt=tt||d;d=rt;const St=(typeof G=="string"?G.split("+"):G).filter(Et=>!h.includes(Et));return h.push(...St),St.length>0?U(St,it).then(()=>q(G,nt,rt,it)):q(G,nt,rt,it)},L=(G={},X)=>S(Oe({id:X,action:"setParameters",payload:{params:G}})),et=async(G,X={},tt={blocks:!0,text:!0,hocr:!0,tsv:!0},it)=>S(Oe({id:it,action:"recognize",payload:{image:await hc(G),options:X,output:tt}})),N=(G="Tesseract OCR Result",X=!1,tt)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),S(Oe({id:tt,action:"getPDF",payload:{title:G,textonly:X}}))),W=async(G,X)=>{if(f)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return S(Oe({id:X,action:"detect",payload:{image:await hc(G)}}))},I=async()=>(v!==null&&(Xb(v),v=null),Promise.resolve());Yb(v,({workerId:G,jobId:X,status:tt,action:it,data:nt})=>{const rt=`${it}-${X}`;if(tt==="resolve"){cc(`[${G}]: Complete ${X}`);let yt=nt;it==="recognize"?yt=Gb(nt):it==="getPDF"&&(yt=Array.from({...nt,length:Object.keys(nt).length})),l[rt]({jobId:X,data:yt})}else if(tt==="reject")if(c[rt](nt),it==="load"&&g(nt),a)a(nt);else throw Error(nt);else tt==="progress"&&r({...nt,userJobId:X})});const D={id:i,worker:v,setResolve:w,setReject:A,load:k,writeText:z,readText:T,removeFile:V,FS:Z,loadLanguage:P,initialize:_,reinitialize:Y,setParameters:L,recognize:et,getPDF:N,detect:W,terminate:I};return C().then(()=>U(n)).then(()=>q(n,t,s)).then(()=>p(D)).catch(()=>{}),y};const ou=au,Jb=async(n,t,e)=>{const s=await ou(t,1,e);return s.recognize(n).finally(async()=>{await s.terminate()})},Qb=async(n,t)=>{const e=await ou("osd",0,t);return e.detect(n).finally(async()=>{await e.terminate()})};var ty={recognize:Jb,detect:Qb},ey={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},sy={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const ny=bb,iy=au,ry=ty,ay=ey,oy=ru,ly=sy,{setLogging:cy}=An;var hy={languages:ay,OEM:oy,PSM:ly,createScheduler:ny,createWorker:iy,setLogging:cy,...ry};let Ns=null;function uy(){async function n(){return Ns||(console.log("Initializing Tesseract worker..."),Ns=await hy.createWorker("eng"),console.log("Tesseract worker ready"),Ns)}async function t(s){console.log("Starting OCR...");const r=await(await n()).recognize(s);return console.log("OCR result:",r.data.text),r.data.text}async function e(){Ns&&(await Ns.terminate(),Ns=null)}return{recognizeText:t,terminate:e}}const Dt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Gt=Object.keys,oe=Array.isArray;function be(n,t){return typeof t!="object"||Gt(t).forEach(function(e){n[e]=t[e]}),n}typeof Promise>"u"||Dt.Promise||(Dt.Promise=Promise);const hi=Object.getPrototypeOf,dy={}.hasOwnProperty;function ke(n,t){return dy.call(n,t)}function wn(n,t){typeof t=="function"&&(t=t(hi(n))),(typeof Reflect>"u"?Gt:Reflect.ownKeys)(t).forEach(e=>{cs(n,e,t[e])})}const lu=Object.defineProperty;function cs(n,t,e,s){lu(n,t,be(e&&ke(e,"get")&&typeof e.get=="function"?{get:e.get,set:e.set,configurable:!0}:{value:e,configurable:!0,writable:!0},s))}function gn(n){return{from:function(t){return n.prototype=Object.create(t.prototype),cs(n.prototype,"constructor",n),{extend:wn.bind(null,n.prototype)}}}}const fy=Object.getOwnPropertyDescriptor;function Zo(n,t){let e;return fy(n,t)||(e=hi(n))&&Zo(e,t)}const py=[].slice;function br(n,t,e){return py.call(n,t,e)}function cu(n,t){return t(n)}function zn(n){if(!n)throw new Error("Assertion Failed")}function hu(n){Dt.setImmediate?setImmediate(n):setTimeout(n,0)}function uu(n,t){return n.reduce((e,s,i)=>{var r=t(s,i);return r&&(e[r[0]]=r[1]),e},{})}function hs(n,t){if(typeof t=="string"&&ke(n,t))return n[t];if(!t)return n;if(typeof t!="string"){for(var e=[],s=0,i=t.length;s<i;++s){var r=hs(n,t[s]);e.push(r)}return e}var a=t.indexOf(".");if(a!==-1){var o=n[t.substr(0,a)];return o==null?void 0:hs(o,t.substr(a+1))}}function Ne(n,t,e){if(n&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(n)))if(typeof t!="string"&&"length"in t){zn(typeof e!="string"&&"length"in e);for(var s=0,i=t.length;s<i;++s)Ne(n,t[s],e[s])}else{var r=t.indexOf(".");if(r!==-1){var a=t.substr(0,r),o=t.substr(r+1);if(o==="")e===void 0?oe(n)&&!isNaN(parseInt(a))?n.splice(a,1):delete n[a]:n[a]=e;else{var l=n[a];l&&ke(n,a)||(l=n[a]={}),Ne(l,o,e)}}else e===void 0?oe(n)&&!isNaN(parseInt(t))?n.splice(t,1):delete n[t]:n[t]=e}}function du(n){var t={};for(var e in n)ke(n,e)&&(t[e]=n[e]);return t}const gy=[].concat;function fu(n){return gy.apply([],n)}const pu="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(fu([8,16,32,64].map(n=>["Int","Uint","Float"].map(t=>t+n+"Array")))).filter(n=>Dt[n]),my=pu.map(n=>Dt[n]);uu(pu,n=>[n,!0]);let _s=null;function Ei(n){_s=typeof WeakMap<"u"&&new WeakMap;const t=Ua(n);return _s=null,t}function Ua(n){if(!n||typeof n!="object")return n;let t=_s&&_s.get(n);if(t)return t;if(oe(n)){t=[],_s&&_s.set(n,t);for(var e=0,s=n.length;e<s;++e)t.push(Ua(n[e]))}else if(my.indexOf(n.constructor)>=0)t=n;else{const r=hi(n);for(var i in t=r===Object.prototype?{}:Object.create(r),_s&&_s.set(n,t),n)ke(n,i)&&(t[i]=Ua(n[i]))}return t}const{toString:by}={};function Wa(n){return by.call(n).slice(8,-1)}const Ga=typeof Symbol<"u"?Symbol.iterator:"@@iterator",yy=typeof Ga=="symbol"?function(n){var t;return n!=null&&(t=n[Ga])&&t.apply(n)}:function(){return null},on={};function as(n){var t,e,s,i;if(arguments.length===1){if(oe(n))return n.slice();if(this===on&&typeof n=="string")return[n];if(i=yy(n)){for(e=[];!(s=i.next()).done;)e.push(s.value);return e}if(n==null)return[n];if(typeof(t=n.length)=="number"){for(e=new Array(t);t--;)e[t]=n[t];return e}return[n]}for(t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return e}const Jo=typeof Symbol<"u"?n=>n[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Ze=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function gu(n,t){Ze=n,mu=t}var mu=()=>!0;const vy=!new Error("").stack;function tn(){if(vy)try{throw tn.arguments,new Error}catch(n){return n}return new Error}function Va(n,t){var e=n.stack;return e?(t=t||0,e.indexOf(n.name)===0&&(t+=(n.name+n.message).split(`
`).length),e.split(`
`).slice(t).filter(mu).map(s=>`
`+s).join("")):""}var bu=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Qo=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(bu),_y={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function mn(n,t){this._e=tn(),this.name=n,this.message=t}function yu(n,t){return n+". Errors: "+Object.keys(t).map(e=>t[e].toString()).filter((e,s,i)=>i.indexOf(e)===s).join(`
`)}function yr(n,t,e,s){this._e=tn(),this.failures=t,this.failedKeys=s,this.successCount=e,this.message=yu(n,t)}function Jn(n,t){this._e=tn(),this.name="BulkError",this.failures=Object.keys(t).map(e=>t[e]),this.failuresByPos=t,this.message=yu(n,t)}gn(mn).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Va(this._e,2))}},toString:function(){return this.name+": "+this.message}}),gn(yr).from(mn),gn(Jn).from(mn);var tl=Qo.reduce((n,t)=>(n[t]=t+"Error",n),{});const wy=mn;var gt=Qo.reduce((n,t)=>{var e=t+"Error";function s(i,r){this._e=tn(),this.name=e,i?typeof i=="string"?(this.message=`${i}${r?`
 `+r:""}`,this.inner=r||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=_y[t]||e,this.inner=null)}return gn(s).from(wy),n[t]=s,n},{});gt.Syntax=SyntaxError,gt.Type=TypeError,gt.Range=RangeError;var dc=bu.reduce((n,t)=>(n[t+"Error"]=gt[t],n),{}),Ji=Qo.reduce((n,t)=>(["Syntax","Type","Range"].indexOf(t)===-1&&(n[t+"Error"]=gt[t]),n),{});function It(){}function ui(n){return n}function Ay(n,t){return n==null||n===ui?t:function(e){return t(n(e))}}function Ys(n,t){return function(){n.apply(this,arguments),t.apply(this,arguments)}}function Sy(n,t){return n===It?t:function(){var e=n.apply(this,arguments);e!==void 0&&(arguments[0]=e);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var r=t.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?Ys(s,this.onsuccess):s),i&&(this.onerror=this.onerror?Ys(i,this.onerror):i),r!==void 0?r:e}}function xy(n,t){return n===It?t:function(){n.apply(this,arguments);var e=this.onsuccess,s=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),e&&(this.onsuccess=this.onsuccess?Ys(e,this.onsuccess):e),s&&(this.onerror=this.onerror?Ys(s,this.onerror):s)}}function Ey(n,t){return n===It?t:function(e){var s=n.apply(this,arguments);be(e,s);var i=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Ys(i,this.onsuccess):i),r&&(this.onerror=this.onerror?Ys(r,this.onerror):r),s===void 0?a===void 0?void 0:a:be(s,a)}}function Cy(n,t){return n===It?t:function(){return t.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function el(n,t){return n===It?t:function(){var e=n.apply(this,arguments);if(e&&typeof e.then=="function"){for(var s=this,i=arguments.length,r=new Array(i);i--;)r[i]=arguments[i];return e.then(function(){return t.apply(s,r)})}return t.apply(this,arguments)}}Ji.ModifyError=yr,Ji.DexieError=mn,Ji.BulkError=Jn;var di={};const vu=100,[Ka,vr,qa]=typeof Promise>"u"?[]:(()=>{let n=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[n,hi(n),n];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,hi(t),n]})(),_u=vr&&vr.then,Qi=Ka&&Ka.constructor,sl=!!qa;var Xa=!1,ky=qa?()=>{qa.then(zi)}:Dt.setImmediate?setImmediate.bind(null,zi):Dt.MutationObserver?()=>{var n=document.createElement("div");new MutationObserver(()=>{zi(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:()=>{setTimeout(zi,0)},Qn=function(n,t){jn.push([n,t]),_r&&(ky(),_r=!1)},Ya=!0,_r=!0,Gs=[],tr=[],Za=null,Ja=ui,bn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:gc,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(n=>{try{gc(n[0],n[1])}catch{}})}},dt=bn,jn=[],Vs=0,er=[];function ot(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=It,this._lib=!1;var t=this._PSD=dt;if(Ze&&(this._stackHolder=tn(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==di)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&to(this,this._value))}this._state=null,this._value=null,++t.ref,Au(this,n)}const Qa={get:function(){var n=dt,t=wr;function e(s,i){var r=!n.global&&(n!==dt||t!==wr);const a=r&&!ps();var o=new ot((l,c)=>{nl(this,new wu(Ar(s,n,r,a),Ar(i,n,r,a),l,c,n))});return Ze&&Eu(o,this),o}return e.prototype=di,e},set:function(n){cs(this,"then",n&&n.prototype===di?Qa:{get:function(){return n},set:Qa.set})}};function wu(n,t,e,s,i){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof t=="function"?t:null,this.resolve=e,this.reject=s,this.psd=i}function Au(n,t){try{t(e=>{if(n._state===null){if(e===n)throw new TypeError("A promise cannot be resolved with itself.");var s=n._lib&&Ci();e&&typeof e.then=="function"?Au(n,(i,r)=>{e instanceof ot?e._then(i,r):e.then(i,r)}):(n._state=!0,n._value=e,Su(n)),s&&ki()}},to.bind(null,n))}catch(e){to(n,e)}}function to(n,t){if(tr.push(t),n._state===null){var e=n._lib&&Ci();t=Ja(t),n._state=!1,n._value=t,Ze&&t!==null&&typeof t=="object"&&!t._promise&&function(s,i,r){try{s.apply(null,r)}catch{}}(()=>{var s=Zo(t,"stack");t._promise=n,cs(t,"stack",{get:()=>Xa?s&&(s.get?s.get.apply(t):s.value):n.stack})}),function(s){Gs.some(i=>i._value===s._value)||Gs.push(s)}(n),Su(n),e&&ki()}}function Su(n){var t=n._listeners;n._listeners=[];for(var e=0,s=t.length;e<s;++e)nl(n,t[e]);var i=n._PSD;--i.ref||i.finalize(),Vs===0&&(++Vs,Qn(()=>{--Vs==0&&il()},[]))}function nl(n,t){if(n._state!==null){var e=n._state?t.onFulfilled:t.onRejected;if(e===null)return(n._state?t.resolve:t.reject)(n._value);++t.psd.ref,++Vs,Qn(Ty,[e,n,t])}else n._listeners.push(t)}function Ty(n,t,e){try{Za=t;var s,i=t._value;t._state?s=n(i):(tr.length&&(tr=[]),s=n(i),tr.indexOf(i)===-1&&function(r){for(var a=Gs.length;a;)if(Gs[--a]._value===r._value)return void Gs.splice(a,1)}(t)),e.resolve(s)}catch(r){e.reject(r)}finally{Za=null,--Vs==0&&il(),--e.psd.ref||e.psd.finalize()}}function xu(n,t,e){if(t.length===e)return t;var s="";if(n._state===!1){var i,r,a=n._value;a!=null?(i=a.name||"Error",r=a.message||a,s=Va(a,0)):(i=a,r=""),t.push(i+(r?": "+r:"")+s)}return Ze&&((s=Va(n._stackHolder,2))&&t.indexOf(s)===-1&&t.push(s),n._prev&&xu(n._prev,t,e)),t}function Eu(n,t){var e=t?t._numPrev+1:0;e<100&&(n._prev=t,n._numPrev=e)}function zi(){Ci()&&ki()}function Ci(){var n=Ya;return Ya=!1,_r=!1,n}function ki(){var n,t,e;do for(;jn.length>0;)for(n=jn,jn=[],e=n.length,t=0;t<e;++t){var s=n[t];s[0].apply(null,s[1])}while(jn.length>0);Ya=!0,_r=!0}function il(){var n=Gs;Gs=[],n.forEach(s=>{s._PSD.onunhandled.call(null,s._value,s)});for(var t=er.slice(0),e=t.length;e;)t[--e]()}function ji(n){return new ot(di,!1,n)}function Nt(n,t){var e=dt;return function(){var s=Ci(),i=dt;try{return Rs(e,!0),n.apply(this,arguments)}catch(r){t&&t(r)}finally{Rs(i,!1),s&&ki()}}}wn(ot.prototype,{then:Qa,_then:function(n,t){nl(this,new wu(null,null,n,t,dt))},catch:function(n){if(arguments.length===1)return this.then(null,n);var t=arguments[0],e=arguments[1];return typeof t=="function"?this.then(null,s=>s instanceof t?e(s):ji(s)):this.then(null,s=>s&&s.name===t?e(s):ji(s))},finally:function(n){return this.then(t=>(n(),t),t=>(n(),ji(t)))},stack:{get:function(){if(this._stack)return this._stack;try{Xa=!0;var n=xu(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=n),n}finally{Xa=!1}}},timeout:function(n,t){return n<1/0?new ot((e,s)=>{var i=setTimeout(()=>s(new gt.Timeout(t)),n);this.then(e,s).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&cs(ot.prototype,Symbol.toStringTag,"Dexie.Promise"),bn.env=Cu(),wn(ot,{all:function(){var n=as.apply(null,arguments).map($i);return new ot(function(t,e){n.length===0&&t([]);var s=n.length;n.forEach((i,r)=>ot.resolve(i).then(a=>{n[r]=a,--s||t(n)},e))})},resolve:n=>{if(n instanceof ot)return n;if(n&&typeof n.then=="function")return new ot((e,s)=>{n.then(e,s)});var t=new ot(di,!0,n);return Eu(t,Za),t},reject:ji,race:function(){var n=as.apply(null,arguments).map($i);return new ot((t,e)=>{n.map(s=>ot.resolve(s).then(t,e))})},PSD:{get:()=>dt,set:n=>dt=n},totalEchoes:{get:()=>wr},newPSD:Ps,usePSD:xn,scheduler:{get:()=>Qn,set:n=>{Qn=n}},rejectionMapper:{get:()=>Ja,set:n=>{Ja=n}},follow:(n,t)=>new ot((e,s)=>Ps((i,r)=>{var a=dt;a.unhandleds=[],a.onunhandled=r,a.finalize=Ys(function(){(function(o){function l(){o(),er.splice(er.indexOf(l),1)}er.push(l),++Vs,Qn(()=>{--Vs==0&&il()},[])})(()=>{this.unhandleds.length===0?i():r(this.unhandleds[0])})},a.finalize),n()},t,e,s))}),Qi&&(Qi.allSettled&&cs(ot,"allSettled",function(){const n=as.apply(null,arguments).map($i);return new ot(t=>{n.length===0&&t([]);let e=n.length;const s=new Array(e);n.forEach((i,r)=>ot.resolve(i).then(a=>s[r]={status:"fulfilled",value:a},a=>s[r]={status:"rejected",reason:a}).then(()=>--e||t(s)))})}),Qi.any&&typeof AggregateError<"u"&&cs(ot,"any",function(){const n=as.apply(null,arguments).map($i);return new ot((t,e)=>{n.length===0&&e(new AggregateError([]));let s=n.length;const i=new Array(s);n.forEach((r,a)=>ot.resolve(r).then(o=>t(o),o=>{i[a]=o,--s||e(new AggregateError(i))}))})}));const ae={awaits:0,echoes:0,id:0};var Py=0,sr=[],ga=0,wr=0,Ry=0;function Ps(n,t,e,s){var i=dt,r=Object.create(i);r.parent=i,r.ref=0,r.global=!1,r.id=++Ry;var a=bn.env;r.env=sl?{Promise:ot,PromiseProp:{value:ot,configurable:!0,writable:!0},all:ot.all,race:ot.race,allSettled:ot.allSettled,any:ot.any,resolve:ot.resolve,reject:ot.reject,nthen:fc(a.nthen,r),gthen:fc(a.gthen,r)}:{},t&&be(r,t),++i.ref,r.finalize=function(){--this.parent.ref||this.parent.finalize()};var o=xn(r,n,e,s);return r.ref===0&&r.finalize(),o}function Sn(){return ae.id||(ae.id=++Py),++ae.awaits,ae.echoes+=vu,ae.id}function ps(){return!!ae.awaits&&(--ae.awaits==0&&(ae.id=0),ae.echoes=ae.awaits*vu,!0)}function $i(n){return ae.echoes&&n&&n.constructor===Qi?(Sn(),n.then(t=>(ps(),t),t=>(ps(),Yt(t)))):n}function Iy(n){++wr,ae.echoes&&--ae.echoes!=0||(ae.echoes=ae.id=0),sr.push(dt),Rs(n,!0)}function My(){var n=sr[sr.length-1];sr.pop(),Rs(n,!1)}function Rs(n,t){var e=dt;if((t?!ae.echoes||ga++&&n===dt:!ga||--ga&&n===dt)||ku(t?Iy.bind(null,n):My),n!==dt&&(dt=n,e===bn&&(bn.env=Cu()),sl)){var s=bn.env.Promise,i=n.env;vr.then=i.nthen,s.prototype.then=i.gthen,(e.global||n.global)&&(Object.defineProperty(Dt,"Promise",i.PromiseProp),s.all=i.all,s.race=i.race,s.resolve=i.resolve,s.reject=i.reject,i.allSettled&&(s.allSettled=i.allSettled),i.any&&(s.any=i.any))}}function Cu(){var n=Dt.Promise;return sl?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(Dt,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:vr.then,gthen:n.prototype.then}:{}}function xn(n,t,e,s,i){var r=dt;try{return Rs(n,!0),t(e,s,i)}finally{Rs(r,!1)}}function ku(n){_u.call(Ka,n)}function Ar(n,t,e,s){return typeof n!="function"?n:function(){var i=dt;e&&Sn(),Rs(t,!0);try{return n.apply(this,arguments)}finally{Rs(i,!1),s&&ku(ps)}}}function fc(n,t){return function(e,s){return n.call(this,Ar(e,t),Ar(s,t))}}(""+_u).indexOf("[native code]")===-1&&(Sn=ps=It);const pc="unhandledrejection";function gc(n,t){var e;try{e=t.onuncatched(n)}catch{}if(e!==!1)try{var s,i={promise:t,reason:n};if(Dt.document&&document.createEvent?((s=document.createEvent("Event")).initEvent(pc,!0,!0),be(s,i)):Dt.CustomEvent&&be(s=new CustomEvent(pc,{detail:i}),i),s&&Dt.dispatchEvent&&(dispatchEvent(s),!Dt.PromiseRejectionEvent&&Dt.onunhandledrejection))try{Dt.onunhandledrejection(s)}catch{}Ze&&s&&!s.defaultPrevented&&console.warn(`Unhandled rejection: ${n.stack||n}`)}catch{}}var Yt=ot.reject;function eo(n,t,e,s){if(n.idbdb&&(n._state.openComplete||dt.letThrough||n._vip)){var i=n._createTransaction(t,e,n._dbSchema);try{i.create(),n._state.PR1398_maxLoop=3}catch(r){return r.name===tl.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>eo(n,t,e,s))):Yt(r)}return i._promise(t,(r,a)=>Ps(()=>(dt.trans=i,s(r,a,i)))).then(r=>i._completion.then(()=>r))}if(n._state.openComplete)return Yt(new gt.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return Yt(new gt.DatabaseClosed);n.open().catch(It)}return n._state.dbReadyPromise.then(()=>eo(n,t,e,s))}const mc="3.2.7",Hs="",so=-1/0,Qe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Tu="String expected.",ti=[],Xr=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Oy=Xr,Ly=Xr,Pu=n=>!/(dexie\.js|dexie\.min\.js)/.test(n),Yr="__dbnames",ma="readonly",ba="readwrite";function Zs(n,t){return n?t?function(){return n.apply(this,arguments)&&t.apply(this,arguments)}:n:t}const Ru={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Hi(n){return typeof n!="string"||/\./.test(n)?t=>t:t=>(t[n]===void 0&&n in t&&delete(t=Ei(t))[n],t)}class Dy{_trans(t,e,s){const i=this._tx||dt.trans,r=this.name;function a(l,c,h){if(!h.schema[r])throw new gt.NotFound("Table "+r+" not part of transaction");return e(h.idbtrans,h)}const o=Ci();try{return i&&i.db===this.db?i===dt.trans?i._promise(t,a,s):Ps(()=>i._promise(t,a,s),{trans:i,transless:dt.transless||dt}):eo(this.db,t,[this.name],a)}finally{o&&ki()}}get(t,e){return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",s=>this.core.get({trans:s,key:t}).then(i=>this.hook.reading.fire(i))).then(e)}where(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(oe(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const e=Gt(t);if(e.length===1)return this.where(e[0]).equals(t[e[0]]);const s=this.schema.indexes.concat(this.schema.primKey).filter(c=>{if(c.compound&&e.every(h=>c.keyPath.indexOf(h)>=0)){for(let h=0;h<e.length;++h)if(e.indexOf(c.keyPath[h])===-1)return!1;return!0}return!1}).sort((c,h)=>c.keyPath.length-h.keyPath.length)[0];if(s&&this.db._maxKey!==Hs){const c=s.keyPath.slice(0,e.length);return this.where(c).equals(c.map(h=>t[h]))}!s&&Ze&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${e.join("+")}]`);const{idxByName:i}=this.schema,r=this.db._deps.indexedDB;function a(c,h){try{return r.cmp(c,h)===0}catch{return!1}}const[o,l]=e.reduce(([c,h],u)=>{const d=i[u],f=t[u];return[c||d,c||!d?Zs(h,d&&d.multi?g=>{const p=hs(g,u);return oe(p)&&p.some(y=>a(f,y))}:g=>a(f,hs(g,u))):h]},[null,null]);return o?this.where(o.name).equals(t[o.keyPath]).filter(l):s?this.filter(l):this.where(e).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,oe(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const e=s=>{if(!s)return s;const i=Object.create(t.prototype);for(var r in s)if(ke(s,r))try{i[r]=s[r]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t}defineClass(){return this.mapToClass(function(t){be(this,t)})}add(t,e){const{auto:s,keyPath:i}=this.schema.primKey;let r=t;return i&&s&&(r=Hi(i)(t)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"add",keys:e!=null?[e]:null,values:[r]})).then(a=>a.numFailures?ot.reject(a.failures[0]):a.lastResult).then(a=>{if(i)try{Ne(t,i,a)}catch{}return a})}update(t,e){if(typeof t!="object"||oe(t))return this.where(":id").equals(t).modify(e);{const s=hs(t,this.schema.primKey.keyPath);if(s===void 0)return Yt(new gt.InvalidArgument("Given object does not contain its primary key"));try{typeof e!="function"?Gt(e).forEach(i=>{Ne(t,i,e[i])}):e(t,{value:t,primKey:s})}catch{}return this.where(":id").equals(s).modify(e)}}put(t,e){const{auto:s,keyPath:i}=this.schema.primKey;let r=t;return i&&s&&(r=Hi(i)(t)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"put",values:[r],keys:e!=null?[e]:null})).then(a=>a.numFailures?ot.reject(a.failures[0]):a.lastResult).then(a=>{if(i)try{Ne(t,i,a)}catch{}return a})}delete(t){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"delete",keys:[t]})).then(e=>e.numFailures?ot.reject(e.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:Ru})).then(t=>t.numFailures?ot.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",e=>this.core.getMany({keys:t,trans:e}).then(s=>s.map(i=>this.hook.reading.fire(i))))}bulkAdd(t,e,s){const i=Array.isArray(e)?e:void 0,r=(s=s||(i?void 0:e))?s.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:o,keyPath:l}=this.schema.primKey;if(l&&i)throw new gt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new gt.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let h=l&&o?t.map(Hi(l)):t;return this.core.mutate({trans:a,type:"add",keys:i,values:h,wantResults:r}).then(({numFailures:u,results:d,lastResult:f,failures:g})=>{if(u===0)return r?d:f;throw new Jn(`${this.name}.bulkAdd(): ${u} of ${c} operations failed`,g)})})}bulkPut(t,e,s){const i=Array.isArray(e)?e:void 0,r=(s=s||(i?void 0:e))?s.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:o,keyPath:l}=this.schema.primKey;if(l&&i)throw new gt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new gt.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let h=l&&o?t.map(Hi(l)):t;return this.core.mutate({trans:a,type:"put",keys:i,values:h,wantResults:r}).then(({numFailures:u,results:d,lastResult:f,failures:g})=>{if(u===0)return r?d:f;throw new Jn(`${this.name}.bulkPut(): ${u} of ${c} operations failed`,g)})})}bulkDelete(t){const e=t.length;return this._trans("readwrite",s=>this.core.mutate({trans:s,type:"delete",keys:t})).then(({numFailures:s,lastResult:i,failures:r})=>{if(s===0)return i;throw new Jn(`${this.name}.bulkDelete(): ${s} of ${e} operations failed`,r)})}}function ei(n){var t={},e=function(a,o){if(o){for(var l=arguments.length,c=new Array(l-1);--l;)c[l-1]=arguments[l];return t[a].subscribe.apply(null,c),n}if(typeof a=="string")return t[a]};e.addEventType=r;for(var s=1,i=arguments.length;s<i;++s)r(arguments[s]);return e;function r(a,o,l){if(typeof a!="object"){var c;o||(o=Cy),l||(l=It);var h={subscribers:[],fire:l,subscribe:function(u){h.subscribers.indexOf(u)===-1&&(h.subscribers.push(u),h.fire=o(h.fire,u))},unsubscribe:function(u){h.subscribers=h.subscribers.filter(function(d){return d!==u}),h.fire=h.subscribers.reduce(o,l)}};return t[a]=e[a]=h,h}Gt(c=a).forEach(function(u){var d=c[u];if(oe(d))r(u,c[u][0],c[u][1]);else{if(d!=="asap")throw new gt.InvalidArgument("Invalid event config");var f=r(u,ui,function(){for(var g=arguments.length,p=new Array(g);g--;)p[g]=arguments[g];f.subscribers.forEach(function(y){hu(function(){y.apply(null,p)})})})}})}}function On(n,t){return gn(t).from({prototype:n}),t}function sn(n,t){return!(n.filter||n.algorithm||n.or)&&(t?n.justLimit:!n.replayFilter)}function ya(n,t){n.filter=Zs(n.filter,t)}function va(n,t,e){var s=n.replayFilter;n.replayFilter=s?()=>Zs(s(),t()):t,n.justLimit=e&&!s}function nr(n,t){if(n.isPrimKey)return t.primaryKey;const e=t.getIndexByKeyPath(n.index);if(!e)throw new gt.Schema("KeyPath "+n.index+" on object store "+t.name+" is not indexed");return e}function bc(n,t,e){const s=nr(n,t.schema);return t.openCursor({trans:e,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:s,range:n.range}})}function Ui(n,t,e,s){const i=n.replayFilter?Zs(n.filter,n.replayFilter()):n.filter;if(n.or){const r={},a=(o,l,c)=>{if(!i||i(l,c,d=>l.stop(d),d=>l.fail(d))){var h=l.primaryKey,u=""+h;u==="[object ArrayBuffer]"&&(u=""+new Uint8Array(h)),ke(r,u)||(r[u]=!0,t(o,l,c))}};return Promise.all([n.or._iterate(a,e),yc(bc(n,s,e),n.algorithm,a,!n.keysOnly&&n.valueMapper)])}return yc(bc(n,s,e),Zs(n.algorithm,i),t,!n.keysOnly&&n.valueMapper)}function yc(n,t,e,s){var i=Nt(s?(r,a,o)=>e(s(r),a,o):e);return n.then(r=>{if(r)return r.start(()=>{var a=()=>r.continue();t&&!t(r,o=>a=o,o=>{r.stop(o),a=It},o=>{r.fail(o),a=It})||i(r.value,r,o=>a=o),a()})})}function ge(n,t){try{const e=vc(n),s=vc(t);if(e!==s)return e==="Array"?1:s==="Array"?-1:e==="binary"?1:s==="binary"?-1:e==="string"?1:s==="string"?-1:e==="Date"?1:s!=="Date"?NaN:-1;switch(e){case"number":case"Date":case"string":return n>t?1:n<t?-1:0;case"binary":return function(i,r){const a=i.length,o=r.length,l=a<o?a:o;for(let c=0;c<l;++c)if(i[c]!==r[c])return i[c]<r[c]?-1:1;return a===o?0:a<o?-1:1}(_c(n),_c(t));case"Array":return function(i,r){const a=i.length,o=r.length,l=a<o?a:o;for(let c=0;c<l;++c){const h=ge(i[c],r[c]);if(h!==0)return h}return a===o?0:a<o?-1:1}(n,t)}}catch{}return NaN}function vc(n){const t=typeof n;if(t!=="object")return t;if(ArrayBuffer.isView(n))return"binary";const e=Wa(n);return e==="ArrayBuffer"?"binary":e}function _c(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}class Fy{_read(t,e){var s=this._ctx;return s.error?s.table._trans(null,Yt.bind(null,s.error)):s.table._trans("readonly",t).then(e)}_write(t){var e=this._ctx;return e.error?e.table._trans(null,Yt.bind(null,e.error)):e.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var e=this._ctx;e.algorithm=Zs(e.algorithm,t)}_iterate(t,e){return Ui(this._ctx,t,e,this._ctx.table.core)}clone(t){var e=Object.create(this.constructor.prototype),s=Object.create(this._ctx);return t&&be(s,t),e._ctx=s,e}raw(){return this._ctx.valueMapper=null,this}each(t){var e=this._ctx;return this._read(s=>Ui(e,t,s,e.table.core))}count(t){return this._read(e=>{const s=this._ctx,i=s.table.core;if(sn(s,!0))return i.count({trans:e,query:{index:nr(s,i.schema),range:s.range}}).then(a=>Math.min(a,s.limit));var r=0;return Ui(s,()=>(++r,!1),e,i).then(()=>r)}).then(t)}sortBy(t,e){const s=t.split(".").reverse(),i=s[0],r=s.length-1;function a(c,h){return h?a(c[s[h]],h-1):c[i]}var o=this._ctx.dir==="next"?1:-1;function l(c,h){var u=a(c,r),d=a(h,r);return u<d?-o:u>d?o:0}return this.toArray(function(c){return c.sort(l)}).then(e)}toArray(t){return this._read(e=>{var s=this._ctx;if(s.dir==="next"&&sn(s,!0)&&s.limit>0){const{valueMapper:i}=s,r=nr(s,s.table.core.schema);return s.table.core.query({trans:e,limit:s.limit,values:!0,query:{index:r,range:s.range}}).then(({result:a})=>i?a.map(i):a)}{const i=[];return Ui(s,r=>i.push(r),e,s.table.core).then(()=>i)}},t)}offset(t){var e=this._ctx;return t<=0||(e.offset+=t,sn(e)?va(e,()=>{var s=t;return(i,r)=>s===0||(s===1?(--s,!1):(r(()=>{i.advance(s),s=0}),!1))}):va(e,()=>{var s=t;return()=>--s<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),va(this._ctx,()=>{var e=t;return function(s,i,r){return--e<=0&&i(r),e>=0}},!0),this}until(t,e){return ya(this._ctx,function(s,i,r){return!t(s.value)||(i(r),e)}),this}first(t){return this.limit(1).toArray(function(e){return e[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){var e,s;return ya(this._ctx,function(i){return t(i.value)}),e=this._ctx,s=t,e.isMatch=Zs(e.isMatch,s),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(s,i){t(i.key,i)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(s,i){t(i.primaryKey,i)})}keys(t){var e=this._ctx;e.keysOnly=!e.isMatch;var s=[];return this.each(function(i,r){s.push(r.key)}).then(function(){return s}).then(t)}primaryKeys(t){var e=this._ctx;if(e.dir==="next"&&sn(e,!0)&&e.limit>0)return this._read(i=>{var r=nr(e,e.table.core.schema);return e.table.core.query({trans:i,values:!1,limit:e.limit,query:{index:r,range:e.range}})}).then(({result:i})=>i).then(t);e.keysOnly=!e.isMatch;var s=[];return this.each(function(i,r){s.push(r.primaryKey)}).then(function(){return s}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(e){return e[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var s={};return ya(this._ctx,function(i){var r=i.primaryKey.toString(),a=ke(s,r);return s[r]=!0,!a}),this}modify(t){var e=this._ctx;return this._write(s=>{var i;if(typeof t=="function")i=t;else{var r=Gt(t),a=r.length;i=function(p){for(var y=!1,m=0;m<a;++m){var v=r[m],w=t[v];hs(p,v)!==w&&(Ne(p,v,w),y=!0)}return y}}const o=e.table.core,{outbound:l,extractKey:c}=o.schema.primaryKey,h=this.db._options.modifyChunkSize||200,u=[];let d=0;const f=[],g=(p,y)=>{const{failures:m,numFailures:v}=y;d+=p-v;for(let w of Gt(m))u.push(m[w])};return this.clone().primaryKeys().then(p=>{const y=m=>{const v=Math.min(h,p.length-m);return o.getMany({trans:s,keys:p.slice(m,m+v),cache:"immutable"}).then(w=>{const A=[],S=[],k=l?[]:null,C=[];for(let T=0;T<v;++T){const V=w[T],Z={value:Ei(V),primKey:p[m+T]};i.call(Z,Z.value,Z)!==!1&&(Z.value==null?C.push(p[m+T]):l||ge(c(V),c(Z.value))===0?(S.push(Z.value),l&&k.push(p[m+T])):(C.push(p[m+T]),A.push(Z.value)))}const z=sn(e)&&e.limit===1/0&&(typeof t!="function"||t===_a)&&{index:e.index,range:e.range};return Promise.resolve(A.length>0&&o.mutate({trans:s,type:"add",values:A}).then(T=>{for(let V in T.failures)C.splice(parseInt(V),1);g(A.length,T)})).then(()=>(S.length>0||z&&typeof t=="object")&&o.mutate({trans:s,type:"put",keys:k,values:S,criteria:z,changeSpec:typeof t!="function"&&t}).then(T=>g(S.length,T))).then(()=>(C.length>0||z&&t===_a)&&o.mutate({trans:s,type:"delete",keys:C,criteria:z}).then(T=>g(C.length,T))).then(()=>p.length>m+v&&y(m+h))})};return y(0).then(()=>{if(u.length>0)throw new yr("Error modifying one or more objects",u,d,f);return p.length})})})}delete(){var t=this._ctx,e=t.range;return sn(t)&&(t.isPrimKey&&!Ly||e.type===3)?this._write(s=>{const{primaryKey:i}=t.table.core.schema,r=e;return t.table.core.count({trans:s,query:{index:i,range:r}}).then(a=>t.table.core.mutate({trans:s,type:"deleteRange",range:r}).then(({failures:o,lastResult:l,results:c,numFailures:h})=>{if(h)throw new yr("Could not delete some values",Object.keys(o).map(u=>o[u]),a-h);return a-h}))}):this.modify(_a)}}const _a=(n,t)=>t.value=null;function Ny(n,t){return n<t?-1:n===t?0:1}function By(n,t){return n>t?-1:n===t?0:1}function Ae(n,t,e){var s=n instanceof Mu?new n.Collection(n):n;return s._ctx.error=e?new e(t):new TypeError(t),s}function nn(n){return new n.Collection(n,()=>Iu("")).limit(0)}function zy(n,t,e,s,i,r){for(var a=Math.min(n.length,s.length),o=-1,l=0;l<a;++l){var c=t[l];if(c!==s[l])return i(n[l],e[l])<0?n.substr(0,l)+e[l]+e.substr(l+1):i(n[l],s[l])<0?n.substr(0,l)+s[l]+e.substr(l+1):o>=0?n.substr(0,o)+t[o]+e.substr(o+1):null;i(n[l],c)<0&&(o=l)}return a<s.length&&r==="next"?n+e.substr(n.length):a<n.length&&r==="prev"?n.substr(0,e.length):o<0?null:n.substr(0,o)+s[o]+e.substr(o+1)}function Wi(n,t,e,s){var i,r,a,o,l,c,h,u=e.length;if(!e.every(p=>typeof p=="string"))return Ae(n,Tu);function d(p){i=function(m){return m==="next"?v=>v.toUpperCase():v=>v.toLowerCase()}(p),r=function(m){return m==="next"?v=>v.toLowerCase():v=>v.toUpperCase()}(p),a=p==="next"?Ny:By;var y=e.map(function(m){return{lower:r(m),upper:i(m)}}).sort(function(m,v){return a(m.lower,v.lower)});o=y.map(function(m){return m.upper}),l=y.map(function(m){return m.lower}),c=p,h=p==="next"?"":s}d("next");var f=new n.Collection(n,()=>ms(o[0],l[u-1]+s));f._ondirectionchange=function(p){d(p)};var g=0;return f._addAlgorithm(function(p,y,m){var v=p.key;if(typeof v!="string")return!1;var w=r(v);if(t(w,l,g))return!0;for(var A=null,S=g;S<u;++S){var k=zy(v,w,o[S],l[S],a,c);k===null&&A===null?g=S+1:(A===null||a(A,k)>0)&&(A=k)}return y(A!==null?function(){p.continue(A+h)}:m),!1}),f}function ms(n,t,e,s){return{type:2,lower:n,upper:t,lowerOpen:e,upperOpen:s}}function Iu(n){return{type:1,lower:n,upper:n}}class Mu{get Collection(){return this._ctx.table.db.Collection}between(t,e,s,i){s=s!==!1,i=i===!0;try{return this._cmp(t,e)>0||this._cmp(t,e)===0&&(s||i)&&(!s||!i)?nn(this):new this.Collection(this,()=>ms(t,e,!s,!i))}catch{return Ae(this,Qe)}}equals(t){return t==null?Ae(this,Qe):new this.Collection(this,()=>Iu(t))}above(t){return t==null?Ae(this,Qe):new this.Collection(this,()=>ms(t,void 0,!0))}aboveOrEqual(t){return t==null?Ae(this,Qe):new this.Collection(this,()=>ms(t,void 0,!1))}below(t){return t==null?Ae(this,Qe):new this.Collection(this,()=>ms(void 0,t,!1,!0))}belowOrEqual(t){return t==null?Ae(this,Qe):new this.Collection(this,()=>ms(void 0,t))}startsWith(t){return typeof t!="string"?Ae(this,Tu):this.between(t,t+Hs,!0,!0)}startsWithIgnoreCase(t){return t===""?this.startsWith(t):Wi(this,(e,s)=>e.indexOf(s[0])===0,[t],Hs)}equalsIgnoreCase(t){return Wi(this,(e,s)=>e===s[0],[t],"")}anyOfIgnoreCase(){var t=as.apply(on,arguments);return t.length===0?nn(this):Wi(this,(e,s)=>s.indexOf(e)!==-1,t,"")}startsWithAnyOfIgnoreCase(){var t=as.apply(on,arguments);return t.length===0?nn(this):Wi(this,(e,s)=>s.some(i=>e.indexOf(i)===0),t,Hs)}anyOf(){const t=as.apply(on,arguments);let e=this._cmp;try{t.sort(e)}catch{return Ae(this,Qe)}if(t.length===0)return nn(this);const s=new this.Collection(this,()=>ms(t[0],t[t.length-1]));s._ondirectionchange=r=>{e=r==="next"?this._ascending:this._descending,t.sort(e)};let i=0;return s._addAlgorithm((r,a,o)=>{const l=r.key;for(;e(l,t[i])>0;)if(++i,i===t.length)return a(o),!1;return e(l,t[i])===0||(a(()=>{r.continue(t[i])}),!1)}),s}notEqual(t){return this.inAnyRange([[so,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=as.apply(on,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return Ae(this,Qe)}const e=t.reduce((s,i)=>s?s.concat([[s[s.length-1][1],i]]):[[so,i]],null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,e){const s=this._cmp,i=this._ascending,r=this._descending,a=this._min,o=this._max;if(t.length===0)return nn(this);if(!t.every(v=>v[0]!==void 0&&v[1]!==void 0&&i(v[0],v[1])<=0))return Ae(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",gt.InvalidArgument);const l=!e||e.includeLowers!==!1,c=e&&e.includeUppers===!0;let h,u=i;function d(v,w){return u(v[0],w[0])}try{h=t.reduce(function(v,w){let A=0,S=v.length;for(;A<S;++A){const k=v[A];if(s(w[0],k[1])<0&&s(w[1],k[0])>0){k[0]=a(k[0],w[0]),k[1]=o(k[1],w[1]);break}}return A===S&&v.push(w),v},[]),h.sort(d)}catch{return Ae(this,Qe)}let f=0;const g=c?v=>i(v,h[f][1])>0:v=>i(v,h[f][1])>=0,p=l?v=>r(v,h[f][0])>0:v=>r(v,h[f][0])>=0;let y=g;const m=new this.Collection(this,()=>ms(h[0][0],h[h.length-1][1],!l,!c));return m._ondirectionchange=v=>{v==="next"?(y=g,u=i):(y=p,u=r),h.sort(d)},m._addAlgorithm((v,w,A)=>{for(var S=v.key;y(S);)if(++f,f===h.length)return w(A),!1;return!!function(k){return!g(k)&&!p(k)}(S)||(this._cmp(S,h[f][1])===0||this._cmp(S,h[f][0])===0||w(()=>{u===i?v.continue(h[f][0]):v.continue(h[f][1])}),!1)}),m}startsWithAnyOf(){const t=as.apply(on,arguments);return t.every(e=>typeof e=="string")?t.length===0?nn(this):this.inAnyRange(t.map(e=>[e,e+Hs])):Ae(this,"startsWithAnyOf() only works with strings")}}function Ve(n){return Nt(function(t){return fi(t),n(t.target.error),!1})}function fi(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}const pi="storagemutated",As="x-storagemutated-1",Is=ei(null,pi);class jy{_lock(){return zn(!dt.global),++this._reculock,this._reculock!==1||dt.global||(dt.lockOwnerFor=this),this}_unlock(){if(zn(!dt.global),--this._reculock==0)for(dt.global||(dt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{xn(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&dt.lockOwnerFor!==this}create(t){if(!this.mode)return this;const e=this.db.idbdb,s=this.db._state.dbOpenError;if(zn(!this.idbtrans),!t&&!e)switch(s&&s.name){case"DatabaseClosedError":throw new gt.DatabaseClosed(s);case"MissingAPIError":throw new gt.MissingAPI(s.message,s);default:throw new gt.OpenFailed(s)}if(!this.active)throw new gt.TransactionInactive;return zn(this._completion._state===null),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):e.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Nt(i=>{fi(i),this._reject(t.error)}),t.onabort=Nt(i=>{fi(i),this.active&&this._reject(new gt.Abort(t.error)),this.active=!1,this.on("abort").fire(i)}),t.oncomplete=Nt(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&Is.storagemutated.fire(t.mutatedParts)}),this}_promise(t,e,s){if(t==="readwrite"&&this.mode!=="readwrite")return Yt(new gt.ReadOnly("Transaction is readonly"));if(!this.active)return Yt(new gt.TransactionInactive);if(this._locked())return new ot((r,a)=>{this._blockedFuncs.push([()=>{this._promise(t,e,s).then(r,a)},dt])});if(s)return Ps(()=>{var r=new ot((a,o)=>{this._lock();const l=e(a,o,this);l&&l.then&&l.then(a,o)});return r.finally(()=>this._unlock()),r._lib=!0,r});var i=new ot((r,a)=>{var o=e(r,a,this);o&&o.then&&o.then(r,a)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(t){var e=this._root();const s=ot.resolve(t);if(e._waitingFor)e._waitingFor=e._waitingFor.then(()=>s);else{e._waitingFor=s,e._waitingQueue=[];var i=e.idbtrans.objectStore(e.storeNames[0]);(function a(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(i.get(-1/0).onsuccess=a)})()}var r=e._waitingFor;return new ot((a,o)=>{s.then(l=>e._waitingQueue.push(Nt(a.bind(null,l))),l=>e._waitingQueue.push(Nt(o.bind(null,l)))).finally(()=>{e._waitingFor===r&&(e._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new gt.Abort))}table(t){const e=this._memoizedTables||(this._memoizedTables={});if(ke(e,t))return e[t];const s=this.schema[t];if(!s)throw new gt.NotFound("Table "+t+" not part of transaction");const i=new this.db.Table(t,s,this);return i.core=this.db.core.table(t),e[t]=i,i}}function no(n,t,e,s,i,r,a){return{name:n,keyPath:t,unique:e,multi:s,auto:i,compound:r,src:(e&&!a?"&":"")+(s?"*":"")+(i?"++":"")+Ou(t)}}function Ou(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function Lu(n,t,e){return{name:n,primKey:t,indexes:e,mappedClass:null,idxByName:uu(e,s=>[s.name,s])}}let gi=n=>{try{return n.only([[]]),gi=()=>[[]],[[]]}catch{return gi=()=>Hs,Hs}};function io(n){return n==null?()=>{}:typeof n=="string"?function(t){return t.split(".").length===1?s=>s[t]:s=>hs(s,t)}(n):t=>hs(t,n)}function wc(n){return[].slice.call(n)}let $y=0;function si(n){return n==null?":id":typeof n=="string"?n:`[${n.join("+")}]`}function Hy(n,t,e){function s(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:h,lowerOpen:u,upperOpen:d}=l;return c===void 0?h===void 0?null:t.upperBound(h,!!d):h===void 0?t.lowerBound(c,!!u):t.bound(c,h,!!u,!!d)}const{schema:i,hasGetAll:r}=function(l,c){const h=wc(l.objectStoreNames);return{schema:{name:l.name,tables:h.map(u=>c.objectStore(u)).map(u=>{const{keyPath:d,autoIncrement:f}=u,g=oe(d),p=d==null,y={},m={name:u.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p,compound:g,keyPath:d,autoIncrement:f,unique:!0,extractKey:io(d)},indexes:wc(u.indexNames).map(v=>u.index(v)).map(v=>{const{name:w,unique:A,multiEntry:S,keyPath:k}=v,C={name:w,compound:oe(k),keyPath:k,unique:A,multiEntry:S,extractKey:io(k)};return y[si(k)]=C,C}),getIndexByKeyPath:v=>y[si(v)]};return y[":id"]=m.primaryKey,d!=null&&(y[si(d)]=m.primaryKey),m})},hasGetAll:h.length>0&&"getAll"in c.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(n,e),a=i.tables.map(l=>function(c){const h=c.name;return{name:h,schema:c,mutate:function({trans:u,type:d,keys:f,values:g,range:p}){return new Promise((y,m)=>{y=Nt(y);const v=u.objectStore(h),w=v.keyPath==null,A=d==="put"||d==="add";if(!A&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);const{length:S}=f||g||{length:1};if(f&&g&&f.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(S===0)return y({numFailures:0,failures:{},results:[],lastResult:void 0});let k;const C=[],z=[];let T=0;const V=P=>{++T,fi(P)};if(d==="deleteRange"){if(p.type===4)return y({numFailures:T,failures:z,results:[],lastResult:void 0});p.type===3?C.push(k=v.clear()):C.push(k=v.delete(s(p)))}else{const[P,U]=A?w?[g,f]:[g,null]:[f,null];if(A)for(let _=0;_<S;++_)C.push(k=U&&U[_]!==void 0?v[d](P[_],U[_]):v[d](P[_])),k.onerror=V;else for(let _=0;_<S;++_)C.push(k=v[d](P[_])),k.onerror=V}const Z=P=>{const U=P.target.result;C.forEach((_,q)=>_.error!=null&&(z[q]=_.error)),y({numFailures:T,failures:z,results:d==="delete"?f:C.map(_=>_.result),lastResult:U})};k.onerror=P=>{V(P),Z(P)},k.onsuccess=Z})},getMany:({trans:u,keys:d})=>new Promise((f,g)=>{f=Nt(f);const p=u.objectStore(h),y=d.length,m=new Array(y);let v,w=0,A=0;const S=C=>{const z=C.target;m[z._pos]=z.result,++A===w&&f(m)},k=Ve(g);for(let C=0;C<y;++C)d[C]!=null&&(v=p.get(d[C]),v._pos=C,v.onsuccess=S,v.onerror=k,++w);w===0&&f(m)}),get:({trans:u,key:d})=>new Promise((f,g)=>{f=Nt(f);const p=u.objectStore(h).get(d);p.onsuccess=y=>f(y.target.result),p.onerror=Ve(g)}),query:function(u){return d=>new Promise((f,g)=>{f=Nt(f);const{trans:p,values:y,limit:m,query:v}=d,w=m===1/0?void 0:m,{index:A,range:S}=v,k=p.objectStore(h),C=A.isPrimaryKey?k:k.index(A.name),z=s(S);if(m===0)return f({result:[]});if(u){const T=y?C.getAll(z,w):C.getAllKeys(z,w);T.onsuccess=V=>f({result:V.target.result}),T.onerror=Ve(g)}else{let T=0;const V=y||!("openKeyCursor"in C)?C.openCursor(z):C.openKeyCursor(z),Z=[];V.onsuccess=P=>{const U=V.result;return U?(Z.push(y?U.value:U.primaryKey),++T===m?f({result:Z}):void U.continue()):f({result:Z})},V.onerror=Ve(g)}})}(r),openCursor:function({trans:u,values:d,query:f,reverse:g,unique:p}){return new Promise((y,m)=>{y=Nt(y);const{index:v,range:w}=f,A=u.objectStore(h),S=v.isPrimaryKey?A:A.index(v.name),k=g?p?"prevunique":"prev":p?"nextunique":"next",C=d||!("openKeyCursor"in S)?S.openCursor(s(w),k):S.openKeyCursor(s(w),k);C.onerror=Ve(m),C.onsuccess=Nt(z=>{const T=C.result;if(!T)return void y(null);T.___id=++$y,T.done=!1;const V=T.continue.bind(T);let Z=T.continuePrimaryKey;Z&&(Z=Z.bind(T));const P=T.advance.bind(T),U=()=>{throw new Error("Cursor not stopped")};T.trans=u,T.stop=T.continue=T.continuePrimaryKey=T.advance=()=>{throw new Error("Cursor not started")},T.fail=Nt(m),T.next=function(){let _=1;return this.start(()=>_--?this.continue():this.stop()).then(()=>this)},T.start=_=>{const q=new Promise((L,et)=>{L=Nt(L),C.onerror=Ve(et),T.fail=et,T.stop=N=>{T.stop=T.continue=T.continuePrimaryKey=T.advance=U,L(N)}}),Y=()=>{if(C.result)try{_()}catch(L){T.fail(L)}else T.done=!0,T.start=()=>{throw new Error("Cursor behind last entry")},T.stop()};return C.onsuccess=Nt(L=>{C.onsuccess=Y,Y()}),T.continue=V,T.continuePrimaryKey=Z,T.advance=P,Y(),q},y(T)},m)})},count({query:u,trans:d}){const{index:f,range:g}=u;return new Promise((p,y)=>{const m=d.objectStore(h),v=f.isPrimaryKey?m:m.index(f.name),w=s(g),A=w?v.count(w):v.count();A.onsuccess=Nt(S=>p(S.target.result)),A.onerror=Ve(y)})}}}(l)),o={};return a.forEach(l=>o[l.name]=l),{stack:"dbcore",transaction:n.transaction.bind(n),table(l){if(!o[l])throw new Error(`Table '${l}' not found`);return o[l]},MIN_KEY:-1/0,MAX_KEY:gi(t),schema:i}}function ro({_novip:n},t){const e=t.db,s=function(i,r,{IDBKeyRange:a,indexedDB:o},l){return{dbcore:function(h,u){return u.reduce((d,{create:f})=>({...d,...f(d)}),h)}(Hy(r,a,l),i.dbcore)}}(n._middlewares,e,n._deps,t);n.core=s.dbcore,n.tables.forEach(i=>{const r=i.name;n.core.schema.tables.some(a=>a.name===r)&&(i.core=n.core.table(r),n[r]instanceof n.Table&&(n[r].core=i.core))})}function Sr({_novip:n},t,e,s){e.forEach(i=>{const r=s[i];t.forEach(a=>{const o=Zo(a,i);(!o||"value"in o&&o.value===void 0)&&(a===n.Transaction.prototype||a instanceof n.Transaction?cs(a,i,{get(){return this.table(i)},set(l){lu(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):a[i]=new n.Table(i,r))})})}function ao({_novip:n},t){t.forEach(e=>{for(let s in e)e[s]instanceof n.Table&&delete e[s]})}function Uy(n,t){return n._cfg.version-t._cfg.version}function Wy(n,t,e,s){const i=n._dbSchema,r=n._createTransaction("readwrite",n._storeNames,i);r.create(e),r._completion.catch(s);const a=r._reject.bind(r),o=dt.transless||dt;Ps(()=>{dt.trans=r,dt.transless=o,t===0?(Gt(i).forEach(l=>{wa(e,l,i[l].primKey,i[l].indexes)}),ro(n,e),ot.follow(()=>n.on.populate.fire(r)).catch(a)):function({_novip:l},c,h,u){const d=[],f=l._versions;let g=l._dbSchema=lo(l,l.idbdb,u),p=!1;const y=f.filter(v=>v._cfg.version>=c);function m(){return d.length?ot.resolve(d.shift()(h.idbtrans)).then(m):ot.resolve()}return y.forEach(v=>{d.push(()=>{const w=g,A=v._cfg.dbschema;co(l,w,u),co(l,A,u),g=l._dbSchema=A;const S=Du(w,A);S.add.forEach(C=>{wa(u,C[0],C[1].primKey,C[1].indexes)}),S.change.forEach(C=>{if(C.recreate)throw new gt.Upgrade("Not yet support for changing primary key");{const z=u.objectStore(C.name);C.add.forEach(T=>oo(z,T)),C.change.forEach(T=>{z.deleteIndex(T.name),oo(z,T)}),C.del.forEach(T=>z.deleteIndex(T))}});const k=v._cfg.contentUpgrade;if(k&&v._cfg.version>c){ro(l,u),h._memoizedTables={},p=!0;let C=du(A);S.del.forEach(Z=>{C[Z]=w[Z]}),ao(l,[l.Transaction.prototype]),Sr(l,[l.Transaction.prototype],Gt(C),C),h.schema=C;const z=Jo(k);let T;z&&Sn();const V=ot.follow(()=>{if(T=k(h),T&&z){var Z=ps.bind(null,null);T.then(Z,Z)}});return T&&typeof T.then=="function"?ot.resolve(T):V.then(()=>T)}}),d.push(w=>{(!p||!Oy)&&function(A,S){[].slice.call(S.db.objectStoreNames).forEach(k=>A[k]==null&&S.db.deleteObjectStore(k))}(v._cfg.dbschema,w),ao(l,[l.Transaction.prototype]),Sr(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),h.schema=l._dbSchema})}),m().then(()=>{var v,w;w=u,Gt(v=g).forEach(A=>{w.db.objectStoreNames.contains(A)||wa(w,A,v[A].primKey,v[A].indexes)})})}(n,t,r,e).catch(a)})}function Du(n,t){const e={del:[],add:[],change:[]};let s;for(s in n)t[s]||e.del.push(s);for(s in t){const i=n[s],r=t[s];if(i){const a={name:s,def:r,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(r.primKey.keyPath||"")||i.primKey.auto!==r.primKey.auto&&!Xr)a.recreate=!0,e.change.push(a);else{const o=i.idxByName,l=r.idxByName;let c;for(c in o)l[c]||a.del.push(c);for(c in l){const h=o[c],u=l[c];h?h.src!==u.src&&a.change.push(u):a.add.push(u)}(a.del.length>0||a.add.length>0||a.change.length>0)&&e.change.push(a)}}else e.add.push([s,r])}return e}function wa(n,t,e,s){const i=n.db.createObjectStore(t,e.keyPath?{keyPath:e.keyPath,autoIncrement:e.auto}:{autoIncrement:e.auto});return s.forEach(r=>oo(i,r)),i}function oo(n,t){n.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function lo(n,t,e){const s={};return br(t.objectStoreNames,0).forEach(i=>{const r=e.objectStore(i);let a=r.keyPath;const o=no(Ou(a),a||"",!1,!1,!!r.autoIncrement,a&&typeof a!="string",!0),l=[];for(let h=0;h<r.indexNames.length;++h){const u=r.index(r.indexNames[h]);a=u.keyPath;var c=no(u.name,a,!!u.unique,!!u.multiEntry,!1,a&&typeof a!="string",!1);l.push(c)}s[i]=Lu(i,o,l)}),s}function co({_novip:n},t,e){const s=e.db.objectStoreNames;for(let i=0;i<s.length;++i){const r=s[i],a=e.objectStore(r);n._hasGetAll="getAll"in a;for(let o=0;o<a.indexNames.length;++o){const l=a.indexNames[o],c=a.index(l).keyPath,h=typeof c=="string"?c:"["+br(c).join("+")+"]";if(t[r]){const u=t[r].idxByName[h];u&&(u.name=l,delete t[r].idxByName[h],t[r].idxByName[l]=u)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Dt.WorkerGlobalScope&&Dt instanceof Dt.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}class Gy{_parseStoresSpec(t,e){Gt(t).forEach(s=>{if(t[s]!==null){var i=t[s].split(",").map((a,o)=>{const l=(a=a.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return no(l,c||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),oe(c),o===0)}),r=i.shift();if(r.multi)throw new gt.Schema("Primary key cannot be multi-valued");i.forEach(a=>{if(a.auto)throw new gt.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new gt.Schema("Index must have a name and cannot be an empty string")}),e[s]=Lu(s,r,i)}})}stores(t){const e=this.db;this._cfg.storesSource=this._cfg.storesSource?be(this._cfg.storesSource,t):t;const s=e._versions,i={};let r={};return s.forEach(a=>{be(i,a._cfg.storesSource),r=a._cfg.dbschema={},a._parseStoresSpec(i,r)}),e._dbSchema=r,ao(e,[e._allTables,e,e.Transaction.prototype]),Sr(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],Gt(r),r),e._storeNames=Gt(r),this}upgrade(t){return this._cfg.contentUpgrade=el(this._cfg.contentUpgrade||It,t),this}}function rl(n,t){let e=n._dbNamesDB;return e||(e=n._dbNamesDB=new Ks(Yr,{addons:[],indexedDB:n,IDBKeyRange:t}),e.version(1).stores({dbnames:"name"})),e.table("dbnames")}function al(n){return n&&typeof n.databases=="function"}function ho(n){return Ps(function(){return dt.letThrough=!0,n()})}function Vy(){var n;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var e=function(){return indexedDB.databases().finally(t)};n=setInterval(e,100),e()}).finally(function(){return clearInterval(n)}):Promise.resolve()}function Ky(n){const t=n._state,{indexedDB:e}=n._deps;if(t.isBeingOpened||n.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?Yt(t.dbOpenError):n);Ze&&(t.openCanceller._stackHolder=tn()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const s=t.openCanceller;function i(){if(t.openCanceller!==s)throw new gt.DatabaseClosed("db.open() was cancelled")}let r=t.dbReadyResolve,a=null,o=!1;const l=()=>new ot((c,h)=>{if(i(),!e)throw new gt.MissingAPI;const u=n.name,d=t.autoSchema?e.open(u):e.open(u,Math.round(10*n.verno));if(!d)throw new gt.MissingAPI;d.onerror=Ve(h),d.onblocked=Nt(n._fireOnBlocked),d.onupgradeneeded=Nt(f=>{if(a=d.transaction,t.autoSchema&&!n._options.allowEmptyDB){d.onerror=fi,a.abort(),d.result.close();const p=e.deleteDatabase(u);p.onsuccess=p.onerror=Nt(()=>{h(new gt.NoSuchDatabase(`Database ${u} doesnt exist`))})}else{a.onerror=Ve(h);var g=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;o=g<1,n._novip.idbdb=d.result,Wy(n,g/10,a,h)}},h),d.onsuccess=Nt(()=>{a=null;const f=n._novip.idbdb=d.result,g=br(f.objectStoreNames);if(g.length>0)try{const y=f.transaction((p=g).length===1?p[0]:p,"readonly");t.autoSchema?function({_novip:m},v,w){m.verno=v.version/10;const A=m._dbSchema=lo(0,v,w);m._storeNames=br(v.objectStoreNames,0),Sr(m,[m._allTables],Gt(A),A)}(n,f,y):(co(n,n._dbSchema,y),function(m,v){const w=Du(lo(0,m.idbdb,v),m._dbSchema);return!(w.add.length||w.change.some(A=>A.add.length||A.change.length))}(n,y)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),ro(n,y)}catch{}var p;ti.push(n),f.onversionchange=Nt(y=>{t.vcFired=!0,n.on("versionchange").fire(y)}),f.onclose=Nt(y=>{n.on("close").fire(y)}),o&&function({indexedDB:y,IDBKeyRange:m},v){!al(y)&&v!==Yr&&rl(y,m).put({name:v}).catch(It)}(n._deps,u),c()},h)}).catch(c=>c&&c.name==="UnknownError"&&t.PR1398_maxLoop>0?(t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l()):ot.reject(c));return ot.race([s,(typeof navigator>"u"?ot.resolve():Vy()).then(l)]).then(()=>(i(),t.onReadyBeingFired=[],ot.resolve(ho(()=>n.on.ready.fire(n.vip))).then(function c(){if(t.onReadyBeingFired.length>0){let h=t.onReadyBeingFired.reduce(el,It);return t.onReadyBeingFired=[],ot.resolve(ho(()=>h(n.vip))).then(c)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>n).catch(c=>{t.dbOpenError=c;try{a&&a.abort()}catch{}return s===t.openCanceller&&n._close(),Yt(c)}).finally(()=>{t.openComplete=!0,r()})}function uo(n){var t=r=>n.next(r),e=i(t),s=i(r=>n.throw(r));function i(r){return a=>{var o=r(a),l=o.value;return o.done?l:l&&typeof l.then=="function"?l.then(e,s):oe(l)?Promise.all(l).then(e,s):e(l)}}return i(t)()}function qy(n,t,e){var s=arguments.length;if(s<2)throw new gt.InvalidArgument("Too few arguments");for(var i=new Array(s-1);--s;)i[s-1]=arguments[s];return e=i.pop(),[n,fu(i),e]}function Fu(n,t,e,s,i){return ot.resolve().then(()=>{const r=dt.transless||dt,a=n._createTransaction(t,e,n._dbSchema,s),o={trans:a,transless:r};if(s)a.idbtrans=s.idbtrans;else try{a.create(),n._state.PR1398_maxLoop=3}catch(u){return u.name===tl.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>Fu(n,t,e,null,i))):Yt(u)}const l=Jo(i);let c;l&&Sn();const h=ot.follow(()=>{if(c=i.call(a,a),c)if(l){var u=ps.bind(null,null);c.then(u,u)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=uo(c))},o);return(c&&typeof c.then=="function"?ot.resolve(c).then(u=>a.active?u:Yt(new gt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):h.then(()=>c)).then(u=>(s&&a._resolve(),a._completion.then(()=>u))).catch(u=>(a._reject(u),Yt(u)))})}function Gi(n,t,e){const s=oe(n)?n.slice():[n];for(let i=0;i<e;++i)s.push(t);return s}const Xy={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return{...n,table(t){const e=n.table(t),{schema:s}=e,i={},r=[];function a(h,u,d){const f=si(h),g=i[f]=i[f]||[],p=h==null?0:typeof h=="string"?1:h.length,y=u>0,m={...d,isVirtual:y,keyTail:u,keyLength:p,extractKey:io(h),unique:!y&&d.unique};return g.push(m),m.isPrimaryKey||r.push(m),p>1&&a(p===2?h[0]:h.slice(0,p-1),u+1,d),g.sort((v,w)=>v.keyTail-w.keyTail),m}const o=a(s.primaryKey.keyPath,0,s.primaryKey);i[":id"]=[o];for(const h of s.indexes)a(h.keyPath,0,h);function l(h){const u=h.query.index;return u.isVirtual?{...h,query:{index:u,range:(d=h.query.range,f=u.keyTail,{type:d.type===1?2:d.type,lower:Gi(d.lower,d.lowerOpen?n.MAX_KEY:n.MIN_KEY,f),lowerOpen:!0,upper:Gi(d.upper,d.upperOpen?n.MIN_KEY:n.MAX_KEY,f),upperOpen:!0})}}:h;var d,f}return{...e,schema:{...s,primaryKey:o,indexes:r,getIndexByKeyPath:function(h){const u=i[si(h)];return u&&u[0]}},count:h=>e.count(l(h)),query:h=>e.query(l(h)),openCursor(h){const{keyTail:u,isVirtual:d,keyLength:f}=h.query.index;return d?e.openCursor(l(h)).then(g=>g&&function(p){return Object.create(p,{continue:{value:function(m){m!=null?p.continue(Gi(m,h.reverse?n.MAX_KEY:n.MIN_KEY,u)):h.unique?p.continue(p.key.slice(0,f).concat(h.reverse?n.MIN_KEY:n.MAX_KEY,u)):p.continue()}},continuePrimaryKey:{value(m,v){p.continuePrimaryKey(Gi(m,n.MAX_KEY,u),v)}},primaryKey:{get:()=>p.primaryKey},key:{get(){const m=p.key;return f===1?m[0]:m.slice(0,f)}},value:{get:()=>p.value}})}(g)):e.openCursor(h)}}}}}};function ol(n,t,e,s){return e=e||{},s=s||"",Gt(n).forEach(i=>{if(ke(t,i)){var r=n[i],a=t[i];if(typeof r=="object"&&typeof a=="object"&&r&&a){const o=Wa(r);o!==Wa(a)?e[s+i]=t[i]:o==="Object"?ol(r,a,e,s+i+"."):r!==a&&(e[s+i]=t[i])}else r!==a&&(e[s+i]=t[i])}else e[s+i]=void 0}),Gt(t).forEach(i=>{ke(n,i)||(e[s+i]=t[i])}),e}const Yy={stack:"dbcore",name:"HooksMiddleware",level:2,create:n=>({...n,table(t){const e=n.table(t),{primaryKey:s}=e.schema;return{...e,mutate(r){const a=dt.trans,{deleting:o,creating:l,updating:c}=a.table(t).hook;switch(r.type){case"add":if(l.fire===It)break;return a._promise("readwrite",()=>h(r),!0);case"put":if(l.fire===It&&c.fire===It)break;return a._promise("readwrite",()=>h(r),!0);case"delete":if(o.fire===It)break;return a._promise("readwrite",()=>h(r),!0);case"deleteRange":if(o.fire===It)break;return a._promise("readwrite",()=>function(d){return u(d.trans,d.range,1e4)}(r),!0)}return e.mutate(r);function h(d){const f=dt.trans,g=d.keys||function(p,y){return y.type==="delete"?y.keys:y.keys||y.values.map(p.extractKey)}(s,d);if(!g)throw new Error("Keys missing");return(d=d.type==="add"||d.type==="put"?{...d,keys:g}:{...d}).type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),function(p,y,m){return y.type==="add"?Promise.resolve([]):p.getMany({trans:y.trans,keys:m,cache:"immutable"})}(e,d,g).then(p=>{const y=g.map((m,v)=>{const w=p[v],A={onerror:null,onsuccess:null};if(d.type==="delete")o.fire.call(A,m,w,f);else if(d.type==="add"||w===void 0){const S=l.fire.call(A,m,d.values[v],f);m==null&&S!=null&&(m=S,d.keys[v]=m,s.outbound||Ne(d.values[v],s.keyPath,m))}else{const S=ol(w,d.values[v]),k=c.fire.call(A,S,m,w,f);if(k){const C=d.values[v];Object.keys(k).forEach(z=>{ke(C,z)?C[z]=k[z]:Ne(C,z,k[z])})}}return A});return e.mutate(d).then(({failures:m,results:v,numFailures:w,lastResult:A})=>{for(let S=0;S<g.length;++S){const k=v?v[S]:g[S],C=y[S];k==null?C.onerror&&C.onerror(m[S]):C.onsuccess&&C.onsuccess(d.type==="put"&&p[S]?d.values[S]:k)}return{failures:m,results:v,numFailures:w,lastResult:A}}).catch(m=>(y.forEach(v=>v.onerror&&v.onerror(m)),Promise.reject(m)))})}function u(d,f,g){return e.query({trans:d,values:!1,query:{index:s,range:f},limit:g}).then(({result:p})=>h({type:"delete",keys:p,trans:d}).then(y=>y.numFailures>0?Promise.reject(y.failures[0]):p.length<g?{failures:[],numFailures:0,lastResult:void 0}:u(d,{...f,lower:p[p.length-1],lowerOpen:!0},g)))}}}}})};function Nu(n,t,e){try{if(!t||t.keys.length<n.length)return null;const s=[];for(let i=0,r=0;i<t.keys.length&&r<n.length;++i)ge(t.keys[i],n[r])===0&&(s.push(e?Ei(t.values[i]):t.values[i]),++r);return s.length===n.length?s:null}catch{return null}}const Zy={stack:"dbcore",level:-1,create:n=>({table:t=>{const e=n.table(t);return{...e,getMany:s=>{if(!s.cache)return e.getMany(s);const i=Nu(s.keys,s.trans._cache,s.cache==="clone");return i?ot.resolve(i):e.getMany(s).then(r=>(s.trans._cache={keys:s.keys,values:s.cache==="clone"?Ei(r):r},r))},mutate:s=>(s.type!=="add"&&(s.trans._cache=null),e.mutate(s))}}})};function ll(n){return!("from"in n)}const ns=function(n,t){if(!this){const e=new ns;return n&&"d"in n&&be(e,n),e}be(this,arguments.length?{d:1,from:n,to:arguments.length>1?t:n}:{d:0})};function mi(n,t,e){const s=ge(t,e);if(isNaN(s))return;if(s>0)throw RangeError();if(ll(n))return be(n,{from:t,to:e,d:1});const i=n.l,r=n.r;if(ge(e,n.from)<0)return i?mi(i,t,e):n.l={from:t,to:e,d:1,l:null,r:null},Ac(n);if(ge(t,n.to)>0)return r?mi(r,t,e):n.r={from:t,to:e,d:1,l:null,r:null},Ac(n);ge(t,n.from)<0&&(n.from=t,n.l=null,n.d=r?r.d+1:1),ge(e,n.to)>0&&(n.to=e,n.r=null,n.d=n.l?n.l.d+1:1);const a=!n.r;i&&!n.l&&xr(n,i),r&&a&&xr(n,r)}function xr(n,t){ll(t)||function e(s,{from:i,to:r,l:a,r:o}){mi(s,i,r),a&&e(s,a),o&&e(s,o)}(n,t)}function Jy(n,t){const e=fo(t);let s=e.next();if(s.done)return!1;let i=s.value;const r=fo(n);let a=r.next(i.from),o=a.value;for(;!s.done&&!a.done;){if(ge(o.from,i.to)<=0&&ge(o.to,i.from)>=0)return!0;ge(i.from,o.from)<0?i=(s=e.next(o.from)).value:o=(a=r.next(i.from)).value}return!1}function fo(n){let t=ll(n)?null:{s:0,n};return{next(e){const s=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,s)for(;t.n.l&&ge(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!s||ge(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Ac(n){var t,e;const s=(((t=n.r)===null||t===void 0?void 0:t.d)||0)-(((e=n.l)===null||e===void 0?void 0:e.d)||0),i=s>1?"r":s<-1?"l":"";if(i){const r=i==="r"?"l":"r",a={...n},o=n[i];n.from=o.from,n.to=o.to,n[i]=o[i],a[i]=o[r],n[r]=a,a.d=Sc(a)}n.d=Sc(n)}function Sc({r:n,l:t}){return(n?t?Math.max(n.d,t.d):n.d:t?t.d:0)+1}wn(ns.prototype,{add(n){return xr(this,n),this},addKey(n){return mi(this,n,n),this},addKeys(n){return n.forEach(t=>mi(this,t,t)),this},[Ga](){return fo(this)}});const Qy={stack:"dbcore",level:0,create:n=>{const t=n.schema.name,e=new ns(n.MIN_KEY,n.MAX_KEY);return{...n,table:s=>{const i=n.table(s),{schema:r}=i,{primaryKey:a}=r,{extractKey:o,outbound:l}=a,c={...i,mutate:d=>{const f=d.trans,g=f.mutatedParts||(f.mutatedParts={}),p=k=>{const C=`idb://${t}/${s}/${k}`;return g[C]||(g[C]=new ns)},y=p(""),m=p(":dels"),{type:v}=d;let[w,A]=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[];const S=d.trans._cache;return i.mutate(d).then(k=>{if(oe(w)){v!=="delete"&&(w=k.results),y.addKeys(w);const C=Nu(w,S);C||v==="add"||m.addKeys(w),(C||A)&&function(z,T,V,Z){function P(U){const _=z(U.name||"");function q(L){return L!=null?U.extractKey(L):null}const Y=L=>U.multiEntry&&oe(L)?L.forEach(et=>_.addKey(et)):_.addKey(L);(V||Z).forEach((L,et)=>{const N=V&&q(V[et]),W=Z&&q(Z[et]);ge(N,W)!==0&&(N!=null&&Y(N),W!=null&&Y(W))})}T.indexes.forEach(P)}(p,r,C,A)}else if(w){const C={from:w.lower,to:w.upper};m.add(C),y.add(C)}else y.add(e),m.add(e),r.indexes.forEach(C=>p(C.name).add(e));return k})}},h=({query:{index:d,range:f}})=>{var g,p;return[d,new ns((g=f.lower)!==null&&g!==void 0?g:n.MIN_KEY,(p=f.upper)!==null&&p!==void 0?p:n.MAX_KEY)]},u={get:d=>[a,new ns(d.key)],getMany:d=>[a,new ns().addKeys(d.keys)],count:h,query:h,openCursor:h};return Gt(u).forEach(d=>{c[d]=function(f){const{subscr:g}=dt;if(g){const p=A=>{const S=`idb://${t}/${s}/${A}`;return g[S]||(g[S]=new ns)},y=p(""),m=p(":dels"),[v,w]=u[d](f);if(p(v.name||"").add(w),!v.isPrimaryKey){if(d!=="count"){const A=d==="query"&&l&&f.values&&i.query({...f,values:!1});return i[d].apply(this,arguments).then(S=>{if(d==="query"){if(l&&f.values)return A.then(({result:C})=>(y.addKeys(C),S));const k=f.values?S.result.map(o):S.result;f.values?y.addKeys(k):m.addKeys(k)}else if(d==="openCursor"){const k=S,C=f.values;return k&&Object.create(k,{key:{get:()=>(m.addKey(k.primaryKey),k.key)},primaryKey:{get(){const z=k.primaryKey;return m.addKey(z),z}},value:{get:()=>(C&&y.addKey(k.primaryKey),k.value)}})}return S})}m.add(e)}}return i[d].apply(this,arguments)}}),c}}}};class Ks{constructor(t,e){this._middlewares={},this.verno=0;const s=Ks.dependencies;this._options=e={addons:Ks.addons,autoOpen:!0,indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange,...e},this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange};const{addons:i}=e;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const r={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:It,dbReadyPromise:null,cancelOpen:It,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var a;r.dbReadyPromise=new ot(o=>{r.dbReadyResolve=o}),r.openCanceller=new ot((o,l)=>{r.cancelOpen=l}),this._state=r,this.name=t,this.on=ei(this,"populate","blocked","versionchange","close",{ready:[el,It]}),this.on.ready.subscribe=cu(this.on.ready.subscribe,o=>(l,c)=>{Ks.vip(()=>{const h=this._state;if(h.openComplete)h.dbOpenError||ot.resolve().then(l),c&&o(l);else if(h.onReadyBeingFired)h.onReadyBeingFired.push(l),c&&o(l);else{o(l);const u=this;c||o(function d(){u.on.ready.unsubscribe(l),u.on.ready.unsubscribe(d)})}})}),this.Collection=(a=this,On(Fy.prototype,function(o,l){this.db=a;let c=Ru,h=null;if(l)try{c=l()}catch(g){h=g}const u=o._ctx,d=u.table,f=d.hook.reading.fire;this._ctx={table:d,index:u.index,isPrimKey:!u.index||d.schema.primKey.keyPath&&u.index===d.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:h,or:u.or,valueMapper:f!==ui?f:null}})),this.Table=function(o){return On(Dy.prototype,function(l,c,h){this.db=o,this._tx=h,this.name=l,this.schema=c,this.hook=o._allTables[l]?o._allTables[l].hook:ei(null,{creating:[Sy,It],reading:[Ay,ui],updating:[Ey,It],deleting:[xy,It]})})}(this),this.Transaction=function(o){return On(jy.prototype,function(l,c,h,u,d){this.db=o,this.mode=l,this.storeNames=c,this.schema=h,this.chromeTransactionDurability=u,this.idbtrans=null,this.on=ei(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ot((f,g)=>{this._resolve=f,this._reject=g}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},f=>{var g=this.active;return this.active=!1,this.on.error.fire(f),this.parent?this.parent._reject(f):g&&this.idbtrans&&this.idbtrans.abort(),Yt(f)})})}(this),this.Version=function(o){return On(Gy.prototype,function(l){this.db=o,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(o){return On(Mu.prototype,function(l,c,h){this.db=o,this._ctx={table:l,index:c===":id"?null:c,or:h};const u=o._deps.indexedDB;if(!u)throw new gt.MissingAPI;this._cmp=this._ascending=u.cmp.bind(u),this._descending=(d,f)=>u.cmp(f,d),this._max=(d,f)=>u.cmp(d,f)>0?d:f,this._min=(d,f)=>u.cmp(d,f)<0?d:f,this._IDBKeyRange=o._deps.IDBKeyRange})}(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=gi(e.IDBKeyRange),this._createTransaction=(o,l,c,h)=>new this.Transaction(o,l,c,this._options.chromeTransactionDurability,h),this._fireOnBlocked=o=>{this.on("blocked").fire(o),ti.filter(l=>l.name===this.name&&l!==this&&!l._state.vcFired).map(l=>l.on("versionchange").fire(o))},this.use(Xy),this.use(Yy),this.use(Qy),this.use(Zy),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(o=>o(this))}version(t){if(isNaN(t)||t<.1)throw new gt.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new gt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const e=this._versions;var s=e.filter(i=>i._cfg.version===t)[0];return s||(s=new this.Version(t),e.push(s),e.sort(Uy),s.stores({}),this._state.autoSchema=!1,s)}_whenReady(t){return this.idbdb&&(this._state.openComplete||dt.letThrough||this._vip)?t():new ot((e,s)=>{if(this._state.openComplete)return s(new gt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void s(new gt.DatabaseClosed);this.open().catch(It)}this._state.dbReadyPromise.then(e,s)}).then(t)}use({stack:t,create:e,level:s,name:i}){i&&this.unuse({stack:t,name:i});const r=this._middlewares[t]||(this._middlewares[t]=[]);return r.push({stack:t,create:e,level:s??10,name:i}),r.sort((a,o)=>a.level-o.level),this}unuse({stack:t,name:e,create:s}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(i=>s?i.create!==s:!!e&&i.name!==e)),this}open(){return Ky(this)}_close(){const t=this._state,e=ti.indexOf(this);if(e>=0&&ti.splice(e,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new ot(s=>{t.dbReadyResolve=s}),t.openCanceller=new ot((s,i)=>{t.cancelOpen=i})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new gt.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,e=this._state;return new ot((s,i)=>{const r=()=>{this.close();var a=this._deps.indexedDB.deleteDatabase(this.name);a.onsuccess=Nt(()=>{(function({indexedDB:o,IDBKeyRange:l},c){!al(o)&&c!==Yr&&rl(o,l).delete(c).catch(It)})(this._deps,this.name),s()}),a.onerror=Ve(i),a.onblocked=this._fireOnBlocked};if(t)throw new gt.InvalidArgument("Arguments not allowed in db.delete()");e.isBeingOpened?e.dbReadyPromise.then(r):r()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Gt(this._allTables).map(t=>this._allTables[t])}transaction(){const t=qy.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,e,s){let i=dt.trans;i&&i.db===this&&t.indexOf("!")===-1||(i=null);const r=t.indexOf("?")!==-1;let a,o;t=t.replace("!","").replace("?","");try{if(o=e.map(c=>{var h=c instanceof this.Table?c.name:c;if(typeof h!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return h}),t=="r"||t===ma)a=ma;else{if(t!="rw"&&t!=ba)throw new gt.InvalidArgument("Invalid transaction mode: "+t);a=ba}if(i){if(i.mode===ma&&a===ba){if(!r)throw new gt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&o.forEach(c=>{if(i&&i.storeNames.indexOf(c)===-1){if(!r)throw new gt.SubTransaction("Table "+c+" not included in parent transaction.");i=null}}),r&&i&&!i.active&&(i=null)}}catch(c){return i?i._promise(null,(h,u)=>{u(c)}):Yt(c)}const l=Fu.bind(null,this,a,o,i,s);return i?i._promise(a,l,"lock"):dt.trans?xn(dt.transless,()=>this._whenReady(l)):this._whenReady(l)}table(t){if(!ke(this._allTables,t))throw new gt.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const tv=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class ev{constructor(t){this._subscribe=t}subscribe(t,e,s){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:e,complete:s})}[tv](){return this}}function Bu(n,t){return Gt(t).forEach(e=>{xr(n[e]||(n[e]=new ns),t[e])}),n}function sv(n){let t,e=!1;const s=new ev(i=>{const r=Jo(n);let a=!1,o={},l={};const c={get closed(){return a},unsubscribe:()=>{a=!0,Is.storagemutated.unsubscribe(f)}};i.start&&i.start(c);let h=!1,u=!1;function d(){return Gt(l).some(p=>o[p]&&Jy(o[p],l[p]))}const f=p=>{Bu(o,p),d()&&g()},g=()=>{if(h||a)return;o={};const p={},y=function(m){r&&Sn();const v=()=>Ps(n,{subscr:m,trans:null}),w=dt.trans?xn(dt.transless,v):v();return r&&w.then(ps,ps),w}(p);u||(Is(pi,f),u=!0),h=!0,Promise.resolve(y).then(m=>{e=!0,t=m,h=!1,a||(d()?g():(o={},l=p,i.next&&i.next(m)))},m=>{h=!1,e=!1,i.error&&i.error(m),c.unsubscribe()})};return g(),c});return s.hasValue=()=>e,s.getValue=()=>t,s}let po;try{po={indexedDB:Dt.indexedDB||Dt.mozIndexedDB||Dt.webkitIndexedDB||Dt.msIndexedDB,IDBKeyRange:Dt.IDBKeyRange||Dt.webkitIDBKeyRange}}catch{po={indexedDB:null,IDBKeyRange:null}}const Bs=Ks;function ir(n){let t=os;try{os=!0,Is.storagemutated.fire(n)}finally{os=t}}wn(Bs,{...Ji,delete:n=>new Bs(n,{addons:[]}).delete(),exists:n=>new Bs(n,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(n){try{return function({indexedDB:t,IDBKeyRange:e}){return al(t)?Promise.resolve(t.databases()).then(s=>s.map(i=>i.name).filter(i=>i!==Yr)):rl(t,e).toCollection().primaryKeys()}(Bs.dependencies).then(n)}catch{return Yt(new gt.MissingAPI)}},defineClass:()=>function(n){be(this,n)},ignoreTransaction:n=>dt.trans?xn(dt.transless,n):n(),vip:ho,async:function(n){return function(){try{var t=uo(n.apply(this,arguments));return t&&typeof t.then=="function"?t:ot.resolve(t)}catch(e){return Yt(e)}}},spawn:function(n,t,e){try{var s=uo(n.apply(e,t||[]));return s&&typeof s.then=="function"?s:ot.resolve(s)}catch(i){return Yt(i)}},currentTransaction:{get:()=>dt.trans||null},waitFor:function(n,t){const e=ot.resolve(typeof n=="function"?Bs.ignoreTransaction(n):n).timeout(t||6e4);return dt.trans?dt.trans.waitFor(e):e},Promise:ot,debug:{get:()=>Ze,set:n=>{gu(n,n==="dexie"?()=>!0:Pu)}},derive:gn,extend:be,props:wn,override:cu,Events:ei,on:Is,liveQuery:sv,extendObservabilitySet:Bu,getByKeyPath:hs,setByKeyPath:Ne,delByKeyPath:function(n,t){typeof t=="string"?Ne(n,t,void 0):"length"in t&&[].map.call(t,function(e){Ne(n,e,void 0)})},shallowClone:du,deepClone:Ei,getObjectDiff:ol,cmp:ge,asap:hu,minKey:so,addons:[],connections:ti,errnames:tl,dependencies:po,semVer:mc,version:mc.split(".").map(n=>parseInt(n)).reduce((n,t,e)=>n+t/Math.pow(10,2*e))}),Bs.maxKey=gi(Bs.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Is(pi,n=>{if(!os){let t;Xr?(t=document.createEvent("CustomEvent"),t.initCustomEvent(As,!0,!0,n)):t=new CustomEvent(As,{detail:n}),os=!0,dispatchEvent(t),os=!1}}),addEventListener(As,({detail:n})=>{os||ir(n)}));let os=!1;if(typeof BroadcastChannel<"u"){const n=new BroadcastChannel(As);typeof n.unref=="function"&&n.unref(),Is(pi,t=>{os||n.postMessage(t)}),n.onmessage=t=>{t.data&&ir(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Is(pi,t=>{try{os||(typeof localStorage<"u"&&localStorage.setItem(As,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(e=>e.postMessage({type:As,changedParts:t})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",t=>{if(t.key===As){const e=JSON.parse(t.newValue);e&&ir(e.changedParts)}});const n=self.document&&navigator.serviceWorker;n&&n.addEventListener("message",function({data:t}){t&&t.type===As&&ir(t.changedParts)})}ot.rejectionMapper=function(n,t){if(!n||n instanceof mn||n instanceof TypeError||n instanceof SyntaxError||!n.name||!dc[n.name])return n;var e=new dc[n.name](t||n.message,n);return"stack"in n&&cs(e,"stack",{get:function(){return this.inner.stack}}),e},gu(Ze,Pu);var zu={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(n,t){(function(e){n.exports=e()})(function(){return function e(s,i,r){function a(c,h){if(!i[c]){if(!s[c]){var u=typeof Bn=="function"&&Bn;if(!h&&u)return u(c,!0);if(o)return o(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[c]={exports:{}};s[c][0].call(f.exports,function(g){var p=s[c][1][g];return a(p||g)},f,f.exports,e,s,i,r)}return i[c].exports}for(var o=typeof Bn=="function"&&Bn,l=0;l<r.length;l++)a(r[l]);return a}({1:[function(e,s,i){var r=e("./utils"),a=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var c,h,u,d,f,g,p,y=[],m=0,v=l.length,w=v,A=r.getTypeOf(l)!=="string";m<l.length;)w=v-m,u=A?(c=l[m++],h=m<v?l[m++]:0,m<v?l[m++]:0):(c=l.charCodeAt(m++),h=m<v?l.charCodeAt(m++):0,m<v?l.charCodeAt(m++):0),d=c>>2,f=(3&c)<<4|h>>4,g=1<w?(15&h)<<2|u>>6:64,p=2<w?63&u:64,y.push(o.charAt(d)+o.charAt(f)+o.charAt(g)+o.charAt(p));return y.join("")},i.decode=function(l){var c,h,u,d,f,g,p=0,y=0,m="data:";if(l.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");var v,w=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&w--,l.charAt(l.length-2)===o.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=a.uint8array?new Uint8Array(0|w):new Array(0|w);p<l.length;)c=o.indexOf(l.charAt(p++))<<2|(d=o.indexOf(l.charAt(p++)))>>4,h=(15&d)<<4|(f=o.indexOf(l.charAt(p++)))>>2,u=(3&f)<<6|(g=o.indexOf(l.charAt(p++))),v[y++]=c,f!==64&&(v[y++]=h),g!==64&&(v[y++]=u);return v}},{"./support":30,"./utils":32}],2:[function(e,s,i){var r=e("./external"),a=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(h,u,d,f,g){this.compressedSize=h,this.uncompressedSize=u,this.crc32=d,this.compression=f,this.compressedContent=g}c.prototype={getContentWorker:function(){var h=new a(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),u=this;return h.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new a(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,u,d){return h.pipe(new o).pipe(new l("uncompressedSize")).pipe(u.compressWorker(d)).pipe(new l("compressedSize")).withStreamInfo("compression",u)},s.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,s,i){var r=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,s,i){var r=e("./utils"),a=function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var h=0;h<8;h++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l}();s.exports=function(o,l){return o!==void 0&&o.length?r.getTypeOf(o)!=="string"?function(c,h,u,d){var f=a,g=d+u;c^=-1;for(var p=d;p<g;p++)c=c>>>8^f[255&(c^h[p])];return-1^c}(0|l,o,o.length,0):function(c,h,u,d){var f=a,g=d+u;c^=-1;for(var p=d;p<g;p++)c=c>>>8^f[255&(c^h.charCodeAt(p))];return-1^c}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(e,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,s,i){var r=null;r=typeof Promise<"u"?Promise:e("lie"),s.exports={Promise:r}},{lie:37}],7:[function(e,s,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=e("pako"),o=e("./utils"),l=e("./stream/GenericWorker"),c=r?"uint8array":"array";function h(u,d){l.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=d,this.meta={}}i.magic="\b\0",o.inherits(h,l),h.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,u.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(d){u.push({data:d,meta:u.meta})}},i.compressWorker=function(u){return new h("Deflate",u)},i.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,s,i){function r(f,g){var p,y="";for(p=0;p<g;p++)y+=String.fromCharCode(255&f),f>>>=8;return y}function a(f,g,p,y,m,v){var w,A,S=f.file,k=f.compression,C=v!==c.utf8encode,z=o.transformTo("string",v(S.name)),T=o.transformTo("string",c.utf8encode(S.name)),V=S.comment,Z=o.transformTo("string",v(V)),P=o.transformTo("string",c.utf8encode(V)),U=T.length!==S.name.length,_=P.length!==V.length,q="",Y="",L="",et=S.dir,N=S.date,W={crc32:0,compressedSize:0,uncompressedSize:0};g&&!p||(W.crc32=f.crc32,W.compressedSize=f.compressedSize,W.uncompressedSize=f.uncompressedSize);var I=0;g&&(I|=8),C||!U&&!_||(I|=2048);var D=0,G=0;et&&(D|=16),m==="UNIX"?(G=798,D|=function(tt,it){var nt=tt;return tt||(nt=it?16893:33204),(65535&nt)<<16}(S.unixPermissions,et)):(G=20,D|=function(tt){return 63&(tt||0)}(S.dosPermissions)),w=N.getUTCHours(),w<<=6,w|=N.getUTCMinutes(),w<<=5,w|=N.getUTCSeconds()/2,A=N.getUTCFullYear()-1980,A<<=4,A|=N.getUTCMonth()+1,A<<=5,A|=N.getUTCDate(),U&&(Y=r(1,1)+r(h(z),4)+T,q+="up"+r(Y.length,2)+Y),_&&(L=r(1,1)+r(h(Z),4)+P,q+="uc"+r(L.length,2)+L);var X="";return X+=`
\0`,X+=r(I,2),X+=k.magic,X+=r(w,2),X+=r(A,2),X+=r(W.crc32,4),X+=r(W.compressedSize,4),X+=r(W.uncompressedSize,4),X+=r(z.length,2),X+=r(q.length,2),{fileRecord:u.LOCAL_FILE_HEADER+X+z+q,dirRecord:u.CENTRAL_FILE_HEADER+r(G,2)+X+r(Z.length,2)+"\0\0\0\0"+r(D,4)+r(y,4)+z+q+Z}}var o=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),h=e("../crc32"),u=e("../signature");function d(f,g,p,y){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=p,this.encodeFileName=y,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(d,l),d.prototype.push=function(f){var g=f.meta.percent||0,p=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,l.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:p?(g+100*(p-y-1))/p:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var g=this.streamFiles&&!f.file.dir;if(g){var p=a(f,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var g=this.streamFiles&&!f.file.dir,p=a(f,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),g)this.push({data:function(y){return u.DATA_DESCRIPTOR+r(y.crc32,4)+r(y.compressedSize,4)+r(y.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var p=this.bytesWritten-f,y=function(m,v,w,A,S){var k=o.transformTo("string",S(A));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(m,2)+r(m,2)+r(v,4)+r(w,4)+r(k.length,2)+k}(this.dirRecords.length,p,f,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var g=this;return f.on("data",function(p){g.processChunk(p)}),f.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),f.on("error",function(p){g.error(p)}),this},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var g=this._sources;if(!l.prototype.error.call(this,f))return!1;for(var p=0;p<g.length;p++)try{g[p].error(f)}catch{}return!0},d.prototype.lock=function(){l.prototype.lock.call(this);for(var f=this._sources,g=0;g<f.length;g++)f[g].lock()},s.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,s,i){var r=e("../compressions"),a=e("./ZipFileWorker");i.generateWorker=function(o,l,c){var h=new a(l.streamFiles,c,l.platform,l.encodeFileName),u=0;try{o.forEach(function(d,f){u++;var g=function(v,w){var A=v||w,S=r[A];if(!S)throw new Error(A+" is not a valid compression method !");return S}(f.options.compression,l.compression),p=f.options.compressionOptions||l.compressionOptions||{},y=f.dir,m=f.date;f._compressWorker(g,p).withStreamInfo("file",{name:d,dir:y,date:m,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(h)}),h.entriesCount=u}catch(d){h.error(d)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,s,i){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new r;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(a,o){return new r().loadAsync(a,o)},r.external=e("./external"),s.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,s,i){var r=e("./utils"),a=e("./external"),o=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),h=e("./nodejsUtils");function u(d){return new a.Promise(function(f,g){var p=d.decompressed.getContentWorker().pipe(new c);p.on("error",function(y){g(y)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}s.exports=function(d,f){var g=this;return f=r.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),h.isNode&&h.isStream(d)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(p){var y=new l(f);return y.load(p),y}).then(function(p){var y=[a.Promise.resolve(p)],m=p.files;if(f.checkCRC32)for(var v=0;v<m.length;v++)y.push(u(m[v]));return a.Promise.all(y)}).then(function(p){for(var y=p.shift(),m=y.files,v=0;v<m.length;v++){var w=m[v],A=w.fileNameStr,S=r.resolve(w.fileNameStr);g.file(S,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:f.createFolders}),w.dir||(g.file(S).unsafeOriginalName=A)}return y.zipComment.length&&(g.comment=y.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,s,i){var r=e("../utils"),a=e("../stream/GenericWorker");function o(l,c){a.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}r.inherits(o,a),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,s,i){var r=e("readable-stream").Readable;function a(o,l,c){r.call(this,l),this._helper=o;var h=this;o.on("data",function(u,d){h.push(u)||h._helper.pause(),c&&c(d)}).on("error",function(u){h.emit("error",u)}).on("end",function(){h.push(null)})}e("../utils").inherits(a,r),a.prototype._read=function(){this._helper.resume()},s.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,a);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,a)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var a=new Buffer(r);return a.fill(0),a},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(e,s,i){function r(S,k,C){var z,T=o.getTypeOf(k),V=o.extend(C||{},h);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(S=m(S)),V.createFolders&&(z=y(S))&&v.call(this,z,!0);var Z=T==="string"&&V.binary===!1&&V.base64===!1;C&&C.binary!==void 0||(V.binary=!Z),(k instanceof u&&k.uncompressedSize===0||V.dir||!k||k.length===0)&&(V.base64=!1,V.binary=!0,k="",V.compression="STORE",T="string");var P=null;P=k instanceof u||k instanceof l?k:g.isNode&&g.isStream(k)?new p(S,k):o.prepareContent(S,k,V.binary,V.optimizedBinaryString,V.base64);var U=new d(S,P,V);this.files[S]=U}var a=e("./utf8"),o=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),h=e("./defaults"),u=e("./compressedObject"),d=e("./zipObject"),f=e("./generate"),g=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),y=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var k=S.lastIndexOf("/");return 0<k?S.substring(0,k):""},m=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},v=function(S,k){return k=k!==void 0?k:h.createFolders,S=m(S),this.files[S]||r.call(this,S,null,{dir:!0,createFolders:k}),this.files[S]};function w(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var k,C,z;for(k in this.files)z=this.files[k],(C=k.slice(this.root.length,k.length))&&k.slice(0,this.root.length)===this.root&&S(C,z)},filter:function(S){var k=[];return this.forEach(function(C,z){S(C,z)&&k.push(z)}),k},file:function(S,k,C){if(arguments.length!==1)return S=this.root+S,r.call(this,S,k,C),this;if(w(S)){var z=S;return this.filter(function(V,Z){return!Z.dir&&z.test(V)})}var T=this.files[this.root+S];return T&&!T.dir?T:null},folder:function(S){if(!S)return this;if(w(S))return this.filter(function(T,V){return V.dir&&S.test(T)});var k=this.root+S,C=v.call(this,k),z=this.clone();return z.root=C.name,z},remove:function(S){S=this.root+S;var k=this.files[S];if(k||(S.slice(-1)!=="/"&&(S+="/"),k=this.files[S]),k&&!k.dir)delete this.files[S];else for(var C=this.filter(function(T,V){return V.name.slice(0,S.length)===S}),z=0;z<C.length;z++)delete this.files[C[z].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var k,C={};try{if((C=o.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=C.type.toLowerCase(),C.compression=C.compression.toUpperCase(),C.type==="binarystring"&&(C.type="string"),!C.type)throw new Error("No output type specified.");o.checkSupport(C.type),C.platform!=="darwin"&&C.platform!=="freebsd"&&C.platform!=="linux"&&C.platform!=="sunos"||(C.platform="UNIX"),C.platform==="win32"&&(C.platform="DOS");var z=C.comment||this.comment||"";k=f.generateWorker(this,C,z)}catch(T){(k=new l("error")).error(T)}return new c(k,C.type||"string",C.mimeType)},generateAsync:function(S,k){return this.generateInternalStream(S).accumulate(k)},generateNodeStream:function(S,k){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(k)}};s.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,s,i){s.exports=e("stream")},{stream:void 0}],17:[function(e,s,i){var r=e("./DataReader");function a(o){r.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}e("../utils").inherits(a,r),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),u=o.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===l&&this.data[d+1]===c&&this.data[d+2]===h&&this.data[d+3]===u)return d-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),u=o.charCodeAt(3),d=this.readData(4);return l===d[0]&&c===d[1]&&h===d[2]&&u===d[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,s,i){var r=e("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return r.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},s.exports=a},{"../utils":32}],19:[function(e,s,i){var r=e("./Uint8ArrayReader");function a(o){r.call(this,o)}e("../utils").inherits(a,r),a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,s,i){var r=e("./DataReader");function a(o){r.call(this,o)}e("../utils").inherits(a,r),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,s,i){var r=e("./ArrayReader");function a(o){r.call(this,o)}e("../utils").inherits(a,r),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,s,i){var r=e("../utils"),a=e("../support"),o=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),h=e("./Uint8ArrayReader");s.exports=function(u){var d=r.getTypeOf(u);return r.checkSupport(d),d!=="string"||a.uint8array?d==="nodebuffer"?new c(u):a.uint8array?new h(r.transformTo("uint8array",u)):new o(r.transformTo("array",u)):new l(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,s,i){var r=e("./GenericWorker"),a=e("../utils");function o(l){r.call(this,"ConvertWorker to "+l),this.destType=l}a.inherits(o,r),o.prototype.processChunk=function(l){this.push({data:a.transformTo(this.destType,l.data),meta:l.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,s,i){var r=e("./GenericWorker"),a=e("../crc32");function o(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,r),o.prototype.processChunk=function(l){this.streamInfo.crc32=a(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,s,i){var r=e("../utils"),a=e("./GenericWorker");function o(l){a.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(o,a),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}a.prototype.processChunk.call(this,l)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,s,i){var r=e("../utils"),a=e("./GenericWorker");function o(l){a.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=r.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}r.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,s,i){function r(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,o){return this._listeners[a].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,o){if(this._listeners[a])for(var l=0;l<this._listeners[a].length;l++)this._listeners[a][l].call(this,o)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(l){o.processChunk(l)}),a.on("end",function(){o.end()}),a.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},s.exports=r},{}],29:[function(e,s,i){var r=e("../utils"),a=e("./ConvertWorker"),o=e("./GenericWorker"),l=e("../base64"),c=e("../support"),h=e("../external"),u=null;if(c.nodestream)try{u=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(g,p){return new h.Promise(function(y,m){var v=[],w=g._internalType,A=g._outputType,S=g._mimeType;g.on("data",function(k,C){v.push(k),p&&p(C)}).on("error",function(k){v=[],m(k)}).on("end",function(){try{var k=function(C,z,T){switch(C){case"blob":return r.newBlob(r.transformTo("arraybuffer",z),T);case"base64":return l.encode(z);default:return r.transformTo(C,z)}}(A,function(C,z){var T,V=0,Z=null,P=0;for(T=0;T<z.length;T++)P+=z[T].length;switch(C){case"string":return z.join("");case"array":return Array.prototype.concat.apply([],z);case"uint8array":for(Z=new Uint8Array(P),T=0;T<z.length;T++)Z.set(z[T],V),V+=z[T].length;return Z;case"nodebuffer":return Buffer.concat(z);default:throw new Error("concat : unsupported type '"+C+"'")}}(w,v),S);y(k)}catch(C){m(C)}v=[]}).resume()})}function f(g,p,y){var m=p;switch(p){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=p,this._mimeType=y,r.checkSupport(m),this._worker=g.pipe(new a(m)),g.lock()}catch(v){this._worker=new o("error"),this._worker.error(v)}}f.prototype={accumulate:function(g){return d(this,g)},on:function(g,p){var y=this;return g==="data"?this._worker.on(g,function(m){p.call(y,m.data,m.meta)}):this._worker.on(g,function(){r.delay(p,arguments,y)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},g)}},s.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(r),i.blob=a.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,s,i){for(var r=e("./utils"),a=e("./support"),o=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function u(){l.call(this,"utf-8 decode"),this.leftOver=null}function d(){l.call(this,"utf-8 encode")}i.utf8encode=function(f){return a.nodebuffer?o.newBufferFrom(f,"utf-8"):function(g){var p,y,m,v,w,A=g.length,S=0;for(v=0;v<A;v++)(64512&(y=g.charCodeAt(v)))==55296&&v+1<A&&(64512&(m=g.charCodeAt(v+1)))==56320&&(y=65536+(y-55296<<10)+(m-56320),v++),S+=y<128?1:y<2048?2:y<65536?3:4;for(p=a.uint8array?new Uint8Array(S):new Array(S),v=w=0;w<S;v++)(64512&(y=g.charCodeAt(v)))==55296&&v+1<A&&(64512&(m=g.charCodeAt(v+1)))==56320&&(y=65536+(y-55296<<10)+(m-56320),v++),y<128?p[w++]=y:(y<2048?p[w++]=192|y>>>6:(y<65536?p[w++]=224|y>>>12:(p[w++]=240|y>>>18,p[w++]=128|y>>>12&63),p[w++]=128|y>>>6&63),p[w++]=128|63&y);return p}(f)},i.utf8decode=function(f){return a.nodebuffer?r.transformTo("nodebuffer",f).toString("utf-8"):function(g){var p,y,m,v,w=g.length,A=new Array(2*w);for(p=y=0;p<w;)if((m=g[p++])<128)A[y++]=m;else if(4<(v=c[m]))A[y++]=65533,p+=v-1;else{for(m&=v===2?31:v===3?15:7;1<v&&p<w;)m=m<<6|63&g[p++],v--;1<v?A[y++]=65533:m<65536?A[y++]=m:(m-=65536,A[y++]=55296|m>>10&1023,A[y++]=56320|1023&m)}return A.length!==y&&(A.subarray?A=A.subarray(0,y):A.length=y),r.applyFromCharCode(A)}(f=r.transformTo(a.uint8array?"uint8array":"array",f))},r.inherits(u,l),u.prototype.processChunk=function(f){var g=r.transformTo(a.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var p=g;(g=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),g.set(p,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var y=function(v,w){var A;for((w=w||v.length)>v.length&&(w=v.length),A=w-1;0<=A&&(192&v[A])==128;)A--;return A<0||A===0?w:A+c[v[A]]>w?A:w}(g),m=g;y!==g.length&&(a.uint8array?(m=g.subarray(0,y),this.leftOver=g.subarray(y,g.length)):(m=g.slice(0,y),this.leftOver=g.slice(y,g.length))),this.push({data:i.utf8decode(m),meta:f.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=u,r.inherits(d,l),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,s,i){var r=e("./support"),a=e("./base64"),o=e("./nodejsUtils"),l=e("./external");function c(p){return p}function h(p,y){for(var m=0;m<p.length;++m)y[m]=255&p.charCodeAt(m);return y}e("setimmediate"),i.newBlob=function(p,y){i.checkSupport("blob");try{return new Blob([p],{type:y})}catch{try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return m.append(p),m.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(p,y,m){var v=[],w=0,A=p.length;if(A<=m)return String.fromCharCode.apply(null,p);for(;w<A;)y==="array"||y==="nodebuffer"?v.push(String.fromCharCode.apply(null,p.slice(w,Math.min(w+m,A)))):v.push(String.fromCharCode.apply(null,p.subarray(w,Math.min(w+m,A)))),w+=m;return v.join("")},stringifyByChar:function(p){for(var y="",m=0;m<p.length;m++)y+=String.fromCharCode(p[m]);return y},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var y=65536,m=i.getTypeOf(p),v=!0;if(m==="uint8array"?v=u.applyCanBeUsed.uint8array:m==="nodebuffer"&&(v=u.applyCanBeUsed.nodebuffer),v)for(;1<y;)try{return u.stringifyByChunk(p,m,y)}catch{y=Math.floor(y/2)}return u.stringifyByChar(p)}function f(p,y){for(var m=0;m<p.length;m++)y[m]=p[m];return y}i.applyFromCharCode=d;var g={};g.string={string:c,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return g.string.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:function(p){return h(p,o.allocBuffer(p.length))}},g.array={string:d,array:c,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(p)}},g.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return f(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:c,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(new Uint8Array(p))}},g.uint8array={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:c,nodebuffer:function(p){return o.newBufferFrom(p)}},g.nodebuffer={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return g.nodebuffer.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:c},i.transformTo=function(p,y){if(y=y||"",!p)return y;i.checkSupport(p);var m=i.getTypeOf(y);return g[m][p](y)},i.resolve=function(p){for(var y=p.split("/"),m=[],v=0;v<y.length;v++){var w=y[v];w==="."||w===""&&v!==0&&v!==y.length-1||(w===".."?m.pop():m.push(w))}return m.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":r.nodebuffer&&o.isBuffer(p)?"nodebuffer":r.uint8array&&p instanceof Uint8Array?"uint8array":r.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!r[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var y,m,v="";for(m=0;m<(p||"").length;m++)v+="\\x"+((y=p.charCodeAt(m))<16?"0":"")+y.toString(16).toUpperCase();return v},i.delay=function(p,y,m){setImmediate(function(){p.apply(m||null,y||[])})},i.inherits=function(p,y){function m(){}m.prototype=y.prototype,p.prototype=new m},i.extend=function(){var p,y,m={};for(p=0;p<arguments.length;p++)for(y in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],y)&&m[y]===void 0&&(m[y]=arguments[p][y]);return m},i.prepareContent=function(p,y,m,v,w){return l.Promise.resolve(y).then(function(A){return r.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new l.Promise(function(S,k){var C=new FileReader;C.onload=function(z){S(z.target.result)},C.onerror=function(z){k(z.target.error)},C.readAsArrayBuffer(A)}):A}).then(function(A){var S=i.getTypeOf(A);return S?(S==="arraybuffer"?A=i.transformTo("uint8array",A):S==="string"&&(w?A=a.decode(A):m&&v!==!0&&(A=function(k){return h(k,r.uint8array?new Uint8Array(k.length):new Array(k.length))}(A))),A):l.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,s,i){var r=e("./reader/readerFor"),a=e("./utils"),o=e("./signature"),l=e("./zipEntry"),c=e("./support");function h(u){this.files=[],this.loadOptions=u}h.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(d)+", expected "+a.pretty(u)+")")}},isSignature:function(u,d){var f=this.reader.index;this.reader.setIndex(u);var g=this.reader.readString(4)===d;return this.reader.setIndex(f),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),d=c.uint8array?"uint8array":"array",f=a.transformTo(d,u);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,d,f,g=this.zip64EndOfCentralSize-44;0<g;)u=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[u]={id:u,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,d;for(u=0;u<this.files.length;u++)d=this.files[u],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(u=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var d=u;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var g=d-f;if(0<g)this.isSignature(d,o.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(u){this.reader=r(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,s,i){var r=e("./reader/readerFor"),a=e("./utils"),o=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),h=e("./compressions"),u=e("./support");function d(f,g){this.options=f,this.loadOptions=g}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var g,p;if(f.skip(22),this.fileNameLength=f.readInt(2),p=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(y){for(var m in h)if(Object.prototype.hasOwnProperty.call(h,m)&&h[m].magic===y)return h[m];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,g,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var g=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(g),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=r(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var g,p,y,m=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<m;)g=f.readInt(2),p=f.readInt(2),y=f.readData(p),this.extraFields[g]={id:g,length:p,value:y};f.setIndex(m)},handleUTF8:function(){var f=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var p=a.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var m=a.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(m)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var g=r(f.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:c.utf8decode(g.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var g=r(f.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:c.utf8decode(g.readData(f.length-5))}return null}},s.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,s,i){function r(g,p,y){this.name=g,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=p,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var a=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),h=e("./stream/GenericWorker");r.prototype={internalStream:function(g){var p=null,y="string";try{if(!g)throw new Error("No output type specified.");var m=(y=g.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),p=this._decompressWorker();var v=!this._dataBinary;v&&!m&&(p=p.pipe(new l.Utf8EncodeWorker)),!v&&m&&(p=p.pipe(new l.Utf8DecodeWorker))}catch(w){(p=new h("error")).error(w)}return new a(p,y,"")},async:function(g,p){return this.internalStream(g).accumulate(p)},nodeStream:function(g,p){return this.internalStream(g||"nodebuffer").toNodejsStream(p)},_compressWorker:function(g,p){if(this._data instanceof c&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(y,g,p)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new o(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<u.length;f++)r.prototype[u[f]]=d;s.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,s,i){(function(r){var a,o,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var c=0,h=new l(g),u=r.document.createTextNode("");h.observe(u,{characterData:!0}),a=function(){u.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)a="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var p=r.document.createElement("script");p.onreadystatechange=function(){g(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},r.document.documentElement.appendChild(p)}:function(){setTimeout(g,0)};else{var d=new r.MessageChannel;d.port1.onmessage=g,a=function(){d.port2.postMessage(0)}}var f=[];function g(){var p,y;o=!0;for(var m=f.length;m;){for(y=f,f=[],p=-1;++p<m;)y[p]();m=f.length}o=!1}s.exports=function(p){f.push(p)!==1||o||a()}}).call(this,typeof Ni<"u"?Ni:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,s,i){var r=e("immediate");function a(){}var o={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function u(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,m!==a&&p(this,m)}function d(m,v,w){this.promise=m,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function f(m,v,w){r(function(){var A;try{A=v(w)}catch(S){return o.reject(m,S)}A===m?o.reject(m,new TypeError("Cannot resolve promise with itself")):o.resolve(m,A)})}function g(m){var v=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof v=="function")return function(){v.apply(m,arguments)}}function p(m,v){var w=!1;function A(C){w||(w=!0,o.reject(m,C))}function S(C){w||(w=!0,o.resolve(m,C))}var k=y(function(){v(S,A)});k.status==="error"&&A(k.value)}function y(m,v){var w={};try{w.value=m(v),w.status="success"}catch(A){w.status="error",w.value=A}return w}(s.exports=u).prototype.finally=function(m){if(typeof m!="function")return this;var v=this.constructor;return this.then(function(w){return v.resolve(m()).then(function(){return w})},function(w){return v.resolve(m()).then(function(){throw w})})},u.prototype.catch=function(m){return this.then(null,m)},u.prototype.then=function(m,v){if(typeof m!="function"&&this.state===c||typeof v!="function"&&this.state===l)return this;var w=new this.constructor(a);return this.state!==h?f(w,this.state===c?m:v,this.outcome):this.queue.push(new d(w,m,v)),w},d.prototype.callFulfilled=function(m){o.resolve(this.promise,m)},d.prototype.otherCallFulfilled=function(m){f(this.promise,this.onFulfilled,m)},d.prototype.callRejected=function(m){o.reject(this.promise,m)},d.prototype.otherCallRejected=function(m){f(this.promise,this.onRejected,m)},o.resolve=function(m,v){var w=y(g,v);if(w.status==="error")return o.reject(m,w.value);var A=w.value;if(A)p(m,A);else{m.state=c,m.outcome=v;for(var S=-1,k=m.queue.length;++S<k;)m.queue[S].callFulfilled(v)}return m},o.reject=function(m,v){m.state=l,m.outcome=v;for(var w=-1,A=m.queue.length;++w<A;)m.queue[w].callRejected(v);return m},u.resolve=function(m){return m instanceof this?m:o.resolve(new this(a),m)},u.reject=function(m){var v=new this(a);return o.reject(v,m)},u.all=function(m){var v=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=m.length,A=!1;if(!w)return this.resolve([]);for(var S=new Array(w),k=0,C=-1,z=new this(a);++C<w;)T(m[C],C);return z;function T(V,Z){v.resolve(V).then(function(P){S[Z]=P,++k!==w||A||(A=!0,o.resolve(z,S))},function(P){A||(A=!0,o.reject(z,P))})}},u.race=function(m){var v=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=m.length,A=!1;if(!w)return this.resolve([]);for(var S=-1,k=new this(a);++S<w;)C=m[S],v.resolve(C).then(function(z){A||(A=!0,o.resolve(k,z))},function(z){A||(A=!0,o.reject(k,z))});var C;return k}},{immediate:36}],38:[function(e,s,i){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),s.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,s,i){var r=e("./zlib/deflate"),a=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),h=Object.prototype.toString,u=0,d=-1,f=0,g=8;function p(m){if(!(this instanceof p))return new p(m);this.options=a.assign({level:d,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},m||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var w=r.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(w!==u)throw new Error(l[w]);if(v.header&&r.deflateSetHeader(this.strm,v.header),v.dictionary){var A;if(A=typeof v.dictionary=="string"?o.string2buf(v.dictionary):h.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(w=r.deflateSetDictionary(this.strm,A))!==u)throw new Error(l[w]);this._dict_set=!0}}function y(m,v){var w=new p(v);if(w.push(m,!0),w.err)throw w.msg||l[w.err];return w.result}p.prototype.push=function(m,v){var w,A,S=this.strm,k=this.options.chunkSize;if(this.ended)return!1;A=v===~~v?v:v===!0?4:0,typeof m=="string"?S.input=o.string2buf(m):h.call(m)==="[object ArrayBuffer]"?S.input=new Uint8Array(m):S.input=m,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new a.Buf8(k),S.next_out=0,S.avail_out=k),(w=r.deflate(S,A))!==1&&w!==u)return this.onEnd(w),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(S.output,S.next_out))):this.onData(a.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&w!==1);return A===4?(w=r.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===u):A!==2||(this.onEnd(u),!(S.avail_out=0))},p.prototype.onData=function(m){this.chunks.push(m)},p.prototype.onEnd=function(m){m===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Deflate=p,i.deflate=y,i.deflateRaw=function(m,v){return(v=v||{}).raw=!0,y(m,v)},i.gzip=function(m,v){return(v=v||{}).gzip=!0,y(m,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,s,i){var r=e("./zlib/inflate"),a=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),h=e("./zlib/zstream"),u=e("./zlib/gzheader"),d=Object.prototype.toString;function f(p){if(!(this instanceof f))return new f(p);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},p||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||p&&p.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var m=r.inflateInit2(this.strm,y.windowBits);if(m!==l.Z_OK)throw new Error(c[m]);this.header=new u,r.inflateGetHeader(this.strm,this.header)}function g(p,y){var m=new f(y);if(m.push(p,!0),m.err)throw m.msg||c[m.err];return m.result}f.prototype.push=function(p,y){var m,v,w,A,S,k,C=this.strm,z=this.options.chunkSize,T=this.options.dictionary,V=!1;if(this.ended)return!1;v=y===~~y?y:y===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof p=="string"?C.input=o.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?C.input=new Uint8Array(p):C.input=p,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new a.Buf8(z),C.next_out=0,C.avail_out=z),(m=r.inflate(C,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&T&&(k=typeof T=="string"?o.string2buf(T):d.call(T)==="[object ArrayBuffer]"?new Uint8Array(T):T,m=r.inflateSetDictionary(this.strm,k)),m===l.Z_BUF_ERROR&&V===!0&&(m=l.Z_OK,V=!1),m!==l.Z_STREAM_END&&m!==l.Z_OK)return this.onEnd(m),!(this.ended=!0);C.next_out&&(C.avail_out!==0&&m!==l.Z_STREAM_END&&(C.avail_in!==0||v!==l.Z_FINISH&&v!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=o.utf8border(C.output,C.next_out),A=C.next_out-w,S=o.buf2string(C.output,w),C.next_out=A,C.avail_out=z-A,A&&a.arraySet(C.output,C.output,w,A,0),this.onData(S)):this.onData(a.shrinkBuf(C.output,C.next_out)))),C.avail_in===0&&C.avail_out===0&&(V=!0)}while((0<C.avail_in||C.avail_out===0)&&m!==l.Z_STREAM_END);return m===l.Z_STREAM_END&&(v=l.Z_FINISH),v===l.Z_FINISH?(m=r.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===l.Z_OK):v!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(C.avail_out=0))},f.prototype.onData=function(p){this.chunks.push(p)},f.prototype.onEnd=function(p){p===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=f,i.inflate=g,i.inflateRaw=function(p,y){return(y=y||{}).raw=!0,g(p,y)},i.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,s,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var u in h)h.hasOwnProperty(u)&&(l[u]=h[u])}}return l},i.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var a={arraySet:function(l,c,h,u,d){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+u),d);else for(var f=0;f<u;f++)l[d+f]=c[h+f]},flattenChunks:function(l){var c,h,u,d,f,g;for(c=u=0,h=l.length;c<h;c++)u+=l[c].length;for(g=new Uint8Array(u),c=d=0,h=l.length;c<h;c++)f=l[c],g.set(f,d),d+=f.length;return g}},o={arraySet:function(l,c,h,u,d){for(var f=0;f<u;f++)l[d+f]=c[h+f]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(r)},{}],42:[function(e,s,i){var r=e("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new r.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(u,d){if(d<65537&&(u.subarray&&o||!u.subarray&&a))return String.fromCharCode.apply(null,r.shrinkBuf(u,d));for(var f="",g=0;g<d;g++)f+=String.fromCharCode(u[g]);return f}l[254]=l[254]=1,i.string2buf=function(u){var d,f,g,p,y,m=u.length,v=0;for(p=0;p<m;p++)(64512&(f=u.charCodeAt(p)))==55296&&p+1<m&&(64512&(g=u.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(g-56320),p++),v+=f<128?1:f<2048?2:f<65536?3:4;for(d=new r.Buf8(v),p=y=0;y<v;p++)(64512&(f=u.charCodeAt(p)))==55296&&p+1<m&&(64512&(g=u.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(g-56320),p++),f<128?d[y++]=f:(f<2048?d[y++]=192|f>>>6:(f<65536?d[y++]=224|f>>>12:(d[y++]=240|f>>>18,d[y++]=128|f>>>12&63),d[y++]=128|f>>>6&63),d[y++]=128|63&f);return d},i.buf2binstring=function(u){return h(u,u.length)},i.binstring2buf=function(u){for(var d=new r.Buf8(u.length),f=0,g=d.length;f<g;f++)d[f]=u.charCodeAt(f);return d},i.buf2string=function(u,d){var f,g,p,y,m=d||u.length,v=new Array(2*m);for(f=g=0;f<m;)if((p=u[f++])<128)v[g++]=p;else if(4<(y=l[p]))v[g++]=65533,f+=y-1;else{for(p&=y===2?31:y===3?15:7;1<y&&f<m;)p=p<<6|63&u[f++],y--;1<y?v[g++]=65533:p<65536?v[g++]=p:(p-=65536,v[g++]=55296|p>>10&1023,v[g++]=56320|1023&p)}return h(v,g)},i.utf8border=function(u,d){var f;for((d=d||u.length)>u.length&&(d=u.length),f=d-1;0<=f&&(192&u[f])==128;)f--;return f<0||f===0?d:f+l[u[f]]>d?f:d}},{"./common":41}],43:[function(e,s,i){s.exports=function(r,a,o,l){for(var c=65535&r|0,h=r>>>16&65535|0,u=0;o!==0;){for(o-=u=2e3<o?2e3:o;h=h+(c=c+a[l++]|0)|0,--u;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(e,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,s,i){var r=function(){for(var a,o=[],l=0;l<256;l++){a=l;for(var c=0;c<8;c++)a=1&a?3988292384^a>>>1:a>>>1;o[l]=a}return o}();s.exports=function(a,o,l,c){var h=r,u=c+l;a^=-1;for(var d=c;d<u;d++)a=a>>>8^h[255&(a^o[d])];return-1^a}},{}],46:[function(e,s,i){var r,a=e("../utils/common"),o=e("./trees"),l=e("./adler32"),c=e("./crc32"),h=e("./messages"),u=0,d=4,f=0,g=-2,p=-1,y=4,m=2,v=8,w=9,A=286,S=30,k=19,C=2*A+1,z=15,T=3,V=258,Z=V+T+1,P=42,U=113,_=1,q=2,Y=3,L=4;function et(b,F){return b.msg=h[F],F}function N(b){return(b<<1)-(4<b?9:0)}function W(b){for(var F=b.length;0<=--F;)b[F]=0}function I(b){var F=b.state,O=F.pending;O>b.avail_out&&(O=b.avail_out),O!==0&&(a.arraySet(b.output,F.pending_buf,F.pending_out,O,b.next_out),b.next_out+=O,F.pending_out+=O,b.total_out+=O,b.avail_out-=O,F.pending-=O,F.pending===0&&(F.pending_out=0))}function D(b,F){o._tr_flush_block(b,0<=b.block_start?b.block_start:-1,b.strstart-b.block_start,F),b.block_start=b.strstart,I(b.strm)}function G(b,F){b.pending_buf[b.pending++]=F}function X(b,F){b.pending_buf[b.pending++]=F>>>8&255,b.pending_buf[b.pending++]=255&F}function tt(b,F){var O,x,E=b.max_chain_length,R=b.strstart,H=b.prev_length,j=b.nice_match,B=b.strstart>b.w_size-Z?b.strstart-(b.w_size-Z):0,K=b.window,Q=b.w_mask,J=b.prev,st=b.strstart+V,ut=K[R+H-1],ct=K[R+H];b.prev_length>=b.good_match&&(E>>=2),j>b.lookahead&&(j=b.lookahead);do if(K[(O=F)+H]===ct&&K[O+H-1]===ut&&K[O]===K[R]&&K[++O]===K[R+1]){R+=2,O++;do;while(K[++R]===K[++O]&&K[++R]===K[++O]&&K[++R]===K[++O]&&K[++R]===K[++O]&&K[++R]===K[++O]&&K[++R]===K[++O]&&K[++R]===K[++O]&&K[++R]===K[++O]&&R<st);if(x=V-(st-R),R=st-V,H<x){if(b.match_start=F,j<=(H=x))break;ut=K[R+H-1],ct=K[R+H]}}while((F=J[F&Q])>B&&--E!=0);return H<=b.lookahead?H:b.lookahead}function it(b){var F,O,x,E,R,H,j,B,K,Q,J=b.w_size;do{if(E=b.window_size-b.lookahead-b.strstart,b.strstart>=J+(J-Z)){for(a.arraySet(b.window,b.window,J,J,0),b.match_start-=J,b.strstart-=J,b.block_start-=J,F=O=b.hash_size;x=b.head[--F],b.head[F]=J<=x?x-J:0,--O;);for(F=O=J;x=b.prev[--F],b.prev[F]=J<=x?x-J:0,--O;);E+=J}if(b.strm.avail_in===0)break;if(H=b.strm,j=b.window,B=b.strstart+b.lookahead,K=E,Q=void 0,Q=H.avail_in,K<Q&&(Q=K),O=Q===0?0:(H.avail_in-=Q,a.arraySet(j,H.input,H.next_in,Q,B),H.state.wrap===1?H.adler=l(H.adler,j,Q,B):H.state.wrap===2&&(H.adler=c(H.adler,j,Q,B)),H.next_in+=Q,H.total_in+=Q,Q),b.lookahead+=O,b.lookahead+b.insert>=T)for(R=b.strstart-b.insert,b.ins_h=b.window[R],b.ins_h=(b.ins_h<<b.hash_shift^b.window[R+1])&b.hash_mask;b.insert&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[R+T-1])&b.hash_mask,b.prev[R&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=R,R++,b.insert--,!(b.lookahead+b.insert<T)););}while(b.lookahead<Z&&b.strm.avail_in!==0)}function nt(b,F){for(var O,x;;){if(b.lookahead<Z){if(it(b),b.lookahead<Z&&F===u)return _;if(b.lookahead===0)break}if(O=0,b.lookahead>=T&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+T-1])&b.hash_mask,O=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),O!==0&&b.strstart-O<=b.w_size-Z&&(b.match_length=tt(b,O)),b.match_length>=T)if(x=o._tr_tally(b,b.strstart-b.match_start,b.match_length-T),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&b.lookahead>=T){for(b.match_length--;b.strstart++,b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+T-1])&b.hash_mask,O=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart,--b.match_length!=0;);b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+1])&b.hash_mask;else x=o._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(x&&(D(b,!1),b.strm.avail_out===0))return _}return b.insert=b.strstart<T-1?b.strstart:T-1,F===d?(D(b,!0),b.strm.avail_out===0?Y:L):b.last_lit&&(D(b,!1),b.strm.avail_out===0)?_:q}function rt(b,F){for(var O,x,E;;){if(b.lookahead<Z){if(it(b),b.lookahead<Z&&F===u)return _;if(b.lookahead===0)break}if(O=0,b.lookahead>=T&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+T-1])&b.hash_mask,O=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=T-1,O!==0&&b.prev_length<b.max_lazy_match&&b.strstart-O<=b.w_size-Z&&(b.match_length=tt(b,O),b.match_length<=5&&(b.strategy===1||b.match_length===T&&4096<b.strstart-b.match_start)&&(b.match_length=T-1)),b.prev_length>=T&&b.match_length<=b.prev_length){for(E=b.strstart+b.lookahead-T,x=o._tr_tally(b,b.strstart-1-b.prev_match,b.prev_length-T),b.lookahead-=b.prev_length-1,b.prev_length-=2;++b.strstart<=E&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+T-1])&b.hash_mask,O=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),--b.prev_length!=0;);if(b.match_available=0,b.match_length=T-1,b.strstart++,x&&(D(b,!1),b.strm.avail_out===0))return _}else if(b.match_available){if((x=o._tr_tally(b,0,b.window[b.strstart-1]))&&D(b,!1),b.strstart++,b.lookahead--,b.strm.avail_out===0)return _}else b.match_available=1,b.strstart++,b.lookahead--}return b.match_available&&(x=o._tr_tally(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=b.strstart<T-1?b.strstart:T-1,F===d?(D(b,!0),b.strm.avail_out===0?Y:L):b.last_lit&&(D(b,!1),b.strm.avail_out===0)?_:q}function yt(b,F,O,x,E){this.good_length=b,this.max_lazy=F,this.nice_length=O,this.max_chain=x,this.func=E}function St(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*C),this.dyn_dtree=new a.Buf16(2*(2*S+1)),this.bl_tree=new a.Buf16(2*(2*k+1)),W(this.dyn_ltree),W(this.dyn_dtree),W(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(z+1),this.heap=new a.Buf16(2*A+1),W(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*A+1),W(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Et(b){var F;return b&&b.state?(b.total_in=b.total_out=0,b.data_type=m,(F=b.state).pending=0,F.pending_out=0,F.wrap<0&&(F.wrap=-F.wrap),F.status=F.wrap?P:U,b.adler=F.wrap===2?0:1,F.last_flush=u,o._tr_init(F),f):et(b,g)}function M(b){var F=Et(b);return F===f&&function(O){O.window_size=2*O.w_size,W(O.head),O.max_lazy_match=r[O.level].max_lazy,O.good_match=r[O.level].good_length,O.nice_match=r[O.level].nice_length,O.max_chain_length=r[O.level].max_chain,O.strstart=0,O.block_start=0,O.lookahead=0,O.insert=0,O.match_length=O.prev_length=T-1,O.match_available=0,O.ins_h=0}(b.state),F}function $(b,F,O,x,E,R){if(!b)return g;var H=1;if(F===p&&(F=6),x<0?(H=0,x=-x):15<x&&(H=2,x-=16),E<1||w<E||O!==v||x<8||15<x||F<0||9<F||R<0||y<R)return et(b,g);x===8&&(x=9);var j=new St;return(b.state=j).strm=b,j.wrap=H,j.gzhead=null,j.w_bits=x,j.w_size=1<<j.w_bits,j.w_mask=j.w_size-1,j.hash_bits=E+7,j.hash_size=1<<j.hash_bits,j.hash_mask=j.hash_size-1,j.hash_shift=~~((j.hash_bits+T-1)/T),j.window=new a.Buf8(2*j.w_size),j.head=new a.Buf16(j.hash_size),j.prev=new a.Buf16(j.w_size),j.lit_bufsize=1<<E+6,j.pending_buf_size=4*j.lit_bufsize,j.pending_buf=new a.Buf8(j.pending_buf_size),j.d_buf=1*j.lit_bufsize,j.l_buf=3*j.lit_bufsize,j.level=F,j.strategy=R,j.method=O,M(b)}r=[new yt(0,0,0,0,function(b,F){var O=65535;for(O>b.pending_buf_size-5&&(O=b.pending_buf_size-5);;){if(b.lookahead<=1){if(it(b),b.lookahead===0&&F===u)return _;if(b.lookahead===0)break}b.strstart+=b.lookahead,b.lookahead=0;var x=b.block_start+O;if((b.strstart===0||b.strstart>=x)&&(b.lookahead=b.strstart-x,b.strstart=x,D(b,!1),b.strm.avail_out===0)||b.strstart-b.block_start>=b.w_size-Z&&(D(b,!1),b.strm.avail_out===0))return _}return b.insert=0,F===d?(D(b,!0),b.strm.avail_out===0?Y:L):(b.strstart>b.block_start&&(D(b,!1),b.strm.avail_out),_)}),new yt(4,4,8,4,nt),new yt(4,5,16,8,nt),new yt(4,6,32,32,nt),new yt(4,4,16,16,rt),new yt(8,16,32,32,rt),new yt(8,16,128,128,rt),new yt(8,32,128,256,rt),new yt(32,128,258,1024,rt),new yt(32,258,258,4096,rt)],i.deflateInit=function(b,F){return $(b,F,v,15,8,0)},i.deflateInit2=$,i.deflateReset=M,i.deflateResetKeep=Et,i.deflateSetHeader=function(b,F){return b&&b.state?b.state.wrap!==2?g:(b.state.gzhead=F,f):g},i.deflate=function(b,F){var O,x,E,R;if(!b||!b.state||5<F||F<0)return b?et(b,g):g;if(x=b.state,!b.output||!b.input&&b.avail_in!==0||x.status===666&&F!==d)return et(b,b.avail_out===0?-5:g);if(x.strm=b,O=x.last_flush,x.last_flush=F,x.status===P)if(x.wrap===2)b.adler=0,G(x,31),G(x,139),G(x,8),x.gzhead?(G(x,(x.gzhead.text?1:0)+(x.gzhead.hcrc?2:0)+(x.gzhead.extra?4:0)+(x.gzhead.name?8:0)+(x.gzhead.comment?16:0)),G(x,255&x.gzhead.time),G(x,x.gzhead.time>>8&255),G(x,x.gzhead.time>>16&255),G(x,x.gzhead.time>>24&255),G(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),G(x,255&x.gzhead.os),x.gzhead.extra&&x.gzhead.extra.length&&(G(x,255&x.gzhead.extra.length),G(x,x.gzhead.extra.length>>8&255)),x.gzhead.hcrc&&(b.adler=c(b.adler,x.pending_buf,x.pending,0)),x.gzindex=0,x.status=69):(G(x,0),G(x,0),G(x,0),G(x,0),G(x,0),G(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),G(x,3),x.status=U);else{var H=v+(x.w_bits-8<<4)<<8;H|=(2<=x.strategy||x.level<2?0:x.level<6?1:x.level===6?2:3)<<6,x.strstart!==0&&(H|=32),H+=31-H%31,x.status=U,X(x,H),x.strstart!==0&&(X(x,b.adler>>>16),X(x,65535&b.adler)),b.adler=1}if(x.status===69)if(x.gzhead.extra){for(E=x.pending;x.gzindex<(65535&x.gzhead.extra.length)&&(x.pending!==x.pending_buf_size||(x.gzhead.hcrc&&x.pending>E&&(b.adler=c(b.adler,x.pending_buf,x.pending-E,E)),I(b),E=x.pending,x.pending!==x.pending_buf_size));)G(x,255&x.gzhead.extra[x.gzindex]),x.gzindex++;x.gzhead.hcrc&&x.pending>E&&(b.adler=c(b.adler,x.pending_buf,x.pending-E,E)),x.gzindex===x.gzhead.extra.length&&(x.gzindex=0,x.status=73)}else x.status=73;if(x.status===73)if(x.gzhead.name){E=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>E&&(b.adler=c(b.adler,x.pending_buf,x.pending-E,E)),I(b),E=x.pending,x.pending===x.pending_buf_size)){R=1;break}R=x.gzindex<x.gzhead.name.length?255&x.gzhead.name.charCodeAt(x.gzindex++):0,G(x,R)}while(R!==0);x.gzhead.hcrc&&x.pending>E&&(b.adler=c(b.adler,x.pending_buf,x.pending-E,E)),R===0&&(x.gzindex=0,x.status=91)}else x.status=91;if(x.status===91)if(x.gzhead.comment){E=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>E&&(b.adler=c(b.adler,x.pending_buf,x.pending-E,E)),I(b),E=x.pending,x.pending===x.pending_buf_size)){R=1;break}R=x.gzindex<x.gzhead.comment.length?255&x.gzhead.comment.charCodeAt(x.gzindex++):0,G(x,R)}while(R!==0);x.gzhead.hcrc&&x.pending>E&&(b.adler=c(b.adler,x.pending_buf,x.pending-E,E)),R===0&&(x.status=103)}else x.status=103;if(x.status===103&&(x.gzhead.hcrc?(x.pending+2>x.pending_buf_size&&I(b),x.pending+2<=x.pending_buf_size&&(G(x,255&b.adler),G(x,b.adler>>8&255),b.adler=0,x.status=U)):x.status=U),x.pending!==0){if(I(b),b.avail_out===0)return x.last_flush=-1,f}else if(b.avail_in===0&&N(F)<=N(O)&&F!==d)return et(b,-5);if(x.status===666&&b.avail_in!==0)return et(b,-5);if(b.avail_in!==0||x.lookahead!==0||F!==u&&x.status!==666){var j=x.strategy===2?function(B,K){for(var Q;;){if(B.lookahead===0&&(it(B),B.lookahead===0)){if(K===u)return _;break}if(B.match_length=0,Q=o._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++,Q&&(D(B,!1),B.strm.avail_out===0))return _}return B.insert=0,K===d?(D(B,!0),B.strm.avail_out===0?Y:L):B.last_lit&&(D(B,!1),B.strm.avail_out===0)?_:q}(x,F):x.strategy===3?function(B,K){for(var Q,J,st,ut,ct=B.window;;){if(B.lookahead<=V){if(it(B),B.lookahead<=V&&K===u)return _;if(B.lookahead===0)break}if(B.match_length=0,B.lookahead>=T&&0<B.strstart&&(J=ct[st=B.strstart-1])===ct[++st]&&J===ct[++st]&&J===ct[++st]){ut=B.strstart+V;do;while(J===ct[++st]&&J===ct[++st]&&J===ct[++st]&&J===ct[++st]&&J===ct[++st]&&J===ct[++st]&&J===ct[++st]&&J===ct[++st]&&st<ut);B.match_length=V-(ut-st),B.match_length>B.lookahead&&(B.match_length=B.lookahead)}if(B.match_length>=T?(Q=o._tr_tally(B,1,B.match_length-T),B.lookahead-=B.match_length,B.strstart+=B.match_length,B.match_length=0):(Q=o._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++),Q&&(D(B,!1),B.strm.avail_out===0))return _}return B.insert=0,K===d?(D(B,!0),B.strm.avail_out===0?Y:L):B.last_lit&&(D(B,!1),B.strm.avail_out===0)?_:q}(x,F):r[x.level].func(x,F);if(j!==Y&&j!==L||(x.status=666),j===_||j===Y)return b.avail_out===0&&(x.last_flush=-1),f;if(j===q&&(F===1?o._tr_align(x):F!==5&&(o._tr_stored_block(x,0,0,!1),F===3&&(W(x.head),x.lookahead===0&&(x.strstart=0,x.block_start=0,x.insert=0))),I(b),b.avail_out===0))return x.last_flush=-1,f}return F!==d?f:x.wrap<=0?1:(x.wrap===2?(G(x,255&b.adler),G(x,b.adler>>8&255),G(x,b.adler>>16&255),G(x,b.adler>>24&255),G(x,255&b.total_in),G(x,b.total_in>>8&255),G(x,b.total_in>>16&255),G(x,b.total_in>>24&255)):(X(x,b.adler>>>16),X(x,65535&b.adler)),I(b),0<x.wrap&&(x.wrap=-x.wrap),x.pending!==0?f:1)},i.deflateEnd=function(b){var F;return b&&b.state?(F=b.state.status)!==P&&F!==69&&F!==73&&F!==91&&F!==103&&F!==U&&F!==666?et(b,g):(b.state=null,F===U?et(b,-3):f):g},i.deflateSetDictionary=function(b,F){var O,x,E,R,H,j,B,K,Q=F.length;if(!b||!b.state||(R=(O=b.state).wrap)===2||R===1&&O.status!==P||O.lookahead)return g;for(R===1&&(b.adler=l(b.adler,F,Q,0)),O.wrap=0,Q>=O.w_size&&(R===0&&(W(O.head),O.strstart=0,O.block_start=0,O.insert=0),K=new a.Buf8(O.w_size),a.arraySet(K,F,Q-O.w_size,O.w_size,0),F=K,Q=O.w_size),H=b.avail_in,j=b.next_in,B=b.input,b.avail_in=Q,b.next_in=0,b.input=F,it(O);O.lookahead>=T;){for(x=O.strstart,E=O.lookahead-(T-1);O.ins_h=(O.ins_h<<O.hash_shift^O.window[x+T-1])&O.hash_mask,O.prev[x&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=x,x++,--E;);O.strstart=x,O.lookahead=T-1,it(O)}return O.strstart+=O.lookahead,O.block_start=O.strstart,O.insert=O.lookahead,O.lookahead=0,O.match_length=O.prev_length=T-1,O.match_available=0,b.next_in=j,b.input=B,b.avail_in=H,O.wrap=R,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,s,i){s.exports=function(r,a){var o,l,c,h,u,d,f,g,p,y,m,v,w,A,S,k,C,z,T,V,Z,P,U,_,q;o=r.state,l=r.next_in,_=r.input,c=l+(r.avail_in-5),h=r.next_out,q=r.output,u=h-(a-r.avail_out),d=h+(r.avail_out-257),f=o.dmax,g=o.wsize,p=o.whave,y=o.wnext,m=o.window,v=o.hold,w=o.bits,A=o.lencode,S=o.distcode,k=(1<<o.lenbits)-1,C=(1<<o.distbits)-1;t:do{w<15&&(v+=_[l++]<<w,w+=8,v+=_[l++]<<w,w+=8),z=A[v&k];e:for(;;){if(v>>>=T=z>>>24,w-=T,(T=z>>>16&255)===0)q[h++]=65535&z;else{if(!(16&T)){if(!(64&T)){z=A[(65535&z)+(v&(1<<T)-1)];continue e}if(32&T){o.mode=12;break t}r.msg="invalid literal/length code",o.mode=30;break t}V=65535&z,(T&=15)&&(w<T&&(v+=_[l++]<<w,w+=8),V+=v&(1<<T)-1,v>>>=T,w-=T),w<15&&(v+=_[l++]<<w,w+=8,v+=_[l++]<<w,w+=8),z=S[v&C];s:for(;;){if(v>>>=T=z>>>24,w-=T,!(16&(T=z>>>16&255))){if(!(64&T)){z=S[(65535&z)+(v&(1<<T)-1)];continue s}r.msg="invalid distance code",o.mode=30;break t}if(Z=65535&z,w<(T&=15)&&(v+=_[l++]<<w,(w+=8)<T&&(v+=_[l++]<<w,w+=8)),f<(Z+=v&(1<<T)-1)){r.msg="invalid distance too far back",o.mode=30;break t}if(v>>>=T,w-=T,(T=h-u)<Z){if(p<(T=Z-T)&&o.sane){r.msg="invalid distance too far back",o.mode=30;break t}if(U=m,(P=0)===y){if(P+=g-T,T<V){for(V-=T;q[h++]=m[P++],--T;);P=h-Z,U=q}}else if(y<T){if(P+=g+y-T,(T-=y)<V){for(V-=T;q[h++]=m[P++],--T;);if(P=0,y<V){for(V-=T=y;q[h++]=m[P++],--T;);P=h-Z,U=q}}}else if(P+=y-T,T<V){for(V-=T;q[h++]=m[P++],--T;);P=h-Z,U=q}for(;2<V;)q[h++]=U[P++],q[h++]=U[P++],q[h++]=U[P++],V-=3;V&&(q[h++]=U[P++],1<V&&(q[h++]=U[P++]))}else{for(P=h-Z;q[h++]=q[P++],q[h++]=q[P++],q[h++]=q[P++],2<(V-=3););V&&(q[h++]=q[P++],1<V&&(q[h++]=q[P++]))}break}}break}}while(l<c&&h<d);l-=V=w>>3,v&=(1<<(w-=V<<3))-1,r.next_in=l,r.next_out=h,r.avail_in=l<c?c-l+5:5-(l-c),r.avail_out=h<d?d-h+257:257-(h-d),o.hold=v,o.bits=w}},{}],49:[function(e,s,i){var r=e("../utils/common"),a=e("./adler32"),o=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),h=1,u=2,d=0,f=-2,g=1,p=852,y=592;function m(P){return(P>>>24&255)+(P>>>8&65280)+((65280&P)<<8)+((255&P)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(P){var U;return P&&P.state?(U=P.state,P.total_in=P.total_out=U.total=0,P.msg="",U.wrap&&(P.adler=1&U.wrap),U.mode=g,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new r.Buf32(p),U.distcode=U.distdyn=new r.Buf32(y),U.sane=1,U.back=-1,d):f}function A(P){var U;return P&&P.state?((U=P.state).wsize=0,U.whave=0,U.wnext=0,w(P)):f}function S(P,U){var _,q;return P&&P.state?(q=P.state,U<0?(_=0,U=-U):(_=1+(U>>4),U<48&&(U&=15)),U&&(U<8||15<U)?f:(q.window!==null&&q.wbits!==U&&(q.window=null),q.wrap=_,q.wbits=U,A(P))):f}function k(P,U){var _,q;return P?(q=new v,(P.state=q).window=null,(_=S(P,U))!==d&&(P.state=null),_):f}var C,z,T=!0;function V(P){if(T){var U;for(C=new r.Buf32(512),z=new r.Buf32(32),U=0;U<144;)P.lens[U++]=8;for(;U<256;)P.lens[U++]=9;for(;U<280;)P.lens[U++]=7;for(;U<288;)P.lens[U++]=8;for(c(h,P.lens,0,288,C,0,P.work,{bits:9}),U=0;U<32;)P.lens[U++]=5;c(u,P.lens,0,32,z,0,P.work,{bits:5}),T=!1}P.lencode=C,P.lenbits=9,P.distcode=z,P.distbits=5}function Z(P,U,_,q){var Y,L=P.state;return L.window===null&&(L.wsize=1<<L.wbits,L.wnext=0,L.whave=0,L.window=new r.Buf8(L.wsize)),q>=L.wsize?(r.arraySet(L.window,U,_-L.wsize,L.wsize,0),L.wnext=0,L.whave=L.wsize):(q<(Y=L.wsize-L.wnext)&&(Y=q),r.arraySet(L.window,U,_-q,Y,L.wnext),(q-=Y)?(r.arraySet(L.window,U,_-q,q,0),L.wnext=q,L.whave=L.wsize):(L.wnext+=Y,L.wnext===L.wsize&&(L.wnext=0),L.whave<L.wsize&&(L.whave+=Y))),0}i.inflateReset=A,i.inflateReset2=S,i.inflateResetKeep=w,i.inflateInit=function(P){return k(P,15)},i.inflateInit2=k,i.inflate=function(P,U){var _,q,Y,L,et,N,W,I,D,G,X,tt,it,nt,rt,yt,St,Et,M,$,b,F,O,x,E=0,R=new r.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!P||!P.state||!P.output||!P.input&&P.avail_in!==0)return f;(_=P.state).mode===12&&(_.mode=13),et=P.next_out,Y=P.output,W=P.avail_out,L=P.next_in,q=P.input,N=P.avail_in,I=_.hold,D=_.bits,G=N,X=W,F=d;t:for(;;)switch(_.mode){case g:if(_.wrap===0){_.mode=13;break}for(;D<16;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}if(2&_.wrap&&I===35615){R[_.check=0]=255&I,R[1]=I>>>8&255,_.check=o(_.check,R,2,0),D=I=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&I)<<8)+(I>>8))%31){P.msg="incorrect header check",_.mode=30;break}if((15&I)!=8){P.msg="unknown compression method",_.mode=30;break}if(D-=4,b=8+(15&(I>>>=4)),_.wbits===0)_.wbits=b;else if(b>_.wbits){P.msg="invalid window size",_.mode=30;break}_.dmax=1<<b,P.adler=_.check=1,_.mode=512&I?10:12,D=I=0;break;case 2:for(;D<16;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}if(_.flags=I,(255&_.flags)!=8){P.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){P.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=I>>8&1),512&_.flags&&(R[0]=255&I,R[1]=I>>>8&255,_.check=o(_.check,R,2,0)),D=I=0,_.mode=3;case 3:for(;D<32;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}_.head&&(_.head.time=I),512&_.flags&&(R[0]=255&I,R[1]=I>>>8&255,R[2]=I>>>16&255,R[3]=I>>>24&255,_.check=o(_.check,R,4,0)),D=I=0,_.mode=4;case 4:for(;D<16;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}_.head&&(_.head.xflags=255&I,_.head.os=I>>8),512&_.flags&&(R[0]=255&I,R[1]=I>>>8&255,_.check=o(_.check,R,2,0)),D=I=0,_.mode=5;case 5:if(1024&_.flags){for(;D<16;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}_.length=I,_.head&&(_.head.extra_len=I),512&_.flags&&(R[0]=255&I,R[1]=I>>>8&255,_.check=o(_.check,R,2,0)),D=I=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(N<(tt=_.length)&&(tt=N),tt&&(_.head&&(b=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),r.arraySet(_.head.extra,q,L,tt,b)),512&_.flags&&(_.check=o(_.check,q,tt,L)),N-=tt,L+=tt,_.length-=tt),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(N===0)break t;for(tt=0;b=q[L+tt++],_.head&&b&&_.length<65536&&(_.head.name+=String.fromCharCode(b)),b&&tt<N;);if(512&_.flags&&(_.check=o(_.check,q,tt,L)),N-=tt,L+=tt,b)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(N===0)break t;for(tt=0;b=q[L+tt++],_.head&&b&&_.length<65536&&(_.head.comment+=String.fromCharCode(b)),b&&tt<N;);if(512&_.flags&&(_.check=o(_.check,q,tt,L)),N-=tt,L+=tt,b)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;D<16;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}if(I!==(65535&_.check)){P.msg="header crc mismatch",_.mode=30;break}D=I=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),P.adler=_.check=0,_.mode=12;break;case 10:for(;D<32;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}P.adler=_.check=m(I),D=I=0,_.mode=11;case 11:if(_.havedict===0)return P.next_out=et,P.avail_out=W,P.next_in=L,P.avail_in=N,_.hold=I,_.bits=D,2;P.adler=_.check=1,_.mode=12;case 12:if(U===5||U===6)break t;case 13:if(_.last){I>>>=7&D,D-=7&D,_.mode=27;break}for(;D<3;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}switch(_.last=1&I,D-=1,3&(I>>>=1)){case 0:_.mode=14;break;case 1:if(V(_),_.mode=20,U!==6)break;I>>>=2,D-=2;break t;case 2:_.mode=17;break;case 3:P.msg="invalid block type",_.mode=30}I>>>=2,D-=2;break;case 14:for(I>>>=7&D,D-=7&D;D<32;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}if((65535&I)!=(I>>>16^65535)){P.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&I,D=I=0,_.mode=15,U===6)break t;case 15:_.mode=16;case 16:if(tt=_.length){if(N<tt&&(tt=N),W<tt&&(tt=W),tt===0)break t;r.arraySet(Y,q,L,tt,et),N-=tt,L+=tt,W-=tt,et+=tt,_.length-=tt;break}_.mode=12;break;case 17:for(;D<14;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}if(_.nlen=257+(31&I),I>>>=5,D-=5,_.ndist=1+(31&I),I>>>=5,D-=5,_.ncode=4+(15&I),I>>>=4,D-=4,286<_.nlen||30<_.ndist){P.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;D<3;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}_.lens[H[_.have++]]=7&I,I>>>=3,D-=3}for(;_.have<19;)_.lens[H[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,O={bits:_.lenbits},F=c(0,_.lens,0,19,_.lencode,0,_.work,O),_.lenbits=O.bits,F){P.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;yt=(E=_.lencode[I&(1<<_.lenbits)-1])>>>16&255,St=65535&E,!((rt=E>>>24)<=D);){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}if(St<16)I>>>=rt,D-=rt,_.lens[_.have++]=St;else{if(St===16){for(x=rt+2;D<x;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}if(I>>>=rt,D-=rt,_.have===0){P.msg="invalid bit length repeat",_.mode=30;break}b=_.lens[_.have-1],tt=3+(3&I),I>>>=2,D-=2}else if(St===17){for(x=rt+3;D<x;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}D-=rt,b=0,tt=3+(7&(I>>>=rt)),I>>>=3,D-=3}else{for(x=rt+7;D<x;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}D-=rt,b=0,tt=11+(127&(I>>>=rt)),I>>>=7,D-=7}if(_.have+tt>_.nlen+_.ndist){P.msg="invalid bit length repeat",_.mode=30;break}for(;tt--;)_.lens[_.have++]=b}}if(_.mode===30)break;if(_.lens[256]===0){P.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,O={bits:_.lenbits},F=c(h,_.lens,0,_.nlen,_.lencode,0,_.work,O),_.lenbits=O.bits,F){P.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,O={bits:_.distbits},F=c(u,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,O),_.distbits=O.bits,F){P.msg="invalid distances set",_.mode=30;break}if(_.mode=20,U===6)break t;case 20:_.mode=21;case 21:if(6<=N&&258<=W){P.next_out=et,P.avail_out=W,P.next_in=L,P.avail_in=N,_.hold=I,_.bits=D,l(P,X),et=P.next_out,Y=P.output,W=P.avail_out,L=P.next_in,q=P.input,N=P.avail_in,I=_.hold,D=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;yt=(E=_.lencode[I&(1<<_.lenbits)-1])>>>16&255,St=65535&E,!((rt=E>>>24)<=D);){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}if(yt&&!(240&yt)){for(Et=rt,M=yt,$=St;yt=(E=_.lencode[$+((I&(1<<Et+M)-1)>>Et)])>>>16&255,St=65535&E,!(Et+(rt=E>>>24)<=D);){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}I>>>=Et,D-=Et,_.back+=Et}if(I>>>=rt,D-=rt,_.back+=rt,_.length=St,yt===0){_.mode=26;break}if(32&yt){_.back=-1,_.mode=12;break}if(64&yt){P.msg="invalid literal/length code",_.mode=30;break}_.extra=15&yt,_.mode=22;case 22:if(_.extra){for(x=_.extra;D<x;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}_.length+=I&(1<<_.extra)-1,I>>>=_.extra,D-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;yt=(E=_.distcode[I&(1<<_.distbits)-1])>>>16&255,St=65535&E,!((rt=E>>>24)<=D);){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}if(!(240&yt)){for(Et=rt,M=yt,$=St;yt=(E=_.distcode[$+((I&(1<<Et+M)-1)>>Et)])>>>16&255,St=65535&E,!(Et+(rt=E>>>24)<=D);){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}I>>>=Et,D-=Et,_.back+=Et}if(I>>>=rt,D-=rt,_.back+=rt,64&yt){P.msg="invalid distance code",_.mode=30;break}_.offset=St,_.extra=15&yt,_.mode=24;case 24:if(_.extra){for(x=_.extra;D<x;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}_.offset+=I&(1<<_.extra)-1,I>>>=_.extra,D-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){P.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(W===0)break t;if(tt=X-W,_.offset>tt){if((tt=_.offset-tt)>_.whave&&_.sane){P.msg="invalid distance too far back",_.mode=30;break}it=tt>_.wnext?(tt-=_.wnext,_.wsize-tt):_.wnext-tt,tt>_.length&&(tt=_.length),nt=_.window}else nt=Y,it=et-_.offset,tt=_.length;for(W<tt&&(tt=W),W-=tt,_.length-=tt;Y[et++]=nt[it++],--tt;);_.length===0&&(_.mode=21);break;case 26:if(W===0)break t;Y[et++]=_.length,W--,_.mode=21;break;case 27:if(_.wrap){for(;D<32;){if(N===0)break t;N--,I|=q[L++]<<D,D+=8}if(X-=W,P.total_out+=X,_.total+=X,X&&(P.adler=_.check=_.flags?o(_.check,Y,X,et-X):a(_.check,Y,X,et-X)),X=W,(_.flags?I:m(I))!==_.check){P.msg="incorrect data check",_.mode=30;break}D=I=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;D<32;){if(N===0)break t;N--,I+=q[L++]<<D,D+=8}if(I!==(4294967295&_.total)){P.msg="incorrect length check",_.mode=30;break}D=I=0}_.mode=29;case 29:F=1;break t;case 30:F=-3;break t;case 31:return-4;case 32:default:return f}return P.next_out=et,P.avail_out=W,P.next_in=L,P.avail_in=N,_.hold=I,_.bits=D,(_.wsize||X!==P.avail_out&&_.mode<30&&(_.mode<27||U!==4))&&Z(P,P.output,P.next_out,X-P.avail_out)?(_.mode=31,-4):(G-=P.avail_in,X-=P.avail_out,P.total_in+=G,P.total_out+=X,_.total+=X,_.wrap&&X&&(P.adler=_.check=_.flags?o(_.check,Y,X,P.next_out-X):a(_.check,Y,X,P.next_out-X)),P.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(G==0&&X===0||U===4)&&F===d&&(F=-5),F)},i.inflateEnd=function(P){if(!P||!P.state)return f;var U=P.state;return U.window&&(U.window=null),P.state=null,d},i.inflateGetHeader=function(P,U){var _;return P&&P.state&&2&(_=P.state).wrap?((_.head=U).done=!1,d):f},i.inflateSetDictionary=function(P,U){var _,q=U.length;return P&&P.state?(_=P.state).wrap!==0&&_.mode!==11?f:_.mode===11&&a(1,U,q,0)!==_.check?-3:Z(P,U,q,q)?(_.mode=31,-4):(_.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,s,i){var r=e("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(h,u,d,f,g,p,y,m){var v,w,A,S,k,C,z,T,V,Z=m.bits,P=0,U=0,_=0,q=0,Y=0,L=0,et=0,N=0,W=0,I=0,D=null,G=0,X=new r.Buf16(16),tt=new r.Buf16(16),it=null,nt=0;for(P=0;P<=15;P++)X[P]=0;for(U=0;U<f;U++)X[u[d+U]]++;for(Y=Z,q=15;1<=q&&X[q]===0;q--);if(q<Y&&(Y=q),q===0)return g[p++]=20971520,g[p++]=20971520,m.bits=1,0;for(_=1;_<q&&X[_]===0;_++);for(Y<_&&(Y=_),P=N=1;P<=15;P++)if(N<<=1,(N-=X[P])<0)return-1;if(0<N&&(h===0||q!==1))return-1;for(tt[1]=0,P=1;P<15;P++)tt[P+1]=tt[P]+X[P];for(U=0;U<f;U++)u[d+U]!==0&&(y[tt[u[d+U]]++]=U);if(C=h===0?(D=it=y,19):h===1?(D=a,G-=257,it=o,nt-=257,256):(D=l,it=c,-1),P=_,k=p,et=U=I=0,A=-1,S=(W=1<<(L=Y))-1,h===1&&852<W||h===2&&592<W)return 1;for(;;){for(z=P-et,V=y[U]<C?(T=0,y[U]):y[U]>C?(T=it[nt+y[U]],D[G+y[U]]):(T=96,0),v=1<<P-et,_=w=1<<L;g[k+(I>>et)+(w-=v)]=z<<24|T<<16|V|0,w!==0;);for(v=1<<P-1;I&v;)v>>=1;if(v!==0?(I&=v-1,I+=v):I=0,U++,--X[P]==0){if(P===q)break;P=u[d+y[U]]}if(Y<P&&(I&S)!==A){for(et===0&&(et=Y),k+=_,N=1<<(L=P-et);L+et<q&&!((N-=X[L+et])<=0);)L++,N<<=1;if(W+=1<<L,h===1&&852<W||h===2&&592<W)return 1;g[A=I&S]=Y<<24|L<<16|k-p|0}}return I!==0&&(g[k+I]=P-et<<24|64<<16|0),m.bits=Y,0}},{"../utils/common":41}],51:[function(e,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,s,i){var r=e("../utils/common"),a=0,o=1;function l(E){for(var R=E.length;0<=--R;)E[R]=0}var c=0,h=29,u=256,d=u+1+h,f=30,g=19,p=2*d+1,y=15,m=16,v=7,w=256,A=16,S=17,k=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=new Array(2*(d+2));l(Z);var P=new Array(2*f);l(P);var U=new Array(512);l(U);var _=new Array(256);l(_);var q=new Array(h);l(q);var Y,L,et,N=new Array(f);function W(E,R,H,j,B){this.static_tree=E,this.extra_bits=R,this.extra_base=H,this.elems=j,this.max_length=B,this.has_stree=E&&E.length}function I(E,R){this.dyn_tree=E,this.max_code=0,this.stat_desc=R}function D(E){return E<256?U[E]:U[256+(E>>>7)]}function G(E,R){E.pending_buf[E.pending++]=255&R,E.pending_buf[E.pending++]=R>>>8&255}function X(E,R,H){E.bi_valid>m-H?(E.bi_buf|=R<<E.bi_valid&65535,G(E,E.bi_buf),E.bi_buf=R>>m-E.bi_valid,E.bi_valid+=H-m):(E.bi_buf|=R<<E.bi_valid&65535,E.bi_valid+=H)}function tt(E,R,H){X(E,H[2*R],H[2*R+1])}function it(E,R){for(var H=0;H|=1&E,E>>>=1,H<<=1,0<--R;);return H>>>1}function nt(E,R,H){var j,B,K=new Array(y+1),Q=0;for(j=1;j<=y;j++)K[j]=Q=Q+H[j-1]<<1;for(B=0;B<=R;B++){var J=E[2*B+1];J!==0&&(E[2*B]=it(K[J]++,J))}}function rt(E){var R;for(R=0;R<d;R++)E.dyn_ltree[2*R]=0;for(R=0;R<f;R++)E.dyn_dtree[2*R]=0;for(R=0;R<g;R++)E.bl_tree[2*R]=0;E.dyn_ltree[2*w]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0}function yt(E){8<E.bi_valid?G(E,E.bi_buf):0<E.bi_valid&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0}function St(E,R,H,j){var B=2*R,K=2*H;return E[B]<E[K]||E[B]===E[K]&&j[R]<=j[H]}function Et(E,R,H){for(var j=E.heap[H],B=H<<1;B<=E.heap_len&&(B<E.heap_len&&St(R,E.heap[B+1],E.heap[B],E.depth)&&B++,!St(R,j,E.heap[B],E.depth));)E.heap[H]=E.heap[B],H=B,B<<=1;E.heap[H]=j}function M(E,R,H){var j,B,K,Q,J=0;if(E.last_lit!==0)for(;j=E.pending_buf[E.d_buf+2*J]<<8|E.pending_buf[E.d_buf+2*J+1],B=E.pending_buf[E.l_buf+J],J++,j===0?tt(E,B,R):(tt(E,(K=_[B])+u+1,R),(Q=C[K])!==0&&X(E,B-=q[K],Q),tt(E,K=D(--j),H),(Q=z[K])!==0&&X(E,j-=N[K],Q)),J<E.last_lit;);tt(E,w,R)}function $(E,R){var H,j,B,K=R.dyn_tree,Q=R.stat_desc.static_tree,J=R.stat_desc.has_stree,st=R.stat_desc.elems,ut=-1;for(E.heap_len=0,E.heap_max=p,H=0;H<st;H++)K[2*H]!==0?(E.heap[++E.heap_len]=ut=H,E.depth[H]=0):K[2*H+1]=0;for(;E.heap_len<2;)K[2*(B=E.heap[++E.heap_len]=ut<2?++ut:0)]=1,E.depth[B]=0,E.opt_len--,J&&(E.static_len-=Q[2*B+1]);for(R.max_code=ut,H=E.heap_len>>1;1<=H;H--)Et(E,K,H);for(B=st;H=E.heap[1],E.heap[1]=E.heap[E.heap_len--],Et(E,K,1),j=E.heap[1],E.heap[--E.heap_max]=H,E.heap[--E.heap_max]=j,K[2*B]=K[2*H]+K[2*j],E.depth[B]=(E.depth[H]>=E.depth[j]?E.depth[H]:E.depth[j])+1,K[2*H+1]=K[2*j+1]=B,E.heap[1]=B++,Et(E,K,1),2<=E.heap_len;);E.heap[--E.heap_max]=E.heap[1],function(ct,Tt){var $t,Bt,te,Pt,Os,Qt,Ht=Tt.dyn_tree,En=Tt.max_code,Ti=Tt.stat_desc.static_tree,ju=Tt.stat_desc.has_stree,$u=Tt.stat_desc.extra_bits,cl=Tt.stat_desc.extra_base,Cn=Tt.stat_desc.max_length,Pi=0;for(Pt=0;Pt<=y;Pt++)ct.bl_count[Pt]=0;for(Ht[2*ct.heap[ct.heap_max]+1]=0,$t=ct.heap_max+1;$t<p;$t++)Cn<(Pt=Ht[2*Ht[2*(Bt=ct.heap[$t])+1]+1]+1)&&(Pt=Cn,Pi++),Ht[2*Bt+1]=Pt,En<Bt||(ct.bl_count[Pt]++,Os=0,cl<=Bt&&(Os=$u[Bt-cl]),Qt=Ht[2*Bt],ct.opt_len+=Qt*(Pt+Os),ju&&(ct.static_len+=Qt*(Ti[2*Bt+1]+Os)));if(Pi!==0){do{for(Pt=Cn-1;ct.bl_count[Pt]===0;)Pt--;ct.bl_count[Pt]--,ct.bl_count[Pt+1]+=2,ct.bl_count[Cn]--,Pi-=2}while(0<Pi);for(Pt=Cn;Pt!==0;Pt--)for(Bt=ct.bl_count[Pt];Bt!==0;)En<(te=ct.heap[--$t])||(Ht[2*te+1]!==Pt&&(ct.opt_len+=(Pt-Ht[2*te+1])*Ht[2*te],Ht[2*te+1]=Pt),Bt--)}}(E,R),nt(K,ut,E.bl_count)}function b(E,R,H){var j,B,K=-1,Q=R[1],J=0,st=7,ut=4;for(Q===0&&(st=138,ut=3),R[2*(H+1)+1]=65535,j=0;j<=H;j++)B=Q,Q=R[2*(j+1)+1],++J<st&&B===Q||(J<ut?E.bl_tree[2*B]+=J:B!==0?(B!==K&&E.bl_tree[2*B]++,E.bl_tree[2*A]++):J<=10?E.bl_tree[2*S]++:E.bl_tree[2*k]++,K=B,ut=(J=0)===Q?(st=138,3):B===Q?(st=6,3):(st=7,4))}function F(E,R,H){var j,B,K=-1,Q=R[1],J=0,st=7,ut=4;for(Q===0&&(st=138,ut=3),j=0;j<=H;j++)if(B=Q,Q=R[2*(j+1)+1],!(++J<st&&B===Q)){if(J<ut)for(;tt(E,B,E.bl_tree),--J!=0;);else B!==0?(B!==K&&(tt(E,B,E.bl_tree),J--),tt(E,A,E.bl_tree),X(E,J-3,2)):J<=10?(tt(E,S,E.bl_tree),X(E,J-3,3)):(tt(E,k,E.bl_tree),X(E,J-11,7));K=B,ut=(J=0)===Q?(st=138,3):B===Q?(st=6,3):(st=7,4)}}l(N);var O=!1;function x(E,R,H,j){X(E,(c<<1)+(j?1:0),3),function(B,K,Q,J){yt(B),G(B,Q),G(B,~Q),r.arraySet(B.pending_buf,B.window,K,Q,B.pending),B.pending+=Q}(E,R,H)}i._tr_init=function(E){O||(function(){var R,H,j,B,K,Q=new Array(y+1);for(B=j=0;B<h-1;B++)for(q[B]=j,R=0;R<1<<C[B];R++)_[j++]=B;for(_[j-1]=B,B=K=0;B<16;B++)for(N[B]=K,R=0;R<1<<z[B];R++)U[K++]=B;for(K>>=7;B<f;B++)for(N[B]=K<<7,R=0;R<1<<z[B]-7;R++)U[256+K++]=B;for(H=0;H<=y;H++)Q[H]=0;for(R=0;R<=143;)Z[2*R+1]=8,R++,Q[8]++;for(;R<=255;)Z[2*R+1]=9,R++,Q[9]++;for(;R<=279;)Z[2*R+1]=7,R++,Q[7]++;for(;R<=287;)Z[2*R+1]=8,R++,Q[8]++;for(nt(Z,d+1,Q),R=0;R<f;R++)P[2*R+1]=5,P[2*R]=it(R,5);Y=new W(Z,C,u+1,d,y),L=new W(P,z,0,f,y),et=new W(new Array(0),T,0,g,v)}(),O=!0),E.l_desc=new I(E.dyn_ltree,Y),E.d_desc=new I(E.dyn_dtree,L),E.bl_desc=new I(E.bl_tree,et),E.bi_buf=0,E.bi_valid=0,rt(E)},i._tr_stored_block=x,i._tr_flush_block=function(E,R,H,j){var B,K,Q=0;0<E.level?(E.strm.data_type===2&&(E.strm.data_type=function(J){var st,ut=4093624447;for(st=0;st<=31;st++,ut>>>=1)if(1&ut&&J.dyn_ltree[2*st]!==0)return a;if(J.dyn_ltree[18]!==0||J.dyn_ltree[20]!==0||J.dyn_ltree[26]!==0)return o;for(st=32;st<u;st++)if(J.dyn_ltree[2*st]!==0)return o;return a}(E)),$(E,E.l_desc),$(E,E.d_desc),Q=function(J){var st;for(b(J,J.dyn_ltree,J.l_desc.max_code),b(J,J.dyn_dtree,J.d_desc.max_code),$(J,J.bl_desc),st=g-1;3<=st&&J.bl_tree[2*V[st]+1]===0;st--);return J.opt_len+=3*(st+1)+5+5+4,st}(E),B=E.opt_len+3+7>>>3,(K=E.static_len+3+7>>>3)<=B&&(B=K)):B=K=H+5,H+4<=B&&R!==-1?x(E,R,H,j):E.strategy===4||K===B?(X(E,2+(j?1:0),3),M(E,Z,P)):(X(E,4+(j?1:0),3),function(J,st,ut,ct){var Tt;for(X(J,st-257,5),X(J,ut-1,5),X(J,ct-4,4),Tt=0;Tt<ct;Tt++)X(J,J.bl_tree[2*V[Tt]+1],3);F(J,J.dyn_ltree,st-1),F(J,J.dyn_dtree,ut-1)}(E,E.l_desc.max_code+1,E.d_desc.max_code+1,Q+1),M(E,E.dyn_ltree,E.dyn_dtree)),rt(E),j&&yt(E)},i._tr_tally=function(E,R,H){return E.pending_buf[E.d_buf+2*E.last_lit]=R>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&R,E.pending_buf[E.l_buf+E.last_lit]=255&H,E.last_lit++,R===0?E.dyn_ltree[2*H]++:(E.matches++,R--,E.dyn_ltree[2*(_[H]+u+1)]++,E.dyn_dtree[2*D(R)]++),E.last_lit===E.lit_bufsize-1},i._tr_align=function(E){X(E,2,3),tt(E,w,Z),function(R){R.bi_valid===16?(G(R,R.bi_buf),R.bi_buf=0,R.bi_valid=0):8<=R.bi_valid&&(R.pending_buf[R.pending++]=255&R.bi_buf,R.bi_buf>>=8,R.bi_valid-=8)}(E)}},{"../utils/common":41}],53:[function(e,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,s,i){(function(r){(function(a,o){if(!a.setImmediate){var l,c,h,u,d=1,f={},g=!1,p=a.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(a);y=y&&y.setTimeout?y:a,l={}.toString.call(a.process)==="[object process]"?function(A){process.nextTick(function(){v(A)})}:function(){if(a.postMessage&&!a.importScripts){var A=!0,S=a.onmessage;return a.onmessage=function(){A=!1},a.postMessage("","*"),a.onmessage=S,A}}()?(u="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",w,!1):a.attachEvent("onmessage",w),function(A){a.postMessage(u+A,"*")}):a.MessageChannel?((h=new MessageChannel).port1.onmessage=function(A){v(A.data)},function(A){h.port2.postMessage(A)}):p&&"onreadystatechange"in p.createElement("script")?(c=p.documentElement,function(A){var S=p.createElement("script");S.onreadystatechange=function(){v(A),S.onreadystatechange=null,c.removeChild(S),S=null},c.appendChild(S)}):function(A){setTimeout(v,0,A)},y.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var S=new Array(arguments.length-1),k=0;k<S.length;k++)S[k]=arguments[k+1];var C={callback:A,args:S};return f[d]=C,l(d),d++},y.clearImmediate=m}function m(A){delete f[A]}function v(A){if(g)setTimeout(v,0,A);else{var S=f[A];if(S){g=!0;try{(function(k){var C=k.callback,z=k.args;switch(z.length){case 0:C();break;case 1:C(z[0]);break;case 2:C(z[0],z[1]);break;case 3:C(z[0],z[1],z[2]);break;default:C.apply(o,z)}})(S)}finally{m(A),g=!1}}}}function w(A){A.source===a&&typeof A.data=="string"&&A.data.indexOf(u)===0&&v(+A.data.slice(u.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof Ni<"u"?Ni:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(zu);var nv=zu.exports;const iv=db(nv),Ue=new Ks("pdf2md");Ue.version(1).stores({projects:"++id, name, createdAt",regions:"++id, projectId, page, type, name"});function rv(){async function n(a){const{meta:o,regions:l,pdfData:c}=a;let h=o.id;h?(await Ue.projects.update(h,{name:o.name,updatedAt:new Date().toISOString()}),await Ue.regions.where("projectId").equals(h).delete()):h=await Ue.projects.add({name:o.name,filename:o.filename,pdfData:c,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});for(const u of l)await Ue.regions.add({projectId:h,...u});return h}async function t(){const a=await Ue.projects.toArray();if(a.length===0)return null;const o=await e(a);if(!o)return null;const l=await Ue.regions.where("projectId").equals(o.id).toArray();return{meta:{id:o.id,name:o.name,filename:o.filename},pdfData:o.pdfData,regions:l}}function e(a){return new Promise(o=>{const l=document.createElement("div");l.className="project-modal",l.innerHTML=`
        <div class="project-modal-content">
          <h3> </h3>
          <ul class="project-list">
            ${a.map(h=>`
              <li data-id="${h.id}">
                <span class="project-name">${h.name}</span>
                <span class="project-date">${new Date(h.createdAt).toLocaleDateString()}</span>
              </li>
            `).join("")}
          </ul>
          <button class="cancel-btn"></button>
        </div>
      `;const c=document.createElement("style");c.textContent=`
        .project-modal {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0,0,0,0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1000;
        }
        .project-modal-content {
          background: white;
          padding: 20px;
          border-radius: 8px;
          min-width: 300px;
          max-width: 500px;
        }
        .project-modal-content h3 {
          margin: 0 0 16px;
        }
        .project-list {
          list-style: none;
          padding: 0;
          margin: 0 0 16px;
          max-height: 300px;
          overflow-y: auto;
        }
        .project-list li {
          padding: 12px;
          border: 1px solid #ddd;
          border-radius: 4px;
          margin-bottom: 8px;
          cursor: pointer;
          display: flex;
          justify-content: space-between;
        }
        .project-list li:hover {
          background: #f5f5f5;
        }
        .project-name {
          font-weight: 500;
        }
        .project-date {
          color: #888;
          font-size: 12px;
        }
        .cancel-btn {
          width: 100%;
          padding: 10px;
          border: 1px solid #ddd;
          border-radius: 4px;
          background: #fff;
          cursor: pointer;
        }
      `,document.head.appendChild(c),document.body.appendChild(l),l.querySelectorAll(".project-list li").forEach(h=>{h.addEventListener("click",()=>{const u=parseInt(h.dataset.id),d=a.find(f=>f.id===u);document.body.removeChild(l),document.head.removeChild(c),o(d)})}),l.querySelector(".cancel-btn").addEventListener("click",()=>{document.body.removeChild(l),document.head.removeChild(c),o(null)})})}async function s(a){const{meta:o,regions:l,markdown:c}=a,h=new iv;h.file("output.md",c||"");const u=h.folder("images");for(const p of l)if(p.imageData&&p.filename){const y=p.imageData.split(",")[1];u.file(p.filename,y,{base64:!0})}h.file("project.json",JSON.stringify({name:o.name,regions:l.map(p=>({page:p.page,type:p.type,name:p.name,caption:p.caption,filename:p.filename,x:p.x,y:p.y,width:p.width,height:p.height}))},null,2));const d=await h.generateAsync({type:"blob"}),f=URL.createObjectURL(d),g=document.createElement("a");g.href=f,g.download=`${o.name||"project"}.zip`,g.click(),URL.revokeObjectURL(f)}async function i(a){await Ue.regions.where("projectId").equals(a).delete(),await Ue.projects.delete(a)}async function r(){return await Ue.projects.toArray()}return{saveProject:n,loadProject:t,exportProject:s,deleteProject:i,listProjects:r}}const av={class:"app-container"},ov={class:"app-header"},lv={class:"header-actions"},cv=["disabled"],hv=["disabled"],uv={class:"app-main"},dv={class:"left-panel"},fv={class:"center-panel"},pv={class:"right-panel"},gv={__name:"App",setup(n){const{loadPdf:t,extractText:e}=nu(),{recognizeText:s}=uy(),{saveProject:i,loadProject:r,exportProject:a}=rv(),o=Jt(null),l=Ad(null),c=Jt(1),h=Jt(0),u=Jt(1),d=Jt([]),f=Jt(null),g=Jt(-1),p=Jt(!1),y=Jt("");async function m(L){console.log("Upload started:",L.name);try{const et=await L.arrayBuffer();console.log("ArrayBuffer size:",et.byteLength),l.value=await t(et),console.log("PDF loaded, pages:",l.value.numPages),h.value=l.value.numPages,o.value={name:L.name.replace(".pdf",""),filename:L.name}}catch(et){console.error("Upload error:",et)}}function v(L){c.value=L}function w(L){u.value=L}async function A(L){f.value={...L,page:c.value,type:"",name:"",caption:"",filename:""},g.value=-1,await S()}async function S(){if(f.value?.imageData){p.value=!0;try{const L=await s(f.value.imageData);k(L)}finally{p.value=!1}}}function k(L){if(!f.value)return;const et=L.match(/Figure\s*(\d+)/i),N=L.match(/Table\s*(\d+)/i);et?(f.value.type="Figure",f.value.name=et[0]):N&&(f.value.type="Table",f.value.name=N[0]);const W=L.split(`
`).filter(I=>I.trim());W.length>1&&(f.value.caption=W.slice(1).join(" ").trim()),f.value.type&&f.value.name&&(f.value.filename=`${f.value.type}_${f.value.name.replace(/\s+/g,"")}.png`,C())}function C(){f.value&&(d.value.push({...f.value}),f.value=null,g.value=-1)}function z(L){g.value>=0&&(d.value[g.value]={...L}),f.value=null,g.value=-1}function T(){f.value=null,g.value=-1}function V(L){g.value=L}function Z(L){f.value={...d.value[L]},g.value=L}function P(L){d.value.splice(L,1),g.value===L&&(f.value=null,g.value=-1)}async function U(){if(!l.value)return;let L="";for(let et=1;et<=h.value;et++){const N=await e(l.value,et);L+=N+`

`;const W=d.value.filter(I=>I.page===et);for(const I of W)L+=`![${I.caption||I.name}](images/${I.filename})

`}y.value=L}async function _(){const L=await r();L&&(o.value=L.meta,d.value=L.regions,l.value=await t(L.pdfData),h.value=l.value.numPages)}async function q(){o.value&&await i({meta:o.value,regions:d.value})}async function Y(){o.value&&await a({meta:o.value,regions:d.value,markdown:y.value})}return(L,et)=>(Xt(),ie("div",av,[at("header",ov,[et[0]||(et[0]=at("h1",null,"PDF to Markdown Converter",-1)),at("div",lv,[at("button",{onClick:_,class:"btn"},""),at("button",{onClick:q,class:"btn",disabled:!o.value},"",8,cv),at("button",{onClick:Y,class:"btn btn-primary",disabled:!o.value},"",8,hv)])]),at("main",uv,[at("div",dv,[o.value?(Xt(),Ia(Rm,{key:1,"pdf-doc":l.value,"current-page":c.value,"total-pages":h.value,zoom:u.value,onPageChange:v,onZoomChange:w,onRegionSelect:A},null,8,["pdf-doc","current-page","total-pages","zoom"])):(Xt(),Ia(yp,{key:0,onUpload:m}))]),at("div",fv,[Me(Wm,{region:f.value,loading:p.value,onOcr:S,onAdd:C,onUpdate:z,onCancel:T},null,8,["region","loading"]),Me(ub,{markdown:y.value,onGenerate:U},null,8,["markdown"])]),at("div",pv,[Me(ib,{regions:d.value,"selected-index":g.value,onSelect:V,onEdit:Z,onDelete:P},null,8,["regions","selected-index"])])])]))}};fp(gv).mount("#app");
