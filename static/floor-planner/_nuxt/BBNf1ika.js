import{a as J,a3 as G,Y as U}from"./DFjDwT1c.js";const $="$s";function st(...t){const n=typeof t[t.length-1]=="string"?t.pop():void 0;typeof t[0]!="string"&&t.unshift(n);const[r,e]=t;if(!r||typeof r!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+r);if(e!==void 0&&typeof e!="function")throw new Error("[nuxt] [useState] init must be a function: "+e);const s=$+r,d=J(),o=G(d.payload.state,s);if(o.value===void 0&&e){const i=e();if(U(i))return d.payload.state[s]=i,i;o.value=i}return o}const A=15,H=10,K=10,m=10,k=10,X={exterior:"#4B5563",interior:"#9CA3AF"};function V(){return`wall-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function I(t,n,r,e,s={}){const d=s.isExterior??!1;return{id:V(),startX:t,startY:n,endX:r,endY:e,thickness:s.thickness??A,isExterior:d,color:s.color??(d?X.exterior:X.interior),zIndex:s.zIndex??1,roomId:s.roomId,side:s.side}}function rt(t,n,r,e,s,d={}){let o=t/s,i=n/s,a=r/s,c=e/s;return d.snapToGrid&&(a=C(a),c=C(c)),Math.sqrt(Math.pow(a-o,2)+Math.pow(c-i,2))<H?null:I(o,i,a,c)}function ot(t,n,r,e,s=!0){if(!s)return{endX:r,endY:e};const d=r-t,o=e-n,i=Math.sqrt(d*d+o*o);if(i===0)return{endX:r,endY:e};const c=Math.atan2(o,d)*180/Math.PI,h=[0,45,90,135,180,-135,-90,-45];for(const f of h){const u=Math.abs(c-f);if(u<=k||u>=360-k){const l=f*Math.PI/180;return{endX:t+i*Math.cos(l),endY:n+i*Math.sin(l)}}}return{endX:r,endY:e}}function C(t,n=K){return Math.round(t/n)*n}function B(t,n,r,e,s,d){const o=s-r,i=d-e,a=o*o+i*i;if(a===0)return{distance:Math.sqrt((t-r)**2+(n-e)**2),projX:r,projY:e,t:0};let c=((t-r)*o+(n-e)*i)/a;c=Math.max(0,Math.min(1,c));const h=r+c*o,f=e+c*i;return{distance:Math.sqrt((t-h)**2+(n-f)**2),projX:h,projY:f,t:c}}function it(t,n,r,e=m){let s=1/0,d=t,o=n,i=!1,a,c;for(const h of r){const f=Math.sqrt((t-h.startX)**2+(n-h.startY)**2);f<e&&f<s&&(s=f,d=h.startX,o=h.startY,i=!0,a=h,c="endpoint");const u=Math.sqrt((t-h.endX)**2+(n-h.endY)**2);u<e&&u<s&&(s=u,d=h.endX,o=h.endY,i=!0,a=h,c="endpoint")}if(i)return{x:d,y:o,snapped:i,snappedWall:a,snapType:c};for(const h of r){const f=B(t,n,h.startX,h.startY,h.endX,h.endY);f.t>.05&&f.t<.95&&f.distance<e&&f.distance<s&&(s=f.distance,d=f.projX,o=f.projY,i=!0,a=h,c="segment")}return{x:d,y:o,snapped:i,snappedWall:a,snapType:c}}function dt(t,n,r){const e=n.endX-n.startX,s=n.endY-n.startY,d=Math.sqrt(e**2+s**2);if(d===0)return t;const o=-s/d,i=e/d,a=t.endX-t.startX,c=t.endY-t.startY,h=(a*e+c*s)/(d*Math.sqrt(a**2+c**2));if(Math.abs(h)>.3)return t;const f=n.thickness/2,u={...t};if(r==="start"){const l=Math.sign(a*o+c*i);u.startX=t.startX+o*f*l,u.startY=t.startY+i*f*l}else{const l=Math.sign(-a*o+-c*i);u.endX=t.endX+o*f*l,u.endY=t.endY+i*f*l}return u}function z(t){const n=t.endX-t.startX,r=t.endY-t.startY;return Math.sqrt(n*n+r*r)}function Z(t){const n=t.endX-t.startX,r=t.endY-t.startY;return Math.atan2(r,n)}function at(t,n){const r=z(t),s=Z(t)*180/Math.PI,d=r*n,o=t.thickness*n;return{x:t.startX*n,y:t.startY*n,width:d,height:o,rotation:s}}function L(t,n,r=5){const e=t.endX-t.startX,s=t.endY-t.startY,d=Math.sqrt(e*e+s*s);if(d===0)return!1;const o=n.endX-n.startX,i=n.endY-n.startY,a=Math.sqrt(o*o+i*i);if(a===0)return!1;const c=e/d,h=s/d,f=o/a,u=i/a;if(Math.abs(c*u-h*f)>.1)return!1;const Y=(y,E,S,v,N,P)=>{const O=E-v,j=N-S,_=y-S,W=P-v,F=O*j-_*W,T=j*j+W*W;return T===0?Math.sqrt((y-S)**2+(E-v)**2):Math.abs(F)/Math.sqrt(T)},g=Y(n.startX,n.startY,t.startX,t.startY,t.endX,t.endY),x=Y(n.endX,n.endY,t.startX,t.startY,t.endX,t.endY);return g<=r&&x<=r}function Q(t,n,r={}){const{checkCollinear:e=!0}=r;if(n.length===0)return{joinedWall:null,removedWallIds:[],notJoinableIds:[]};const s=[t],d=[];for(const u of n)!e||L(t,u)?s.push(u):d.push(u.id);if(s.length<2)return{joinedWall:null,removedWallIds:[],notJoinableIds:d};const o=[];for(const u of s)o.push({x:u.startX,y:u.startY}),o.push({x:u.endX,y:u.endY});let i=0,a=o[0],c=o[1];for(let u=0;u<o.length;u++)for(let l=u+1;l<o.length;l++){const Y=o[u],g=o[l],x=Math.sqrt((Y.x-g.x)**2+(Y.y-g.y)**2);x>i&&(i=x,a=Y,c=g)}const h={...t,startX:a.x,startY:a.y,endX:c.x,endY:c.y},f=s.filter(u=>u.id!==t.id).map(u=>u.id);return{joinedWall:h,removedWallIds:f,notJoinableIds:d}}function p(t,n,r,e){return Math.sqrt((r-t)**2+(e-n)**2)}function R(t,n,r=m){const e=p(t.endX,t.endY,n.startX,n.startY),s=p(t.endX,t.endY,n.endX,n.endY),d=p(t.startX,t.startY,n.startX,n.startY),o=p(t.startX,t.startY,n.endX,n.endY);return Math.min(e,s,d,o)<=r}function ct(t,n=m){if(t.length===0)return[];const r=new Set,e=[];function s(d,o){if(!r.has(d.id)){r.add(d.id),o.push(d);for(const i of t)!r.has(i.id)&&R(d,i,n)&&s(i,o)}}for(const d of t)if(!r.has(d.id)){const o=[];s(d,o),o.length>0&&e.push(o)}return e}function w(t,n=m){if(t.length<=1)return t;const r=[],e=[...t];for(r.push(e.shift());e.length>0;){const s=r[r.length-1];let d=!1;for(let o=0;o<e.length;o++){const i=e[o];if(p(s.endX,s.endY,i.startX,i.startY)<=n){r.push(i),e.splice(o,1),d=!0;break}if(p(s.endX,s.endY,i.endX,i.endY)<=n){const a={...i,startX:i.endX,startY:i.endY,endX:i.startX,endY:i.startY};r.push(a),e.splice(o,1),d=!0;break}}if(!d&&r.length>0){const o=r[0];for(let i=0;i<e.length;i++){const a=e[i];if(p(o.startX,o.startY,a.endX,a.endY)<=n){r.unshift(a),e.splice(i,1),d=!0;break}if(p(o.startX,o.startY,a.startX,a.startY)<=n){const c={...a,startX:a.endX,startY:a.endY,endX:a.startX,endY:a.startY};r.unshift(c),e.splice(i,1),d=!0;break}}}d||r.push(e.shift())}return r}function D(t){const n=t.endX-t.startX,r=t.endY-t.startY,e=Math.sqrt(n*n+r*r);return e===0?{nx:0,ny:-1}:{nx:-r/e,ny:n/e}}function ut(t){if(t.length===0)return null;const n=w(t),r=n.reduce((f,u)=>f+u.thickness,0)/n.length,e=n[0],s=n[n.length-1],d=p(s.endX,s.endY,e.startX,e.startY)<=m,o=[];for(const f of n)o.push({x:f.startX,y:f.startY});o.push({x:s.endX,y:s.endY});const i=[],a=[],c=r/2;for(let f=0;f<n.length;f++){const u=n[f],l=D(u),Y=u.startX+l.nx*c,g=u.startY+l.ny*c,x=u.startX-l.nx*c,y=u.startY-l.ny*c;i.push(Y,g),a.push(x,y)}const h=D(s);return i.push(s.endX+h.nx*c),i.push(s.endY+h.ny*c),a.push(s.endX-h.nx*c),a.push(s.endY-h.ny*c),d&&(i.push(i[0],i[1]),a.push(a[0],a[1])),{id:`polygon-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,outerPoints:i,innerPoints:a,wallIds:n.map(f=>f.id),thickness:r,isClosed:d,color:n[0]?.color??X.interior}}function tt(t,n,r=m){const e=[];for(const s of n)R(t,s,r)&&e.push(s.id);return e}function ft(t,n,r=m){if(t.roomId)return{walls:[...n,t],joinedWallId:null,removedWallIds:[]};const e=tt(t,n,r);if(e.length===0)return{walls:[...n,t],joinedWallId:null,removedWallIds:[]};const s=n.filter(i=>e.includes(i.id)&&L(t,i,r));if(s.length===0)return{walls:[...n,t],joinedWallId:null,removedWallIds:[]};const d=s.find(i=>i.roomId),o=Q(t,s);if(o.joinedWall){d&&(o.joinedWall.roomId=d.roomId,o.joinedWall.side=d.side,o.joinedWall.isExterior=!0,o.joinedWall.color=X.exterior);const i=n.filter(a=>!o.removedWallIds.includes(a.id));return i.push(o.joinedWall),{walls:i,joinedWallId:o.joinedWall.id,removedWallIds:o.removedWallIds}}return{walls:[...n,t],joinedWallId:null,removedWallIds:[]}}function nt(t,n,r=A){const e=t.x/n,s=t.y/n,d=t.width/n,o=t.height/n;return[I(e,s,e+d,s,{thickness:r,isExterior:!0,roomId:t.id,side:"top",color:X.exterior}),I(e+d,s,e+d,s+o,{thickness:r,isExterior:!0,roomId:t.id,side:"right",color:X.exterior}),I(e+d,s+o,e,s+o,{thickness:r,isExterior:!0,roomId:t.id,side:"bottom",color:X.exterior}),I(e,s+o,e,s,{thickness:r,isExterior:!0,roomId:t.id,side:"left",color:X.exterior})]}function ht(t,n,r){const e=n.x/r,s=n.y/r,d=n.width/r,o=n.height/r;return t.map(i=>{if(i.roomId!==n.id)return i;switch(i.side){case"top":return{...i,startX:e,startY:s,endX:e+d,endY:s};case"right":return{...i,startX:e+d,startY:s,endX:e+d,endY:s+o};case"bottom":return{...i,startX:e+d,startY:s+o,endX:e,endY:s+o};case"left":return{...i,startX:e,startY:s+o,endX:e,endY:s};default:return i}})}const b="floor-plan-data",M="1.2";function lt(t){const n={version:M,...t,savedAt:new Date().toISOString()};localStorage.setItem(b,JSON.stringify(n))}function q(t){const n=t.room;if(!n)return t;if(t.wallList?.some(a=>a.roomId===n.id)){const{wallThickness:a,...c}=n;return{...t,version:M,room:c}}const e=n.widthCm?n.width/n.widthCm:2,s=n.wallThickness??15,d=nt(n,e,s),{wallThickness:o,...i}=n;return{...t,version:M,room:i,wallList:[...t.wallList||[],...d]}}function pt(){const t=localStorage.getItem(b);if(!t)return null;try{let n=JSON.parse(t);return(n.version==="1.1"||!n.version)&&(n=q(n)),n}catch{return null}}function Yt(t){const n={version:M,...t,savedAt:new Date().toISOString()},r=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),e=URL.createObjectURL(r),s=document.createElement("a");s.href=e,s.download=`floor-plan-${new Date().toISOString().slice(0,10)}.json`,s.click(),URL.revokeObjectURL(e)}function Xt(t){return new Promise((n,r)=>{const e=new FileReader;e.onload=s=>{try{let d=JSON.parse(s.target?.result);(d.version==="1.1"||!d.version)&&(d=q(d)),n(d)}catch{r(new Error("잘못된 파일 형식입니다."))}},e.onerror=()=>r(new Error("파일을 읽을 수 없습니다.")),e.readAsText(t)})}export{m as S,X as W,at as a,it as b,nt as c,lt as d,Yt as e,ct as f,z as g,rt as h,dt as i,ft as j,Q as k,pt as l,st as m,Xt as n,ot as s,ht as u,ut as w};
