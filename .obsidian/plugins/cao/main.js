/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Ms=Object.defineProperty;var Do=Object.getOwnPropertyDescriptor;var Lo=Object.getOwnPropertyNames;var Bo=Object.prototype.hasOwnProperty;var Wo=(n,e)=>{for(var t in e)Ms(n,t,{get:e[t],enumerable:!0})},jo=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Lo(e))!Bo.call(n,s)&&s!==t&&Ms(n,s,{get:()=>e[s],enumerable:!(r=Do(e,s))||r.enumerable});return n};var Uo=n=>jo(Ms({},"__esModule",{value:!0}),n);var Uu={};Wo(Uu,{default:()=>ks});module.exports=Uo(Uu);var te=require("obsidian");var xt="0.33.1";var Va=!1,Pt,Ts,qo,Ho,Vo,Xa,Xo,$n,Fs,Ya,$s,Nn,Ja;function Ka(n,e={auto:!1}){if(Va)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${n.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(Pt)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${n.kind}'\` after \`import '@anthropic-ai/sdk/shims/${Pt}'\``);Va=e.auto,Pt=n.kind,Ts=n.fetch,qo=n.Request,Ho=n.Response,Vo=n.Headers,Xa=n.FormData,Xo=n.Blob,$n=n.File,Fs=n.ReadableStream,Ya=n.getMultipartRequestOptions,$s=n.getDefaultAgent,Nn=n.fileFromPath,Ja=n.isFsReadStream}var Dn=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Ga({manuallyImported:n}={}){let e=n?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n",t,r,s,a;try{t=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:a,FormData:typeof FormData!="undefined"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob!="undefined"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File!="undefined"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream!="undefined"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new Dn(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:i=>!1}}Pt||Ka(Ga(),{auto:!0});var $=class extends Error{},V=class extends ${constructor(e,t,r,s){super(`${V.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=t}static makeMessage(e,t,r){let s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new Je({message:r,cause:Ln(t)});let a=t;return e===400?new Gr(e,a,r,s):e===401?new Qr(e,a,r,s):e===403?new zr(e,a,r,s):e===404?new Zr(e,a,r,s):e===409?new en(e,a,r,s):e===422?new tn(e,a,r,s):e===429?new rn(e,a,r,s):e>=500?new nn(e,a,r,s):new V(e,a,r,s)}},he=class extends V{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Je=class extends V{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},rr=class extends Je{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},Gr=class extends V{},Qr=class extends V{},zr=class extends V{},Zr=class extends V{},en=class extends V{},tn=class extends V{},rn=class extends V{},nn=class extends V{};var me=class{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let r=me.NEWLINE_CHARS.has(t[t.length-1]||""),s=t.split(me.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer!="undefined"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new $(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!="undefined"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!=null||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new $(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new $("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};me.NEWLINE_CHARS=new Set([`
`,"\r"]);me.NEWLINE_REGEXP=/\r\n|[\n\r]/g;var pe=class{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(let i of Ko(e,t)){if(i.event==="completion")try{yield JSON.parse(i.data)}catch(o){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),o}if(i.event==="message_start"||i.event==="message_delta"||i.event==="message_stop"||i.event==="content_block_start"||i.event==="content_block_delta"||i.event==="content_block_stop")try{yield JSON.parse(i.data)}catch(o){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),o}if(i.event!=="ping"&&i.event==="error")throw V.generate(void 0,`SSE Error: ${i.data}`,i.data,Ds(e.headers))}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new pe(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){let i=new me,o=Bn(e);for await(let c of o)for(let l of i.decode(c))yield l;for(let c of i.flush())yield c}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new pe(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){let i=r.next();e.push(i),t.push(i)}return a.shift()}});return[new pe(()=>s(e),this.controller),new pe(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new Fs({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:a,done:i}=await t.next();if(i)return s.close();let o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*Ko(n,e){if(!n.body)throw e.abort(),new $("Attempted to iterate over a response with no body");let t=new Ns,r=new me,s=Bn(n.body);for await(let a of Go(s))for(let i of r.decode(a)){let o=t.decode(i);o&&(yield o)}for(let a of r.flush()){let i=t.decode(a);i&&(yield i)}}async function*Go(n){let e=new Uint8Array;for await(let t of n){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let a;for(;(a=Qo(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}function Qo(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}var Ns=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=zo(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function zo(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function Bn(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var Zo=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",ec=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&sn(n),sn=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function";async function Qa(n,e,t){var s,a,i;if(n=await n,ec(n))return n;if(Zo(n)){let o=await n.blob();e||(e=(s=new URL(n.url).pathname.split(/[\\/]/).pop())!=null?s:"unknown_file");let c=sn(o)?[await o.arrayBuffer()]:[o];return new $n(c,e,t)}let r=await tc(n);if(e||(e=(a=nc(n))!=null?a:"unknown_file"),!(t!=null&&t.type)){let o=(i=r[0])==null?void 0:i.type;typeof o=="string"&&(t={...t,type:o})}return new $n(r,e,t)}async function tc(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(sn(n))e.push(await n.arrayBuffer());else if(sc(n))for await(let r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${rc(n)}`);return e}function rc(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function nc(n){var e;return Ls(n.name)||Ls(n.filename)||((e=Ls(n.path))==null?void 0:e.split(/[\\/]/).pop())}var Ls=n=>{if(typeof n=="string")return n;if(typeof Buffer!="undefined"&&n instanceof Buffer)return String(n)},sc=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Bs=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var ic=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},oc=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Wn;async function ri(n){let{response:e}=n;if(n.options.stream)return nr("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):pe.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;let t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){let a=await e.json();return nr("response",e.status,e.url,e.headers,a),ni(a,e)}let s=await e.text();return nr("response",e.status,e.url,e.headers,s),s}function ni(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var sr=class extends Promise{constructor(e,t=ri){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new sr(this.responsePromise,async t=>ni(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Un=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=Ws("maxRetries",t),this.timeout=Ws("timeout",r),this.httpAgent=s,this.fetch=a!=null?a:Ts}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...fc(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${gc()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{let a=s&&sn(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:a}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer!="undefined")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder!="undefined")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var C,g,k,w,x,T;let{method:r,path:s,query:a,headers:i={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Bs(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,c=this.calculateContentLength(o),l=this.buildURL(s,a);"timeout"in e&&Ws("timeout",e.timeout);let d=(C=e.timeout)!=null?C:this.timeout,u=(k=(g=e.httpAgent)!=null?g:this.httpAgent)!=null?k:$s(l),m=d+1e3;typeof((w=u==null?void 0:u.options)==null?void 0:w.timeout)=="number"&&m>((x=u.options.timeout)!=null?x:0)&&(u.options.timeout=m),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let p=this.buildHeaders({options:e,headers:i,contentLength:c,retryCount:t});return{req:{method:r,...o&&{body:o},headers:p,...u&&{agent:u},signal:(T=e.signal)!=null?T:null},url:l,timeout:d}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){let a={};r&&(a["content-length"]=r);let i=this.defaultHeaders(e);return ei(a,i),ei(a,t),Bs(e.body)&&Pt!=="node"&&delete a["content-type"],ti(i,"x-stainless-retry-count")===void 0&&ti(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return V.generate(e,t,r,s)}request(e,t=null){return new sr(this.makeRequest(e,t))}async makeRequest(e,t){var u,m,p;let r=await e,s=(u=r.maxRetries)!=null?u:this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);let{req:a,url:i,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(a,{url:i,options:r}),nr("request",i,r,a.headers),(m=r.signal)!=null&&m.aborted)throw new he;let c=new AbortController,l=await this.fetchWithTimeout(i,a,o,c).catch(Ln);if(l instanceof Error){if((p=r.signal)!=null&&p.aborted)throw new he;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new rr:new Je({cause:l})}let d=Ds(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let x=`retrying, ${t} attempts remaining`;return nr(`response (error; ${x})`,l.status,i,d),this.retryRequest(r,t,d)}let y=await l.text().catch(x=>Ln(x).message),C=dc(y),g=C?void 0:y;throw nr(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,i,d,g),this.makeStatusError(l.status,C,g,d)}return{response:l,options:r,controller:c}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new js(this,r,e)}buildURL(e,t){let r=mc(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return an(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r!="undefined").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new $(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){let{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),r);return this.fetch.call(void 0,e,{signal:s.signal,...i}).finally(()=>{clearTimeout(o)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){var o;let s,a=r==null?void 0:r["retry-after-ms"];if(a){let c=parseFloat(a);Number.isNaN(c)||(s=c)}let i=r==null?void 0:r["retry-after"];if(i&&!s){let c=parseFloat(i);Number.isNaN(c)?s=Date.parse(i)-Date.now():s=c*1e3}if(!(s&&0<=s&&s<60*1e3)){let c=(o=e.maxRetries)!=null?o:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,c)}return await pc(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${xt}`}},qn=class{constructor(e,t,r,s){Wn.set(this,void 0),ic(this,Wn,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new $("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,a]of r)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await oc(this,Wn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Wn=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},js=class extends sr{constructor(e,t,r){super(t,async s=>new r(e,s.response,await ri(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},Ds=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),cc={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},we=n=>typeof n=="object"&&n!==null&&!an(n)&&Object.keys(n).every(e=>si(cc,e)),lc=()=>{var e,t;if(typeof Deno!="undefined"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":xt,"X-Stainless-OS":Za(Deno.build.os),"X-Stainless-Arch":za(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)==null?void 0:e.deno)!=null?t:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":xt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":xt,"X-Stainless-OS":Za(process.platform),"X-Stainless-Arch":za(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let n=uc();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":xt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":xt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function uc(){if(typeof navigator=="undefined"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}var za=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Za=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),jn,fc=()=>jn!=null?jn:jn=lc(),dc=n=>{try{return JSON.parse(n)}catch(e){return}},hc=/^[a-z][a-z0-9+.-]*:/i,mc=n=>hc.test(n),pc=n=>new Promise(e=>setTimeout(e,n)),Ws=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new $(`${n} must be an integer`);if(e<0)throw new $(`${n} must be a positive integer`);return e},Ln=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch(e){}return new Error(String(n))};var Hn=n=>{var e,t,r,s,a,i;if(typeof process!="undefined")return(r=(t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())!=null?r:void 0;if(typeof Deno!="undefined")return(i=(a=(s=Deno.env)==null?void 0:s.get)==null?void 0:a.call(s,n))==null?void 0:i.trim()};function an(n){if(!n)return!0;for(let e in n)return!1;return!0}function si(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function ei(n,e){for(let t in e){if(!si(e,t))continue;let r=t.toLowerCase();if(!r)continue;let s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function nr(n,...e){var t;typeof process!="undefined"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${n}`,...e)}var gc=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),ai=()=>typeof window!="undefined"&&typeof window.document!="undefined"&&typeof navigator!="undefined",wc=n=>typeof(n==null?void 0:n.get)=="function";var ti=(n,e)=>{var r;let t=e.toLowerCase();if(wc(n)){let s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(let a of[e,t,e.toUpperCase(),s]){let i=n.get(a);if(i)return i}}for(let[s,a]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};var Ae=class extends qn{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var t;if((t=this.options.query)!=null&&t.before_id){let r=this.first_id;return r?{params:{before_id:r}}:null}let e=this.last_id;return e?{params:{after_id:e}}:null}};var K=class{constructor(e){this._client=e}};var At=class extends K{retrieve(e,t){return this._client.get(`/v1/models/${e}?beta=true`,t)}list(e={},t){return we(e)?this.list({},e):this._client.getAPIList("/v1/models?beta=true",ar,{query:e,...t})}},ar=class extends Ae{};At.BetaModelInfosPage=ar;var Ke=class{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){let e=new me;for await(let t of this.iterator)for(let r of e.decode(t))yield JSON.parse(r);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),new $("Attempted to iterate over a response with no body");return new Ke(Bn(e.body),t)}};var Ct=class extends K{create(e,t){let{betas:r,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r!=null?r:[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}retrieve(e,t={},r){if(we(t))return this.retrieve(e,{},t);let{betas:s}=t;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...r,headers:{"anthropic-beta":[...s!=null?s:[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}list(e={},t){if(we(e))return this.list({},e);let{betas:r,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",ir,{query:s,...t,headers:{"anthropic-beta":[...r!=null?r:[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}cancel(e,t={},r){if(we(t))return this.cancel(e,{},t);let{betas:s}=t;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:{"anthropic-beta":[...s!=null?s:[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}async results(e,t={},r){if(we(t))return this.results(e,{},t);let s=await this.retrieve(e);if(!s.results_url)throw new $(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);let{betas:a}=t;return this._client.get(s.results_url,{...r,headers:{"anthropic-beta":[...a!=null?a:[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers},__binaryResponse:!0})._thenUnwrap((i,o)=>Ke.fromResponse(o.response,o.controller))}},ir=class extends Ae{};Ct.BetaMessageBatchesPage=ir;var Ge=class extends K{constructor(){super(...arguments),this.batches=new Ct(this._client)}create(e,t){var a,i;let{betas:r,...s}=e;return this._client.post("/v1/messages?beta=true",{body:s,timeout:(a=this._client._options.timeout)!=null?a:6e5,...t,headers:{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0,...t==null?void 0:t.headers},stream:(i=e.stream)!=null?i:!1})}countTokens(e,t){let{betas:r,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r!=null?r:[],"token-counting-2024-11-01"].toString(),...t==null?void 0:t.headers}})}};Ge.Batches=Ct;Ge.BetaMessageBatchesPage=ir;var Ce=class extends K{constructor(){super(...arguments),this.models=new At(this._client),this.messages=new Ge(this._client)}};Ce.Models=At;Ce.BetaModelInfosPage=ar;Ce.Messages=Ge;var St=class extends K{create(e,t){var r,s;return this._client.post("/v1/complete",{body:e,timeout:(r=this._client._options.timeout)!=null?r:6e5,...t,stream:(s=e.stream)!=null?s:!1})}};var Rt=class extends K{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/v1/messages/batches/${e}`,t)}list(e={},t){return we(e)?this.list({},e):this._client.getAPIList("/v1/messages/batches",or,{query:e,...t})}cancel(e,t){return this._client.post(`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let r=await this.retrieve(e);if(!r.results_url)throw new $(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);return this._client.get(r.results_url,{...t,__binaryResponse:!0})._thenUnwrap((s,a)=>Ke.fromResponse(a.response,a.controller))}},or=class extends Ae{};Rt.MessageBatchesPage=or;var Ac=n=>{let e=0,t=[];for(;e<n.length;){let r=n[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",c=!1;for(r=n[++e];r!=='"';){if(e===n.length){c=!0;break}if(r==="\\"){if(e++,e===n.length){c=!0;break}o+=r+n[e],r=n[++e]}else o+=r,r=n[++e]}r=n[++e],c||t.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let a=/[0-9]/;if(r&&a.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=n[++e]);r&&a.test(r)||r===".";)o+=r,r=n[++e];t.push({type:"number",value:o});continue}let i=/[a-z]/i;if(r&&i.test(r)){let o="";for(;r&&i.test(r)&&e!==n.length;)o+=r,r=n[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},cr=n=>{if(n.length===0)return n;let e=n[n.length-1];switch(e.type){case"separator":return n=n.slice(0,n.length-1),cr(n);break;case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return n=n.slice(0,n.length-1),cr(n);case"string":let r=n[n.length-2];if((r==null?void 0:r.type)==="delimiter")return n=n.slice(0,n.length-1),cr(n);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return n=n.slice(0,n.length-1),cr(n);break;case"delimiter":return n=n.slice(0,n.length-1),cr(n);break}return n},Cc=n=>{let e=[];return n.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?n.push({type:"brace",value:"}"}):t==="]"&&n.push({type:"paren",value:"]"})}),n},Sc=n=>{let e="";return n.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},ii=n=>JSON.parse(Sc(Cc(cr(Ac(n)))));var re=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},M=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ge,Qe,Vn,Xn,on,cn,Yn,ln,Fe,un,Jn,Kn,lr,Us,oi,qs,Hs,Vs,Xs,ci,li="__json_buf",Et=class{constructor(){ge.add(this),this.messages=[],this.receivedMessages=[],Qe.set(this,void 0),this.controller=new AbortController,Vn.set(this,void 0),Xn.set(this,()=>{}),on.set(this,()=>{}),cn.set(this,void 0),Yn.set(this,()=>{}),ln.set(this,()=>{}),Fe.set(this,{}),un.set(this,!1),Jn.set(this,!1),Kn.set(this,!1),lr.set(this,!1),qs.set(this,e=>{if(re(this,Jn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new he),e instanceof he)return re(this,Kn,!0,"f"),this._emit("abort",e);if(e instanceof $)return this._emit("error",e);if(e instanceof Error){let t=new $(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new $(String(e)))}),re(this,Vn,new Promise((e,t)=>{re(this,Xn,e,"f"),re(this,on,t,"f")}),"f"),re(this,cn,new Promise((e,t)=>{re(this,Yn,e,"f"),re(this,ln,t,"f")}),"f"),M(this,Vn,"f").catch(()=>{}),M(this,cn,"f").catch(()=>{})}static fromReadableStream(e){let t=new Et;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){let s=new Et;for(let a of t.messages)s._addMessageParam(a);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},M(this,qs,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var i;let s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),M(this,ge,"m",Hs).call(this);let a=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let o of a)M(this,ge,"m",Vs).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new he;M(this,ge,"m",Xs).call(this)}_connected(){this.ended||(M(this,Xn,"f").call(this),this._emit("connect"))}get ended(){return M(this,un,"f")}get errored(){return M(this,Jn,"f")}get aborted(){return M(this,Kn,"f")}abort(){this.controller.abort()}on(e,t){return(M(this,Fe,"f")[e]||(M(this,Fe,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=M(this,Fe,"f")[e];if(!r)return this;let s=r.findIndex(a=>a.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(M(this,Fe,"f")[e]||(M(this,Fe,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{re(this,lr,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){re(this,lr,!0,"f"),await M(this,cn,"f")}get currentMessage(){return M(this,Qe,"f")}async finalMessage(){return await this.done(),M(this,ge,"m",Us).call(this)}async finalText(){return await this.done(),M(this,ge,"m",oi).call(this)}_emit(e,...t){if(M(this,un,"f"))return;e==="end"&&(re(this,un,!0,"f"),M(this,Yn,"f").call(this));let r=M(this,Fe,"f")[e];if(r&&(M(this,Fe,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!M(this,lr,"f")&&!(r!=null&&r.length)&&Promise.reject(s),M(this,on,"f").call(this,s),M(this,ln,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!M(this,lr,"f")&&!(r!=null&&r.length)&&Promise.reject(s),M(this,on,"f").call(this,s),M(this,ln,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",M(this,ge,"m",Us).call(this))}async _fromReadableStream(e,t){var a;let r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),M(this,ge,"m",Hs).call(this),this._connected();let s=pe.fromReadableStream(e,this.controller);for await(let i of s)M(this,ge,"m",Vs).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new he;M(this,ge,"m",Xs).call(this)}[(Qe=new WeakMap,Vn=new WeakMap,Xn=new WeakMap,on=new WeakMap,cn=new WeakMap,Yn=new WeakMap,ln=new WeakMap,Fe=new WeakMap,un=new WeakMap,Jn=new WeakMap,Kn=new WeakMap,lr=new WeakMap,qs=new WeakMap,ge=new WeakSet,Us=function(){if(this.receivedMessages.length===0)throw new $("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},oi=function(){if(this.receivedMessages.length===0)throw new $("stream ended without producing a Message with role=assistant");let t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new $("stream ended without producing a content block with type=text");return t.join(" ")},Hs=function(){this.ended||re(this,Qe,void 0,"f")},Vs=function(t){if(this.ended)return;let r=M(this,ge,"m",ci).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{let s=r.content.at(-1);t.delta.type==="text_delta"&&s.type==="text"?this._emit("text",t.delta.text,s.text||""):t.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{re(this,Qe,r,"f");break}case"content_block_start":case"message_delta":break}},Xs=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");let t=M(this,Qe,"f");if(!t)throw new $("request ended without sending any chunks");return re(this,Qe,void 0,"f"),t},ci=function(t){let r=M(this,Qe,"f");if(t.type==="message_start"){if(r)throw new $(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new $(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{let s=r.content.at(t.index);if((s==null?void 0:s.type)==="text"&&t.delta.type==="text_delta")s.text+=t.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&t.delta.type==="input_json_delta"){let a=s[li]||"";a+=t.delta.partial_json,Object.defineProperty(s,li,{value:a,enumerable:!1,writable:!0}),a&&(s.input=ii(a))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("streamEvent",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new pe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};var $e=class extends K{constructor(){super(...arguments),this.batches=new Rt(this._client)}create(e,t){var r,s;return e.model in ui&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${ui[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:(r=this._client._options.timeout)!=null?r:6e5,...t,stream:(s=e.stream)!=null?s:!1})}stream(e,t){return Et.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}},ui={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024"};$e.Batches=Rt;$e.MessageBatchesPage=or;var ze=class extends K{retrieve(e,t){return this._client.get(`/v1/models/${e}`,t)}list(e={},t){return we(e)?this.list({},e):this._client.getAPIList("/v1/models",It,{query:e,...t})}},It=class extends Ae{};ze.ModelInfosPage=It;var fi,L=class extends Un{constructor({baseURL:e=Hn("ANTHROPIC_BASE_URL"),apiKey:t=(a=>(a=Hn("ANTHROPIC_API_KEY"))!=null?a:null)(),authToken:r=(i=>(i=Hn("ANTHROPIC_AUTH_TOKEN"))!=null?i:null)(),...s}={}){var c;let o={apiKey:t,authToken:r,...s,baseURL:e||"https://api.anthropic.com"};if(!o.dangerouslyAllowBrowser&&ai())throw new $(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);super({baseURL:o.baseURL,timeout:(c=o.timeout)!=null?c:6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new St(this),this.messages=new $e(this),this.models=new ze(this),this.beta=new Ce(this),this._options=o,this.apiKey=t,this.authToken=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"])&&t["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&t.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){let t=this.apiKeyAuth(e),r=this.bearerAuth(e);return t!=null&&!an(t)?t:r!=null&&!an(r)?r:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}};fi=L;L.Anthropic=fi;L.HUMAN_PROMPT=`

Human:`;L.AI_PROMPT=`

Assistant:`;L.DEFAULT_TIMEOUT=6e5;L.AnthropicError=$;L.APIError=V;L.APIConnectionError=Je;L.APIConnectionTimeoutError=rr;L.APIUserAbortError=he;L.NotFoundError=Zr;L.ConflictError=en;L.RateLimitError=rn;L.BadRequestError=Gr;L.AuthenticationError=Qr;L.InternalServerError=nn;L.PermissionDeniedError=zr;L.UnprocessableEntityError=tn;L.toFile=Qa;L.fileFromPath=Nn;L.Completions=St;L.Messages=$e;L.Models=ze;L.ModelInfosPage=It;L.Beta=Ce;var{HUMAN_PROMPT:md,AI_PROMPT:pd}=L,di=L;var Gn="RFC3986",Qn={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},hi="RFC1738";var Ec=Array.isArray,Se=(()=>{let n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})();var Ys=1024,mi=(n,e,t,r,s)=>{if(n.length===0)return n;let a=n;if(typeof n=="symbol"?a=Symbol.prototype.toString.call(n):typeof n!="string"&&(a=String(n)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=Ys){let c=a.length>=Ys?a.slice(o,o+Ys):a,l=[];for(let d=0;d<c.length;++d){let u=c.charCodeAt(d);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===hi&&(u===40||u===41)){l[l.length]=c.charAt(d);continue}if(u<128){l[l.length]=Se[u];continue}if(u<2048){l[l.length]=Se[192|u>>6]+Se[128|u&63];continue}if(u<55296||u>=57344){l[l.length]=Se[224|u>>12]+Se[128|u>>6&63]+Se[128|u&63];continue}d+=1,u=65536+((u&1023)<<10|c.charCodeAt(d)&1023),l[l.length]=Se[240|u>>18]+Se[128|u>>12&63]+Se[128|u>>6&63]+Se[128|u&63]}i+=l.join("")}return i};function pi(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function Js(n,e){if(Ec(n)){let t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}var Ic=Object.prototype.hasOwnProperty,gi={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},Re=Array.isArray,Oc=Array.prototype.push,wi=function(n,e){Oc.apply(n,Re(e)?e:[e])},vc=Date.prototype.toISOString,Y={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:mi,encodeValuesOnly:!1,format:Gn,formatter:Qn[Gn],indices:!1,serializeDate(n){return vc.call(n)},skipNulls:!1,strictNullHandling:!1};function kc(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}var Ks={};function yi(n,e,t,r,s,a,i,o,c,l,d,u,m,p,y,C,g,k){let w=n,x=k,T=0,h=!1;for(;(x=x.get(Ks))!==void 0&&!h;){let F=x.get(n);if(T+=1,typeof F!="undefined"){if(F===T)throw new RangeError("Cyclic object value");h=!0}typeof x.get(Ks)=="undefined"&&(T=0)}if(typeof l=="function"?w=l(e,w):w instanceof Date?w=m==null?void 0:m(w):t==="comma"&&Re(w)&&(w=Js(w,function(F){return F instanceof Date?m==null?void 0:m(F):F})),w===null){if(a)return c&&!C?c(e,Y.encoder,g,"key",p):e;w=""}if(kc(w)||pi(w)){if(c){let F=C?e:c(e,Y.encoder,g,"key",p);return[(y==null?void 0:y(F))+"="+(y==null?void 0:y(c(w,Y.encoder,g,"value",p)))]}return[(y==null?void 0:y(e))+"="+(y==null?void 0:y(String(w)))]}let P=[];if(typeof w=="undefined")return P;let S;if(t==="comma"&&Re(w))C&&c&&(w=Js(w,c)),S=[{value:w.length>0?w.join(",")||null:void 0}];else if(Re(l))S=l;else{let F=Object.keys(w);S=d?F.sort(d):F}let O=o?String(e).replace(/\./g,"%2E"):String(e),I=r&&Re(w)&&w.length===1?O+"[]":O;if(s&&Re(w)&&w.length===0)return I+"[]";for(let F=0;F<S.length;++F){let D=S[F],E=typeof D=="object"&&typeof D.value!="undefined"?D.value:w[D];if(i&&E===null)continue;let W=u&&o?D.replace(/\./g,"%2E"):D,ie=Re(w)?typeof t=="function"?t(I,W):I:I+(u?"."+W:"["+W+"]");k.set(n,T);let oe=new WeakMap;oe.set(Ks,k),wi(P,yi(E,ie,t,r,s,a,i,o,t==="comma"&&C&&Re(w)?null:c,l,d,u,m,p,y,C,g,oe))}return P}function Mc(n=Y){if(typeof n.allowEmptyArrays!="undefined"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys!="undefined"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder!="undefined"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=n.charset||Y.charset;if(typeof n.charset!="undefined"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Gn;if(typeof n.format!="undefined"){if(!Ic.call(Qn,n.format))throw new TypeError("Unknown format option provided.");t=n.format}let r=Qn[t],s=Y.filter;(typeof n.filter=="function"||Re(n.filter))&&(s=n.filter);let a;if(n.arrayFormat&&n.arrayFormat in gi?a=n.arrayFormat:"indices"in n?a=n.indices?"indices":"repeat":a=Y.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let i=typeof n.allowDots=="undefined"?n.encodeDotInKeys?!0:Y.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:Y.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:Y.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:Y.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter=="undefined"?Y.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:Y.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:Y.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:Y.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:Y.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:Y.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:Y.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:Y.strictNullHandling}}function Gs(n,e={}){let t=n,r=Mc(e),s,a;typeof r.filter=="function"?(a=r.filter,t=a("",t)):Re(r.filter)&&(a=r.filter,s=a);let i=[];if(typeof t!="object"||t===null)return"";let o=gi[r.arrayFormat],c=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);let l=new WeakMap;for(let m=0;m<s.length;++m){let p=s[m];r.skipNulls&&t[p]===null||wi(i,yi(t[p],p,o,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let d=i.join(r.delimiter),u=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),d.length>0?u+d:""}var Ot="4.104.0";var _i=!1,vt,Qs,Fc,$c,Nc,zs,Dc,zn,Zs,ea,ta,Zn,ra;function bi(n,e={auto:!1}){if(_i)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(vt)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${vt}'\``);_i=e.auto,vt=n.kind,Qs=n.fetch,Fc=n.Request,$c=n.Response,Nc=n.Headers,zs=n.FormData,Dc=n.Blob,zn=n.File,Zs=n.ReadableStream,ea=n.getMultipartRequestOptions,ta=n.getDefaultAgent,Zn=n.fileFromPath,ra=n.isFsReadStream}var es=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function xi({manuallyImported:n}={}){let e=n?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,r,s,a;try{t=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:a,FormData:typeof FormData!="undefined"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob!="undefined"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File!="undefined"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream!="undefined"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new es(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}var na=()=>{vt||bi(xi(),{auto:!0})};na();var _=class extends Error{},q=class extends _{constructor(e,t,r,s){super(`${q.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;let a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,r){let s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new Ze({message:r,cause:ts(t)});let a=t==null?void 0:t.error;return e===400?new fn(e,a,r,s):e===401?new dn(e,a,r,s):e===403?new hn(e,a,r,s):e===404?new mn(e,a,r,s):e===409?new pn(e,a,r,s):e===422?new gn(e,a,r,s):e===429?new wn(e,a,r,s):e>=500?new yn(e,a,r,s):new q(e,a,r,s)}},X=class extends q{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Ze=class extends q{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},et=class extends Ze{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},fn=class extends q{},dn=class extends q{},hn=class extends q{},mn=class extends q{},pn=class extends q{},gn=class extends q{},wn=class extends q{},yn=class extends q{},ur=class extends _{constructor(){super("Could not parse response content as the length limit was reached")}},fr=class extends _{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var rs=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},kt=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ce,Mt=class{constructor(){ce.set(this,void 0),this.buffer=new Uint8Array,rs(this,ce,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,r=new Uint8Array(this.buffer.length+t.length);r.set(this.buffer),r.set(t,this.buffer.length),this.buffer=r;let s=[],a;for(;(a=Wc(this.buffer,kt(this,ce,"f")))!=null;){if(a.carriage&&kt(this,ce,"f")==null){rs(this,ce,a.index,"f");continue}if(kt(this,ce,"f")!=null&&(a.index!==kt(this,ce,"f")+1||a.carriage)){s.push(this.decodeText(this.buffer.slice(0,kt(this,ce,"f")-1))),this.buffer=this.buffer.slice(kt(this,ce,"f")),rs(this,ce,null,"f");continue}let i=kt(this,ce,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));s.push(o),this.buffer=this.buffer.slice(a.index),rs(this,ce,null,"f")}return s}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer!="undefined"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new _(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!="undefined"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!=null||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new _(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new _("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};ce=new WeakMap;Mt.NEWLINE_CHARS=new Set([`
`,"\r"]);Mt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Wc(n,e){for(let s=e!=null?e:0;s<n.length;s++){if(n[s]===10)return{preceding:s,index:s+1,carriage:!1};if(n[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function Pi(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}function sa(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var Z=class{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(let i of jc(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(o&&o.error)throw new q(void 0,o.error,void 0,ia(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(i.event=="error")throw new q(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new Z(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){let i=new Mt,o=sa(e);for await(let c of o)for(let l of i.decode(c))yield l;for(let c of i.flush())yield c}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new Z(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){let i=r.next();e.push(i),t.push(i)}return a.shift()}});return[new Z(()=>s(e),this.controller),new Z(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new Zs({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:a,done:i}=await t.next();if(i)return s.close();let o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*jc(n,e){if(!n.body)throw e.abort(),new _("Attempted to iterate over a response with no body");let t=new aa,r=new Mt,s=sa(n.body);for await(let a of Uc(s))for(let i of r.decode(a)){let o=t.decode(i);o&&(yield o)}for(let a of r.flush()){let i=t.decode(a);i&&(yield i)}}async function*Uc(n){let e=new Uint8Array;for await(let t of n){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let a;for(;(a=Pi(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}var aa=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=qc(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function qc(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}var Ai=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Ci=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&_n(n),_n=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Hc=n=>Ci(n)||Ai(n)||ra(n);async function la(n,e,t){var s,a,i;if(n=await n,Ci(n))return n;if(Ai(n)){let o=await n.blob();e||(e=(s=new URL(n.url).pathname.split(/[\\/]/).pop())!=null?s:"unknown_file");let c=_n(o)?[await o.arrayBuffer()]:[o];return new zn(c,e,t)}let r=await Vc(n);if(e||(e=(a=Yc(n))!=null?a:"unknown_file"),!(t!=null&&t.type)){let o=(i=r[0])==null?void 0:i.type;typeof o=="string"&&(t={...t,type:o})}return new zn(r,e,t)}async function Vc(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(_n(n))e.push(await n.arrayBuffer());else if(Jc(n))for await(let r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Xc(n)}`);return e}function Xc(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Yc(n){var e;return oa(n.name)||oa(n.filename)||((e=oa(n.path))==null?void 0:e.split(/[\\/]/).pop())}var oa=n=>{if(typeof n=="string")return n;if(typeof Buffer!="undefined"&&n instanceof Buffer)return String(n)},Jc=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",ua=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var ne=async n=>{let e=await Si(n.body);return ea(e,n)},Si=async n=>{let e=new zs;return await Promise.all(Object.entries(n||{}).map(([t,r])=>ca(e,t,r))),e};var ca=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Hc(t)){let r=await la(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>ca(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>ca(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Gc=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Qc=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ns;na();async function vi(n){var i;let{response:e}=n;if(n.options.stream)return Ne("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Z.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;let t=e.headers.get("content-type"),r=(i=t==null?void 0:t.split(";")[0])==null?void 0:i.trim();if((r==null?void 0:r.includes("application/json"))||(r==null?void 0:r.endsWith("+json"))){let o=await e.json();return Ne("response",e.status,e.url,e.headers,o),ki(o,e)}let a=await e.text();return Ne("response",e.status,e.url,e.headers,a),a}function ki(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var dr=class extends Promise{constructor(e,t=vi){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new dr(this.responsePromise,async t=>ki(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},is=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=fa("maxRetries",t),this.timeout=fa("timeout",r),this.httpAgent=s,this.fetch=a!=null?a:Qs}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...tl(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${al()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{let a=s&&_n(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:a}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer!="undefined")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder!="undefined")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var C,g,k,w,x,T;let r={...e},{method:s,path:a,query:i,headers:o={}}=r,c=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:ua(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,l=this.calculateContentLength(c),d=this.buildURL(a,i);"timeout"in r&&fa("timeout",r.timeout),r.timeout=(C=r.timeout)!=null?C:this.timeout;let u=(k=(g=r.httpAgent)!=null?g:this.httpAgent)!=null?k:ta(d),m=r.timeout+1e3;typeof((w=u==null?void 0:u.options)==null?void 0:w.timeout)=="number"&&m>((x=u.options.timeout)!=null?x:0)&&(u.options.timeout=m),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let p=this.buildHeaders({options:r,headers:o,contentLength:l,retryCount:t});return{req:{method:s,...c&&{body:c},headers:p,...u&&{agent:u},signal:(T=r.signal)!=null?T:null},url:d,timeout:r.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){let a={};r&&(a["content-length"]=r);let i=this.defaultHeaders(e);return Ii(a,i),Ii(a,t),ua(e.body)&&vt!=="node"&&delete a["content-type"],as(i,"x-stainless-retry-count")===void 0&&as(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),as(i,"x-stainless-timeout")===void 0&&as(t,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return q.generate(e,t,r,s)}request(e,t=null){return new dr(this.makeRequest(e,t))}async makeRequest(e,t){var u,m,p;let r=await e,s=(u=r.maxRetries)!=null?u:this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);let{req:a,url:i,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(a,{url:i,options:r}),Ne("request",i,r,a.headers),(m=r.signal)!=null&&m.aborted)throw new X;let c=new AbortController,l=await this.fetchWithTimeout(i,a,o,c).catch(ts);if(l instanceof Error){if((p=r.signal)!=null&&p.aborted)throw new X;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new et:new Ze({cause:l})}let d=ia(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let x=`retrying, ${t} attempts remaining`;return Ne(`response (error; ${x})`,l.status,i,d),this.retryRequest(r,t,d)}let y=await l.text().catch(x=>ts(x).message),C=rl(y),g=C?void 0:y;throw Ne(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,i,d,g),this.makeStatusError(l.status,C,g,d)}return{response:l,options:r,controller:c}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new da(this,r,e)}buildURL(e,t){let r=sl(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Mi(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r!="undefined").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new _(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){let{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),r),c={signal:s.signal,...i};return c.method&&(c.method=c.method.toUpperCase()),this.fetch.call(void 0,e,c).finally(()=>{clearTimeout(o)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){var o;let s,a=r==null?void 0:r["retry-after-ms"];if(a){let c=parseFloat(a);Number.isNaN(c)||(s=c)}let i=r==null?void 0:r["retry-after"];if(i&&!s){let c=parseFloat(i);Number.isNaN(c)?s=Date.parse(i)-Date.now():s=c*1e3}if(!(s&&0<=s&&s<60*1e3)){let c=(o=e.maxRetries)!=null?o:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,c)}return await De(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ot}`}},bn=class{constructor(e,t,r,s){ns.set(this,void 0),Gc(this,ns,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new _("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,a]of r)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await Qc(this,ns,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ns=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},da=class extends dr{constructor(e,t,r){super(t,async s=>new r(e,s.response,await vi(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},ia=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),zc={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},R=n=>typeof n=="object"&&n!==null&&!Mi(n)&&Object.keys(n).every(e=>Ti(zc,e)),Zc=()=>{var e,t;if(typeof Deno!="undefined"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ot,"X-Stainless-OS":Ei(Deno.build.os),"X-Stainless-Arch":Ri(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)==null?void 0:e.deno)!=null?t:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ot,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ot,"X-Stainless-OS":Ei(process.platform),"X-Stainless-Arch":Ri(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let n=el();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ot,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ot,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function el(){if(typeof navigator=="undefined"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}var Ri=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Ei=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),ss,tl=()=>ss!=null?ss:ss=Zc(),rl=n=>{try{return JSON.parse(n)}catch(e){return}},nl=/^[a-z][a-z0-9+.-]*:/i,sl=n=>nl.test(n),De=n=>new Promise(e=>setTimeout(e,n)),fa=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new _(`${n} must be an integer`);if(e<0)throw new _(`${n} must be a positive integer`);return e},ts=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch(e){}return new Error(n)};var xn=n=>{var e,t,r,s,a,i;if(typeof process!="undefined")return(r=(t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())!=null?r:void 0;if(typeof Deno!="undefined")return(i=(a=(s=Deno.env)==null?void 0:s.get)==null?void 0:a.call(s,n))==null?void 0:i.trim()};function Mi(n){if(!n)return!0;for(let e in n)return!1;return!0}function Ti(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ii(n,e){for(let t in e){if(!Ti(e,t))continue;let r=t.toLowerCase();if(!r)continue;let s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}var Oi=new Set(["authorization","api-key"]);function Ne(n,...e){var t;if(typeof process!="undefined"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"){let r=e.map(s=>{if(!s)return s;if(s.headers){let i={...s,headers:{...s.headers}};for(let o in s.headers)Oi.has(o.toLowerCase())&&(i.headers[o]="REDACTED");return i}let a=null;for(let i in s)Oi.has(i.toLowerCase())&&(a!=null||(a={...s}),a[i]="REDACTED");return a!=null?a:s});console.log(`OpenAI:DEBUG:${n}`,...r)}}var al=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Fi=()=>typeof window!="undefined"&&typeof window.document!="undefined"&&typeof navigator!="undefined",il=n=>typeof(n==null?void 0:n.get)=="function";var as=(n,e)=>{var r;let t=e.toLowerCase();if(il(n)){let s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(let a of[e,t,e.toUpperCase(),s]){let i=n.get(a);if(i)return i}}for(let[s,a]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};var $i=n=>{if(typeof Buffer!="undefined"){let e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(n),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};function Pn(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}var Ee=class extends bn{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){return null}nextPageInfo(){return null}},v=class extends bn{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;let e=this.getPaginatedItems();if(!e.length)return null;let t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}};var f=class{constructor(e){this._client=e}};var hr=class extends f{list(e,t={},r){return R(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,os,{query:t,...r})}};var tt=class extends f{constructor(){super(...arguments),this.messages=new hr(this._client)}create(e,t){var r;return this._client.post("/chat/completions",{body:e,...t,stream:(r=e.stream)!=null?r:!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return R(e)?this.list({},e):this._client.getAPIList("/chat/completions",rt,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}},rt=class extends v{},os=class extends v{};tt.ChatCompletionsPage=rt;tt.Messages=hr;var Be=class extends f{constructor(){super(...arguments),this.completions=new tt(this._client)}};Be.Completions=tt;Be.ChatCompletionsPage=rt;var mr=class extends f{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}};var pr=class extends f{create(e,t){var r;return this._client.post("/audio/transcriptions",ne({body:e,...t,stream:(r=e.stream)!=null?r:!1,__metadata:{model:e.model}}))}};var gr=class extends f{create(e,t){return this._client.post("/audio/translations",ne({body:e,...t,__metadata:{model:e.model}}))}};var Ie=class extends f{constructor(){super(...arguments),this.transcriptions=new pr(this._client),this.translations=new gr(this._client),this.speech=new mr(this._client)}};Ie.Transcriptions=pr;Ie.Translations=gr;Ie.Speech=mr;var nt=class extends f{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return R(e)?this.list({},e):this._client.getAPIList("/batches",Tt,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},Tt=class extends v{};nt.BatchesPage=Tt;var ye=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},U=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ha,cs,ls,An,Cn,us,Sn,We,Rn,fs,ds,wr,Ni,st=class{constructor(){ha.add(this),this.controller=new AbortController,cs.set(this,void 0),ls.set(this,()=>{}),An.set(this,()=>{}),Cn.set(this,void 0),us.set(this,()=>{}),Sn.set(this,()=>{}),We.set(this,{}),Rn.set(this,!1),fs.set(this,!1),ds.set(this,!1),wr.set(this,!1),ye(this,cs,new Promise((e,t)=>{ye(this,ls,e,"f"),ye(this,An,t,"f")}),"f"),ye(this,Cn,new Promise((e,t)=>{ye(this,us,e,"f"),ye(this,Sn,t,"f")}),"f"),U(this,cs,"f").catch(()=>{}),U(this,Cn,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},U(this,ha,"m",Ni).bind(this))},0)}_connected(){this.ended||(U(this,ls,"f").call(this),this._emit("connect"))}get ended(){return U(this,Rn,"f")}get errored(){return U(this,fs,"f")}get aborted(){return U(this,ds,"f")}abort(){this.controller.abort()}on(e,t){return(U(this,We,"f")[e]||(U(this,We,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=U(this,We,"f")[e];if(!r)return this;let s=r.findIndex(a=>a.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(U(this,We,"f")[e]||(U(this,We,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{ye(this,wr,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){ye(this,wr,!0,"f"),await U(this,Cn,"f")}_emit(e,...t){if(U(this,Rn,"f"))return;e==="end"&&(ye(this,Rn,!0,"f"),U(this,us,"f").call(this));let r=U(this,We,"f")[e];if(r&&(U(this,We,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!U(this,wr,"f")&&!(r!=null&&r.length)&&Promise.reject(s),U(this,An,"f").call(this,s),U(this,Sn,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!U(this,wr,"f")&&!(r!=null&&r.length)&&Promise.reject(s),U(this,An,"f").call(this,s),U(this,Sn,"f").call(this,s),this._emit("end")}}_emitFinal(){}};cs=new WeakMap,ls=new WeakMap,An=new WeakMap,Cn=new WeakMap,us=new WeakMap,Sn=new WeakMap,We=new WeakMap,Rn=new WeakMap,fs=new WeakMap,ds=new WeakMap,wr=new WeakMap,ha=new WeakSet,Ni=function(e){if(ye(this,fs,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new X),e instanceof X)return ye(this,ds,!0,"f"),this._emit("abort",e);if(e instanceof _)return this._emit("error",e);if(e instanceof Error){let t=new _(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new _(String(e)))};var b=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},le=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Q,ma,Oe,hs,_e,$t,yr,Ft,gs,ue,ms,ps,On,En,In,Di,Li,Bi,Wi,ji,Ui,qi,ee=class extends st{constructor(){super(...arguments),Q.add(this),ma.set(this,[]),Oe.set(this,{}),hs.set(this,{}),_e.set(this,void 0),$t.set(this,void 0),yr.set(this,void 0),Ft.set(this,void 0),gs.set(this,void 0),ue.set(this,void 0),ms.set(this,void 0),ps.set(this,void 0),On.set(this,void 0)}[(ma=new WeakMap,Oe=new WeakMap,hs=new WeakMap,_e=new WeakMap,$t=new WeakMap,yr=new WeakMap,Ft=new WeakMap,gs=new WeakMap,ue=new WeakMap,ms=new WeakMap,ps=new WeakMap,On=new WeakMap,Q=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new ee;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;let r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=Z.fromReadableStream(e,this.controller);for await(let i of s)b(this,Q,"m",En).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new X;return this._addRun(b(this,Q,"m",In).call(this))}toReadableStream(){return new Z(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,a){let i=new ee;return i._run(()=>i._runToolAssistantStream(e,t,r,s,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,s,a){var l;let i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let o={...s,stream:!0},c=await e.submitToolOutputs(t,r,o,{...a,signal:this.controller.signal});this._connected();for await(let d of c)b(this,Q,"m",En).call(this,d);if((l=c.controller.signal)!=null&&l.aborted)throw new X;return this._addRun(b(this,Q,"m",In).call(this))}static createThreadAssistantStream(e,t,r){let s=new ee;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){let a=new ee;return a._run(()=>a._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return b(this,ms,"f")}currentRun(){return b(this,ps,"f")}currentMessageSnapshot(){return b(this,_e,"f")}currentRunStepSnapshot(){return b(this,On,"f")}async finalRunSteps(){return await this.done(),Object.values(b(this,Oe,"f"))}async finalMessages(){return await this.done(),Object.values(b(this,hs,"f"))}async finalRun(){if(await this.done(),!b(this,$t,"f"))throw Error("Final run was not received.");return b(this,$t,"f")}async _createThreadAssistantStream(e,t,r){var o;let s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...t,stream:!0},i=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(let c of i)b(this,Q,"m",En).call(this,c);if((o=i.controller.signal)!=null&&o.aborted)throw new X;return this._addRun(b(this,Q,"m",In).call(this))}async _createAssistantStream(e,t,r,s){var c;let a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let i={...r,stream:!0},o=await e.create(t,i,{...s,signal:this.controller.signal});this._connected();for await(let l of o)b(this,Q,"m",En).call(this,l);if((c=o.controller.signal)!=null&&c.aborted)throw new X;return this._addRun(b(this,Q,"m",In).call(this))}static accumulateDelta(e,t){for(let[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let a=e[r];if(a==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(Pn(a)&&Pn(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(let i of s){if(!Pn(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);let o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let c=a[o];c==null?a.push(i):a[o]=this.accumulateDelta(c,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${a}`);e[r]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,a){return await this._createToolAssistantStream(r,e,t,s,a)}};En=function(e){if(!this.ended)switch(le(this,ms,e,"f"),b(this,Q,"m",Bi).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":b(this,Q,"m",qi).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":b(this,Q,"m",Li).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":b(this,Q,"m",Di).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},In=function(){if(this.ended)throw new _("stream has ended, this shouldn't happen");if(!b(this,$t,"f"))throw Error("Final run has not been received");return b(this,$t,"f")},Di=function(e){let[t,r]=b(this,Q,"m",ji).call(this,e,b(this,_e,"f"));le(this,_e,t,"f"),b(this,hs,"f")[t.id]=t;for(let s of r){let a=t.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=t.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=b(this,yr,"f")){if(b(this,Ft,"f"))switch(b(this,Ft,"f").type){case"text":this._emit("textDone",b(this,Ft,"f").text,b(this,_e,"f"));break;case"image_file":this._emit("imageFileDone",b(this,Ft,"f").image_file,b(this,_e,"f"));break}le(this,yr,s.index,"f")}le(this,Ft,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(b(this,yr,"f")!==void 0){let s=e.data.content[b(this,yr,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,b(this,_e,"f"));break;case"text":this._emit("textDone",s.text,b(this,_e,"f"));break}}b(this,_e,"f")&&this._emit("messageDone",e.data),le(this,_e,void 0,"f")}},Li=function(e){let t=b(this,Q,"m",Wi).call(this,e);switch(le(this,On,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let a of r.step_details.tool_calls)a.index==b(this,gs,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(b(this,ue,"f")&&this._emit("toolCallDone",b(this,ue,"f")),le(this,gs,a.index,"f"),le(this,ue,t.step_details.tool_calls[a.index],"f"),b(this,ue,"f")&&this._emit("toolCallCreated",b(this,ue,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":le(this,On,void 0,"f"),e.data.step_details.type=="tool_calls"&&b(this,ue,"f")&&(this._emit("toolCallDone",b(this,ue,"f")),le(this,ue,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},Bi=function(e){b(this,ma,"f").push(e),this._emit("event",e)},Wi=function(e){switch(e.event){case"thread.run.step.created":return b(this,Oe,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=b(this,Oe,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let s=ee.accumulateDelta(t,r.delta);b(this,Oe,"f")[e.data.id]=s}return b(this,Oe,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":b(this,Oe,"f")[e.data.id]=e.data;break}if(b(this,Oe,"f")[e.data.id])return b(this,Oe,"f")[e.data.id];throw new Error("No snapshot available")},ji=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let a of s.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=b(this,Q,"m",Ui).call(this,a,i)}else t.content[a.index]=a,r.push(a);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Ui=function(e,t){return ee.accumulateDelta(t,e)},qi=function(e){switch(le(this,ps,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":le(this,$t,e.data,"f"),b(this,ue,"f")&&(this._emit("toolCallDone",b(this,ue,"f")),le(this,ue,void 0,"f"));break;case"thread.run.cancelling":break}};var Nt=class extends f{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return R(e)?this.list({},e):this._client.getAPIList("/assistants",_r,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}},_r=class extends v{};Nt.AssistantsPage=_r;function pa(n){return typeof n.parse=="function"}var at=n=>(n==null?void 0:n.role)==="assistant",ga=n=>(n==null?void 0:n.role)==="function",wa=n=>(n==null?void 0:n.role)==="tool";function vn(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function Dt(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function Hi(n,e){return!e||!ya(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:kn(n,e)}function kn(n,e){let t=n.choices.map(r=>{var s,a;if(r.finish_reason==="length")throw new ur;if(r.finish_reason==="content_filter")throw new fr;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:(a=(s=r.message.tool_calls)==null?void 0:s.map(i=>ml(e,i)))!=null?a:void 0}:void 0,parsed:r.message.content&&!r.message.refusal?hl(e,r.message.content):null}}});return{...n,choices:t}}function hl(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function ml(n,e){var r;let t=(r=n.tools)==null?void 0:r.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Dt(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function Vi(n,e){var r;if(!n)return!1;let t=(r=n.tools)==null?void 0:r.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return Dt(t)||(t==null?void 0:t.function.strict)||!1}function ya(n){var e,t;return vn(n.response_format)?!0:(t=(e=n.tools)==null?void 0:e.some(r=>Dt(r)||r.type==="function"&&r.function.strict===!0))!=null?t:!1}function Xi(n){for(let e of n!=null?n:[]){if(e.type!=="function")throw new _(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new _(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var se=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},z,_a,ws,ba,xa,Pa,Ji,Aa,Yi=10,br=class extends st{constructor(){super(...arguments),z.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(ga(e)||wa(e))&&e.content)this._emit("functionCallResult",e.content);else if(at(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(at(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new _("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),se(this,z,"m",_a).call(this)}async finalMessage(){return await this.done(),se(this,z,"m",ws).call(this)}async finalFunctionCall(){return await this.done(),se(this,z,"m",ba).call(this)}async finalFunctionCallResult(){return await this.done(),se(this,z,"m",xa).call(this)}async totalUsage(){return await this.done(),se(this,z,"m",Pa).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=se(this,z,"m",ws).call(this);t&&this._emit("finalMessage",t);let r=se(this,z,"m",_a).call(this);r&&this._emit("finalContent",r);let s=se(this,z,"m",ba).call(this);s&&this._emit("finalFunctionCall",s);let a=se(this,z,"m",xa).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",se(this,z,"m",Pa).call(this))}async _createChatCompletion(e,t,r){let s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),se(this,z,"m",Ji).call(this,t);let a=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(kn(a,t))}async _runChatCompletion(e,t,r){for(let s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var m;let s="function",{function_call:a="auto",stream:i,...o}=t,c=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:l=Yi}=r||{},d={};for(let p of t.functions)d[p.name||p.function.name]=p;let u=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){let C=(m=(await this._createChatCompletion(e,{...o,function_call:a,functions:u,messages:[...this.messages]},r)).choices[0])==null?void 0:m.message;if(!C)throw new _("missing message in ChatCompletion response");if(!C.function_call)return;let{name:g,arguments:k}=C.function_call,w=d[g];if(w){if(c&&c!==g){let P=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,name:g,content:P});continue}}else{let P=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${u.map(S=>JSON.stringify(S.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:P});continue}let x;try{x=pa(w)?await w.parse(k):k}catch(P){this._addMessage({role:s,name:g,content:P instanceof Error?P.message:String(P)});continue}let T=await w.function(x,this),h=se(this,z,"m",Aa).call(this,T);if(this._addMessage({role:s,name:g,content:h}),c)return}}async _runTools(e,t,r){var p,y,C;let s="tool",{tool_choice:a="auto",stream:i,...o}=t,c=typeof a!="string"&&((p=a==null?void 0:a.function)==null?void 0:p.name),{maxChatCompletions:l=Yi}=r||{},d=t.tools.map(g=>{if(Dt(g)){if(!g.$callback)throw new _("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),u={};for(let g of d)g.type==="function"&&(u[g.function.name||g.function.function.name]=g.function);let m="tools"in t?d.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(let g of t.messages)this._addMessage(g,!1);for(let g=0;g<l;++g){let w=(y=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:m,messages:[...this.messages]},r)).choices[0])==null?void 0:y.message;if(!w)throw new _("missing message in ChatCompletion response");if(!((C=w.tool_calls)!=null&&C.length))return;for(let x of w.tool_calls){if(x.type!=="function")continue;let T=x.id,{name:h,arguments:P}=x.function,S=u[h];if(S){if(c&&c!==h){let D=`Invalid tool_call: ${JSON.stringify(h)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,tool_call_id:T,content:D});continue}}else{let D=`Invalid tool_call: ${JSON.stringify(h)}. Available options are: ${Object.keys(u).map(E=>JSON.stringify(E)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:T,content:D});continue}let O;try{O=pa(S)?await S.parse(P):P}catch(D){let E=D instanceof Error?D.message:String(D);this._addMessage({role:s,tool_call_id:T,content:E});continue}let I=await S.function(O,this),F=se(this,z,"m",Aa).call(this,I);if(this._addMessage({role:s,tool_call_id:T,content:F}),c)return}}}};z=new WeakSet,_a=function(){var e;return(e=se(this,z,"m",ws).call(this).content)!=null?e:null},ws=function(){var t,r;let e=this.messages.length;for(;e-- >0;){let s=this.messages[e];if(at(s)){let{function_call:a,...i}=s,o={...i,content:(t=s.content)!=null?t:null,refusal:(r=s.refusal)!=null?r:null};return a&&(o.function_call=a),o}}throw new _("stream ended without producing a ChatCompletionMessage with role=assistant")},ba=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){let s=this.messages[r];if(at(s)&&(s!=null&&s.function_call))return s.function_call;if(at(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},xa=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(ga(t)&&t.content!=null||wa(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Pa=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Ji=function(e){if(e.n!=null&&e.n>1)throw new _("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Aa=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var it=class extends br{static runFunctions(e,t,r){let s=new it,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,r){let s=new it,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}_addMessage(e,t=!0){super._addMessage(e,t),at(e)&&e.content&&this._emit("content",e.content)}};var G={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},Ca=class extends Error{},Sa=class extends Error{};function pl(n,e=G.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return gl(n.trim(),e)}var gl=(n,e)=>{let t=n.length,r=0,s=m=>{throw new Ca(`${m} at position ${r}`)},a=m=>{throw new Sa(`${m} at position ${r}`)},i=()=>(u(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?c():n[r]==="["?l():n.substring(r,r+4)==="null"||G.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||G.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||G.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||G.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||G.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||G.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):d()),o=()=>{let m=r,p=!1;for(r++;r<t&&(n[r]!=='"'||p&&n[r-1]==="\\");)p=n[r]==="\\"?!p:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(m,++r-Number(p)))}catch(y){a(String(y))}else if(G.STR&e)try{return JSON.parse(n.substring(m,r-Number(p))+'"')}catch(y){return JSON.parse(n.substring(m,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{r++,u();let m={};try{for(;n[r]!=="}";){if(u(),r>=t&&G.OBJ&e)return m;let p=o();u(),r++;try{let y=i();Object.defineProperty(m,p,{value:y,writable:!0,enumerable:!0,configurable:!0})}catch(y){if(G.OBJ&e)return m;throw y}u(),n[r]===","&&r++}}catch(p){if(G.OBJ&e)return m;s("Expected '}' at end of object")}return r++,m},l=()=>{r++;let m=[];try{for(;n[r]!=="]";)m.push(i()),u(),n[r]===","&&r++}catch(p){if(G.ARR&e)return m;s("Expected ']' at end of array")}return r++,m},d=()=>{if(r===0){n==="-"&&G.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(p){if(G.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch(y){}a(String(p))}}let m=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(G.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(m,r))}catch(p){n.substring(m,r)==="-"&&G.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(m,n.lastIndexOf("e")))}catch(y){a(String(y))}}},u=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return i()},Ra=n=>pl(n,G.ALL^G.NUM);var xr=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},B=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},J,je,Pr,ot,Ea,ys,Ia,Oa,va,_s,ka,Ki,Ue=class extends br{constructor(e){super(),J.add(this),je.set(this,void 0),Pr.set(this,void 0),ot.set(this,void 0),xr(this,je,e,"f"),xr(this,Pr,[],"f")}get currentChatCompletionSnapshot(){return B(this,ot,"f")}static fromReadableStream(e){let t=new Ue(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let s=new Ue(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var i;super._createChatCompletion;let s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),B(this,J,"m",Ea).call(this);let a=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let o of a)B(this,J,"m",Ia).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new X;return this._addChatCompletion(B(this,J,"m",_s).call(this))}async _fromReadableStream(e,t){var i;let r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),B(this,J,"m",Ea).call(this),this._connected();let s=Z.fromReadableStream(e,this.controller),a;for await(let o of s)a&&a!==o.id&&this._addChatCompletion(B(this,J,"m",_s).call(this)),B(this,J,"m",Ia).call(this,o),a=o.id;if((i=s.controller.signal)!=null&&i.aborted)throw new X;return this._addChatCompletion(B(this,J,"m",_s).call(this))}[(je=new WeakMap,Pr=new WeakMap,ot=new WeakMap,J=new WeakSet,Ea=function(){this.ended||xr(this,ot,void 0,"f")},ys=function(t){let r=B(this,Pr,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},B(this,Pr,"f")[t.index]=r,r)},Ia=function(t){var s,a,i,o,c,l,d,u,m,p,y,C,g,k,w,x,T,h,P,S;if(this.ended)return;let r=B(this,J,"m",Ki).call(this,t);this._emit("chunk",t,r);for(let O of t.choices){let I=r.choices[O.index];O.delta.content!=null&&((s=I.message)==null?void 0:s.role)==="assistant"&&((a=I.message)!=null&&a.content)&&(this._emit("content",O.delta.content,I.message.content),this._emit("content.delta",{delta:O.delta.content,snapshot:I.message.content,parsed:I.message.parsed})),O.delta.refusal!=null&&((i=I.message)==null?void 0:i.role)==="assistant"&&((o=I.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:O.delta.refusal,snapshot:I.message.refusal}),((c=O.logprobs)==null?void 0:c.content)!=null&&((l=I.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(d=O.logprobs)==null?void 0:d.content,snapshot:(m=(u=I.logprobs)==null?void 0:u.content)!=null?m:[]}),((p=O.logprobs)==null?void 0:p.refusal)!=null&&((y=I.message)==null?void 0:y.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(C=O.logprobs)==null?void 0:C.refusal,snapshot:(k=(g=I.logprobs)==null?void 0:g.refusal)!=null?k:[]});let F=B(this,J,"m",ys).call(this,I);I.finish_reason&&(B(this,J,"m",va).call(this,I),F.current_tool_call_index!=null&&B(this,J,"m",Oa).call(this,I,F.current_tool_call_index));for(let D of(w=O.delta.tool_calls)!=null?w:[])F.current_tool_call_index!==D.index&&(B(this,J,"m",va).call(this,I),F.current_tool_call_index!=null&&B(this,J,"m",Oa).call(this,I,F.current_tool_call_index)),F.current_tool_call_index=D.index;for(let D of(x=O.delta.tool_calls)!=null?x:[]){let E=(T=I.message.tool_calls)==null?void 0:T[D.index];E!=null&&E.type&&((E==null?void 0:E.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(h=E.function)==null?void 0:h.name,index:D.index,arguments:E.function.arguments,parsed_arguments:E.function.parsed_arguments,arguments_delta:(S=(P=D.function)==null?void 0:P.arguments)!=null?S:""}):(E==null||E.type,void 0))}}},Oa=function(t,r){var i,o,c;if(B(this,J,"m",ys).call(this,t).done_tool_calls.has(r))return;let a=(i=t.message.tool_calls)==null?void 0:i[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){let l=(c=(o=B(this,je,"f"))==null?void 0:o.tools)==null?void 0:c.find(d=>d.type==="function"&&d.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:Dt(l)?l.$parseRaw(a.function.arguments):l!=null&&l.function.strict?JSON.parse(a.function.arguments):null})}else a.type},va=function(t){var s,a;let r=B(this,J,"m",ys).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;let i=B(this,J,"m",ka).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},_s=function(){if(this.ended)throw new _("stream has ended, this shouldn't happen");let t=B(this,ot,"f");if(!t)throw new _("request ended without sending any chunks");return xr(this,ot,void 0,"f"),xr(this,Pr,[],"f"),wl(t,B(this,je,"f"))},ka=function(){var r;let t=(r=B(this,je,"f"))==null?void 0:r.response_format;return vn(t)?t:null},Ki=function(t){var d,u,m,p,y,C;var r,s,a,i;let o=B(this,ot,"f"),{choices:c,...l}=t;o?Object.assign(o,l):o=xr(this,ot,{...l,choices:[]},"f");for(let{delta:g,finish_reason:k,index:w,logprobs:x=null,...T}of t.choices){let h=o.choices[w];if(h||(h=o.choices[w]={finish_reason:k,index:w,message:{},logprobs:x,...T}),x)if(!h.logprobs)h.logprobs=Object.assign({},x);else{let{content:E,refusal:W,...ie}=x;Object.assign(h.logprobs,ie),E&&((d=(r=h.logprobs).content)!=null||(r.content=[]),h.logprobs.content.push(...E)),W&&((u=(s=h.logprobs).refusal)!=null||(s.refusal=[]),h.logprobs.refusal.push(...W))}if(k&&(h.finish_reason=k,B(this,je,"f")&&ya(B(this,je,"f")))){if(k==="length")throw new ur;if(k==="content_filter")throw new fr}if(Object.assign(h,T),!g)continue;let{content:P,refusal:S,function_call:O,role:I,tool_calls:F,...D}=g;if(Object.assign(h.message,D),S&&(h.message.refusal=(h.message.refusal||"")+S),I&&(h.message.role=I),O&&(h.message.function_call?(O.name&&(h.message.function_call.name=O.name),O.arguments&&((m=(a=h.message.function_call).arguments)!=null||(a.arguments=""),h.message.function_call.arguments+=O.arguments)):h.message.function_call=O),P&&(h.message.content=(h.message.content||"")+P,!h.message.refusal&&B(this,J,"m",ka).call(this)&&(h.message.parsed=Ra(h.message.content))),F){h.message.tool_calls||(h.message.tool_calls=[]);for(let{index:E,id:W,type:ie,function:oe,...No}of F){let Pe=(p=(i=h.message.tool_calls)[E])!=null?p:i[E]={};Object.assign(Pe,No),W&&(Pe.id=W),ie&&(Pe.type=ie),oe&&((C=Pe.function)!=null||(Pe.function={name:(y=oe.name)!=null?y:"",arguments:""})),oe!=null&&oe.name&&(Pe.function.name=oe.name),oe!=null&&oe.arguments&&(Pe.function.arguments+=oe.arguments,Vi(B(this,je,"f"),Pe)&&(Pe.function.parsed_arguments=Ra(Pe.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Z(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function wl(n,e){let{id:t,choices:r,created:s,model:a,system_fingerprint:i,...o}=n,c={...o,id:t,choices:r.map(({message:l,finish_reason:d,index:u,logprobs:m,...p})=>{var x,T,h;if(!d)throw new _(`missing finish_reason for choice ${u}`);let{content:y=null,function_call:C,tool_calls:g,...k}=l,w=l.role;if(!w)throw new _(`missing role for choice ${u}`);if(C){let{arguments:P,name:S}=C;if(P==null)throw new _(`missing function_call.arguments for choice ${u}`);if(!S)throw new _(`missing function_call.name for choice ${u}`);return{...p,message:{content:y,function_call:{arguments:P,name:S},role:w,refusal:(x=l.refusal)!=null?x:null},finish_reason:d,index:u,logprobs:m}}return g?{...p,index:u,finish_reason:d,logprobs:m,message:{...k,role:w,content:y,refusal:(T=l.refusal)!=null?T:null,tool_calls:g.map((P,S)=>{let{function:O,type:I,id:F,...D}=P,{arguments:E,name:W,...ie}=O||{};if(F==null)throw new _(`missing choices[${u}].tool_calls[${S}].id
${bs(n)}`);if(I==null)throw new _(`missing choices[${u}].tool_calls[${S}].type
${bs(n)}`);if(W==null)throw new _(`missing choices[${u}].tool_calls[${S}].function.name
${bs(n)}`);if(E==null)throw new _(`missing choices[${u}].tool_calls[${S}].function.arguments
${bs(n)}`);return{...D,id:F,type:I,function:{...ie,name:W,arguments:E}}})}}:{...p,message:{...k,content:y,role:w,refusal:(h=l.refusal)!=null?h:null},finish_reason:d,index:u,logprobs:m}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Hi(c,e)}function bs(n){return JSON.stringify(n)}var qe=class extends Ue{static fromReadableStream(e){let t=new qe(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){let s=new qe(null),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,r){let s=new qe(t),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}};var Mn=class extends f{parse(e,t){return Xi(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>kn(r,e))}runFunctions(e,t){return e.stream?qe.runFunctions(this._client,e,t):it.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?qe.runTools(this._client,e,t):it.runTools(this._client,e,t)}stream(e,t){return Ue.createChatCompletion(this._client,e,t)}};var Ar=class extends f{constructor(){super(...arguments),this.completions=new Mn(this._client)}};(function(n){n.Completions=Mn})(Ar||(Ar={}));var Cr=class extends f{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}};var Sr=class extends f{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}};var ct=class extends f{constructor(){super(...arguments),this.sessions=new Cr(this._client),this.transcriptionSessions=new Sr(this._client)}};ct.Sessions=Cr;ct.TranscriptionSessions=Sr;var Lt=class extends f{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return R(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Rr,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},Rr=class extends v{};Lt.MessagesPage=Rr;var Bt=class extends f{retrieve(e,t,r,s={},a){return R(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t,r={},s){return R(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Er,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}},Er=class extends v{};Bt.RunStepsPage=Er;var He=class extends f{constructor(){super(...arguments),this.steps=new Bt(this._client)}create(e,t,r){var i;let{include:s,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:(i=t.stream)!=null?i:!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return R(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Ir,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return ee.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{let c=i.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(o=l)}}await De(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,r){return ee.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){var a;return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:(a=r.stream)!=null?a:!1})}async submitToolOutputsAndPoll(e,t,r,s){let a=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,t,r,s){return ee.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}},Ir=class extends v{};He.RunsPage=Ir;He.Steps=Bt;He.RunStepsPage=Er;var ve=class extends f{constructor(){super(...arguments),this.runs=new He(this._client),this.messages=new Lt(this._client)}create(e={},t){return R(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){var r;return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:(r=e.stream)!=null?r:!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return ee.createThreadAssistantStream(e,this._client.beta.threads,t)}};ve.Runs=He;ve.RunsPage=Ir;ve.Messages=Lt;ve.MessagesPage=Rr;var be=class extends f{constructor(){super(...arguments),this.realtime=new ct(this._client),this.chat=new Ar(this._client),this.assistants=new Nt(this._client),this.threads=new ve(this._client)}};be.Realtime=ct;be.Assistants=Nt;be.AssistantsPage=_r;be.Threads=ve;var Wt=class extends f{create(e,t){var r;return this._client.post("/completions",{body:e,...t,stream:(r=e.stream)!=null?r:!1})}};var Or=class extends f{retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}/content`,{...r,headers:{Accept:"application/binary",...r==null?void 0:r.headers},__binaryResponse:!0})}};var lt=class extends f{constructor(){super(...arguments),this.content=new Or(this._client)}create(e,t,r){return this._client.post(`/containers/${e}/files`,ne({body:t,...r}))}retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}`,r)}list(e,t={},r){return R(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,vr,{query:t,...r})}del(e,t,r){return this._client.delete(`/containers/${e}/files/${t}`,{...r,headers:{Accept:"*/*",...r==null?void 0:r.headers}})}},vr=class extends v{};lt.FileListResponsesPage=vr;lt.Content=Or;var ke=class extends f{constructor(){super(...arguments),this.files=new lt(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return R(e)?this.list({},e):this._client.getAPIList("/containers",jt,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}},jt=class extends v{};ke.ContainerListResponsesPage=jt;ke.Files=lt;ke.FileListResponsesPage=vr;var Ut=class extends f{create(e,t){let r=!!e.encoding_format,s=r?e.encoding_format:"base64";r&&Ne("Request","User defined encoding_format:",e.encoding_format);let a=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return r?a:(Ne("response","Decoding base64 embeddings to float32 array"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{let c=o.embedding;o.embedding=$i(c)}),i)))}};var qt=class extends f{retrieve(e,t,r,s){return this._client.get(`/evals/${e}/runs/${t}/output_items/${r}`,s)}list(e,t,r={},s){return R(r)?this.list(e,t,{},r):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,kr,{query:r,...s})}},kr=class extends v{};qt.OutputItemListResponsesPage=kr;var Ve=class extends f{constructor(){super(...arguments),this.outputItems=new qt(this._client)}create(e,t,r){return this._client.post(`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){return this._client.get(`/evals/${e}/runs/${t}`,r)}list(e,t={},r){return R(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Mr,{query:t,...r})}del(e,t,r){return this._client.delete(`/evals/${e}/runs/${t}`,r)}cancel(e,t,r){return this._client.post(`/evals/${e}/runs/${t}`,r)}},Mr=class extends v{};Ve.RunListResponsesPage=Mr;Ve.OutputItems=qt;Ve.OutputItemListResponsesPage=kr;var Me=class extends f{constructor(){super(...arguments),this.runs=new Ve(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,r){return this._client.post(`/evals/${e}`,{body:t,...r})}list(e={},t){return R(e)?this.list({},e):this._client.getAPIList("/evals",Ht,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}},Ht=class extends v{};Me.EvalListResponsesPage=Ht;Me.Runs=Ve;Me.RunListResponsesPage=Mr;var ut=class extends f{create(e,t){return this._client.post("/files",ne({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return R(e)?this.list({},e):this._client.getAPIList("/files",Vt,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),a=Date.now(),i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await De(t),i=await this.retrieve(e),Date.now()-a>r)throw new et({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return i}},Vt=class extends v{};ut.FileObjectsPage=Vt;var Tr=class extends f{};var Fr=class extends f{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var Xt=class extends f{constructor(){super(...arguments),this.graders=new Fr(this._client)}};Xt.Graders=Fr;var Yt=class extends f{create(e,t,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,$r,{body:t,method:"post",...r})}retrieve(e,t={},r){return R(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}del(e,t,r){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,r)}},$r=class extends Ee{};Yt.PermissionCreateResponsesPage=$r;var ft=class extends f{constructor(){super(...arguments),this.permissions=new Yt(this._client)}};ft.Permissions=Yt;ft.PermissionCreateResponsesPage=$r;var Jt=class extends f{list(e,t={},r){return R(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Nr,{query:t,...r})}},Nr=class extends v{};Jt.FineTuningJobCheckpointsPage=Nr;var Te=class extends f{constructor(){super(...arguments),this.checkpoints=new Jt(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return R(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Dr,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return R(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Lr,{query:t,...r})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}},Dr=class extends v{},Lr=class extends v{};Te.FineTuningJobsPage=Dr;Te.FineTuningJobEventsPage=Lr;Te.Checkpoints=Jt;Te.FineTuningJobCheckpointsPage=Nr;var fe=class extends f{constructor(){super(...arguments),this.methods=new Tr(this._client),this.jobs=new Te(this._client),this.checkpoints=new ft(this._client),this.alpha=new Xt(this._client)}};fe.Methods=Tr;fe.Jobs=Te;fe.FineTuningJobsPage=Dr;fe.FineTuningJobEventsPage=Lr;fe.Checkpoints=ft;fe.Alpha=Xt;var Br=class extends f{};var dt=class extends f{constructor(){super(...arguments),this.graderModels=new Br(this._client)}};dt.GraderModels=Br;var Kt=class extends f{createVariation(e,t){return this._client.post("/images/variations",ne({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",ne({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};var ht=class extends f{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Gt,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},Gt=class extends Ee{};ht.ModelsPage=Gt;var Qt=class extends f{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function Gi(n,e){return!e||!Wl(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:Ma(n,e)}function Ma(n,e){let t=n.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:ql(e,s)};if(s.type==="message"){let a=s.content.map(i=>i.type==="output_text"?{...i,parsed:Bl(e,i.text)}:i);return{...s,content:a}}return s}),r=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||Ta(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let s of r.output)if(s.type==="message"){for(let a of s.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),r}function Bl(n,e){var t,r,s,a;return((r=(t=n.text)==null?void 0:t.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((s=n.text)==null?void 0:s.format)?((a=n.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function Wl(n){var e;return!!vn((e=n.text)==null?void 0:e.format)}function jl(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function Ul(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function ql(n,e){var r;let t=Ul((r=n.tools)!=null?r:[],e.name);return{...e,...e,parsed_arguments:jl(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function Ta(n){let e=[];for(let t of n.output)if(t.type==="message")for(let r of t.content)r.type==="output_text"&&e.push(r.text);n.output_text=e.join("")}var Wr=class extends f{list(e,t={},r){return R(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,xs,{query:t,...r})}};var jr=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},mt=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ur,Ps,pt,As,Qi,zi,Zi,eo,qr=class extends st{constructor(e){super(),Ur.add(this),Ps.set(this,void 0),pt.set(this,void 0),As.set(this,void 0),jr(this,Ps,e,"f")}static createResponse(e,t,r){let s=new qr(t);return s._run(()=>s._createOrRetrieveResponse(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,t,r){var o,c;let s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),mt(this,Ur,"m",Qi).call(this);let a,i=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),i=(o=t.starting_after)!=null?o:null):a=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(let l of a)mt(this,Ur,"m",zi).call(this,l,i);if((c=a.controller.signal)!=null&&c.aborted)throw new X;return mt(this,Ur,"m",Zi).call(this)}[(Ps=new WeakMap,pt=new WeakMap,As=new WeakMap,Ur=new WeakSet,Qi=function(){this.ended||jr(this,pt,void 0,"f")},zi=function(t,r){if(this.ended)return;let s=(i,o)=>{(r==null||o.sequence_number>r)&&this._emit(i,o)},a=mt(this,Ur,"m",eo).call(this,t);switch(s("event",t),t.type){case"response.output_text.delta":{let i=a.output[t.output_index];if(!i)throw new _(`missing output at index ${t.output_index}`);if(i.type==="message"){let o=i.content[t.content_index];if(!o)throw new _(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new _(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let i=a.output[t.output_index];if(!i)throw new _(`missing output at index ${t.output_index}`);i.type==="function_call"&&s("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:s(t.type,t);break}},Zi=function(){if(this.ended)throw new _("stream has ended, this shouldn't happen");let t=mt(this,pt,"f");if(!t)throw new _("request ended without sending any events");jr(this,pt,void 0,"f");let r=Vl(t,mt(this,Ps,"f"));return jr(this,As,r,"f"),r},eo=function(t){let r=mt(this,pt,"f");if(!r){if(t.type!=="response.created")throw new _(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=jr(this,pt,t.response,"f"),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{let s=r.output[t.output_index];if(!s)throw new _(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{let s=r.output[t.output_index];if(!s)throw new _(`missing output at index ${t.output_index}`);if(s.type==="message"){let a=s.content[t.content_index];if(!a)throw new _(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new _(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{let s=r.output[t.output_index];if(!s)throw new _(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{jr(this,pt,t.response,"f");break}}return r},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=mt(this,As,"f");if(!e)throw new _("stream ended without producing a ChatCompletion");return e}};function Vl(n,e){return Gi(n,e)}var gt=class extends f{constructor(){super(...arguments),this.inputItems=new Wr(this._client)}create(e,t){var r;return this._client.post("/responses",{body:e,...t,stream:(r=e.stream)!=null?r:!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&Ta(s),s))}retrieve(e,t={},r){var s;return this._client.get(`/responses/${e}`,{query:t,...r,stream:(s=t==null?void 0:t.stream)!=null?s:!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>Ma(r,e))}stream(e,t){return qr.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}},xs=class extends v{};gt.InputItems=Wr;var Hr=class extends f{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,ne({body:t,...r}))}};var wt=class extends f{constructor(){super(...arguments),this.parts=new Hr(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}};wt.Parts=Hr;var to=async n=>{let e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(let s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let r=[];for(let s of e)s.status==="fulfilled"&&r.push(s.value);return r};var yt=class extends f{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return R(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,_t,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){let s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let a=await this.retrieve(e,t,{...r,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{let c=a.response.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(o=l)}}await De(o);break;case"failed":case"completed":return i}}}async upload(e,t,r){let s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){let s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}content(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Vr,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},_t=class extends v{},Vr=class extends Ee{};yt.VectorStoreFilesPage=_t;yt.FileContentResponsesPage=Vr;var Xr=class extends f{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return R(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,_t,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){let s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{let c=i.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(o=l)}}await De(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){var m;if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let a=(m=s==null?void 0:s.maxConcurrency)!=null?m:5,i=Math.min(a,t.length),o=this._client,c=t.values(),l=[...r];async function d(p){for(let y of p){let C=await o.files.create({file:y,purpose:"assistants"},s);l.push(C.id)}}let u=Array(i).fill(c).map(d);return await to(u),await this.createAndPoll(e,{file_ids:l})}};var de=class extends f{constructor(){super(...arguments),this.files=new yt(this._client),this.fileBatches=new Xr(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return R(e)?this.list({},e):this._client.getAPIList("/vector_stores",zt,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/search`,Zt,{body:t,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},zt=class extends v{},Zt=class extends Ee{};de.VectorStoresPage=zt;de.VectorStoreSearchResponsesPage=Zt;de.Files=yt;de.VectorStoreFilesPage=_t;de.FileContentResponsesPage=Vr;de.FileBatches=Xr;var ro,A=class extends is{constructor({baseURL:e=xn("OPENAI_BASE_URL"),apiKey:t=xn("OPENAI_API_KEY"),organization:r=(i=>(i=xn("OPENAI_ORG_ID"))!=null?i:null)(),project:s=(o=>(o=xn("OPENAI_PROJECT_ID"))!=null?o:null)(),...a}={}){var l;if(t===void 0)throw new _("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let c={apiKey:t,organization:r,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!c.dangerouslyAllowBrowser&&Fi())throw new _(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:c.baseURL,timeout:(l=c.timeout)!=null?l:6e5,httpAgent:c.httpAgent,maxRetries:c.maxRetries,fetch:c.fetch}),this.completions=new Wt(this),this.chat=new Be(this),this.embeddings=new Ut(this),this.files=new ut(this),this.images=new Kt(this),this.audio=new Ie(this),this.moderations=new Qt(this),this.models=new ht(this),this.fineTuning=new fe(this),this.graders=new dt(this),this.vectorStores=new de(this),this.beta=new be(this),this.batches=new nt(this),this.uploads=new wt(this),this.responses=new gt(this),this.evals=new Me(this),this.containers=new ke(this),this._options=c,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Gs(e,{arrayFormat:"brackets"})}};ro=A;A.OpenAI=ro;A.DEFAULT_TIMEOUT=6e5;A.OpenAIError=_;A.APIError=q;A.APIConnectionError=Ze;A.APIConnectionTimeoutError=et;A.APIUserAbortError=X;A.NotFoundError=mn;A.ConflictError=pn;A.RateLimitError=wn;A.BadRequestError=fn;A.AuthenticationError=dn;A.InternalServerError=yn;A.PermissionDeniedError=hn;A.UnprocessableEntityError=gn;A.toFile=la;A.fileFromPath=Zn;A.Completions=Wt;A.Chat=Be;A.ChatCompletionsPage=rt;A.Embeddings=Ut;A.Files=ut;A.FileObjectsPage=Vt;A.Images=Kt;A.Audio=Ie;A.Moderations=Qt;A.Models=ht;A.ModelsPage=Gt;A.FineTuning=fe;A.Graders=dt;A.VectorStores=de;A.VectorStoresPage=zt;A.VectorStoreSearchResponsesPage=Zt;A.Beta=be;A.Batches=nt;A.BatchesPage=Tt;A.Uploads=wt;A.Responses=gt;A.Evals=Me;A.EvalListResponsesPage=Ht;A.Containers=ke;A.ContainerListResponsesPage=jt;var no=A;var Gl=Math.pow(10,8)*24*60*60*1e3,dw=-Gl,Cs=6048e5,so=864e5;var Ql=3600;var ao=Ql*24,hw=ao*7,zl=ao*365.2425,Zl=zl/12,mw=Zl*3,Fa=Symbol.for("constructDateFrom");function ae(n,e){return typeof n=="function"?n(e):n&&typeof n=="object"&&Fa in n?n[Fa](e):n instanceof Date?new n.constructor(e):new Date(e)}function H(n,e){return ae(e||n,n)}var eu={};function bt(){return eu}function Xe(n,e){var o,c,l,d,u,m,p,y;let t=bt(),r=(y=(p=(d=(l=e==null?void 0:e.weekStartsOn)!=null?l:(c=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:c.weekStartsOn)!=null?d:t.weekStartsOn)!=null?p:(m=(u=t.locale)==null?void 0:u.options)==null?void 0:m.weekStartsOn)!=null?y:0,s=H(n,e==null?void 0:e.in),a=s.getDay(),i=(a<r?7:0)+a-r;return s.setDate(s.getDate()-i),s.setHours(0,0,0,0),s}function er(n,e){return Xe(n,{...e,weekStartsOn:1})}function Ss(n,e){let t=H(n,e==null?void 0:e.in),r=t.getFullYear(),s=ae(t,0);s.setFullYear(r+1,0,4),s.setHours(0,0,0,0);let a=er(s),i=ae(t,0);i.setFullYear(r,0,4),i.setHours(0,0,0,0);let o=er(i);return t.getTime()>=a.getTime()?r+1:t.getTime()>=o.getTime()?r:r-1}function $a(n){let e=H(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}function io(n,...e){let t=ae.bind(null,n||e.find(r=>typeof r=="object"));return e.map(t)}function Na(n,e){let t=H(n,e==null?void 0:e.in);return t.setHours(0,0,0,0),t}function oo(n,e,t){let[r,s]=io(t==null?void 0:t.in,n,e),a=Na(r),i=Na(s),o=+a-$a(a),c=+i-$a(i);return Math.round((o-c)/so)}function co(n,e){let t=Ss(n,e),r=ae((e==null?void 0:e.in)||n,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),er(r)}function lo(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function uo(n){return!(!lo(n)&&typeof n!="number"||isNaN(+H(n)))}function fo(n,e){let t=H(n,e==null?void 0:e.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}var tu={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},ho=(n,e,t)=>{let r,s=tu[n];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+r:r+" ago":r};function Rs(n){return(e={})=>{let t=e.width?String(e.width):n.defaultWidth;return n.formats[t]||n.formats[n.defaultWidth]}}var ru={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},nu={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},su={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},mo={date:Rs({formats:ru,defaultWidth:"full"}),time:Rs({formats:nu,defaultWidth:"full"}),dateTime:Rs({formats:su,defaultWidth:"full"})};var au={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},po=(n,e,t,r)=>au[n];function Yr(n){return(e,t)=>{let r=t!=null&&t.context?String(t.context):"standalone",s;if(r==="formatting"&&n.formattingValues){let i=n.defaultFormattingWidth||n.defaultWidth,o=t!=null&&t.width?String(t.width):i;s=n.formattingValues[o]||n.formattingValues[i]}else{let i=n.defaultWidth,o=t!=null&&t.width?String(t.width):n.defaultWidth;s=n.values[o]||n.values[i]}let a=n.argumentCallback?n.argumentCallback(e):e;return s[a]}}var iu={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},ou={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},cu={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},lu={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},uu={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},fu={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},du=(n,e)=>{let t=Number(n),r=t%100;if(r>20||r<10)switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},go={ordinalNumber:du,era:Yr({values:iu,defaultWidth:"wide"}),quarter:Yr({values:ou,defaultWidth:"wide",argumentCallback:n=>n-1}),month:Yr({values:cu,defaultWidth:"wide"}),day:Yr({values:lu,defaultWidth:"wide"}),dayPeriod:Yr({values:uu,defaultWidth:"wide",formattingValues:fu,defaultFormattingWidth:"wide"})};function Jr(n){return(e,t={})=>{let r=t.width,s=r&&n.matchPatterns[r]||n.matchPatterns[n.defaultMatchWidth],a=e.match(s);if(!a)return null;let i=a[0],o=r&&n.parsePatterns[r]||n.parsePatterns[n.defaultParseWidth],c=Array.isArray(o)?mu(o,u=>u.test(i)):hu(o,u=>u.test(i)),l;l=n.valueCallback?n.valueCallback(c):c,l=t.valueCallback?t.valueCallback(l):l;let d=e.slice(i.length);return{value:l,rest:d}}}function hu(n,e){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&e(n[t]))return t}function mu(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return t}function wo(n){return(e,t={})=>{let r=e.match(n.matchPattern);if(!r)return null;let s=r[0],a=e.match(n.parsePattern);if(!a)return null;let i=n.valueCallback?n.valueCallback(a[0]):a[0];i=t.valueCallback?t.valueCallback(i):i;let o=e.slice(s.length);return{value:i,rest:o}}}var pu=/^(\d+)(th|st|nd|rd)?/i,gu=/\d+/i,wu={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},yu={any:[/^b/i,/^(a|c)/i]},_u={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},bu={any:[/1/i,/2/i,/3/i,/4/i]},xu={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Pu={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Au={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Cu={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Su={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ru={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},yo={ordinalNumber:wo({matchPattern:pu,parsePattern:gu,valueCallback:n=>parseInt(n,10)}),era:Jr({matchPatterns:wu,defaultMatchWidth:"wide",parsePatterns:yu,defaultParseWidth:"any"}),quarter:Jr({matchPatterns:_u,defaultMatchWidth:"wide",parsePatterns:bu,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Jr({matchPatterns:xu,defaultMatchWidth:"wide",parsePatterns:Pu,defaultParseWidth:"any"}),day:Jr({matchPatterns:Au,defaultMatchWidth:"wide",parsePatterns:Cu,defaultParseWidth:"any"}),dayPeriod:Jr({matchPatterns:Su,defaultMatchWidth:"any",parsePatterns:Ru,defaultParseWidth:"any"})};var Da={code:"en-US",formatDistance:ho,formatLong:mo,formatRelative:po,localize:go,match:yo,options:{weekStartsOn:0,firstWeekContainsDate:1}};function _o(n,e){let t=H(n,e==null?void 0:e.in);return oo(t,fo(t))+1}function bo(n,e){let t=H(n,e==null?void 0:e.in),r=+er(t)-+co(t);return Math.round(r/Cs)+1}function Es(n,e){var d,u,m,p,y,C,g,k;let t=H(n,e==null?void 0:e.in),r=t.getFullYear(),s=bt(),a=(k=(g=(p=(m=e==null?void 0:e.firstWeekContainsDate)!=null?m:(u=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)!=null?p:s.firstWeekContainsDate)!=null?g:(C=(y=s.locale)==null?void 0:y.options)==null?void 0:C.firstWeekContainsDate)!=null?k:1,i=ae((e==null?void 0:e.in)||n,0);i.setFullYear(r+1,0,a),i.setHours(0,0,0,0);let o=Xe(i,e),c=ae((e==null?void 0:e.in)||n,0);c.setFullYear(r,0,a),c.setHours(0,0,0,0);let l=Xe(c,e);return+t>=+o?r+1:+t>=+l?r:r-1}function xo(n,e){var o,c,l,d,u,m,p,y;let t=bt(),r=(y=(p=(d=(l=e==null?void 0:e.firstWeekContainsDate)!=null?l:(c=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:c.firstWeekContainsDate)!=null?d:t.firstWeekContainsDate)!=null?p:(m=(u=t.locale)==null?void 0:u.options)==null?void 0:m.firstWeekContainsDate)!=null?y:1,s=Es(n,e),a=ae((e==null?void 0:e.in)||n,0);return a.setFullYear(s,0,r),a.setHours(0,0,0,0),Xe(a,e)}function Po(n,e){let t=H(n,e==null?void 0:e.in),r=+Xe(t,e)-+xo(t,e);return Math.round(r/Cs)+1}function N(n,e){let t=n<0?"-":"",r=Math.abs(n).toString().padStart(e,"0");return t+r}var Ye={y(n,e){let t=n.getFullYear(),r=t>0?t:1-t;return N(e==="yy"?r%100:r,e.length)},M(n,e){let t=n.getMonth();return e==="M"?String(t+1):N(t+1,2)},d(n,e){return N(n.getDate(),e.length)},a(n,e){let t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return N(n.getHours()%12||12,e.length)},H(n,e){return N(n.getHours(),e.length)},m(n,e){return N(n.getMinutes(),e.length)},s(n,e){return N(n.getSeconds(),e.length)},S(n,e){let t=e.length,r=n.getMilliseconds(),s=Math.trunc(r*Math.pow(10,t-3));return N(s,e.length)}};var Kr={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},La={G:function(n,e,t){let r=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(r,{width:"abbreviated"});case"GGGGG":return t.era(r,{width:"narrow"});case"GGGG":default:return t.era(r,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){let r=n.getFullYear(),s=r>0?r:1-r;return t.ordinalNumber(s,{unit:"year"})}return Ye.y(n,e)},Y:function(n,e,t,r){let s=Es(n,r),a=s>0?s:1-s;if(e==="YY"){let i=a%100;return N(i,2)}return e==="Yo"?t.ordinalNumber(a,{unit:"year"}):N(a,e.length)},R:function(n,e){let t=Ss(n);return N(t,e.length)},u:function(n,e){let t=n.getFullYear();return N(t,e.length)},Q:function(n,e,t){let r=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return N(r,2);case"Qo":return t.ordinalNumber(r,{unit:"quarter"});case"QQQ":return t.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(r,{width:"wide",context:"formatting"})}},q:function(n,e,t){let r=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return N(r,2);case"qo":return t.ordinalNumber(r,{unit:"quarter"});case"qqq":return t.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(r,{width:"wide",context:"standalone"})}},M:function(n,e,t){let r=n.getMonth();switch(e){case"M":case"MM":return Ye.M(n,e);case"Mo":return t.ordinalNumber(r+1,{unit:"month"});case"MMM":return t.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(r,{width:"wide",context:"formatting"})}},L:function(n,e,t){let r=n.getMonth();switch(e){case"L":return String(r+1);case"LL":return N(r+1,2);case"Lo":return t.ordinalNumber(r+1,{unit:"month"});case"LLL":return t.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(r,{width:"wide",context:"standalone"})}},w:function(n,e,t,r){let s=Po(n,r);return e==="wo"?t.ordinalNumber(s,{unit:"week"}):N(s,e.length)},I:function(n,e,t){let r=bo(n);return e==="Io"?t.ordinalNumber(r,{unit:"week"}):N(r,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):Ye.d(n,e)},D:function(n,e,t){let r=_o(n);return e==="Do"?t.ordinalNumber(r,{unit:"dayOfYear"}):N(r,e.length)},E:function(n,e,t){let r=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(r,{width:"short",context:"formatting"});case"EEEE":default:return t.day(r,{width:"wide",context:"formatting"})}},e:function(n,e,t,r){let s=n.getDay(),a=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(a);case"ee":return N(a,2);case"eo":return t.ordinalNumber(a,{unit:"day"});case"eee":return t.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(s,{width:"short",context:"formatting"});case"eeee":default:return t.day(s,{width:"wide",context:"formatting"})}},c:function(n,e,t,r){let s=n.getDay(),a=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(a);case"cc":return N(a,e.length);case"co":return t.ordinalNumber(a,{unit:"day"});case"ccc":return t.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(s,{width:"narrow",context:"standalone"});case"cccccc":return t.day(s,{width:"short",context:"standalone"});case"cccc":default:return t.day(s,{width:"wide",context:"standalone"})}},i:function(n,e,t){let r=n.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return N(s,e.length);case"io":return t.ordinalNumber(s,{unit:"day"});case"iii":return t.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(r,{width:"short",context:"formatting"});case"iiii":default:return t.day(r,{width:"wide",context:"formatting"})}},a:function(n,e,t){let s=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(n,e,t){let r=n.getHours(),s;switch(r===12?s=Kr.noon:r===0?s=Kr.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(n,e,t){let r=n.getHours(),s;switch(r>=17?s=Kr.evening:r>=12?s=Kr.afternoon:r>=4?s=Kr.morning:s=Kr.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let r=n.getHours()%12;return r===0&&(r=12),t.ordinalNumber(r,{unit:"hour"})}return Ye.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):Ye.H(n,e)},K:function(n,e,t){let r=n.getHours()%12;return e==="Ko"?t.ordinalNumber(r,{unit:"hour"}):N(r,e.length)},k:function(n,e,t){let r=n.getHours();return r===0&&(r=24),e==="ko"?t.ordinalNumber(r,{unit:"hour"}):N(r,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):Ye.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):Ye.s(n,e)},S:function(n,e){return Ye.S(n,e)},X:function(n,e,t){let r=n.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return Co(r);case"XXXX":case"XX":return tr(r);case"XXXXX":case"XXX":default:return tr(r,":")}},x:function(n,e,t){let r=n.getTimezoneOffset();switch(e){case"x":return Co(r);case"xxxx":case"xx":return tr(r);case"xxxxx":case"xxx":default:return tr(r,":")}},O:function(n,e,t){let r=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Ao(r,":");case"OOOO":default:return"GMT"+tr(r,":")}},z:function(n,e,t){let r=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Ao(r,":");case"zzzz":default:return"GMT"+tr(r,":")}},t:function(n,e,t){let r=Math.trunc(+n/1e3);return N(r,e.length)},T:function(n,e,t){return N(+n,e.length)}};function Ao(n,e=""){let t=n>0?"-":"+",r=Math.abs(n),s=Math.trunc(r/60),a=r%60;return a===0?t+String(s):t+String(s)+e+N(a,2)}function Co(n,e){return n%60===0?(n>0?"-":"+")+N(Math.abs(n)/60,2):tr(n,e)}function tr(n,e=""){let t=n>0?"-":"+",r=Math.abs(n),s=N(Math.trunc(r/60),2),a=N(r%60,2);return t+s+e+a}var So=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Ro=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},Eu=(n,e)=>{let t=n.match(/(P+)(p+)?/)||[],r=t[1],s=t[2];if(!s)return So(n,e);let a;switch(r){case"P":a=e.dateTime({width:"short"});break;case"PP":a=e.dateTime({width:"medium"});break;case"PPP":a=e.dateTime({width:"long"});break;case"PPPP":default:a=e.dateTime({width:"full"});break}return a.replace("{{date}}",So(r,e)).replace("{{time}}",Ro(s,e))},Eo={p:Ro,P:Eu};var Iu=/^D+$/,Ou=/^Y+$/,vu=["D","DD","YY","YYYY"];function Io(n){return Iu.test(n)}function Oo(n){return Ou.test(n)}function vo(n,e,t){let r=ku(n,e,t);if(console.warn(r),vu.includes(n))throw new RangeError(r)}function ku(n,e,t){let r=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${r} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}var Mu=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Tu=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Fu=/^'([^]*?)'?$/,$u=/''/g,Nu=/[a-zA-Z]/;function ko(n,e,t){var d,u,m,p,y,C,g,k,w,x,T,h,P,S,O,I,F,D;let r=bt(),s=(u=(d=t==null?void 0:t.locale)!=null?d:r.locale)!=null?u:Da,a=(x=(w=(C=(y=t==null?void 0:t.firstWeekContainsDate)!=null?y:(p=(m=t==null?void 0:t.locale)==null?void 0:m.options)==null?void 0:p.firstWeekContainsDate)!=null?C:r.firstWeekContainsDate)!=null?w:(k=(g=r.locale)==null?void 0:g.options)==null?void 0:k.firstWeekContainsDate)!=null?x:1,i=(D=(F=(S=(P=t==null?void 0:t.weekStartsOn)!=null?P:(h=(T=t==null?void 0:t.locale)==null?void 0:T.options)==null?void 0:h.weekStartsOn)!=null?S:r.weekStartsOn)!=null?F:(I=(O=r.locale)==null?void 0:O.options)==null?void 0:I.weekStartsOn)!=null?D:0,o=H(n,t==null?void 0:t.in);if(!uo(o))throw new RangeError("Invalid time value");let c=e.match(Tu).map(E=>{let W=E[0];if(W==="p"||W==="P"){let ie=Eo[W];return ie(E,s.formatLong)}return E}).join("").match(Mu).map(E=>{if(E==="''")return{isToken:!1,value:"'"};let W=E[0];if(W==="'")return{isToken:!1,value:Du(E)};if(La[W])return{isToken:!0,value:E};if(W.match(Nu))throw new RangeError("Format string contains an unescaped latin alphabet character `"+W+"`");return{isToken:!1,value:E}});s.localize.preprocessor&&(c=s.localize.preprocessor(o,c));let l={firstWeekContainsDate:a,weekStartsOn:i,locale:s};return c.map(E=>{if(!E.isToken)return E.value;let W=E.value;(!(t!=null&&t.useAdditionalWeekYearTokens)&&Oo(W)||!(t!=null&&t.useAdditionalDayOfYearTokens)&&Io(W))&&vo(W,e,String(n));let ie=La[W[0]];return ie(o,W,s.localize,l)}).join("")}function Du(n){let e=n.match(Fu);return e?e[1].replace($u,"'"):n}var j=require("obsidian"),Tn={provider:"anthropic",anthropicApiKey:"",openaiApiKey:"",baseURL:"",maxTokens:1024,anthropicModel:"claude-sonnet-4-5",openaiModel:"gpt-4o",systemPrompt:"You are a helpful AI assistant",temperature:1,chatFolderPath:"CAO/history",streamingResponse:!0,showStats:!0,useCallouts:!1,customPrompts:[{name:"Summarize",template:`Please provide a comprehensive summary of the following content. Include the main points, key takeaways, and important details:

{cursor}`},{name:"Rewrite",template:`Please rewrite the following text to improve clarity, readability, and flow while maintaining the original meaning and tone:

{cursor}`},{name:"Explain like I'm 5",template:"Please explain {cursor} in simple terms that a 5-year-old could understand. Use everyday examples and avoid complex terminology."}]},Is=class extends j.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;t.empty(),new j.Setting(t).setName("Chat folder path").setDesc("Path to store chat history files(relative to vault root)").addText(s=>s.setPlaceholder("CAO/history").setValue(this.plugin.settings.chatFolderPath).onChange(async a=>{a?this.plugin.settings.chatFolderPath=a:this.plugin.settings.chatFolderPath=Tn.chatFolderPath,await this.plugin.saveSettings()})),new j.Setting(t).setName("API Provider").setDesc("Choose between Anthropic (official) or OpenAI-compatible APIs").addDropdown(s=>s.addOption("anthropic","Anthropic (Official)").addOption("openai-compatible","OpenAI Compatible").setValue(this.plugin.settings.provider).onChange(async a=>{this.plugin.settings.provider=a,await this.plugin.saveSettings(),this.display()}));let r=this.plugin.settings.provider==="anthropic";new j.Setting(t).setName(r?"Anthropic API Key":"Provider API Key").setDesc(r?"Enter your Anthropic API key":"Enter your provider's API key (OpenAI, OpenRouter, etc.)").addText(s=>s.setPlaceholder("Enter your API key").setValue(r?this.plugin.settings.anthropicApiKey:this.plugin.settings.openaiApiKey).onChange(async a=>{r?this.plugin.settings.anthropicApiKey=a:this.plugin.settings.openaiApiKey=a,await this.plugin.saveSettings()})),r||new j.Setting(t).setName("Base URL").setDesc("Custom API endpoint (leave empty for default: https://api.openai.com/v1)").addText(s=>s.setPlaceholder("https://api.openai.com/v1").setValue(this.plugin.settings.baseURL).onChange(async a=>{this.plugin.settings.baseURL=a,await this.plugin.saveSettings()})),r?new j.Setting(t).setName("Model").setDesc("Claude model to use").addDropdown(s=>s.addOption("claude-sonnet-4-5","Claude 4.5 Sonnet (latest)").addOption("claude-sonnet-4-0","Claude 4.0 Sonnet (latest)").addOption("claude-haiku-4-5","Claude 4.5 Haiku (latest)").addOption("claude-3-5-haiku-latest","Claude 3.5 Haiku (latest)").addOption("claude-3-haiku-20240307","Claude 3 Haiku (latest)").addOption("claude-opus-4-5","Claude 4.5 Opus (latest)").addOption("claude-opus-4-1","Claude 4.1 Opus (latest)").addOption("claude-opus-4-0","Claude 4.0 Opus (latest)").setValue(this.plugin.settings.anthropicModel).onChange(async a=>{this.plugin.settings.anthropicModel=a,await this.plugin.saveSettings()})):new j.Setting(t).setName("Model").setDesc("Model to use (e.g., gpt-4o for OpenAI, anthropic/claude-haiku-4.5 for OpenRouter, or provider-specific model names)").addText(s=>s.setPlaceholder("gpt-4o").setValue(this.plugin.settings.openaiModel).onChange(async a=>{this.plugin.settings.openaiModel=a,await this.plugin.saveSettings()})),new j.Setting(t).setName("Max tokens").setDesc("Maximum number of tokens in response").addText(s=>s.setPlaceholder("1024").setValue(this.plugin.settings.maxTokens.toFixed(0)).onChange(async a=>{let i=Number(a);i?!isNaN(i)&&i>0?(this.plugin.settings.maxTokens=i,await this.plugin.saveSettings()):new j.Notice("Max tokens should be a positive integer."):(this.plugin.settings.maxTokens=Tn.maxTokens,await this.plugin.saveSettings())})),new j.Setting(t).setName("Temperature").setDesc("Controls randomness in responses(0.0 to 1.0). Lower values make responses more deterministic, while higher values get more creative.").addText(s=>s.setPlaceholder("1.0").setValue(this.plugin.settings.temperature.toFixed(2)).onChange(async a=>{let i=Number(a);i?!isNaN(i)&&i>=0&&i<=1?(this.plugin.settings.temperature=i,await this.plugin.saveSettings()):new j.Notice("Temperature should be a number between 0 and 1."):(this.plugin.settings.temperature=Tn.temperature,await this.plugin.saveSettings())})),new j.Setting(t).setName("System prompt").setDesc("Default system prompt for Claude").addTextArea(s=>s.setPlaceholder("You are a helpful AI assistant").setValue(this.plugin.settings.systemPrompt).onChange(async a=>{this.plugin.settings.systemPrompt=a,await this.plugin.saveSettings()})),new j.Setting(t).setName("Streaming response").setDesc("Stream response content as they're generated").addToggle(s=>s.setValue(this.plugin.settings.streamingResponse).onChange(async a=>{this.plugin.settings.streamingResponse=a,await this.plugin.saveSettings()})),new j.Setting(t).setName("Show stats").setDesc("Show numbers of tokens in responses").addToggle(s=>s.setValue(this.plugin.settings.showStats).onChange(async a=>{this.plugin.settings.showStats=a,await this.plugin.saveSettings()})),new j.Setting(t).setName("Callouts for chat formatting (Experimental)").setDesc("Use callouts instead of headers to format chat messages").addToggle(s=>s.setValue(this.plugin.settings.useCallouts).onChange(async a=>{this.plugin.settings.useCallouts=a,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Custom Prompts"}),t.createEl("p",{text:"Create custom commands for quick prompt insertion. Use {cursor} to mark cursor position."}),this.plugin.settings.customPrompts.forEach((s,a)=>{let i=new j.Setting(t).setName(s.name);i.addButton(o=>o.setIcon("pencil").setTooltip("Edit").onClick(()=>{this.showTemplateEditor(s,a)})),i.addButton(o=>o.setIcon("trash").setTooltip("Delete").setWarning().onClick(async()=>{this.plugin.settings.customPrompts.splice(a,1),await this.plugin.saveSettings(),this.display()}))}),new j.Setting(t).addButton(s=>s.setButtonText("Add Custom Prompt").setCta().onClick(()=>{this.showTemplateEditor()}))}showTemplateEditor(t,r){let s=t!==void 0,a=t||{name:"",template:""};new Ba(this.app,a,async o=>{var l;let c=this.plugin.settings.customPrompts.findIndex(d=>d.name===o.name);if(!s&&c!==-1){new j.Notice("A template with this name already exists!");return}if(s&&c!==-1&&c!==r){new j.Notice("A template with this name already exists!");return}if((l=this.app.commands)!=null&&l.commands&&this.app.commands.commands[o.name]&&(!s||s&&r!==void 0&&this.plugin.settings.customPrompts[r].name!==o.name)){new j.Notice("A command with this name already exists. Please choose a different name.");return}s&&r!==void 0?this.plugin.settings.customPrompts[r]=o:this.plugin.settings.customPrompts.push(o),await this.plugin.saveSettings(),this.display()}).open()}},Ba=class extends j.Modal{constructor(t,r,s){super(t);this.template={...r},this.onSave=s}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Custom Prompt Template"});let r=t.createEl("div");r.style.marginBottom="20px",r.createEl("h3",{text:"Command Name"}),r.createEl("p",{text:"Name for the command (e.g., 'explain' creates 'explain' command)",cls:"setting-item-description"});let s=r.createEl("input",{type:"text"});s.value=this.template.name,s.style.width="100%",s.style.padding="8px",s.style.marginTop="8px",s.addEventListener("input",d=>{let u=d.target;this.template.name=u.value});let a=t.createEl("div");a.style.marginBottom="20px",a.createEl("h3",{text:"Template Content"}),a.createEl("p",{text:"Template content. Use {cursor} to mark where cursor should be placed after insertion.",cls:"setting-item-description"});let i=a.createEl("textarea",{placeholder:"Please explain {cursor} in simple terms for beginners"});i.value=this.template.template,i.style.width="100%",i.style.minHeight="120px",i.style.padding="8px",i.style.marginTop="8px",i.style.fontFamily="var(--font-monospace)",i.style.resize="vertical",i.addEventListener("input",d=>{let u=d.target;this.template.template=u.value});let o=t.createEl("div",{cls:"modal-button-container"});o.style.display="flex",o.style.justifyContent="flex-end",o.style.gap="8px",o.style.marginTop="16px";let c=o.createEl("button",{text:"Save"});c.classList.add("mod-cta"),c.addEventListener("click",()=>{if(!this.template.name.trim()){new j.Notice("Template name is required!");return}if(!this.template.template.trim()){new j.Notice("Template content is required!");return}this.onSave(this.template),this.close()}),o.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:t}=this;t.empty()}};function Lu(n){let e=/\[\[(.*?)\]\]/g;return(n.match(e)||[]).map(r=>r.slice(2,-2).split("|")[0])}async function Bu(n,e){e=e.split("|")[0];let[t,r]=e.split("#"),s=n.metadataCache.getFirstLinkpathDest(t,"");if(!s)return console.warn(`Could not find file: ${t}`),null;let a=await n.vault.read(s);if(!r)return a;let i=n.metadataCache.getFileCache(s);if(i!=null&&i.headings&&!r.startsWith("^")){let o=i.headings.find(c=>c.heading===r);if(o){let c=a.indexOf("#".repeat(o.level)+" "+o.heading);if(c!==-1){let l=a.slice(c),d=new RegExp(`\\n#{1,${o.level}}\\s`,"g");d.lastIndex=1;let u=d.exec(l),m=u?c+u.index:a.length;return a.slice(c,m)}}}if(i!=null&&i.blocks&&r.startsWith("^")){let o=r.slice(1),c=i.blocks[o];if(c){let l=a.split(`
`),d=c.position.start.line,u=c.position.end.line;return l.slice(d,u+1).join(`
`)}}return null}async function Wa(n,e,t=new Set){let r=`User query: ${e}`,s=Lu(e);for(let a of s){if(t.has(a))continue;let i=await Bu(n,a);i&&(r+=`

Context from [[${a}]]:
${i}`,t.add(a))}return r}async function Wu(n,e){let t=e.split(`
`),r=[],s=null,a=[],i=!1,o=new Set;for(let c of t)if(c.startsWith("### Me"))s&&(s.content=a.join(`
`).trim(),r.push(s)),s={role:"user",content:""},a=[],i=!1;else if(c.startsWith("### CAO")){if(s){let l=a.join(`
`).trim();s.content=await Wa(n,l,o),r.push(s)}s={role:"assistant",content:""},a=[],i=!1}else if(c.startsWith("> [!question] Me")||c.startsWith("> [!question]+ Me")){if(s){let l=a.join(`
`).trim();i&&(l=a.map(d=>d.startsWith("> ")?d.slice(2):d).join(`
`).trim()),s.content=l,r.push(s)}s={role:"user",content:""},a=[],i=!0}else if(c.startsWith("> [!success] CAO")||c.startsWith("> [!success]+ CAO")){if(s){let l=a.join(`
`).trim();i&&(l=a.map(d=>d.startsWith("> ")?d.slice(2):d).join(`
`).trim()),s.content=await Wa(n,l,o),r.push(s)}s={role:"assistant",content:""},a=[],i=!0}else a.push(c);if(s){let c=a.join(`
`).trim();i&&(c=a.map(l=>l.startsWith("> ")?l.slice(2):l).join(`
`).trim()),s.content=await Wa(n,c,o),r.push(s)}for(let c=0;c<r.length;c++)if(c%2===0&&r[c].role!=="user"||c%2===1&&r[c].role!=="assistant")return null;return r}async function Mo(n,e,t){let r=ju(e);if(r==="mixed")return{isValid:!1,error:{type:"format",message:"This chat contains mixed formatting (both headers and callouts)."}};if(r==="empty")return{isValid:!1,error:{type:"format",message:"No valid formatting found (headers or callouts)."}};if(r==="headers"&&t)return{isValid:!1,error:{type:"format",message:'This chat uses header format, please disable "Use callouts for chat formatting" in settings to continue.'}};if(r==="callouts"&&!t)return{isValid:!1,error:{type:"format",message:'This chat uses callout format, please enable "Use callouts for chat formatting" in settings to continue.'}};let s=await Wu(n,e);return!s||s.length===0?{isValid:!1,error:{type:"parsing",message:"Invalid chat format, messages should alternate user query and assistant response."}}:s.every(i=>!i.content.slice(12).trim())?{isValid:!1,error:{type:"empty_message",message:"Query message is empty."}}:{isValid:!0,messages:s,format:r}}function ju(n){let e=n.split(`
`),t=!1,r=!1;for(let s of e)if(s.startsWith("### Me")||s.startsWith("### CAO")?t=!0:(s.startsWith("> [!question] Me")||s.startsWith("> [!question]+ Me")||s.startsWith("> [!success] CAO")||s.startsWith("> [!success]+ CAO"))&&(r=!0),t&&r)return"mixed";return t?"headers":r?"callouts":"empty"}function ja(n,e=!1){let t=e?"":`

`;return n?t+`> [!question]+ Me
> `:t+`### Me
`}function Fn(n){return n?`

> [!success]+ CAO
`:`

### CAO
`}function Ua(n){return n.split(`
`).map(e=>e.trim()===""?">":`> ${e}`).join(`
`)}function qa(n,e){if(!n)return{processedChunk:n,newIsStartOfLine:e};let t="",r=e;for(let s=0;s<n.length;s++){let a=n[s];r&&(t+="> "),t+=a,r=a===`
`}return{processedChunk:t,newIsStartOfLine:r}}function Ha(n){let e=n.lastLine();n.setCursor(e,n.getLine(e).length)}async function xe(n,e){let t=n.lastLine(),r={line:t,ch:n.getLine(t).length};n.replaceRange(e,r),n.scrollIntoView({from:r,to:r},!0)}function To(n,e){return n.vault.getMarkdownFiles().filter(t=>t.path.startsWith(e+"/")&&t.extension==="md")}function Fo(n){return n.sort((e,t)=>t.stat.mtime-e.stat.mtime)}function $o(n){return n.replace(/\.md$/,"")}var vs=require("obsidian");var Os=class extends vs.SuggestModal{constructor(t,r,s){super(t);this.chatFolderPath=r,this.onSelect=s,this.setPlaceholder("Type to search chat files...")}getSuggestions(t){let r=To(this.app,this.chatFolderPath),a=Fo(r).map(i=>({file:i,displayName:$o(i.basename)}));return t?a.filter(i=>i.displayName.toLowerCase().includes(t.toLowerCase())):a}renderSuggestion(t,r){let{displayName:s,file:a}=t;r.createEl("div",{text:s,cls:"suggestion-main-text"});let i=new Date(a.stat.mtime).toLocaleString();r.createEl("div",{text:`Last modified: ${i}`,cls:"suggestion-aux"})}onChooseSuggestion(t,r){this.onSelect(t.file)}onOpen(){super.onOpen(),this.getSuggestions("").length===0&&(this.close(),new vs.Notice("No chats yet, try open a new chat"))}};var ks=class extends te.Plugin{constructor(){super(...arguments);this.anthropic=null;this.openai=null;this.promptCommands=new Set}initializeAnthropicClient(){this.settings.provider==="anthropic"?(this.anthropic=new di({apiKey:this.settings.anthropicApiKey,dangerouslyAllowBrowser:!0}),this.openai=null):(this.openai=new no({apiKey:this.settings.openaiApiKey,baseURL:this.settings.baseURL||"https://api.openai.com/v1",dangerouslyAllowBrowser:!0}),this.anthropic=null)}async onload(){await this.loadSettings(),this.initializeAnthropicClient(),this.addSettingTab(new Is(this.app,this)),this.addCommand({id:"open-new-chat",name:"Open new chat",callback:async()=>{let r=`Chat ${ko(new Date,"yyyy-MM-dd HH-mm-ss")}.md`,s=this.settings.chatFolderPath;await this.app.vault.adapter.exists(s)||await this.app.vault.createFolder(s);let a=`${s}/${r}`,i=await this.app.vault.create(a,ja(this.settings.useCallouts,!0)),o=this.app.workspace.getLeaf(!1);await o.openFile(i);let c=o.view;c instanceof te.MarkdownView&&Ha(c.editor)}}),this.addCommand({id:"open-last-chat",name:"Open last chat",callback:async()=>{let t=this.settings.chatFolderPath;if(!await this.app.vault.adapter.exists(t)){new te.Notice("CAO folder not found");return}let r=this.app.vault.getMarkdownFiles().filter(a=>a.path.startsWith(t+"/")).sort((a,i)=>i.stat.mtime-a.stat.mtime);if(r.length===0){new te.Notice("No chats yet");return}await this.app.workspace.getLeaf(!1).openFile(r[0])}}),this.addCommand({id:"select-chat",name:"Select chat",callback:async()=>{let t=this.settings.chatFolderPath;if(!await this.app.vault.adapter.exists(t)){new te.Notice("CAO folder not found");return}new Os(this.app,t,async s=>{await this.app.workspace.getLeaf(!1).openFile(s)}).open()}}),this.addCommand({id:"get-response",name:"Get response",editorCallback:async(t,r)=>{var y,C,g,k,w;if(!(this.settings.provider==="anthropic"?this.settings.anthropicApiKey:this.settings.openaiApiKey)){new te.Notice("Please set your API key first.");return}let a=t.getValue(),i=await Mo(this.app,a,this.settings.useCallouts);if(!i.isValid){new te.Notice(i.error.message,8e3);return}let o=i.messages,c=this.settings.provider==="anthropic"?this.settings.anthropicModel:this.settings.openaiModel,l=this.settings.maxTokens,d=this.settings.temperature,u=this.settings.systemPrompt,m=r.file;m&&await this.app.fileManager.processFrontMatter(m,x=>{"model"in x&&(c=x.model),"max_tokens"in x&&(l=x.max_tokens),"temperature"in x&&(d=x.temperature),"system_prompt"in x&&(u=x.system_prompt)});let p=0;if(this.settings.provider==="anthropic"){let x=o.map(h=>({role:h.role==="user"?"user":"assistant",content:h.content})),T={model:c,max_tokens:l,temperature:d,system:u,messages:x};try{if(this.settings.streamingResponse){await xe(t,Fn(this.settings.useCallouts));let h=this.anthropic.messages.stream(T),P=!0;for await(let S of h){if(S.type==="content_block_delta"&&"text"in S.delta)if(this.settings.useCallouts){let{processedChunk:O,newIsStartOfLine:I}=qa(S.delta.text,P);await xe(t,O),P=I}else await xe(t,S.delta.text);S.type==="message_delta"&&(p=((y=S.usage)==null?void 0:y.output_tokens)||0)}}else{let h=await this.anthropic.messages.create(T);if(!h||!h.content){new te.Notice("No response received, try again later");return}p=((C=h.usage)==null?void 0:C.output_tokens)||0;let P=h.content.map(I=>I.text).join(""),S=this.settings.useCallouts?Ua(P):P,O=Fn(this.settings.useCallouts)+S;await xe(t,O)}}catch(h){let P="Failed to get response from Anthropic: ";h.status===401?P+="Invalid API key. Please check your Anthropic API key in settings.":h.status===404?P+=`Model "${c}" not found. Please verify the model name in settings.`:h.status===429?P+="Rate limit exceeded. Please try again later.":h.message?P+=h.message:P+="Unknown error occurred.",new te.Notice(P,8e3),console.error("Anthropic API error:",h);return}}else{let x=[{role:"system",content:u},...o.map(h=>({role:h.role==="user"?"user":"assistant",content:h.content}))],T={model:c,max_tokens:l,temperature:d,messages:x};try{if(this.settings.streamingResponse){await xe(t,Fn(this.settings.useCallouts));let h=await this.openai.chat.completions.create({...T,stream:!0,stream_options:{include_usage:!0}}),P=!0;for await(let S of h){let O=(k=(g=S.choices[0])==null?void 0:g.delta)==null?void 0:k.content;if(O)if(this.settings.useCallouts){let{processedChunk:I,newIsStartOfLine:F}=qa(O,P);await xe(t,I),P=F}else await xe(t,O);S.usage&&(p=S.usage.completion_tokens||0)}}else{let h=await this.openai.chat.completions.create(T);if(!h||!h.choices||h.choices.length===0){new te.Notice("No response received, try again later");return}p=((w=h.usage)==null?void 0:w.completion_tokens)||0;let P=h.choices[0].message.content||"",S=this.settings.useCallouts?Ua(P):P,O=Fn(this.settings.useCallouts)+S;await xe(t,O)}}catch(h){let P="Failed to get response: ";h.status===401?P+="Invalid API key. Please check your provider API key in settings.":h.status===404?P+=`Model "${c}" not found. Please verify the base URL or the model name in settings.`:h.status===429?P+="Rate limit exceeded. Please try again later.":h.message?P+=h.message:P+="Unknown error occurred.",new te.Notice(P,8e3),console.error("OpenAI-compatible API error:",h);return}}if(this.settings.showStats){let x=this.settings.useCallouts?`
> (${p} tokens)`:`
(${p} tokens)`;await xe(t,x)}await xe(t,ja(this.settings.useCallouts)),Ha(t)}}),this.addCommand({id:"add-chat-options",name:"Add/Reset chat options in frontmatter",editorCallback:async(t,r)=>{let s=r.file;if(!s){new te.Notice("Please open a chat first.");return}await this.app.fileManager.processFrontMatter(s,a=>{let i=this.settings.provider==="anthropic"?this.settings.anthropicModel:this.settings.openaiModel;a.model=i,a.max_tokens=this.settings.maxTokens,a.temperature=this.settings.temperature,a.system_prompt=this.settings.systemPrompt})}}),this.registerPromptCommands(this.settings.customPrompts)}registerPromptCommands(t){t.forEach(r=>{this.addCommand({id:r.name,name:r.name,editorCallback:(s,a)=>{this.insertTemplate(s,r)}}),this.promptCommands.add(r.name)})}updatePromptCommands(t){let r=new Set(t.map(s=>s.name));this.promptCommands.forEach(s=>{r.has(s)||(this.removeCommand(s),this.promptCommands.delete(s))}),t.forEach(s=>{this.promptCommands.has(s.name)||(this.addCommand({id:s.name,name:s.name,editorCallback:(a,i)=>{this.insertTemplate(a,s)}}),this.promptCommands.add(s.name))})}insertTemplate(t,r){let s=t.getCursor(),a=r.template;this.positionCursorInTemplate(t,s,a)}positionCursorInTemplate(t,r,s){let a="{cursor}",i=s.indexOf(a);if(i!==-1){let c=s.substring(0,i).split(`
`),l=r.line+c.length-1,d=c.length===1?r.ch+c[0].length:c[c.length-1].length,u=s.replace(a,"");t.replaceRange(u,r),t.setCursor(l,d)}else{t.replaceRange(s,r);let o=s.split(`
`),c=r.line+o.length-1,l=o.length===1?r.ch+o[0].length:o[o.length-1].length;t.setCursor(c,l)}}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},Tn,t);let r=!1;t!=null&&t.apiKey&&!(t!=null&&t.anthropicApiKey)&&(this.settings.anthropicApiKey=t.apiKey,this.settings.provider="anthropic",r=!0),t!=null&&t.model&&!(t!=null&&t.anthropicModel)&&(this.settings.anthropicModel=t.model,r=!0),r&&await this.saveSettings()}async saveSettings(){await this.saveData(this.settings),this.initializeAnthropicClient(),this.updatePromptCommands(this.settings.customPrompts)}};

/* nosourcemap */